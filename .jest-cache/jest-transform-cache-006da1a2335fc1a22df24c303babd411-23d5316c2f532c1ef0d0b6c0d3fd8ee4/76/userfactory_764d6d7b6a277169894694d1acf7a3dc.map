{"version":3,"sources":["/Users/stefanbekker/projects/fancy-planties/src/test-utils/factories/user-factory.js"],"sourcesContent":["// User test data factory\n\n// Simple random string generator for tests (avoiding oslo dependency issues)\nconst generateRandomString = (length, alphabet = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ') => {\n  let result = '';\n  for (let i = 0; i < length; i++) {\n    result += alphabet.charAt(Math.floor(Math.random() * alphabet.length));\n  }\n  return result;\n};\nimport bcrypt from 'bcryptjs';\n\n// Counter for unique test data\nlet userCounter = 0;\n\n/**\n * Creates a test user object with realistic data\n * @param {Object} overrides - Properties to override in the generated user\n * @returns {Object} Test user object\n */\nexport const createTestUser = (overrides = {}) => {\n  userCounter++;\n  const timestamp = Date.now();\n  const randomSuffix = Math.floor(Math.random() * 10000);\n  \n  const baseUser = {\n    // Remove id - let database auto-generate it\n    email: `testuser${userCounter}_${timestamp}_${randomSuffix}@example.com`,\n    name: `Test User ${userCounter}`,\n    hashedPassword: '$2a$12$LQv3c1yqBWVHxkd0LHAkCOYz6TtxMQJqhN8/LewdBPj/RQ/dQ5YQm', // 'password123'\n    isCurator: false,\n    isEmailVerified: true,\n    createdAt: new Date(),\n    updatedAt: new Date(),\n  };\n  \n  return {\n    ...baseUser,\n    ...overrides,\n  };\n};\n\n/**\n * Creates a test user with admin/curator privileges\n * @param {Object} overrides - Properties to override\n * @returns {Object} Test curator user object\n */\nexport const createTestCurator = (overrides = {}) => {\n  return createTestUser({\n    isCurator: true,\n    name: `Test Curator ${userCounter + 1}`,\n    ...overrides,\n  });\n};\n\n/**\n * Creates a test user with unverified email\n * @param {Object} overrides - Properties to override\n * @returns {Object} Test unverified user object\n */\nexport const createTestUnverifiedUser = (overrides = {}) => {\n  return createTestUser({\n    isEmailVerified: false,\n    name: `Test Unverified User ${userCounter + 1}`,\n    ...overrides,\n  });\n};\n\n/**\n * Creates multiple test users\n * @param {number} count - Number of users to create\n * @param {Object} baseOverrides - Base properties to apply to all users\n * @returns {Array} Array of test user objects\n */\nexport const createTestUsers = (count = 3, baseOverrides = {}) => {\n  return Array.from({ length: count }, (_, index) => \n    createTestUser({\n      ...baseOverrides,\n      name: `Test User ${userCounter + index + 1}`,\n    })\n  );\n};\n\n/**\n * Creates a test session object for a user\n * @param {Object} user - User object to create session for\n * @param {Object} overrides - Properties to override\n * @returns {Object} Test session object\n */\nexport const createTestSession = (user, overrides = {}) => {\n  const sessionId = generateRandomString(40, '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ');\n  const expiresAt = new Date(Date.now() + 1000 * 60 * 60 * 24 * 30); // 30 days\n  \n  return {\n    id: sessionId,\n    userId: user.id,\n    expiresAt,\n    ...overrides,\n  };\n};\n\n/**\n * Creates an authenticated test user with session\n * @param {Object} userOverrides - Properties to override for user\n * @param {Object} sessionOverrides - Properties to override for session\n * @returns {Object} Object with user and session properties\n */\nexport const createAuthenticatedTestUser = (userOverrides = {}, sessionOverrides = {}) => {\n  const user = createTestUser(userOverrides);\n  const session = createTestSession(user, sessionOverrides);\n  \n  return { user, session };\n};\n\n/**\n * Creates test email verification code\n * @param {Object} user - User object to create verification code for\n * @param {Object} overrides - Properties to override\n * @returns {Object} Test email verification code object\n */\nexport const createTestEmailVerificationCode = (user, overrides = {}) => {\n  return {\n    id: Math.floor(Math.random() * 10000),\n    userId: user.id,\n    code: generateRandomString(6, '0123456789'),\n    expiresAt: new Date(Date.now() + 1000 * 60 * 15), // 15 minutes\n    createdAt: new Date(),\n    attemptsUsed: 0,\n    ...overrides,\n  };\n};\n\n/**\n * Hashes a password for testing (synchronous version for test setup)\n * @param {string} password - Plain text password\n * @returns {string} Hashed password\n */\nexport const hashTestPassword = (password) => {\n  return bcrypt.hashSync(password, 12);\n};\n\n/**\n * Creates a test user with a specific password\n * @param {string} password - Plain text password\n * @param {Object} overrides - Properties to override\n * @returns {Object} Test user with hashed password\n */\nexport const createTestUserWithPassword = (password, overrides = {}) => {\n  return createTestUser({\n    hashedPassword: hashTestPassword(password),\n    ...overrides,\n  });\n};\n\n/**\n * Reset the user counter (useful for test isolation)\n */\nexport const resetUserCounter = () => {\n  userCounter = 0;\n};"],"names":["createAuthenticatedTestUser","createTestCurator","createTestEmailVerificationCode","createTestSession","createTestUnverifiedUser","createTestUser","createTestUserWithPassword","createTestUsers","hashTestPassword","resetUserCounter","generateRandomString","length","alphabet","result","i","charAt","Math","floor","random","userCounter","overrides","timestamp","Date","now","randomSuffix","baseUser","email","name","hashedPassword","isCurator","isEmailVerified","createdAt","updatedAt","count","baseOverrides","Array","from","_","index","user","sessionId","expiresAt","id","userId","userOverrides","sessionOverrides","session","code","attemptsUsed","password","bcrypt","hashSync"],"mappings":"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"}