{"version":3,"names":["cov_2qk2v8jqrg","actualCoverage","s","POST","syncRequestSchema","_zod","z","object","pendingEntries","array","id","string","plantInstanceId","number","careType","enum","notes","optional","timestamp","request","f","user","_server1","validateRequest","b","_server","NextResponse","json","error","status","body","parse","results","_offlineservice","OfflineService","processPendingCareEntries","success","syncedCount","filter","r","length","failedCount","ZodError","details","issues","console"],"sources":["/Users/stefanbekker/projects/fancy-planties/src/app/api/offline/sync/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { validateRequest } from '@/lib/auth/server';\nimport { OfflineService } from '@/lib/services/offline-service';\nimport { z } from 'zod';\n\nconst syncRequestSchema = z.object({\n  pendingEntries: z.array(z.object({\n    id: z.string(),\n    plantInstanceId: z.number(),\n    careType: z.enum(['fertilizer', 'repot', 'water', 'prune', 'inspect', 'other']),\n    notes: z.string().optional(),\n    timestamp: z.string(),\n  })),\n});\n\n/**\n * POST /api/offline/sync\n * Sync pending offline entries when back online\n */\nexport async function POST(request: NextRequest) {\n  try {\n    const { user } = await validateRequest();\n    if (!user) {\n      return NextResponse.json(\n        { error: 'Unauthorized' },\n        { status: 401 }\n      );\n    }\n\n    const body = await request.json();\n    const { pendingEntries } = syncRequestSchema.parse(body);\n\n    const results = await OfflineService.processPendingCareEntries(user.id, pendingEntries);\n    \n    return NextResponse.json({\n      success: true,\n      results,\n      syncedCount: results.filter(r => r.success).length,\n      failedCount: results.filter(r => !r.success).length,\n    });\n  } catch (error) {\n    if (error instanceof z.ZodError) {\n      return NextResponse.json(\n        { error: 'Invalid request data', details: error.issues },\n        { status: 400 }\n      );\n    }\n\n    console.error('Error syncing offline data:', error);\n    return NextResponse.json(\n      { error: 'Failed to sync offline data' },\n      { status: 500 }\n    );\n  }\n}"],"mappings":"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","ignoreList":[]}