894ea4f9c90e957fa98d831efed0175e
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: Object.getOwnPropertyDescriptor(all, name).get
    });
}
_export(exports, {
    get EmailVerificationCodeService () {
        return EmailVerificationCodeService;
    },
    get VerificationCodeError () {
        return VerificationCodeError;
    },
    get VerificationError () {
        return VerificationError;
    },
    get emailVerificationCodeService () {
        return emailVerificationCodeService;
    }
});
require("server-only");
const _db = require("../db");
const _schema = require("../db/schema");
const _drizzleorm = require("drizzle-orm");
const _crypto = require("crypto");
var VerificationError = /*#__PURE__*/ function(VerificationError) {
    VerificationError["CODE_EXPIRED"] = "CODE_EXPIRED";
    VerificationError["CODE_INVALID"] = "CODE_INVALID";
    VerificationError["TOO_MANY_ATTEMPTS"] = "TOO_MANY_ATTEMPTS";
    VerificationError["USER_NOT_FOUND"] = "USER_NOT_FOUND";
    VerificationError["ALREADY_VERIFIED"] = "ALREADY_VERIFIED";
    return VerificationError;
}({});
class VerificationCodeError extends Error {
    constructor(message, code){
        super(message), this.code = code;
        this.name = 'VerificationCodeError';
    }
}
class EmailVerificationCodeService {
    static{
        this.CODE_LENGTH = 6;
    }
    static{
        this.EXPIRY_MINUTES = 10;
    }
    static{
        this.MAX_ATTEMPTS = 5;
    }
    /**
   * Generate a cryptographically secure 6-digit verification code
   */ generateSecureCode() {
        // Generate random bytes and convert to 6-digit number
        const buffer = (0, _crypto.randomBytes)(4);
        const randomNumber = buffer.readUInt32BE(0);
        // Ensure it's always 6 digits by using modulo and padding
        const code = (randomNumber % 1000000).toString().padStart(6, '0');
        return code;
    }
    /**
   * Generate and store a new verification code for a user
   * Invalidates any existing codes for the user
   */ async generateCode(userId) {
        // First, delete any existing codes for this user
        await this.deleteUserCodes(userId);
        // Generate new code
        const code = this.generateSecureCode();
        const expiresAt = new Date(Date.now() + EmailVerificationCodeService.EXPIRY_MINUTES * 60 * 1000);
        // Store in database
        await _db.db.insert(_schema.emailVerificationCodes).values({
            userId,
            code,
            expiresAt,
            attemptsUsed: 0
        });
        return code;
    }
    /**
   * Validate a verification code for a user
   * Returns true if valid, throws VerificationCodeError if invalid
   */ async validateCode(email, code) {
        // Find user by email
        const userResult = await _db.db.select({
            id: _schema.users.id,
            isEmailVerified: _schema.users.isEmailVerified
        }).from(_schema.users).where((0, _drizzleorm.eq)(_schema.users.email, email)).limit(1);
        if (userResult.length === 0) {
            throw new VerificationCodeError('User not found', "USER_NOT_FOUND");
        }
        const user = userResult[0];
        // Check if user is already verified
        if (user.isEmailVerified) {
            throw new VerificationCodeError('Email already verified', "ALREADY_VERIFIED");
        }
        // Find the verification code
        const codeResult = await _db.db.select().from(_schema.emailVerificationCodes).where((0, _drizzleorm.and)((0, _drizzleorm.eq)(_schema.emailVerificationCodes.userId, user.id), (0, _drizzleorm.eq)(_schema.emailVerificationCodes.code, code))).limit(1);
        if (codeResult.length === 0) {
            throw new VerificationCodeError('Invalid verification code', "CODE_INVALID");
        }
        const verificationCode = codeResult[0];
        // Check if code has expired
        if (new Date() > verificationCode.expiresAt) {
            // Clean up expired code
            await _db.db.delete(_schema.emailVerificationCodes).where((0, _drizzleorm.eq)(_schema.emailVerificationCodes.id, verificationCode.id));
            throw new VerificationCodeError('Verification code has expired', "CODE_EXPIRED");
        }
        // Check if too many attempts have been made
        if (verificationCode.attemptsUsed >= EmailVerificationCodeService.MAX_ATTEMPTS) {
            // Invalidate the code
            await _db.db.delete(_schema.emailVerificationCodes).where((0, _drizzleorm.eq)(_schema.emailVerificationCodes.id, verificationCode.id));
            throw new VerificationCodeError('Too many verification attempts', "TOO_MANY_ATTEMPTS");
        }
        // Code is valid - mark user as verified and delete the code
        await _db.db.transaction(async (tx)=>{
            // Update user verification status
            await tx.update(_schema.users).set({
                isEmailVerified: true
            }).where((0, _drizzleorm.eq)(_schema.users.id, user.id));
            // Delete the verification code
            await tx.delete(_schema.emailVerificationCodes).where((0, _drizzleorm.eq)(_schema.emailVerificationCodes.id, verificationCode.id));
        });
        return true;
    }
    /**
   * Increment the attempt count for a verification code
   * Used when validation fails but we want to track attempts
   */ async incrementAttempts(email, code) {
        // Find user by email
        const userResult = await _db.db.select({
            id: _schema.users.id
        }).from(_schema.users).where((0, _drizzleorm.eq)(_schema.users.email, email)).limit(1);
        if (userResult.length === 0) {
            return; // User not found, nothing to increment
        }
        const user = userResult[0];
        // Find and increment attempts for the code
        const codeResult = await _db.db.select({
            id: _schema.emailVerificationCodes.id,
            attemptsUsed: _schema.emailVerificationCodes.attemptsUsed
        }).from(_schema.emailVerificationCodes).where((0, _drizzleorm.and)((0, _drizzleorm.eq)(_schema.emailVerificationCodes.userId, user.id), (0, _drizzleorm.eq)(_schema.emailVerificationCodes.code, code))).limit(1);
        if (codeResult.length > 0) {
            const verificationCode = codeResult[0];
            await _db.db.update(_schema.emailVerificationCodes).set({
                attemptsUsed: verificationCode.attemptsUsed + 1
            }).where((0, _drizzleorm.eq)(_schema.emailVerificationCodes.id, verificationCode.id));
        }
    }
    /**
   * Clean up expired verification codes
   * Should be called periodically by a cleanup job
   */ async cleanupExpiredCodes() {
        const now = new Date();
        // First count the expired codes
        const expiredCodes = await _db.db.select({
            id: _schema.emailVerificationCodes.id
        }).from(_schema.emailVerificationCodes).where((0, _drizzleorm.lt)(_schema.emailVerificationCodes.expiresAt, now));
        const count = expiredCodes.length;
        // Then delete them if any exist
        if (count > 0) {
            await _db.db.delete(_schema.emailVerificationCodes).where((0, _drizzleorm.lt)(_schema.emailVerificationCodes.expiresAt, now));
        }
        return count;
    }
    /**
   * Delete all verification codes for a specific user
   * Used when generating new codes or when user is deleted
   */ async deleteUserCodes(userId) {
        await _db.db.delete(_schema.emailVerificationCodes).where((0, _drizzleorm.eq)(_schema.emailVerificationCodes.userId, userId));
    }
    /**
   * Get active verification code for a user (for testing/debugging)
   */ async getUserActiveCode(userId) {
        const now = new Date();
        const result = await _db.db.select().from(_schema.emailVerificationCodes).where((0, _drizzleorm.and)((0, _drizzleorm.eq)(_schema.emailVerificationCodes.userId, userId), (0, _drizzleorm.gt)(_schema.emailVerificationCodes.expiresAt, now) // Not expired
        )).limit(1);
        return result.length > 0 ? result[0] : null;
    }
    /**
   * Check if a user has any active verification codes
   */ async hasActiveCode(userId) {
        const code = await this.getUserActiveCode(userId);
        return code !== null;
    }
    /**
   * Get verification code statistics for monitoring
   */ async getCodeStats() {
        const now = new Date();
        // Count active codes
        const activeResult = await _db.db.select({
            id: _schema.emailVerificationCodes.id
        }).from(_schema.emailVerificationCodes).where((0, _drizzleorm.gt)(_schema.emailVerificationCodes.expiresAt, now));
        // Count expired codes
        const expiredResult = await _db.db.select({
            id: _schema.emailVerificationCodes.id
        }).from(_schema.emailVerificationCodes).where((0, _drizzleorm.lt)(_schema.emailVerificationCodes.expiresAt, now));
        // Count codes with high attempts (4 or more)
        const highAttemptResult = await _db.db.select({
            id: _schema.emailVerificationCodes.id
        }).from(_schema.emailVerificationCodes).where((0, _drizzleorm.and)((0, _drizzleorm.gt)(_schema.emailVerificationCodes.expiresAt, now), (0, _drizzleorm.eq)(_schema.emailVerificationCodes.attemptsUsed, 4) // Close to max attempts
        ));
        return {
            totalActive: activeResult.length,
            expiredCount: expiredResult.length,
            highAttemptCount: highAttemptResult.length
        };
    }
}
const emailVerificationCodeService = new EmailVerificationCodeService();

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9zdGVmYW5iZWtrZXIvcHJvamVjdHMvZmFuY3ktcGxhbnRpZXMvc3JjL2xpYi9zZXJ2aWNlcy9lbWFpbC12ZXJpZmljYXRpb24tY29kZS1zZXJ2aWNlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAnc2VydmVyLW9ubHknO1xuaW1wb3J0IHsgZGIgfSBmcm9tICdAL2xpYi9kYic7XG5pbXBvcnQgeyBlbWFpbFZlcmlmaWNhdGlvbkNvZGVzLCB1c2VycyB9IGZyb20gJ0AvbGliL2RiL3NjaGVtYSc7XG5pbXBvcnQgeyBlcSwgYW5kLCBsdCwgZ3QgfSBmcm9tICdkcml6emxlLW9ybSc7XG5pbXBvcnQgeyByYW5kb21CeXRlcyB9IGZyb20gJ2NyeXB0byc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgRW1haWxWZXJpZmljYXRpb25Db2RlIHtcbiAgaWQ6IG51bWJlcjtcbiAgdXNlcklkOiBudW1iZXI7XG4gIGNvZGU6IHN0cmluZztcbiAgZXhwaXJlc0F0OiBEYXRlO1xuICBjcmVhdGVkQXQ6IERhdGU7XG4gIGF0dGVtcHRzVXNlZDogbnVtYmVyO1xufVxuXG5leHBvcnQgZW51bSBWZXJpZmljYXRpb25FcnJvciB7XG4gIENPREVfRVhQSVJFRCA9ICdDT0RFX0VYUElSRUQnLFxuICBDT0RFX0lOVkFMSUQgPSAnQ09ERV9JTlZBTElEJyxcbiAgVE9PX01BTllfQVRURU1QVFMgPSAnVE9PX01BTllfQVRURU1QVFMnLFxuICBVU0VSX05PVF9GT1VORCA9ICdVU0VSX05PVF9GT1VORCcsXG4gIEFMUkVBRFlfVkVSSUZJRUQgPSAnQUxSRUFEWV9WRVJJRklFRCdcbn1cblxuZXhwb3J0IGNsYXNzIFZlcmlmaWNhdGlvbkNvZGVFcnJvciBleHRlbmRzIEVycm9yIHtcbiAgY29uc3RydWN0b3IoXG4gICAgbWVzc2FnZTogc3RyaW5nLFxuICAgIHB1YmxpYyBjb2RlOiBWZXJpZmljYXRpb25FcnJvclxuICApIHtcbiAgICBzdXBlcihtZXNzYWdlKTtcbiAgICB0aGlzLm5hbWUgPSAnVmVyaWZpY2F0aW9uQ29kZUVycm9yJztcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgRW1haWxWZXJpZmljYXRpb25Db2RlU2VydmljZSB7XG4gIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5IENPREVfTEVOR1RIID0gNjtcbiAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgRVhQSVJZX01JTlVURVMgPSAxMDtcbiAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgTUFYX0FUVEVNUFRTID0gNTtcblxuICAvKipcbiAgICogR2VuZXJhdGUgYSBjcnlwdG9ncmFwaGljYWxseSBzZWN1cmUgNi1kaWdpdCB2ZXJpZmljYXRpb24gY29kZVxuICAgKi9cbiAgcHJpdmF0ZSBnZW5lcmF0ZVNlY3VyZUNvZGUoKTogc3RyaW5nIHtcbiAgICAvLyBHZW5lcmF0ZSByYW5kb20gYnl0ZXMgYW5kIGNvbnZlcnQgdG8gNi1kaWdpdCBudW1iZXJcbiAgICBjb25zdCBidWZmZXIgPSByYW5kb21CeXRlcyg0KTtcbiAgICBjb25zdCByYW5kb21OdW1iZXIgPSBidWZmZXIucmVhZFVJbnQzMkJFKDApO1xuICAgIC8vIEVuc3VyZSBpdCdzIGFsd2F5cyA2IGRpZ2l0cyBieSB1c2luZyBtb2R1bG8gYW5kIHBhZGRpbmdcbiAgICBjb25zdCBjb2RlID0gKHJhbmRvbU51bWJlciAlIDEwMDAwMDApLnRvU3RyaW5nKCkucGFkU3RhcnQoNiwgJzAnKTtcbiAgICByZXR1cm4gY29kZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZW5lcmF0ZSBhbmQgc3RvcmUgYSBuZXcgdmVyaWZpY2F0aW9uIGNvZGUgZm9yIGEgdXNlclxuICAgKiBJbnZhbGlkYXRlcyBhbnkgZXhpc3RpbmcgY29kZXMgZm9yIHRoZSB1c2VyXG4gICAqL1xuICBhc3luYyBnZW5lcmF0ZUNvZGUodXNlcklkOiBudW1iZXIpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIC8vIEZpcnN0LCBkZWxldGUgYW55IGV4aXN0aW5nIGNvZGVzIGZvciB0aGlzIHVzZXJcbiAgICBhd2FpdCB0aGlzLmRlbGV0ZVVzZXJDb2Rlcyh1c2VySWQpO1xuXG4gICAgLy8gR2VuZXJhdGUgbmV3IGNvZGVcbiAgICBjb25zdCBjb2RlID0gdGhpcy5nZW5lcmF0ZVNlY3VyZUNvZGUoKTtcbiAgICBjb25zdCBleHBpcmVzQXQgPSBuZXcgRGF0ZShEYXRlLm5vdygpICsgRW1haWxWZXJpZmljYXRpb25Db2RlU2VydmljZS5FWFBJUllfTUlOVVRFUyAqIDYwICogMTAwMCk7XG5cbiAgICAvLyBTdG9yZSBpbiBkYXRhYmFzZVxuICAgIGF3YWl0IGRiLmluc2VydChlbWFpbFZlcmlmaWNhdGlvbkNvZGVzKS52YWx1ZXMoe1xuICAgICAgdXNlcklkLFxuICAgICAgY29kZSxcbiAgICAgIGV4cGlyZXNBdCxcbiAgICAgIGF0dGVtcHRzVXNlZDogMCxcbiAgICB9KTtcblxuICAgIHJldHVybiBjb2RlO1xuICB9XG5cbiAgLyoqXG4gICAqIFZhbGlkYXRlIGEgdmVyaWZpY2F0aW9uIGNvZGUgZm9yIGEgdXNlclxuICAgKiBSZXR1cm5zIHRydWUgaWYgdmFsaWQsIHRocm93cyBWZXJpZmljYXRpb25Db2RlRXJyb3IgaWYgaW52YWxpZFxuICAgKi9cbiAgYXN5bmMgdmFsaWRhdGVDb2RlKGVtYWlsOiBzdHJpbmcsIGNvZGU6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIC8vIEZpbmQgdXNlciBieSBlbWFpbFxuICAgIGNvbnN0IHVzZXJSZXN1bHQgPSBhd2FpdCBkYlxuICAgICAgLnNlbGVjdCh7IGlkOiB1c2Vycy5pZCwgaXNFbWFpbFZlcmlmaWVkOiB1c2Vycy5pc0VtYWlsVmVyaWZpZWQgfSlcbiAgICAgIC5mcm9tKHVzZXJzKVxuICAgICAgLndoZXJlKGVxKHVzZXJzLmVtYWlsLCBlbWFpbCkpXG4gICAgICAubGltaXQoMSk7XG5cbiAgICBpZiAodXNlclJlc3VsdC5sZW5ndGggPT09IDApIHtcbiAgICAgIHRocm93IG5ldyBWZXJpZmljYXRpb25Db2RlRXJyb3IoJ1VzZXIgbm90IGZvdW5kJywgVmVyaWZpY2F0aW9uRXJyb3IuVVNFUl9OT1RfRk9VTkQpO1xuICAgIH1cblxuICAgIGNvbnN0IHVzZXIgPSB1c2VyUmVzdWx0WzBdO1xuXG4gICAgLy8gQ2hlY2sgaWYgdXNlciBpcyBhbHJlYWR5IHZlcmlmaWVkXG4gICAgaWYgKHVzZXIuaXNFbWFpbFZlcmlmaWVkKSB7XG4gICAgICB0aHJvdyBuZXcgVmVyaWZpY2F0aW9uQ29kZUVycm9yKCdFbWFpbCBhbHJlYWR5IHZlcmlmaWVkJywgVmVyaWZpY2F0aW9uRXJyb3IuQUxSRUFEWV9WRVJJRklFRCk7XG4gICAgfVxuXG4gICAgLy8gRmluZCB0aGUgdmVyaWZpY2F0aW9uIGNvZGVcbiAgICBjb25zdCBjb2RlUmVzdWx0ID0gYXdhaXQgZGJcbiAgICAgIC5zZWxlY3QoKVxuICAgICAgLmZyb20oZW1haWxWZXJpZmljYXRpb25Db2RlcylcbiAgICAgIC53aGVyZShcbiAgICAgICAgYW5kKFxuICAgICAgICAgIGVxKGVtYWlsVmVyaWZpY2F0aW9uQ29kZXMudXNlcklkLCB1c2VyLmlkKSxcbiAgICAgICAgICBlcShlbWFpbFZlcmlmaWNhdGlvbkNvZGVzLmNvZGUsIGNvZGUpXG4gICAgICAgIClcbiAgICAgIClcbiAgICAgIC5saW1pdCgxKTtcblxuICAgIGlmIChjb2RlUmVzdWx0Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgdGhyb3cgbmV3IFZlcmlmaWNhdGlvbkNvZGVFcnJvcignSW52YWxpZCB2ZXJpZmljYXRpb24gY29kZScsIFZlcmlmaWNhdGlvbkVycm9yLkNPREVfSU5WQUxJRCk7XG4gICAgfVxuXG4gICAgY29uc3QgdmVyaWZpY2F0aW9uQ29kZSA9IGNvZGVSZXN1bHRbMF07XG5cbiAgICAvLyBDaGVjayBpZiBjb2RlIGhhcyBleHBpcmVkXG4gICAgaWYgKG5ldyBEYXRlKCkgPiB2ZXJpZmljYXRpb25Db2RlLmV4cGlyZXNBdCkge1xuICAgICAgLy8gQ2xlYW4gdXAgZXhwaXJlZCBjb2RlXG4gICAgICBhd2FpdCBkYlxuICAgICAgICAuZGVsZXRlKGVtYWlsVmVyaWZpY2F0aW9uQ29kZXMpXG4gICAgICAgIC53aGVyZShlcShlbWFpbFZlcmlmaWNhdGlvbkNvZGVzLmlkLCB2ZXJpZmljYXRpb25Db2RlLmlkKSk7XG4gICAgICBcbiAgICAgIHRocm93IG5ldyBWZXJpZmljYXRpb25Db2RlRXJyb3IoJ1ZlcmlmaWNhdGlvbiBjb2RlIGhhcyBleHBpcmVkJywgVmVyaWZpY2F0aW9uRXJyb3IuQ09ERV9FWFBJUkVEKTtcbiAgICB9XG5cbiAgICAvLyBDaGVjayBpZiB0b28gbWFueSBhdHRlbXB0cyBoYXZlIGJlZW4gbWFkZVxuICAgIGlmICh2ZXJpZmljYXRpb25Db2RlLmF0dGVtcHRzVXNlZCA+PSBFbWFpbFZlcmlmaWNhdGlvbkNvZGVTZXJ2aWNlLk1BWF9BVFRFTVBUUykge1xuICAgICAgLy8gSW52YWxpZGF0ZSB0aGUgY29kZVxuICAgICAgYXdhaXQgZGJcbiAgICAgICAgLmRlbGV0ZShlbWFpbFZlcmlmaWNhdGlvbkNvZGVzKVxuICAgICAgICAud2hlcmUoZXEoZW1haWxWZXJpZmljYXRpb25Db2Rlcy5pZCwgdmVyaWZpY2F0aW9uQ29kZS5pZCkpO1xuICAgICAgXG4gICAgICB0aHJvdyBuZXcgVmVyaWZpY2F0aW9uQ29kZUVycm9yKCdUb28gbWFueSB2ZXJpZmljYXRpb24gYXR0ZW1wdHMnLCBWZXJpZmljYXRpb25FcnJvci5UT09fTUFOWV9BVFRFTVBUUyk7XG4gICAgfVxuXG4gICAgLy8gQ29kZSBpcyB2YWxpZCAtIG1hcmsgdXNlciBhcyB2ZXJpZmllZCBhbmQgZGVsZXRlIHRoZSBjb2RlXG4gICAgYXdhaXQgZGIudHJhbnNhY3Rpb24oYXN5bmMgKHR4KSA9PiB7XG4gICAgICAvLyBVcGRhdGUgdXNlciB2ZXJpZmljYXRpb24gc3RhdHVzXG4gICAgICBhd2FpdCB0eFxuICAgICAgICAudXBkYXRlKHVzZXJzKVxuICAgICAgICAuc2V0KHsgaXNFbWFpbFZlcmlmaWVkOiB0cnVlIH0pXG4gICAgICAgIC53aGVyZShlcSh1c2Vycy5pZCwgdXNlci5pZCkpO1xuXG4gICAgICAvLyBEZWxldGUgdGhlIHZlcmlmaWNhdGlvbiBjb2RlXG4gICAgICBhd2FpdCB0eFxuICAgICAgICAuZGVsZXRlKGVtYWlsVmVyaWZpY2F0aW9uQ29kZXMpXG4gICAgICAgIC53aGVyZShlcShlbWFpbFZlcmlmaWNhdGlvbkNvZGVzLmlkLCB2ZXJpZmljYXRpb25Db2RlLmlkKSk7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBJbmNyZW1lbnQgdGhlIGF0dGVtcHQgY291bnQgZm9yIGEgdmVyaWZpY2F0aW9uIGNvZGVcbiAgICogVXNlZCB3aGVuIHZhbGlkYXRpb24gZmFpbHMgYnV0IHdlIHdhbnQgdG8gdHJhY2sgYXR0ZW1wdHNcbiAgICovXG4gIGFzeW5jIGluY3JlbWVudEF0dGVtcHRzKGVtYWlsOiBzdHJpbmcsIGNvZGU6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIC8vIEZpbmQgdXNlciBieSBlbWFpbFxuICAgIGNvbnN0IHVzZXJSZXN1bHQgPSBhd2FpdCBkYlxuICAgICAgLnNlbGVjdCh7IGlkOiB1c2Vycy5pZCB9KVxuICAgICAgLmZyb20odXNlcnMpXG4gICAgICAud2hlcmUoZXEodXNlcnMuZW1haWwsIGVtYWlsKSlcbiAgICAgIC5saW1pdCgxKTtcblxuICAgIGlmICh1c2VyUmVzdWx0Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuOyAvLyBVc2VyIG5vdCBmb3VuZCwgbm90aGluZyB0byBpbmNyZW1lbnRcbiAgICB9XG5cbiAgICBjb25zdCB1c2VyID0gdXNlclJlc3VsdFswXTtcblxuICAgIC8vIEZpbmQgYW5kIGluY3JlbWVudCBhdHRlbXB0cyBmb3IgdGhlIGNvZGVcbiAgICBjb25zdCBjb2RlUmVzdWx0ID0gYXdhaXQgZGJcbiAgICAgIC5zZWxlY3QoeyBpZDogZW1haWxWZXJpZmljYXRpb25Db2Rlcy5pZCwgYXR0ZW1wdHNVc2VkOiBlbWFpbFZlcmlmaWNhdGlvbkNvZGVzLmF0dGVtcHRzVXNlZCB9KVxuICAgICAgLmZyb20oZW1haWxWZXJpZmljYXRpb25Db2RlcylcbiAgICAgIC53aGVyZShcbiAgICAgICAgYW5kKFxuICAgICAgICAgIGVxKGVtYWlsVmVyaWZpY2F0aW9uQ29kZXMudXNlcklkLCB1c2VyLmlkKSxcbiAgICAgICAgICBlcShlbWFpbFZlcmlmaWNhdGlvbkNvZGVzLmNvZGUsIGNvZGUpXG4gICAgICAgIClcbiAgICAgIClcbiAgICAgIC5saW1pdCgxKTtcblxuICAgIGlmIChjb2RlUmVzdWx0Lmxlbmd0aCA+IDApIHtcbiAgICAgIGNvbnN0IHZlcmlmaWNhdGlvbkNvZGUgPSBjb2RlUmVzdWx0WzBdO1xuICAgICAgYXdhaXQgZGJcbiAgICAgICAgLnVwZGF0ZShlbWFpbFZlcmlmaWNhdGlvbkNvZGVzKVxuICAgICAgICAuc2V0KHsgYXR0ZW1wdHNVc2VkOiB2ZXJpZmljYXRpb25Db2RlLmF0dGVtcHRzVXNlZCArIDEgfSlcbiAgICAgICAgLndoZXJlKGVxKGVtYWlsVmVyaWZpY2F0aW9uQ29kZXMuaWQsIHZlcmlmaWNhdGlvbkNvZGUuaWQpKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ2xlYW4gdXAgZXhwaXJlZCB2ZXJpZmljYXRpb24gY29kZXNcbiAgICogU2hvdWxkIGJlIGNhbGxlZCBwZXJpb2RpY2FsbHkgYnkgYSBjbGVhbnVwIGpvYlxuICAgKi9cbiAgYXN5bmMgY2xlYW51cEV4cGlyZWRDb2RlcygpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG4gICAgXG4gICAgLy8gRmlyc3QgY291bnQgdGhlIGV4cGlyZWQgY29kZXNcbiAgICBjb25zdCBleHBpcmVkQ29kZXMgPSBhd2FpdCBkYlxuICAgICAgLnNlbGVjdCh7IGlkOiBlbWFpbFZlcmlmaWNhdGlvbkNvZGVzLmlkIH0pXG4gICAgICAuZnJvbShlbWFpbFZlcmlmaWNhdGlvbkNvZGVzKVxuICAgICAgLndoZXJlKGx0KGVtYWlsVmVyaWZpY2F0aW9uQ29kZXMuZXhwaXJlc0F0LCBub3cpKTtcblxuICAgIGNvbnN0IGNvdW50ID0gZXhwaXJlZENvZGVzLmxlbmd0aDtcblxuICAgIC8vIFRoZW4gZGVsZXRlIHRoZW0gaWYgYW55IGV4aXN0XG4gICAgaWYgKGNvdW50ID4gMCkge1xuICAgICAgYXdhaXQgZGJcbiAgICAgICAgLmRlbGV0ZShlbWFpbFZlcmlmaWNhdGlvbkNvZGVzKVxuICAgICAgICAud2hlcmUobHQoZW1haWxWZXJpZmljYXRpb25Db2Rlcy5leHBpcmVzQXQsIG5vdykpO1xuICAgIH1cblxuICAgIHJldHVybiBjb3VudDtcbiAgfVxuXG4gIC8qKlxuICAgKiBEZWxldGUgYWxsIHZlcmlmaWNhdGlvbiBjb2RlcyBmb3IgYSBzcGVjaWZpYyB1c2VyXG4gICAqIFVzZWQgd2hlbiBnZW5lcmF0aW5nIG5ldyBjb2RlcyBvciB3aGVuIHVzZXIgaXMgZGVsZXRlZFxuICAgKi9cbiAgYXN5bmMgZGVsZXRlVXNlckNvZGVzKHVzZXJJZDogbnVtYmVyKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgYXdhaXQgZGJcbiAgICAgIC5kZWxldGUoZW1haWxWZXJpZmljYXRpb25Db2RlcylcbiAgICAgIC53aGVyZShlcShlbWFpbFZlcmlmaWNhdGlvbkNvZGVzLnVzZXJJZCwgdXNlcklkKSk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGFjdGl2ZSB2ZXJpZmljYXRpb24gY29kZSBmb3IgYSB1c2VyIChmb3IgdGVzdGluZy9kZWJ1Z2dpbmcpXG4gICAqL1xuICBhc3luYyBnZXRVc2VyQWN0aXZlQ29kZSh1c2VySWQ6IG51bWJlcik6IFByb21pc2U8RW1haWxWZXJpZmljYXRpb25Db2RlIHwgbnVsbD4ge1xuICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJcbiAgICAgIC5zZWxlY3QoKVxuICAgICAgLmZyb20oZW1haWxWZXJpZmljYXRpb25Db2RlcylcbiAgICAgIC53aGVyZShcbiAgICAgICAgYW5kKFxuICAgICAgICAgIGVxKGVtYWlsVmVyaWZpY2F0aW9uQ29kZXMudXNlcklkLCB1c2VySWQpLFxuICAgICAgICAgIGd0KGVtYWlsVmVyaWZpY2F0aW9uQ29kZXMuZXhwaXJlc0F0LCBub3cpIC8vIE5vdCBleHBpcmVkXG4gICAgICAgIClcbiAgICAgIClcbiAgICAgIC5saW1pdCgxKTtcblxuICAgIHJldHVybiByZXN1bHQubGVuZ3RoID4gMCA/IHJlc3VsdFswXSA6IG51bGw7XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2sgaWYgYSB1c2VyIGhhcyBhbnkgYWN0aXZlIHZlcmlmaWNhdGlvbiBjb2Rlc1xuICAgKi9cbiAgYXN5bmMgaGFzQWN0aXZlQ29kZSh1c2VySWQ6IG51bWJlcik6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIGNvbnN0IGNvZGUgPSBhd2FpdCB0aGlzLmdldFVzZXJBY3RpdmVDb2RlKHVzZXJJZCk7XG4gICAgcmV0dXJuIGNvZGUgIT09IG51bGw7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHZlcmlmaWNhdGlvbiBjb2RlIHN0YXRpc3RpY3MgZm9yIG1vbml0b3JpbmdcbiAgICovXG4gIGFzeW5jIGdldENvZGVTdGF0cygpOiBQcm9taXNlPHtcbiAgICB0b3RhbEFjdGl2ZTogbnVtYmVyO1xuICAgIGV4cGlyZWRDb3VudDogbnVtYmVyO1xuICAgIGhpZ2hBdHRlbXB0Q291bnQ6IG51bWJlcjtcbiAgfT4ge1xuICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG4gICAgXG4gICAgLy8gQ291bnQgYWN0aXZlIGNvZGVzXG4gICAgY29uc3QgYWN0aXZlUmVzdWx0ID0gYXdhaXQgZGJcbiAgICAgIC5zZWxlY3QoeyBpZDogZW1haWxWZXJpZmljYXRpb25Db2Rlcy5pZCB9KVxuICAgICAgLmZyb20oZW1haWxWZXJpZmljYXRpb25Db2RlcylcbiAgICAgIC53aGVyZShndChlbWFpbFZlcmlmaWNhdGlvbkNvZGVzLmV4cGlyZXNBdCwgbm93KSk7XG5cbiAgICAvLyBDb3VudCBleHBpcmVkIGNvZGVzXG4gICAgY29uc3QgZXhwaXJlZFJlc3VsdCA9IGF3YWl0IGRiXG4gICAgICAuc2VsZWN0KHsgaWQ6IGVtYWlsVmVyaWZpY2F0aW9uQ29kZXMuaWQgfSlcbiAgICAgIC5mcm9tKGVtYWlsVmVyaWZpY2F0aW9uQ29kZXMpXG4gICAgICAud2hlcmUobHQoZW1haWxWZXJpZmljYXRpb25Db2Rlcy5leHBpcmVzQXQsIG5vdykpO1xuXG4gICAgLy8gQ291bnQgY29kZXMgd2l0aCBoaWdoIGF0dGVtcHRzICg0IG9yIG1vcmUpXG4gICAgY29uc3QgaGlnaEF0dGVtcHRSZXN1bHQgPSBhd2FpdCBkYlxuICAgICAgLnNlbGVjdCh7IGlkOiBlbWFpbFZlcmlmaWNhdGlvbkNvZGVzLmlkIH0pXG4gICAgICAuZnJvbShlbWFpbFZlcmlmaWNhdGlvbkNvZGVzKVxuICAgICAgLndoZXJlKFxuICAgICAgICBhbmQoXG4gICAgICAgICAgZ3QoZW1haWxWZXJpZmljYXRpb25Db2Rlcy5leHBpcmVzQXQsIG5vdyksXG4gICAgICAgICAgZXEoZW1haWxWZXJpZmljYXRpb25Db2Rlcy5hdHRlbXB0c1VzZWQsIDQpIC8vIENsb3NlIHRvIG1heCBhdHRlbXB0c1xuICAgICAgICApXG4gICAgICApO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHRvdGFsQWN0aXZlOiBhY3RpdmVSZXN1bHQubGVuZ3RoLFxuICAgICAgZXhwaXJlZENvdW50OiBleHBpcmVkUmVzdWx0Lmxlbmd0aCxcbiAgICAgIGhpZ2hBdHRlbXB0Q291bnQ6IGhpZ2hBdHRlbXB0UmVzdWx0Lmxlbmd0aCxcbiAgICB9O1xuICB9XG59XG5cbi8vIEV4cG9ydCBzaW5nbGV0b24gaW5zdGFuY2VcbmV4cG9ydCBjb25zdCBlbWFpbFZlcmlmaWNhdGlvbkNvZGVTZXJ2aWNlID0gbmV3IEVtYWlsVmVyaWZpY2F0aW9uQ29kZVNlcnZpY2UoKTsiXSwibmFtZXMiOlsiRW1haWxWZXJpZmljYXRpb25Db2RlU2VydmljZSIsIlZlcmlmaWNhdGlvbkNvZGVFcnJvciIsIlZlcmlmaWNhdGlvbkVycm9yIiwiZW1haWxWZXJpZmljYXRpb25Db2RlU2VydmljZSIsIkVycm9yIiwibWVzc2FnZSIsImNvZGUiLCJuYW1lIiwiQ09ERV9MRU5HVEgiLCJFWFBJUllfTUlOVVRFUyIsIk1BWF9BVFRFTVBUUyIsImdlbmVyYXRlU2VjdXJlQ29kZSIsImJ1ZmZlciIsInJhbmRvbUJ5dGVzIiwicmFuZG9tTnVtYmVyIiwicmVhZFVJbnQzMkJFIiwidG9TdHJpbmciLCJwYWRTdGFydCIsImdlbmVyYXRlQ29kZSIsInVzZXJJZCIsImRlbGV0ZVVzZXJDb2RlcyIsImV4cGlyZXNBdCIsIkRhdGUiLCJub3ciLCJkYiIsImluc2VydCIsImVtYWlsVmVyaWZpY2F0aW9uQ29kZXMiLCJ2YWx1ZXMiLCJhdHRlbXB0c1VzZWQiLCJ2YWxpZGF0ZUNvZGUiLCJlbWFpbCIsInVzZXJSZXN1bHQiLCJzZWxlY3QiLCJpZCIsInVzZXJzIiwiaXNFbWFpbFZlcmlmaWVkIiwiZnJvbSIsIndoZXJlIiwiZXEiLCJsaW1pdCIsImxlbmd0aCIsInVzZXIiLCJjb2RlUmVzdWx0IiwiYW5kIiwidmVyaWZpY2F0aW9uQ29kZSIsImRlbGV0ZSIsInRyYW5zYWN0aW9uIiwidHgiLCJ1cGRhdGUiLCJzZXQiLCJpbmNyZW1lbnRBdHRlbXB0cyIsImNsZWFudXBFeHBpcmVkQ29kZXMiLCJleHBpcmVkQ29kZXMiLCJsdCIsImNvdW50IiwiZ2V0VXNlckFjdGl2ZUNvZGUiLCJyZXN1bHQiLCJndCIsImhhc0FjdGl2ZUNvZGUiLCJnZXRDb2RlU3RhdHMiLCJhY3RpdmVSZXN1bHQiLCJleHBpcmVkUmVzdWx0IiwiaGlnaEF0dGVtcHRSZXN1bHQiLCJ0b3RhbEFjdGl2ZSIsImV4cGlyZWRDb3VudCIsImhpZ2hBdHRlbXB0Q291bnQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O1FBaUNhQTtlQUFBQTs7UUFWQUM7ZUFBQUE7O1FBUkRDO2VBQUFBOztRQXVSQ0M7ZUFBQUE7OztRQXRTTjtvQkFDWTt3QkFDMkI7NEJBQ2Q7d0JBQ0o7QUFX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