e7428bec4654ab3e2e0dbb5e1ef37fb0
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "CareHistoryQueries", {
    enumerable: true,
    get: function() {
        return CareHistoryQueries;
    }
});
const _db = require("..");
const _schema = require("../schema");
const _drizzleorm = require("drizzle-orm");
const _carecalculator = require("../../services/care-calculator");
const _caretypes = require("../../types/care-types");
class CareHistoryQueries {
    /**
   * Create a new care history entry
   */ static async createCareHistory(data) {
        // Validate care type enum constraint
        const validCareTypes = [
            'fertilizer',
            'water',
            'repot',
            'prune',
            'inspect',
            'other'
        ];
        if (!validCareTypes.includes(data.careType)) {
            throw new Error(`Invalid care type: ${data.careType}. Must be one of: ${validCareTypes.join(', ')}`);
        }
        const [careEntry] = await _db.db.insert(_schema.careHistory).values({
            ...data,
            createdAt: new Date(),
            updatedAt: new Date()
        }).returning();
        return careEntry;
    }
    /**
   * Get care history by ID
   */ static async getCareHistoryById(id) {
        const [careEntry] = await _db.db.select().from(_schema.careHistory).where((0, _drizzleorm.eq)(_schema.careHistory.id, id)).limit(1);
        return careEntry || null;
    }
    /**
   * Get care history for a specific plant instance
   */ static async getCareHistoryForPlant(plantInstanceId, userId, filters) {
        // Build where conditions
        const conditions = [
            (0, _drizzleorm.eq)(_schema.careHistory.plantInstanceId, plantInstanceId),
            (0, _drizzleorm.eq)(_schema.careHistory.userId, userId)
        ];
        if (filters?.careType) {
            conditions.push((0, _drizzleorm.eq)(_schema.careHistory.careType, filters.careType));
        }
        if (filters?.startDate) {
            conditions.push((0, _drizzleorm.gte)(_schema.careHistory.careDate, filters.startDate));
        }
        if (filters?.endDate) {
            conditions.push((0, _drizzleorm.lte)(_schema.careHistory.careDate, filters.endDate));
        }
        // Apply sorting
        const sortField = filters?.sortBy === 'care_type' ? _schema.careHistory.careType : filters?.sortBy === 'created_at' ? _schema.careHistory.createdAt : _schema.careHistory.careDate;
        const sortOrder = filters?.sortOrder === 'asc' ? (0, _drizzleorm.asc)(sortField) : (0, _drizzleorm.desc)(sortField);
        // Build the query
        let query = _db.db.select({
            careHistory: _schema.careHistory,
            plantInstance: _schema.plantInstances,
            plant: _schema.plants
        }).from(_schema.careHistory).leftJoin(_schema.plantInstances, (0, _drizzleorm.eq)(_schema.careHistory.plantInstanceId, _schema.plantInstances.id)).leftJoin(_schema.plants, (0, _drizzleorm.eq)(_schema.plantInstances.plantId, _schema.plants.id)).where((0, _drizzleorm.and)(...conditions)).orderBy(sortOrder);
        // Apply pagination
        if (filters?.limit) {
            query = query.limit(filters.limit);
        }
        if (filters?.offset) {
            query = query.offset(filters.offset);
        }
        const results = await query;
        return results.map((result)=>this.enhanceCareHistory(result.careHistory, result.plantInstance, result.plant));
    }
    /**
   * Get care history for multiple plant instances (for dashboard)
   */ static async getCareHistoryForPlants(plantInstanceIds, userId, filters) {
        if (plantInstanceIds.length === 0) return [];
        // Build where conditions
        const conditions = [
            (0, _drizzleorm.inArray)(_schema.careHistory.plantInstanceId, plantInstanceIds),
            (0, _drizzleorm.eq)(_schema.careHistory.userId, userId)
        ];
        if (filters?.careType) {
            conditions.push((0, _drizzleorm.eq)(_schema.careHistory.careType, filters.careType));
        }
        if (filters?.startDate) {
            conditions.push((0, _drizzleorm.gte)(_schema.careHistory.careDate, filters.startDate));
        }
        if (filters?.endDate) {
            conditions.push((0, _drizzleorm.lte)(_schema.careHistory.careDate, filters.endDate));
        }
        // Apply sorting
        const sortField = filters?.sortBy === 'care_type' ? _schema.careHistory.careType : filters?.sortBy === 'created_at' ? _schema.careHistory.createdAt : _schema.careHistory.careDate;
        const sortOrder = filters?.sortOrder === 'asc' ? (0, _drizzleorm.asc)(sortField) : (0, _drizzleorm.desc)(sortField);
        // Build the query
        let query = _db.db.select({
            careHistory: _schema.careHistory,
            plantInstance: _schema.plantInstances,
            plant: _schema.plants
        }).from(_schema.careHistory).leftJoin(_schema.plantInstances, (0, _drizzleorm.eq)(_schema.careHistory.plantInstanceId, _schema.plantInstances.id)).leftJoin(_schema.plants, (0, _drizzleorm.eq)(_schema.plantInstances.plantId, _schema.plants.id)).where((0, _drizzleorm.and)(...conditions)).orderBy(sortOrder);
        // Apply pagination
        if (filters?.limit) {
            query = query.limit(filters.limit);
        }
        if (filters?.offset) {
            query = query.offset(filters.offset);
        }
        const results = await query;
        return results.map((result)=>this.enhanceCareHistory(result.careHistory, result.plantInstance, result.plant));
    }
    /**
   * Get recent care history for a user
   */ static async getRecentCareHistory(userId, limit = 20) {
        const results = await _db.db.select({
            careHistory: _schema.careHistory,
            plantInstance: _schema.plantInstances,
            plant: _schema.plants
        }).from(_schema.careHistory).leftJoin(_schema.plantInstances, (0, _drizzleorm.eq)(_schema.careHistory.plantInstanceId, _schema.plantInstances.id)).leftJoin(_schema.plants, (0, _drizzleorm.eq)(_schema.plantInstances.plantId, _schema.plants.id)).where((0, _drizzleorm.eq)(_schema.careHistory.userId, userId)).orderBy((0, _drizzleorm.desc)(_schema.careHistory.careDate)).limit(limit);
        return results.map((result)=>this.enhanceCareHistory(result.careHistory, result.plantInstance, result.plant));
    }
    /**
   * Update care history entry
   */ static async updateCareHistory(id, userId, updates) {
        const [updated] = await _db.db.update(_schema.careHistory).set({
            ...updates,
            updatedAt: new Date()
        }).where((0, _drizzleorm.and)((0, _drizzleorm.eq)(_schema.careHistory.id, id), (0, _drizzleorm.eq)(_schema.careHistory.userId, userId))).returning();
        return updated || null;
    }
    /**
   * Delete care history entry
   */ static async deleteCareHistory(id, userId) {
        // First check if record exists and belongs to user
        const existing = await _db.db.select().from(_schema.careHistory).where((0, _drizzleorm.and)((0, _drizzleorm.eq)(_schema.careHistory.id, id), (0, _drizzleorm.eq)(_schema.careHistory.userId, userId))).limit(1);
        if (existing.length === 0) {
            return false; // Record doesn't exist or doesn't belong to user
        }
        // Perform the delete
        await _db.db.delete(_schema.careHistory).where((0, _drizzleorm.and)((0, _drizzleorm.eq)(_schema.careHistory.id, id), (0, _drizzleorm.eq)(_schema.careHistory.userId, userId)));
        // Verify deletion by checking if record still exists
        const stillExists = await _db.db.select().from(_schema.careHistory).where((0, _drizzleorm.eq)(_schema.careHistory.id, id)).limit(1);
        return stillExists.length === 0;
    }
    /**
   * Get care statistics for a plant instance
   */ static async getPlantCareStatistics(plantInstanceId, userId) {
        // Get plant instance
        const [plantInstance] = await _db.db.select().from(_schema.plantInstances).where((0, _drizzleorm.and)((0, _drizzleorm.eq)(_schema.plantInstances.id, plantInstanceId), (0, _drizzleorm.eq)(_schema.plantInstances.userId, userId))).limit(1);
        if (!plantInstance) return null;
        // Get care history
        const careHistoryData = await _db.db.select().from(_schema.careHistory).where((0, _drizzleorm.and)((0, _drizzleorm.eq)(_schema.careHistory.plantInstanceId, plantInstanceId), (0, _drizzleorm.eq)(_schema.careHistory.userId, userId))).orderBy((0, _drizzleorm.asc)(_schema.careHistory.careDate));
        return _carecalculator.CareCalculator.calculatePlantCareStatistics(plantInstance, careHistoryData);
    }
    /**
   * Get care statistics for multiple plants
   */ static async getBulkCareStatistics(plantInstanceIds, userId) {
        if (plantInstanceIds.length === 0) return [];
        // Get plant instances
        const plantInstancesData = await _db.db.select().from(_schema.plantInstances).where((0, _drizzleorm.and)((0, _drizzleorm.inArray)(_schema.plantInstances.id, plantInstanceIds), (0, _drizzleorm.eq)(_schema.plantInstances.userId, userId)));
        // Get care history for all plants
        const careHistoryData = await _db.db.select().from(_schema.careHistory).where((0, _drizzleorm.and)((0, _drizzleorm.inArray)(_schema.careHistory.plantInstanceId, plantInstanceIds), (0, _drizzleorm.eq)(_schema.careHistory.userId, userId))).orderBy((0, _drizzleorm.asc)(_schema.careHistory.careDate));
        // Group care history by plant instance
        const careHistoryByPlant = careHistoryData.reduce((acc, care)=>{
            if (!acc[care.plantInstanceId]) {
                acc[care.plantInstanceId] = [];
            }
            acc[care.plantInstanceId].push(care);
            return acc;
        }, {});
        // Calculate statistics for each plant
        return plantInstancesData.map((plantInstance)=>_carecalculator.CareCalculator.calculatePlantCareStatistics(plantInstance, careHistoryByPlant[plantInstance.id] || []));
    }
    /**
   * Get care dashboard data
   */ static async getCareDashboardData(userId, options = {}) {
        const { includeInactive = false, daysAhead = 7 } = options;
        // Get all plant instances for the user
        const plantInstancesData = await _db.db.select({
            plantInstance: _schema.plantInstances,
            plant: _schema.plants
        }).from(_schema.plantInstances).leftJoin(_schema.plants, (0, _drizzleorm.eq)(_schema.plantInstances.plantId, _schema.plants.id)).where(includeInactive ? (0, _drizzleorm.eq)(_schema.plantInstances.userId, userId) : (0, _drizzleorm.and)((0, _drizzleorm.eq)(_schema.plantInstances.userId, userId), (0, _drizzleorm.eq)(_schema.plantInstances.isActive, true)));
        // Get recent care history for statistics
        const oneWeekAgo = new Date();
        oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);
        const recentCareHistory = await _db.db.select().from(_schema.careHistory).where((0, _drizzleorm.and)((0, _drizzleorm.eq)(_schema.careHistory.userId, userId), (0, _drizzleorm.gte)(_schema.careHistory.careDate, oneWeekAgo)));
        // Enhance plant instances with care calculations
        const enhancedPlants = plantInstancesData.map(({ plantInstance, plant })=>{
            if (!plant) return null;
            const careStatus = _carecalculator.CareCalculator.calculateCareStatus(plantInstance.fertilizerDue);
            const careUrgency = _carecalculator.CareCalculator.calculateCareUrgency(plantInstance.fertilizerDue);
            const daysUntilFertilizerDue = _carecalculator.CareCalculator.calculateDaysUntilFertilizerDue(plantInstance.fertilizerDue);
            const daysSinceLastFertilized = _carecalculator.CareCalculator.calculateDaysSinceLastFertilized(plantInstance.lastFertilized);
            const daysSinceLastRepot = _carecalculator.CareCalculator.calculateDaysSinceLastRepot(plantInstance.lastRepot);
            const displayName = plantInstance.nickname || plant.commonName;
            const primaryImage = plantInstance.images?.[0] || plant.defaultImage || null;
            return {
                ...plantInstance,
                plant,
                careStatus,
                careUrgency,
                daysUntilFertilizerDue,
                daysSinceLastFertilized,
                daysSinceLastRepot,
                displayName,
                primaryImage
            };
        }).filter((plant)=>plant !== null);
        // Categorize plants by care status
        const overdue = enhancedPlants.filter((p)=>p.careStatus === 'overdue');
        const dueToday = enhancedPlants.filter((p)=>p.careStatus === 'due_today');
        const dueSoon = enhancedPlants.filter((p)=>p.careStatus === 'due_soon');
        // Get recently cared plants (fertilized in last 3 days)
        const threeDaysAgo = new Date();
        threeDaysAgo.setDate(threeDaysAgo.getDate() - 3);
        const recentlyCared = enhancedPlants.filter((p)=>p.lastFertilized && p.lastFertilized >= threeDaysAgo);
        // Calculate care streak (consecutive days with proper care)
        const careStreakDays = this.calculateUserCareStreak(userId, recentCareHistory);
        // Calculate average care consistency across all plants
        const averageCareConsistency = enhancedPlants.length > 0 ? enhancedPlants.reduce((sum, plant)=>{
            // Simplified consistency calculation for dashboard
            const daysSince = plant.daysSinceLastFertilized || 0;
            const scheduleDays = _caretypes.careHelpers.parseFertilizerSchedule(plant.fertilizerSchedule);
            const consistency = Math.max(0, 100 - daysSince / scheduleDays * 50);
            return sum + consistency;
        }, 0) / enhancedPlants.length : 0;
        return {
            overdue,
            dueToday,
            dueSoon,
            recentlyCared,
            statistics: {
                totalActivePlants: enhancedPlants.length,
                overdueCount: overdue.length,
                dueTodayCount: dueToday.length,
                dueSoonCount: dueSoon.length,
                careStreakDays,
                totalCareEventsThisWeek: recentCareHistory.length,
                averageCareConsistency: Math.round(averageCareConsistency)
            },
            quickActions: _caretypes.careHelpers.getDefaultQuickCareActions()
        };
    }
    /**
   * Get care history count for a plant instance
   */ static async getCareHistoryCount(plantInstanceId, userId, careType) {
        const conditions = [
            (0, _drizzleorm.eq)(_schema.careHistory.plantInstanceId, plantInstanceId),
            (0, _drizzleorm.eq)(_schema.careHistory.userId, userId)
        ];
        if (careType) {
            conditions.push((0, _drizzleorm.eq)(_schema.careHistory.careType, careType));
        }
        const [result] = await _db.db.select({
            count: (0, _drizzleorm.count)()
        }).from(_schema.careHistory).where((0, _drizzleorm.and)(...conditions));
        return result.count;
    }
    /**
   * Get last care date for a specific care type
   */ static async getLastCareDate(plantInstanceId, userId, careType) {
        const [result] = await _db.db.select({
            careDate: _schema.careHistory.careDate
        }).from(_schema.careHistory).where((0, _drizzleorm.and)((0, _drizzleorm.eq)(_schema.careHistory.plantInstanceId, plantInstanceId), (0, _drizzleorm.eq)(_schema.careHistory.userId, userId), (0, _drizzleorm.eq)(_schema.careHistory.careType, careType))).orderBy((0, _drizzleorm.desc)(_schema.careHistory.careDate)).limit(1);
        return result?.careDate || null;
    }
    /**
   * Bulk create care history entries
   */ static async bulkCreateCareHistory(entries) {
        if (entries.length === 0) return [];
        const entriesWithTimestamps = entries.map((entry)=>({
                ...entry,
                createdAt: new Date(),
                updatedAt: new Date()
            }));
        return await _db.db.insert(_schema.careHistory).values(entriesWithTimestamps).returning();
    }
    /**
   * Private helper to enhance care history with computed properties
   */ static enhanceCareHistory(care, plantInstance, plant) {
        const now = new Date();
        const daysSinceCare = Math.floor((now.getTime() - care.careDate.getTime()) / (1000 * 60 * 60 * 24));
        const formattedDate = _caretypes.careHelpers.formatCareDate(care.careDate);
        const careTypeDisplay = _caretypes.careHelpers.getCareTypeDisplay(care.careType);
        return {
            ...care,
            plantInstance: plantInstance && plant ? {
                ...plantInstance,
                plant
            } : undefined,
            daysSinceCare,
            formattedDate,
            careTypeDisplay
        };
    }
    /**
   * Private helper to calculate user care streak
   */ static calculateUserCareStreak(userId, recentCareHistory) {
        // Simplified care streak calculation
        // Count consecutive days with at least one care event
        const careByDate = recentCareHistory.reduce((acc, care)=>{
            const dateKey = care.careDate.toISOString().split('T')[0];
            acc[dateKey] = true;
            return acc;
        }, {});
        let streak = 0;
        const today = new Date();
        for(let i = 0; i < 30; i++){
            const checkDate = new Date(today);
            checkDate.setDate(checkDate.getDate() - i);
            const dateKey = checkDate.toISOString().split('T')[0];
            if (careByDate[dateKey]) {
                streak++;
            } else if (i > 0) {
                break;
            }
        }
        return streak;
    }
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9zdGVmYW5iZWtrZXIvcHJvamVjdHMvZmFuY3ktcGxhbnRpZXMvc3JjL2xpYi9kYi9xdWVyaWVzL2NhcmUtaGlzdG9yeS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBkYiB9IGZyb20gJ0AvbGliL2RiJztcbmltcG9ydCB7IGNhcmVIaXN0b3J5LCBwbGFudEluc3RhbmNlcywgcGxhbnRzIH0gZnJvbSAnQC9saWIvZGIvc2NoZW1hJztcbmltcG9ydCB7IGVxLCBhbmQsIGRlc2MsIGFzYywgZ3RlLCBsdGUsIGluQXJyYXksIHNxbCwgY291bnQgfSBmcm9tICdkcml6emxlLW9ybSc7XG5pbXBvcnQgdHlwZSB7IFxuICBDYXJlSGlzdG9yeSwgXG4gIE5ld0NhcmVIaXN0b3J5LCBcbiAgUGxhbnRJbnN0YW5jZSxcbiAgUGxhbnQgXG59IGZyb20gJ0AvbGliL2RiL3NjaGVtYSc7XG5pbXBvcnQgdHlwZSB7IEVuaGFuY2VkUGxhbnRJbnN0YW5jZSB9IGZyb20gJ0AvbGliL3R5cGVzL3BsYW50LWluc3RhbmNlLXR5cGVzJztcbmltcG9ydCB0eXBlIHsgXG4gIENhcmVGaWx0ZXJJbnB1dCxcbiAgQ2FyZVN0YXRzUXVlcnlJbnB1dCxcbiAgQ2FyZURhc2hib2FyZFF1ZXJ5SW5wdXQgXG59IGZyb20gJ0AvbGliL3ZhbGlkYXRpb24vY2FyZS1zY2hlbWFzJztcbmltcG9ydCB0eXBlIHsgXG4gIEVuaGFuY2VkQ2FyZUhpc3RvcnksXG4gIFBsYW50Q2FyZVN0YXRpc3RpY3MsXG4gIENhcmVEYXNoYm9hcmREYXRhLFxuICBDYXJlVHlwZVxufSBmcm9tICdAL2xpYi90eXBlcy9jYXJlLXR5cGVzJztcbmltcG9ydCB7IENhcmVDYWxjdWxhdG9yIH0gZnJvbSAnQC9saWIvc2VydmljZXMvY2FyZS1jYWxjdWxhdG9yJztcbmltcG9ydCB7IGNhcmVIZWxwZXJzIH0gZnJvbSAnQC9saWIvdHlwZXMvY2FyZS10eXBlcyc7XG5cbi8qKlxuICogRGF0YWJhc2UgcXVlcmllcyBmb3IgY2FyZSBoaXN0b3J5IG1hbmFnZW1lbnRcbiAqL1xuZXhwb3J0IGNsYXNzIENhcmVIaXN0b3J5UXVlcmllcyB7XG4gIC8qKlxuICAgKiBDcmVhdGUgYSBuZXcgY2FyZSBoaXN0b3J5IGVudHJ5XG4gICAqL1xuICBzdGF0aWMgYXN5bmMgY3JlYXRlQ2FyZUhpc3RvcnkoZGF0YTogTmV3Q2FyZUhpc3RvcnkpOiBQcm9taXNlPENhcmVIaXN0b3J5PiB7XG4gICAgLy8gVmFsaWRhdGUgY2FyZSB0eXBlIGVudW0gY29uc3RyYWludFxuICAgIGNvbnN0IHZhbGlkQ2FyZVR5cGVzID0gWydmZXJ0aWxpemVyJywgJ3dhdGVyJywgJ3JlcG90JywgJ3BydW5lJywgJ2luc3BlY3QnLCAnb3RoZXInXTtcbiAgICBpZiAoIXZhbGlkQ2FyZVR5cGVzLmluY2x1ZGVzKGRhdGEuY2FyZVR5cGUpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgY2FyZSB0eXBlOiAke2RhdGEuY2FyZVR5cGV9LiBNdXN0IGJlIG9uZSBvZjogJHt2YWxpZENhcmVUeXBlcy5qb2luKCcsICcpfWApO1xuICAgIH1cblxuICAgIGNvbnN0IFtjYXJlRW50cnldID0gYXdhaXQgZGJcbiAgICAgIC5pbnNlcnQoY2FyZUhpc3RvcnkpXG4gICAgICAudmFsdWVzKHtcbiAgICAgICAgLi4uZGF0YSxcbiAgICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9KVxuICAgICAgLnJldHVybmluZygpO1xuXG4gICAgcmV0dXJuIGNhcmVFbnRyeTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgY2FyZSBoaXN0b3J5IGJ5IElEXG4gICAqL1xuICBzdGF0aWMgYXN5bmMgZ2V0Q2FyZUhpc3RvcnlCeUlkKGlkOiBudW1iZXIpOiBQcm9taXNlPENhcmVIaXN0b3J5IHwgbnVsbD4ge1xuICAgIGNvbnN0IFtjYXJlRW50cnldID0gYXdhaXQgZGJcbiAgICAgIC5zZWxlY3QoKVxuICAgICAgLmZyb20oY2FyZUhpc3RvcnkpXG4gICAgICAud2hlcmUoZXEoY2FyZUhpc3RvcnkuaWQsIGlkKSlcbiAgICAgIC5saW1pdCgxKTtcblxuICAgIHJldHVybiBjYXJlRW50cnkgfHwgbnVsbDtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgY2FyZSBoaXN0b3J5IGZvciBhIHNwZWNpZmljIHBsYW50IGluc3RhbmNlXG4gICAqL1xuICBzdGF0aWMgYXN5bmMgZ2V0Q2FyZUhpc3RvcnlGb3JQbGFudChcbiAgICBwbGFudEluc3RhbmNlSWQ6IG51bWJlcixcbiAgICB1c2VySWQ6IG51bWJlcixcbiAgICBmaWx0ZXJzPzogUGFydGlhbDxDYXJlRmlsdGVySW5wdXQ+XG4gICk6IFByb21pc2U8RW5oYW5jZWRDYXJlSGlzdG9yeVtdPiB7XG4gICAgLy8gQnVpbGQgd2hlcmUgY29uZGl0aW9uc1xuICAgIGNvbnN0IGNvbmRpdGlvbnMgPSBbXG4gICAgICBlcShjYXJlSGlzdG9yeS5wbGFudEluc3RhbmNlSWQsIHBsYW50SW5zdGFuY2VJZCksXG4gICAgICBlcShjYXJlSGlzdG9yeS51c2VySWQsIHVzZXJJZClcbiAgICBdO1xuXG4gICAgaWYgKGZpbHRlcnM/LmNhcmVUeXBlKSB7XG4gICAgICBjb25kaXRpb25zLnB1c2goZXEoY2FyZUhpc3RvcnkuY2FyZVR5cGUsIGZpbHRlcnMuY2FyZVR5cGUpKTtcbiAgICB9XG5cbiAgICBpZiAoZmlsdGVycz8uc3RhcnREYXRlKSB7XG4gICAgICBjb25kaXRpb25zLnB1c2goZ3RlKGNhcmVIaXN0b3J5LmNhcmVEYXRlLCBmaWx0ZXJzLnN0YXJ0RGF0ZSkpO1xuICAgIH1cblxuICAgIGlmIChmaWx0ZXJzPy5lbmREYXRlKSB7XG4gICAgICBjb25kaXRpb25zLnB1c2gobHRlKGNhcmVIaXN0b3J5LmNhcmVEYXRlLCBmaWx0ZXJzLmVuZERhdGUpKTtcbiAgICB9XG5cbiAgICAvLyBBcHBseSBzb3J0aW5nXG4gICAgY29uc3Qgc29ydEZpZWxkID0gZmlsdGVycz8uc29ydEJ5ID09PSAnY2FyZV90eXBlJyA/IGNhcmVIaXN0b3J5LmNhcmVUeXBlIDpcbiAgICAgICAgICAgICAgICAgICAgIGZpbHRlcnM/LnNvcnRCeSA9PT0gJ2NyZWF0ZWRfYXQnID8gY2FyZUhpc3RvcnkuY3JlYXRlZEF0IDpcbiAgICAgICAgICAgICAgICAgICAgIGNhcmVIaXN0b3J5LmNhcmVEYXRlO1xuICAgIFxuICAgIGNvbnN0IHNvcnRPcmRlciA9IGZpbHRlcnM/LnNvcnRPcmRlciA9PT0gJ2FzYycgPyBhc2Moc29ydEZpZWxkKSA6IGRlc2Moc29ydEZpZWxkKTtcblxuICAgIC8vIEJ1aWxkIHRoZSBxdWVyeVxuICAgIGxldCBxdWVyeSA9IGRiXG4gICAgICAuc2VsZWN0KHtcbiAgICAgICAgY2FyZUhpc3Rvcnk6IGNhcmVIaXN0b3J5LFxuICAgICAgICBwbGFudEluc3RhbmNlOiBwbGFudEluc3RhbmNlcyxcbiAgICAgICAgcGxhbnQ6IHBsYW50cyxcbiAgICAgIH0pXG4gICAgICAuZnJvbShjYXJlSGlzdG9yeSlcbiAgICAgIC5sZWZ0Sm9pbihwbGFudEluc3RhbmNlcywgZXEoY2FyZUhpc3RvcnkucGxhbnRJbnN0YW5jZUlkLCBwbGFudEluc3RhbmNlcy5pZCkpXG4gICAgICAubGVmdEpvaW4ocGxhbnRzLCBlcShwbGFudEluc3RhbmNlcy5wbGFudElkLCBwbGFudHMuaWQpKVxuICAgICAgLndoZXJlKGFuZCguLi5jb25kaXRpb25zKSlcbiAgICAgIC5vcmRlckJ5KHNvcnRPcmRlcik7XG5cbiAgICAvLyBBcHBseSBwYWdpbmF0aW9uXG4gICAgaWYgKGZpbHRlcnM/LmxpbWl0KSB7XG4gICAgICBxdWVyeSA9IHF1ZXJ5LmxpbWl0KGZpbHRlcnMubGltaXQpIGFzIGFueTtcbiAgICB9XG4gICAgaWYgKGZpbHRlcnM/Lm9mZnNldCkge1xuICAgICAgcXVlcnkgPSBxdWVyeS5vZmZzZXQoZmlsdGVycy5vZmZzZXQpIGFzIGFueTtcbiAgICB9XG5cbiAgICBjb25zdCByZXN1bHRzID0gYXdhaXQgcXVlcnk7XG5cbiAgICByZXR1cm4gcmVzdWx0cy5tYXAocmVzdWx0ID0+IHRoaXMuZW5oYW5jZUNhcmVIaXN0b3J5KHJlc3VsdC5jYXJlSGlzdG9yeSwgcmVzdWx0LnBsYW50SW5zdGFuY2UsIHJlc3VsdC5wbGFudCkpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBjYXJlIGhpc3RvcnkgZm9yIG11bHRpcGxlIHBsYW50IGluc3RhbmNlcyAoZm9yIGRhc2hib2FyZClcbiAgICovXG4gIHN0YXRpYyBhc3luYyBnZXRDYXJlSGlzdG9yeUZvclBsYW50cyhcbiAgICBwbGFudEluc3RhbmNlSWRzOiBudW1iZXJbXSxcbiAgICB1c2VySWQ6IG51bWJlcixcbiAgICBmaWx0ZXJzPzogUGFydGlhbDxDYXJlRmlsdGVySW5wdXQ+XG4gICk6IFByb21pc2U8RW5oYW5jZWRDYXJlSGlzdG9yeVtdPiB7XG4gICAgaWYgKHBsYW50SW5zdGFuY2VJZHMubGVuZ3RoID09PSAwKSByZXR1cm4gW107XG5cbiAgICAvLyBCdWlsZCB3aGVyZSBjb25kaXRpb25zXG4gICAgY29uc3QgY29uZGl0aW9ucyA9IFtcbiAgICAgIGluQXJyYXkoY2FyZUhpc3RvcnkucGxhbnRJbnN0YW5jZUlkLCBwbGFudEluc3RhbmNlSWRzKSxcbiAgICAgIGVxKGNhcmVIaXN0b3J5LnVzZXJJZCwgdXNlcklkKVxuICAgIF07XG5cbiAgICBpZiAoZmlsdGVycz8uY2FyZVR5cGUpIHtcbiAgICAgIGNvbmRpdGlvbnMucHVzaChlcShjYXJlSGlzdG9yeS5jYXJlVHlwZSwgZmlsdGVycy5jYXJlVHlwZSkpO1xuICAgIH1cblxuICAgIGlmIChmaWx0ZXJzPy5zdGFydERhdGUpIHtcbiAgICAgIGNvbmRpdGlvbnMucHVzaChndGUoY2FyZUhpc3RvcnkuY2FyZURhdGUsIGZpbHRlcnMuc3RhcnREYXRlKSk7XG4gICAgfVxuXG4gICAgaWYgKGZpbHRlcnM/LmVuZERhdGUpIHtcbiAgICAgIGNvbmRpdGlvbnMucHVzaChsdGUoY2FyZUhpc3RvcnkuY2FyZURhdGUsIGZpbHRlcnMuZW5kRGF0ZSkpO1xuICAgIH1cblxuICAgIC8vIEFwcGx5IHNvcnRpbmdcbiAgICBjb25zdCBzb3J0RmllbGQgPSBmaWx0ZXJzPy5zb3J0QnkgPT09ICdjYXJlX3R5cGUnID8gY2FyZUhpc3RvcnkuY2FyZVR5cGUgOlxuICAgICAgICAgICAgICAgICAgICAgZmlsdGVycz8uc29ydEJ5ID09PSAnY3JlYXRlZF9hdCcgPyBjYXJlSGlzdG9yeS5jcmVhdGVkQXQgOlxuICAgICAgICAgICAgICAgICAgICAgY2FyZUhpc3RvcnkuY2FyZURhdGU7XG4gICAgXG4gICAgY29uc3Qgc29ydE9yZGVyID0gZmlsdGVycz8uc29ydE9yZGVyID09PSAnYXNjJyA/IGFzYyhzb3J0RmllbGQpIDogZGVzYyhzb3J0RmllbGQpO1xuXG4gICAgLy8gQnVpbGQgdGhlIHF1ZXJ5XG4gICAgbGV0IHF1ZXJ5ID0gZGJcbiAgICAgIC5zZWxlY3Qoe1xuICAgICAgICBjYXJlSGlzdG9yeTogY2FyZUhpc3RvcnksXG4gICAgICAgIHBsYW50SW5zdGFuY2U6IHBsYW50SW5zdGFuY2VzLFxuICAgICAgICBwbGFudDogcGxhbnRzLFxuICAgICAgfSlcbiAgICAgIC5mcm9tKGNhcmVIaXN0b3J5KVxuICAgICAgLmxlZnRKb2luKHBsYW50SW5zdGFuY2VzLCBlcShjYXJlSGlzdG9yeS5wbGFudEluc3RhbmNlSWQsIHBsYW50SW5zdGFuY2VzLmlkKSlcbiAgICAgIC5sZWZ0Sm9pbihwbGFudHMsIGVxKHBsYW50SW5zdGFuY2VzLnBsYW50SWQsIHBsYW50cy5pZCkpXG4gICAgICAud2hlcmUoYW5kKC4uLmNvbmRpdGlvbnMpKVxuICAgICAgLm9yZGVyQnkoc29ydE9yZGVyKTtcblxuICAgIC8vIEFwcGx5IHBhZ2luYXRpb25cbiAgICBpZiAoZmlsdGVycz8ubGltaXQpIHtcbiAgICAgIHF1ZXJ5ID0gcXVlcnkubGltaXQoZmlsdGVycy5saW1pdCkgYXMgYW55O1xuICAgIH1cbiAgICBpZiAoZmlsdGVycz8ub2Zmc2V0KSB7XG4gICAgICBxdWVyeSA9IHF1ZXJ5Lm9mZnNldChmaWx0ZXJzLm9mZnNldCkgYXMgYW55O1xuICAgIH1cblxuICAgIGNvbnN0IHJlc3VsdHMgPSBhd2FpdCBxdWVyeTtcblxuICAgIHJldHVybiByZXN1bHRzLm1hcChyZXN1bHQgPT4gdGhpcy5lbmhhbmNlQ2FyZUhpc3RvcnkocmVzdWx0LmNhcmVIaXN0b3J5LCByZXN1bHQucGxhbnRJbnN0YW5jZSwgcmVzdWx0LnBsYW50KSk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHJlY2VudCBjYXJlIGhpc3RvcnkgZm9yIGEgdXNlclxuICAgKi9cbiAgc3RhdGljIGFzeW5jIGdldFJlY2VudENhcmVIaXN0b3J5KFxuICAgIHVzZXJJZDogbnVtYmVyLFxuICAgIGxpbWl0OiBudW1iZXIgPSAyMFxuICApOiBQcm9taXNlPEVuaGFuY2VkQ2FyZUhpc3RvcnlbXT4ge1xuICAgIGNvbnN0IHJlc3VsdHMgPSBhd2FpdCBkYlxuICAgICAgLnNlbGVjdCh7XG4gICAgICAgIGNhcmVIaXN0b3J5OiBjYXJlSGlzdG9yeSxcbiAgICAgICAgcGxhbnRJbnN0YW5jZTogcGxhbnRJbnN0YW5jZXMsXG4gICAgICAgIHBsYW50OiBwbGFudHMsXG4gICAgICB9KVxuICAgICAgLmZyb20oY2FyZUhpc3RvcnkpXG4gICAgICAubGVmdEpvaW4ocGxhbnRJbnN0YW5jZXMsIGVxKGNhcmVIaXN0b3J5LnBsYW50SW5zdGFuY2VJZCwgcGxhbnRJbnN0YW5jZXMuaWQpKVxuICAgICAgLmxlZnRKb2luKHBsYW50cywgZXEocGxhbnRJbnN0YW5jZXMucGxhbnRJZCwgcGxhbnRzLmlkKSlcbiAgICAgIC53aGVyZShlcShjYXJlSGlzdG9yeS51c2VySWQsIHVzZXJJZCkpXG4gICAgICAub3JkZXJCeShkZXNjKGNhcmVIaXN0b3J5LmNhcmVEYXRlKSlcbiAgICAgIC5saW1pdChsaW1pdCk7XG5cbiAgICByZXR1cm4gcmVzdWx0cy5tYXAocmVzdWx0ID0+IHRoaXMuZW5oYW5jZUNhcmVIaXN0b3J5KHJlc3VsdC5jYXJlSGlzdG9yeSwgcmVzdWx0LnBsYW50SW5zdGFuY2UsIHJlc3VsdC5wbGFudCkpO1xuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZSBjYXJlIGhpc3RvcnkgZW50cnlcbiAgICovXG4gIHN0YXRpYyBhc3luYyB1cGRhdGVDYXJlSGlzdG9yeShcbiAgICBpZDogbnVtYmVyLFxuICAgIHVzZXJJZDogbnVtYmVyLFxuICAgIHVwZGF0ZXM6IFBhcnRpYWw8TmV3Q2FyZUhpc3Rvcnk+XG4gICk6IFByb21pc2U8Q2FyZUhpc3RvcnkgfCBudWxsPiB7XG4gICAgY29uc3QgW3VwZGF0ZWRdID0gYXdhaXQgZGJcbiAgICAgIC51cGRhdGUoY2FyZUhpc3RvcnkpXG4gICAgICAuc2V0KHtcbiAgICAgICAgLi4udXBkYXRlcyxcbiAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgfSlcbiAgICAgIC53aGVyZShcbiAgICAgICAgYW5kKFxuICAgICAgICAgIGVxKGNhcmVIaXN0b3J5LmlkLCBpZCksXG4gICAgICAgICAgZXEoY2FyZUhpc3RvcnkudXNlcklkLCB1c2VySWQpXG4gICAgICAgIClcbiAgICAgIClcbiAgICAgIC5yZXR1cm5pbmcoKTtcblxuICAgIHJldHVybiB1cGRhdGVkIHx8IG51bGw7XG4gIH1cblxuICAvKipcbiAgICogRGVsZXRlIGNhcmUgaGlzdG9yeSBlbnRyeVxuICAgKi9cbiAgc3RhdGljIGFzeW5jIGRlbGV0ZUNhcmVIaXN0b3J5KGlkOiBudW1iZXIsIHVzZXJJZDogbnVtYmVyKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgLy8gRmlyc3QgY2hlY2sgaWYgcmVjb3JkIGV4aXN0cyBhbmQgYmVsb25ncyB0byB1c2VyXG4gICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBkYlxuICAgICAgLnNlbGVjdCgpXG4gICAgICAuZnJvbShjYXJlSGlzdG9yeSlcbiAgICAgIC53aGVyZShcbiAgICAgICAgYW5kKFxuICAgICAgICAgIGVxKGNhcmVIaXN0b3J5LmlkLCBpZCksXG4gICAgICAgICAgZXEoY2FyZUhpc3RvcnkudXNlcklkLCB1c2VySWQpXG4gICAgICAgIClcbiAgICAgIClcbiAgICAgIC5saW1pdCgxKTtcbiAgICBcbiAgICBpZiAoZXhpc3RpbmcubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4gZmFsc2U7IC8vIFJlY29yZCBkb2Vzbid0IGV4aXN0IG9yIGRvZXNuJ3QgYmVsb25nIHRvIHVzZXJcbiAgICB9XG4gICAgXG4gICAgLy8gUGVyZm9ybSB0aGUgZGVsZXRlXG4gICAgYXdhaXQgZGJcbiAgICAgIC5kZWxldGUoY2FyZUhpc3RvcnkpXG4gICAgICAud2hlcmUoXG4gICAgICAgIGFuZChcbiAgICAgICAgICBlcShjYXJlSGlzdG9yeS5pZCwgaWQpLFxuICAgICAgICAgIGVxKGNhcmVIaXN0b3J5LnVzZXJJZCwgdXNlcklkKVxuICAgICAgICApXG4gICAgICApO1xuICAgIFxuICAgIC8vIFZlcmlmeSBkZWxldGlvbiBieSBjaGVja2luZyBpZiByZWNvcmQgc3RpbGwgZXhpc3RzXG4gICAgY29uc3Qgc3RpbGxFeGlzdHMgPSBhd2FpdCBkYlxuICAgICAgLnNlbGVjdCgpXG4gICAgICAuZnJvbShjYXJlSGlzdG9yeSlcbiAgICAgIC53aGVyZShlcShjYXJlSGlzdG9yeS5pZCwgaWQpKVxuICAgICAgLmxpbWl0KDEpO1xuICAgICAgICBcbiAgICByZXR1cm4gc3RpbGxFeGlzdHMubGVuZ3RoID09PSAwO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBjYXJlIHN0YXRpc3RpY3MgZm9yIGEgcGxhbnQgaW5zdGFuY2VcbiAgICovXG4gIHN0YXRpYyBhc3luYyBnZXRQbGFudENhcmVTdGF0aXN0aWNzKFxuICAgIHBsYW50SW5zdGFuY2VJZDogbnVtYmVyLFxuICAgIHVzZXJJZDogbnVtYmVyXG4gICk6IFByb21pc2U8UGxhbnRDYXJlU3RhdGlzdGljcyB8IG51bGw+IHtcbiAgICAvLyBHZXQgcGxhbnQgaW5zdGFuY2VcbiAgICBjb25zdCBbcGxhbnRJbnN0YW5jZV0gPSBhd2FpdCBkYlxuICAgICAgLnNlbGVjdCgpXG4gICAgICAuZnJvbShwbGFudEluc3RhbmNlcylcbiAgICAgIC53aGVyZShcbiAgICAgICAgYW5kKFxuICAgICAgICAgIGVxKHBsYW50SW5zdGFuY2VzLmlkLCBwbGFudEluc3RhbmNlSWQpLFxuICAgICAgICAgIGVxKHBsYW50SW5zdGFuY2VzLnVzZXJJZCwgdXNlcklkKVxuICAgICAgICApXG4gICAgICApXG4gICAgICAubGltaXQoMSk7XG5cbiAgICBpZiAoIXBsYW50SW5zdGFuY2UpIHJldHVybiBudWxsO1xuXG4gICAgLy8gR2V0IGNhcmUgaGlzdG9yeVxuICAgIGNvbnN0IGNhcmVIaXN0b3J5RGF0YSA9IGF3YWl0IGRiXG4gICAgICAuc2VsZWN0KClcbiAgICAgIC5mcm9tKGNhcmVIaXN0b3J5KVxuICAgICAgLndoZXJlKFxuICAgICAgICBhbmQoXG4gICAgICAgICAgZXEoY2FyZUhpc3RvcnkucGxhbnRJbnN0YW5jZUlkLCBwbGFudEluc3RhbmNlSWQpLFxuICAgICAgICAgIGVxKGNhcmVIaXN0b3J5LnVzZXJJZCwgdXNlcklkKVxuICAgICAgICApXG4gICAgICApXG4gICAgICAub3JkZXJCeShhc2MoY2FyZUhpc3RvcnkuY2FyZURhdGUpKTtcblxuICAgIHJldHVybiBDYXJlQ2FsY3VsYXRvci5jYWxjdWxhdGVQbGFudENhcmVTdGF0aXN0aWNzKHBsYW50SW5zdGFuY2UsIGNhcmVIaXN0b3J5RGF0YSk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGNhcmUgc3RhdGlzdGljcyBmb3IgbXVsdGlwbGUgcGxhbnRzXG4gICAqL1xuICBzdGF0aWMgYXN5bmMgZ2V0QnVsa0NhcmVTdGF0aXN0aWNzKFxuICAgIHBsYW50SW5zdGFuY2VJZHM6IG51bWJlcltdLFxuICAgIHVzZXJJZDogbnVtYmVyXG4gICk6IFByb21pc2U8UGxhbnRDYXJlU3RhdGlzdGljc1tdPiB7XG4gICAgaWYgKHBsYW50SW5zdGFuY2VJZHMubGVuZ3RoID09PSAwKSByZXR1cm4gW107XG5cbiAgICAvLyBHZXQgcGxhbnQgaW5zdGFuY2VzXG4gICAgY29uc3QgcGxhbnRJbnN0YW5jZXNEYXRhID0gYXdhaXQgZGJcbiAgICAgIC5zZWxlY3QoKVxuICAgICAgLmZyb20ocGxhbnRJbnN0YW5jZXMpXG4gICAgICAud2hlcmUoXG4gICAgICAgIGFuZChcbiAgICAgICAgICBpbkFycmF5KHBsYW50SW5zdGFuY2VzLmlkLCBwbGFudEluc3RhbmNlSWRzKSxcbiAgICAgICAgICBlcShwbGFudEluc3RhbmNlcy51c2VySWQsIHVzZXJJZClcbiAgICAgICAgKVxuICAgICAgKTtcblxuICAgIC8vIEdldCBjYXJlIGhpc3RvcnkgZm9yIGFsbCBwbGFudHNcbiAgICBjb25zdCBjYXJlSGlzdG9yeURhdGEgPSBhd2FpdCBkYlxuICAgICAgLnNlbGVjdCgpXG4gICAgICAuZnJvbShjYXJlSGlzdG9yeSlcbiAgICAgIC53aGVyZShcbiAgICAgICAgYW5kKFxuICAgICAgICAgIGluQXJyYXkoY2FyZUhpc3RvcnkucGxhbnRJbnN0YW5jZUlkLCBwbGFudEluc3RhbmNlSWRzKSxcbiAgICAgICAgICBlcShjYXJlSGlzdG9yeS51c2VySWQsIHVzZXJJZClcbiAgICAgICAgKVxuICAgICAgKVxuICAgICAgLm9yZGVyQnkoYXNjKGNhcmVIaXN0b3J5LmNhcmVEYXRlKSk7XG5cbiAgICAvLyBHcm91cCBjYXJlIGhpc3RvcnkgYnkgcGxhbnQgaW5zdGFuY2VcbiAgICBjb25zdCBjYXJlSGlzdG9yeUJ5UGxhbnQgPSBjYXJlSGlzdG9yeURhdGEucmVkdWNlKChhY2MsIGNhcmUpID0+IHtcbiAgICAgIGlmICghYWNjW2NhcmUucGxhbnRJbnN0YW5jZUlkXSkge1xuICAgICAgICBhY2NbY2FyZS5wbGFudEluc3RhbmNlSWRdID0gW107XG4gICAgICB9XG4gICAgICBhY2NbY2FyZS5wbGFudEluc3RhbmNlSWRdLnB1c2goY2FyZSk7XG4gICAgICByZXR1cm4gYWNjO1xuICAgIH0sIHt9IGFzIFJlY29yZDxudW1iZXIsIENhcmVIaXN0b3J5W10+KTtcblxuICAgIC8vIENhbGN1bGF0ZSBzdGF0aXN0aWNzIGZvciBlYWNoIHBsYW50XG4gICAgcmV0dXJuIHBsYW50SW5zdGFuY2VzRGF0YS5tYXAocGxhbnRJbnN0YW5jZSA9PiBcbiAgICAgIENhcmVDYWxjdWxhdG9yLmNhbGN1bGF0ZVBsYW50Q2FyZVN0YXRpc3RpY3MoXG4gICAgICAgIHBsYW50SW5zdGFuY2UsIFxuICAgICAgICBjYXJlSGlzdG9yeUJ5UGxhbnRbcGxhbnRJbnN0YW5jZS5pZF0gfHwgW11cbiAgICAgIClcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBjYXJlIGRhc2hib2FyZCBkYXRhXG4gICAqL1xuICBzdGF0aWMgYXN5bmMgZ2V0Q2FyZURhc2hib2FyZERhdGEoXG4gICAgdXNlcklkOiBudW1iZXIsXG4gICAgb3B0aW9uczogUGFydGlhbDxDYXJlRGFzaGJvYXJkUXVlcnlJbnB1dD4gPSB7fVxuICApOiBQcm9taXNlPENhcmVEYXNoYm9hcmREYXRhPiB7XG4gICAgY29uc3QgeyBpbmNsdWRlSW5hY3RpdmUgPSBmYWxzZSwgZGF5c0FoZWFkID0gNyB9ID0gb3B0aW9ucztcblxuICAgIC8vIEdldCBhbGwgcGxhbnQgaW5zdGFuY2VzIGZvciB0aGUgdXNlclxuICAgIGNvbnN0IHBsYW50SW5zdGFuY2VzRGF0YSA9IGF3YWl0IGRiXG4gICAgICAuc2VsZWN0KHtcbiAgICAgICAgcGxhbnRJbnN0YW5jZTogcGxhbnRJbnN0YW5jZXMsXG4gICAgICAgIHBsYW50OiBwbGFudHMsXG4gICAgICB9KVxuICAgICAgLmZyb20ocGxhbnRJbnN0YW5jZXMpXG4gICAgICAubGVmdEpvaW4ocGxhbnRzLCBlcShwbGFudEluc3RhbmNlcy5wbGFudElkLCBwbGFudHMuaWQpKVxuICAgICAgLndoZXJlKFxuICAgICAgICBpbmNsdWRlSW5hY3RpdmUgXG4gICAgICAgICAgPyBlcShwbGFudEluc3RhbmNlcy51c2VySWQsIHVzZXJJZClcbiAgICAgICAgICA6IGFuZChcbiAgICAgICAgICAgICAgZXEocGxhbnRJbnN0YW5jZXMudXNlcklkLCB1c2VySWQpLFxuICAgICAgICAgICAgICBlcShwbGFudEluc3RhbmNlcy5pc0FjdGl2ZSwgdHJ1ZSlcbiAgICAgICAgICAgIClcbiAgICAgICk7XG5cbiAgICAvLyBHZXQgcmVjZW50IGNhcmUgaGlzdG9yeSBmb3Igc3RhdGlzdGljc1xuICAgIGNvbnN0IG9uZVdlZWtBZ28gPSBuZXcgRGF0ZSgpO1xuICAgIG9uZVdlZWtBZ28uc2V0RGF0ZShvbmVXZWVrQWdvLmdldERhdGUoKSAtIDcpO1xuXG4gICAgY29uc3QgcmVjZW50Q2FyZUhpc3RvcnkgPSBhd2FpdCBkYlxuICAgICAgLnNlbGVjdCgpXG4gICAgICAuZnJvbShjYXJlSGlzdG9yeSlcbiAgICAgIC53aGVyZShcbiAgICAgICAgYW5kKFxuICAgICAgICAgIGVxKGNhcmVIaXN0b3J5LnVzZXJJZCwgdXNlcklkKSxcbiAgICAgICAgICBndGUoY2FyZUhpc3RvcnkuY2FyZURhdGUsIG9uZVdlZWtBZ28pXG4gICAgICAgIClcbiAgICAgICk7XG5cbiAgICAvLyBFbmhhbmNlIHBsYW50IGluc3RhbmNlcyB3aXRoIGNhcmUgY2FsY3VsYXRpb25zXG4gICAgY29uc3QgZW5oYW5jZWRQbGFudHMgPSBwbGFudEluc3RhbmNlc0RhdGEubWFwKCh7IHBsYW50SW5zdGFuY2UsIHBsYW50IH0pID0+IHtcbiAgICAgIGlmICghcGxhbnQpIHJldHVybiBudWxsO1xuICAgICAgXG4gICAgICBjb25zdCBjYXJlU3RhdHVzID0gQ2FyZUNhbGN1bGF0b3IuY2FsY3VsYXRlQ2FyZVN0YXR1cyhwbGFudEluc3RhbmNlLmZlcnRpbGl6ZXJEdWUpO1xuICAgICAgY29uc3QgY2FyZVVyZ2VuY3kgPSBDYXJlQ2FsY3VsYXRvci5jYWxjdWxhdGVDYXJlVXJnZW5jeShwbGFudEluc3RhbmNlLmZlcnRpbGl6ZXJEdWUpO1xuICAgICAgY29uc3QgZGF5c1VudGlsRmVydGlsaXplckR1ZSA9IENhcmVDYWxjdWxhdG9yLmNhbGN1bGF0ZURheXNVbnRpbEZlcnRpbGl6ZXJEdWUocGxhbnRJbnN0YW5jZS5mZXJ0aWxpemVyRHVlKTtcbiAgICAgIGNvbnN0IGRheXNTaW5jZUxhc3RGZXJ0aWxpemVkID0gQ2FyZUNhbGN1bGF0b3IuY2FsY3VsYXRlRGF5c1NpbmNlTGFzdEZlcnRpbGl6ZWQocGxhbnRJbnN0YW5jZS5sYXN0RmVydGlsaXplZCk7XG4gICAgICBjb25zdCBkYXlzU2luY2VMYXN0UmVwb3QgPSBDYXJlQ2FsY3VsYXRvci5jYWxjdWxhdGVEYXlzU2luY2VMYXN0UmVwb3QocGxhbnRJbnN0YW5jZS5sYXN0UmVwb3QpO1xuICAgICAgY29uc3QgZGlzcGxheU5hbWUgPSBwbGFudEluc3RhbmNlLm5pY2tuYW1lIHx8IHBsYW50LmNvbW1vbk5hbWU7XG4gICAgICBjb25zdCBwcmltYXJ5SW1hZ2UgPSBwbGFudEluc3RhbmNlLmltYWdlcz8uWzBdIHx8IHBsYW50LmRlZmF1bHRJbWFnZSB8fCBudWxsO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5wbGFudEluc3RhbmNlLFxuICAgICAgICBwbGFudCxcbiAgICAgICAgY2FyZVN0YXR1cyxcbiAgICAgICAgY2FyZVVyZ2VuY3ksXG4gICAgICAgIGRheXNVbnRpbEZlcnRpbGl6ZXJEdWUsXG4gICAgICAgIGRheXNTaW5jZUxhc3RGZXJ0aWxpemVkLFxuICAgICAgICBkYXlzU2luY2VMYXN0UmVwb3QsXG4gICAgICAgIGRpc3BsYXlOYW1lLFxuICAgICAgICBwcmltYXJ5SW1hZ2UsXG4gICAgICB9O1xuICAgIH0pLmZpbHRlcigocGxhbnQpOiBwbGFudCBpcyBFbmhhbmNlZFBsYW50SW5zdGFuY2UgPT4gcGxhbnQgIT09IG51bGwpO1xuXG4gICAgLy8gQ2F0ZWdvcml6ZSBwbGFudHMgYnkgY2FyZSBzdGF0dXNcbiAgICBjb25zdCBvdmVyZHVlID0gZW5oYW5jZWRQbGFudHMuZmlsdGVyKHAgPT4gcC5jYXJlU3RhdHVzID09PSAnb3ZlcmR1ZScpO1xuICAgIGNvbnN0IGR1ZVRvZGF5ID0gZW5oYW5jZWRQbGFudHMuZmlsdGVyKHAgPT4gcC5jYXJlU3RhdHVzID09PSAnZHVlX3RvZGF5Jyk7XG4gICAgY29uc3QgZHVlU29vbiA9IGVuaGFuY2VkUGxhbnRzLmZpbHRlcihwID0+IHAuY2FyZVN0YXR1cyA9PT0gJ2R1ZV9zb29uJyk7XG4gICAgXG4gICAgLy8gR2V0IHJlY2VudGx5IGNhcmVkIHBsYW50cyAoZmVydGlsaXplZCBpbiBsYXN0IDMgZGF5cylcbiAgICBjb25zdCB0aHJlZURheXNBZ28gPSBuZXcgRGF0ZSgpO1xuICAgIHRocmVlRGF5c0Fnby5zZXREYXRlKHRocmVlRGF5c0Fnby5nZXREYXRlKCkgLSAzKTtcbiAgICBjb25zdCByZWNlbnRseUNhcmVkID0gZW5oYW5jZWRQbGFudHMuZmlsdGVyKHAgPT4gXG4gICAgICBwLmxhc3RGZXJ0aWxpemVkICYmIHAubGFzdEZlcnRpbGl6ZWQgPj0gdGhyZWVEYXlzQWdvXG4gICAgKTtcblxuICAgIC8vIENhbGN1bGF0ZSBjYXJlIHN0cmVhayAoY29uc2VjdXRpdmUgZGF5cyB3aXRoIHByb3BlciBjYXJlKVxuICAgIGNvbnN0IGNhcmVTdHJlYWtEYXlzID0gdGhpcy5jYWxjdWxhdGVVc2VyQ2FyZVN0cmVhayh1c2VySWQsIHJlY2VudENhcmVIaXN0b3J5KTtcblxuICAgIC8vIENhbGN1bGF0ZSBhdmVyYWdlIGNhcmUgY29uc2lzdGVuY3kgYWNyb3NzIGFsbCBwbGFudHNcbiAgICBjb25zdCBhdmVyYWdlQ2FyZUNvbnNpc3RlbmN5ID0gZW5oYW5jZWRQbGFudHMubGVuZ3RoID4gMFxuICAgICAgPyBlbmhhbmNlZFBsYW50cy5yZWR1Y2UoKHN1bSwgcGxhbnQpID0+IHtcbiAgICAgICAgICAvLyBTaW1wbGlmaWVkIGNvbnNpc3RlbmN5IGNhbGN1bGF0aW9uIGZvciBkYXNoYm9hcmRcbiAgICAgICAgICBjb25zdCBkYXlzU2luY2UgPSBwbGFudC5kYXlzU2luY2VMYXN0RmVydGlsaXplZCB8fCAwO1xuICAgICAgICAgIGNvbnN0IHNjaGVkdWxlRGF5cyA9IGNhcmVIZWxwZXJzLnBhcnNlRmVydGlsaXplclNjaGVkdWxlKHBsYW50LmZlcnRpbGl6ZXJTY2hlZHVsZSk7XG4gICAgICAgICAgY29uc3QgY29uc2lzdGVuY3kgPSBNYXRoLm1heCgwLCAxMDAgLSAoZGF5c1NpbmNlIC8gc2NoZWR1bGVEYXlzKSAqIDUwKTtcbiAgICAgICAgICByZXR1cm4gc3VtICsgY29uc2lzdGVuY3k7XG4gICAgICAgIH0sIDApIC8gZW5oYW5jZWRQbGFudHMubGVuZ3RoXG4gICAgICA6IDA7XG5cbiAgICByZXR1cm4ge1xuICAgICAgb3ZlcmR1ZSxcbiAgICAgIGR1ZVRvZGF5LFxuICAgICAgZHVlU29vbixcbiAgICAgIHJlY2VudGx5Q2FyZWQsXG4gICAgICBzdGF0aXN0aWNzOiB7XG4gICAgICAgIHRvdGFsQWN0aXZlUGxhbnRzOiBlbmhhbmNlZFBsYW50cy5sZW5ndGgsXG4gICAgICAgIG92ZXJkdWVDb3VudDogb3ZlcmR1ZS5sZW5ndGgsXG4gICAgICAgIGR1ZVRvZGF5Q291bnQ6IGR1ZVRvZGF5Lmxlbmd0aCxcbiAgICAgICAgZHVlU29vbkNvdW50OiBkdWVTb29uLmxlbmd0aCxcbiAgICAgICAgY2FyZVN0cmVha0RheXMsXG4gICAgICAgIHRvdGFsQ2FyZUV2ZW50c1RoaXNXZWVrOiByZWNlbnRDYXJlSGlzdG9yeS5sZW5ndGgsXG4gICAgICAgIGF2ZXJhZ2VDYXJlQ29uc2lzdGVuY3k6IE1hdGgucm91bmQoYXZlcmFnZUNhcmVDb25zaXN0ZW5jeSksXG4gICAgICB9LFxuICAgICAgcXVpY2tBY3Rpb25zOiBjYXJlSGVscGVycy5nZXREZWZhdWx0UXVpY2tDYXJlQWN0aW9ucygpLFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogR2V0IGNhcmUgaGlzdG9yeSBjb3VudCBmb3IgYSBwbGFudCBpbnN0YW5jZVxuICAgKi9cbiAgc3RhdGljIGFzeW5jIGdldENhcmVIaXN0b3J5Q291bnQoXG4gICAgcGxhbnRJbnN0YW5jZUlkOiBudW1iZXIsXG4gICAgdXNlcklkOiBudW1iZXIsXG4gICAgY2FyZVR5cGU/OiBDYXJlVHlwZVxuICApOiBQcm9taXNlPG51bWJlcj4ge1xuICAgIGNvbnN0IGNvbmRpdGlvbnMgPSBbXG4gICAgICBlcShjYXJlSGlzdG9yeS5wbGFudEluc3RhbmNlSWQsIHBsYW50SW5zdGFuY2VJZCksXG4gICAgICBlcShjYXJlSGlzdG9yeS51c2VySWQsIHVzZXJJZClcbiAgICBdO1xuXG4gICAgaWYgKGNhcmVUeXBlKSB7XG4gICAgICBjb25kaXRpb25zLnB1c2goZXEoY2FyZUhpc3RvcnkuY2FyZVR5cGUsIGNhcmVUeXBlKSk7XG4gICAgfVxuXG4gICAgY29uc3QgW3Jlc3VsdF0gPSBhd2FpdCBkYlxuICAgICAgLnNlbGVjdCh7IGNvdW50OiBjb3VudCgpIH0pXG4gICAgICAuZnJvbShjYXJlSGlzdG9yeSlcbiAgICAgIC53aGVyZShhbmQoLi4uY29uZGl0aW9ucykpO1xuXG4gICAgcmV0dXJuIHJlc3VsdC5jb3VudDtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgbGFzdCBjYXJlIGRhdGUgZm9yIGEgc3BlY2lmaWMgY2FyZSB0eXBlXG4gICAqL1xuICBzdGF0aWMgYXN5bmMgZ2V0TGFzdENhcmVEYXRlKFxuICAgIHBsYW50SW5zdGFuY2VJZDogbnVtYmVyLFxuICAgIHVzZXJJZDogbnVtYmVyLFxuICAgIGNhcmVUeXBlOiBDYXJlVHlwZVxuICApOiBQcm9taXNlPERhdGUgfCBudWxsPiB7XG4gICAgY29uc3QgW3Jlc3VsdF0gPSBhd2FpdCBkYlxuICAgICAgLnNlbGVjdCh7IGNhcmVEYXRlOiBjYXJlSGlzdG9yeS5jYXJlRGF0ZSB9KVxuICAgICAgLmZyb20oY2FyZUhpc3RvcnkpXG4gICAgICAud2hlcmUoXG4gICAgICAgIGFuZChcbiAgICAgICAgICBlcShjYXJlSGlzdG9yeS5wbGFudEluc3RhbmNlSWQsIHBsYW50SW5zdGFuY2VJZCksXG4gICAgICAgICAgZXEoY2FyZUhpc3RvcnkudXNlcklkLCB1c2VySWQpLFxuICAgICAgICAgIGVxKGNhcmVIaXN0b3J5LmNhcmVUeXBlLCBjYXJlVHlwZSlcbiAgICAgICAgKVxuICAgICAgKVxuICAgICAgLm9yZGVyQnkoZGVzYyhjYXJlSGlzdG9yeS5jYXJlRGF0ZSkpXG4gICAgICAubGltaXQoMSk7XG5cbiAgICByZXR1cm4gcmVzdWx0Py5jYXJlRGF0ZSB8fCBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIEJ1bGsgY3JlYXRlIGNhcmUgaGlzdG9yeSBlbnRyaWVzXG4gICAqL1xuICBzdGF0aWMgYXN5bmMgYnVsa0NyZWF0ZUNhcmVIaXN0b3J5KGVudHJpZXM6IE5ld0NhcmVIaXN0b3J5W10pOiBQcm9taXNlPENhcmVIaXN0b3J5W10+IHtcbiAgICBpZiAoZW50cmllcy5sZW5ndGggPT09IDApIHJldHVybiBbXTtcblxuICAgIGNvbnN0IGVudHJpZXNXaXRoVGltZXN0YW1wcyA9IGVudHJpZXMubWFwKGVudHJ5ID0+ICh7XG4gICAgICAuLi5lbnRyeSxcbiAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICB9KSk7XG5cbiAgICByZXR1cm4gYXdhaXQgZGJcbiAgICAgIC5pbnNlcnQoY2FyZUhpc3RvcnkpXG4gICAgICAudmFsdWVzKGVudHJpZXNXaXRoVGltZXN0YW1wcylcbiAgICAgIC5yZXR1cm5pbmcoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQcml2YXRlIGhlbHBlciB0byBlbmhhbmNlIGNhcmUgaGlzdG9yeSB3aXRoIGNvbXB1dGVkIHByb3BlcnRpZXNcbiAgICovXG4gIHByaXZhdGUgc3RhdGljIGVuaGFuY2VDYXJlSGlzdG9yeShcbiAgICBjYXJlOiBDYXJlSGlzdG9yeSxcbiAgICBwbGFudEluc3RhbmNlPzogUGxhbnRJbnN0YW5jZSB8IG51bGwsXG4gICAgcGxhbnQ/OiBQbGFudCB8IG51bGxcbiAgKTogRW5oYW5jZWRDYXJlSGlzdG9yeSB7XG4gICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcbiAgICBjb25zdCBkYXlzU2luY2VDYXJlID0gTWF0aC5mbG9vcigobm93LmdldFRpbWUoKSAtIGNhcmUuY2FyZURhdGUuZ2V0VGltZSgpKSAvICgxMDAwICogNjAgKiA2MCAqIDI0KSk7XG4gICAgY29uc3QgZm9ybWF0dGVkRGF0ZSA9IGNhcmVIZWxwZXJzLmZvcm1hdENhcmVEYXRlKGNhcmUuY2FyZURhdGUpO1xuICAgIGNvbnN0IGNhcmVUeXBlRGlzcGxheSA9IGNhcmVIZWxwZXJzLmdldENhcmVUeXBlRGlzcGxheShjYXJlLmNhcmVUeXBlIGFzIENhcmVUeXBlKTtcblxuICAgIHJldHVybiB7XG4gICAgICAuLi5jYXJlLFxuICAgICAgcGxhbnRJbnN0YW5jZTogcGxhbnRJbnN0YW5jZSAmJiBwbGFudCA/IHsgLi4ucGxhbnRJbnN0YW5jZSwgcGxhbnQgfSA6IHVuZGVmaW5lZCxcbiAgICAgIGRheXNTaW5jZUNhcmUsXG4gICAgICBmb3JtYXR0ZWREYXRlLFxuICAgICAgY2FyZVR5cGVEaXNwbGF5LFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogUHJpdmF0ZSBoZWxwZXIgdG8gY2FsY3VsYXRlIHVzZXIgY2FyZSBzdHJlYWtcbiAgICovXG4gIHByaXZhdGUgc3RhdGljIGNhbGN1bGF0ZVVzZXJDYXJlU3RyZWFrKFxuICAgIHVzZXJJZDogbnVtYmVyLFxuICAgIHJlY2VudENhcmVIaXN0b3J5OiBDYXJlSGlzdG9yeVtdXG4gICk6IG51bWJlciB7XG4gICAgLy8gU2ltcGxpZmllZCBjYXJlIHN0cmVhayBjYWxjdWxhdGlvblxuICAgIC8vIENvdW50IGNvbnNlY3V0aXZlIGRheXMgd2l0aCBhdCBsZWFzdCBvbmUgY2FyZSBldmVudFxuICAgIGNvbnN0IGNhcmVCeURhdGUgPSByZWNlbnRDYXJlSGlzdG9yeS5yZWR1Y2UoKGFjYywgY2FyZSkgPT4ge1xuICAgICAgY29uc3QgZGF0ZUtleSA9IGNhcmUuY2FyZURhdGUudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdO1xuICAgICAgYWNjW2RhdGVLZXldID0gdHJ1ZTtcbiAgICAgIHJldHVybiBhY2M7XG4gICAgfSwge30gYXMgUmVjb3JkPHN0cmluZywgYm9vbGVhbj4pO1xuXG4gICAgbGV0IHN0cmVhayA9IDA7XG4gICAgY29uc3QgdG9kYXkgPSBuZXcgRGF0ZSgpO1xuICAgIFxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMzA7IGkrKykgeyAvLyBDaGVjayBsYXN0IDMwIGRheXNcbiAgICAgIGNvbnN0IGNoZWNrRGF0ZSA9IG5ldyBEYXRlKHRvZGF5KTtcbiAgICAgIGNoZWNrRGF0ZS5zZXREYXRlKGNoZWNrRGF0ZS5nZXREYXRlKCkgLSBpKTtcbiAgICAgIGNvbnN0IGRhdGVLZXkgPSBjaGVja0RhdGUudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdO1xuICAgICAgXG4gICAgICBpZiAoY2FyZUJ5RGF0ZVtkYXRlS2V5XSkge1xuICAgICAgICBzdHJlYWsrKztcbiAgICAgIH0gZWxzZSBpZiAoaSA+IDApIHsgLy8gRG9uJ3QgYnJlYWsgb24gZmlyc3QgZGF5ICh0b2RheSkgaWYgbm8gY2FyZVxuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gc3RyZWFrO1xuICB9XG59Il0sIm5hbWVzIjpbIkNhcmVIaXN0b3J5UXVlcmllcyIsImNyZWF0ZUNhcmVIaXN0b3J5IiwiZGF0YSIsInZhbGlkQ2FyZVR5cGVzIiwiaW5jbHVkZXMiLCJjYXJlVHlwZSIsIkVycm9yIiwiam9pbiIsImNhcmVFbnRyeSIsImRiIiwiaW5zZXJ0IiwiY2FyZUhpc3RvcnkiLCJ2YWx1ZXMiLCJjcmVhdGVkQXQiLCJEYXRlIiwidXBkYXRlZEF0IiwicmV0dXJuaW5nIiwiZ2V0Q2FyZUhpc3RvcnlCeUlkIiwiaWQiLCJzZWxlY3QiLCJmcm9tIiwid2hlcmUiLCJlcSIsImxpbWl0IiwiZ2V0Q2FyZUhpc3RvcnlGb3JQbGFudCIsInBsYW50SW5zdGFuY2VJZCIsInVzZXJJZCIsImZpbHRlcnMiLCJjb25kaXRpb25zIiwicHVzaCIsInN0YXJ0RGF0ZSIsImd0ZSIsImNhcmVEYXRlIiwiZW5kRGF0ZSIsImx0ZSIsInNvcnRGaWVsZCIsInNvcnRCeSIsInNvcnRPcmRlciIsImFzYyIsImRlc2MiLCJxdWVyeSIsInBsYW50SW5zdGFuY2UiLCJwbGFudEluc3RhbmNlcyIsInBsYW50IiwicGxhbnRzIiwibGVmdEpvaW4iLCJwbGFudElkIiwiYW5kIiwib3JkZXJCeSIsIm9mZnNldCIsInJlc3VsdHMiLCJtYXAiLCJyZXN1bHQiLCJlbmhhbmNlQ2FyZUhpc3RvcnkiLCJnZXRDYXJlSGlzdG9yeUZvclBsYW50cyIsInBsYW50SW5zdGFuY2VJZHMiLCJsZW5ndGgiLCJpbkFycmF5IiwiZ2V0UmVjZW50Q2FyZUhpc3RvcnkiLCJ1cGRhdGVDYXJlSGlzdG9yeSIsInVwZGF0ZXMiLCJ1cGRhdGVkIiwidXBkYXRlIiwic2V0IiwiZGVsZXRlQ2FyZUhpc3RvcnkiLCJleGlzdGluZyIsImRlbGV0ZSIsInN0aWxsRXhpc3RzIiwiZ2V0UGxhbnRDYXJlU3RhdGlzdGljcyIsImNhcmVIaXN0b3J5RGF0YSIsIkNhcmVDYWxjdWxhdG9yIiwiY2FsY3VsYXRlUGxhbnRDYXJlU3RhdGlzdGljcyIsImdldEJ1bGtDYXJlU3RhdGlzdGljcyIsInBsYW50SW5zdGFuY2VzRGF0YSIsImNhcmVIaXN0b3J5QnlQbGFudCIsInJlZHVjZSIsImFjYyIsImNhcmUiLCJnZXRDYXJlRGFzaGJvYXJkRGF0YSIsIm9wdGlvbnMiLCJpbmNsdWRlSW5hY3RpdmUiLCJkYXlzQWhlYWQiLCJpc0FjdGl2ZSIsIm9uZVdlZWtBZ28iLCJzZXREYXRlIiwiZ2V0RGF0ZSIsInJlY2VudENhcmVIaXN0b3J5IiwiZW5oYW5jZWRQbGFudHMiLCJjYXJlU3RhdHVzIiwiY2FsY3VsYXRlQ2FyZVN0YXR1cyIsImZlcnRpbGl6ZXJEdWUiLCJjYXJlVXJnZW5jeSIsImNhbGN1bGF0ZUNhcmVVcmdlbmN5IiwiZGF5c1VudGlsRmVydGlsaXplckR1ZSIsImNhbGN1bGF0ZURheXNVbnRpbEZlcnRpbGl6ZXJEdWUiLCJkYXlzU2luY2VMYXN0RmVydGlsaXplZCIsImNhbGN1bGF0ZURheXNTaW5jZUxhc3RGZXJ0aWxpemVkIiwibGFzdEZlcnRpbGl6ZWQiLCJkYXlzU2luY2VMYXN0UmVwb3QiLCJjYWxjdWxhdGVEYXlzU2luY2VMYXN0UmVwb3QiLCJsYXN0UmVwb3QiLCJkaXNwbGF5TmFtZSIsIm5pY2tuYW1lIiwiY29tbW9uTmFtZSIsInByaW1hcnlJbWFnZSIsImltYWdlcyIsImRlZmF1bHRJbWFnZSIsImZpbHRlciIsIm92ZXJkdWUiLCJwIiwiZHVlVG9kYXkiLCJkdWVTb29uIiwidGhyZWVEYXlzQWdvIiwicmVjZW50bHlDYXJlZCIsImNhcmVTdHJlYWtEYXlzIiwiY2FsY3VsYXRlVXNlckNhcmVTdHJlYWsiLCJhdmVyYWdlQ2FyZUNvbnNpc3RlbmN5Iiwic3VtIiwiZGF5c1NpbmNlIiwic2NoZWR1bGVEYXlzIiwiY2FyZUhlbHBlcnMiLCJwYXJzZUZlcnRpbGl6ZXJTY2hlZHVsZSIsImZlcnRpbGl6ZXJTY2hlZHVsZSIsImNvbnNpc3RlbmN5IiwiTWF0aCIsIm1heCIsInN0YXRpc3RpY3MiLCJ0b3RhbEFjdGl2ZVBsYW50cyIsIm92ZXJkdWVDb3VudCIsImR1ZVRvZGF5Q291bnQiLCJkdWVTb29uQ291bnQiLCJ0b3RhbENhcmVFdmVudHNUaGlzV2VlayIsInJvdW5kIiwicXVpY2tBY3Rpb25zIiwiZ2V0RGVmYXVsdFF1aWNrQ2FyZUFjdGlvbnMiLCJnZXRDYXJlSGlzdG9yeUNvdW50IiwiY291bnQiLCJnZXRMYXN0Q2FyZURhdGUiLCJidWxrQ3JlYXRlQ2FyZUhpc3RvcnkiLCJlbnRyaWVzIiwiZW50cmllc1dpdGhUaW1lc3RhbXBzIiwiZW50cnkiLCJub3ciLCJkYXlzU2luY2VDYXJlIiwiZmxvb3IiLCJnZXRUaW1lIiwiZm9ybWF0dGVkRGF0ZSIsImZvcm1hdENhcmVEYXRlIiwiY2FyZVR5cGVEaXNwbGF5IiwiZ2V0Q2FyZVR5cGVEaXNwbGF5IiwidW5kZWZpbmVkIiwiY2FyZUJ5RGF0ZSIsImRhdGVLZXkiLCJ0b0lTT1N0cmluZyIsInNwbGl0Iiwic3RyZWFrIiwidG9kYXkiLCJpIiwiY2hlY2tEYXRlIl0sIm1hcHBpbmdzIjoiOzs7OytCQTJCYUE7OztlQUFBQTs7O29CQTNCTTt3QkFDaUM7NEJBQ2M7Z0NBbUJuQzsyQkFDSDtBQUtyQixNQUFNQTtJQUNYOztHQUVDLEdBQ0QsYUFBYUMsa0JBQWtCQyxJQUFvQixFQUF3QjtRQUN6RSxxQ0FBcUM7UUFDckMsTUFBTUMsaUJBQWlCO1lBQUM7WUFBYztZQUFTO1lBQVM7WUFBUztZQUFXO1NBQVE7UUFDcEYsSUFBSSxDQUFDQSxlQUFlQyxRQUFRLENBQUNGLEtBQUtHLFFBQVEsR0FBRztZQUMzQyxNQUFNLElBQUlDLE1BQU0sQ0FBQyxtQkFBbUIsRUFBRUosS0FBS0csUUFBUSxDQUFDLGtCQUFrQixFQUFFRixlQUFlSSxJQUFJLENBQUMsT0FBTztRQUNyRztRQUVBLE1BQU0sQ0FBQ0MsVUFBVSxHQUFHLE1BQU1DLE1BQUUsQ0FDekJDLE1BQU0sQ0FBQ0MsbUJBQVcsRUFDbEJDLE1BQU0sQ0FBQztZQUNOLEdBQUdWLElBQUk7WUFDUFcsV0FBVyxJQUFJQztZQUNmQyxXQUFXLElBQUlEO1FBQ2pCLEdBQ0NFLFNBQVM7UUFFWixPQUFPUjtJQUNUO0lBRUE7O0dBRUMsR0FDRCxhQUFhUyxtQkFBbUJDLEVBQVUsRUFBK0I7UUFDdkUsTUFBTSxDQUFDVixVQUFVLEdBQUcsTUFBTUMsTUFBRSxDQUN6QlUsTUFBTSxHQUNOQyxJQUFJLENBQUNULG1CQUFXLEVBQ2hCVSxLQUFLLENBQUNDLElBQUFBLGNBQUUsRUFBQ1gsbUJBQVcsQ0FBQ08sRUFBRSxFQUFFQSxLQUN6QkssS0FBSyxDQUFDO1FBRVQsT0FBT2YsYUFBYTtJQUN0QjtJQUVBOztHQUVDLEdBQ0QsYUFBYWdCLHVCQUNYQyxlQUF1QixFQUN2QkMsTUFBYyxFQUNkQyxPQUFrQyxFQUNGO1FBQ2hDLHlCQUF5QjtRQUN6QixNQUFNQyxhQUFhO1lBQ2pCTixJQUFBQSxjQUFFLEVBQUNYLG1C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