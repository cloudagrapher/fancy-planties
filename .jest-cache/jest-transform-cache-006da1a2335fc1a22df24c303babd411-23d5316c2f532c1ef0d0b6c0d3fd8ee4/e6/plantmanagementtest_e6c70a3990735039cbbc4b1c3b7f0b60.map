{"version":3,"sources":["/Users/stefanbekker/projects/fancy-planties/src/__tests__/api/plant-management.test.js"],"sourcesContent":["// Plant Management API Endpoint Tests\n// Tests GET /api/plants, POST /api/plant-instances, PUT /api/plant-instances/[id] endpoints\n\nimport { NextRequest, NextResponse } from 'next/server';\nimport { GET as getPlantsHandler, POST as createPlantHandler } from '@/app/api/plants/route';\nimport { GET as getPlantInstancesHandler, POST as createPlantInstanceHandler } from '@/app/api/plant-instances/route';\nimport { GET as getPlantInstanceHandler, PUT as updatePlantInstanceHandler, DELETE as deletePlantInstanceHandler } from '@/app/api/plant-instances/[id]/route';\nimport { createTestUser, createTestSession } from '@/test-utils/factories/user-factory';\nimport { createTestPlant, createTestPlantInstance } from '@/test-utils/factories/plant-factory';\nimport { resetApiMocks } from '@/test-utils/helpers/api-helpers';\n\n// Mock the auth functions\njest.mock('@/lib/auth/server', () => ({\n  validateRequest: jest.fn(),\n}));\n\n// Mock the database queries\njest.mock('@/lib/db/queries/plant-taxonomy', () => ({\n  createPlant: jest.fn(),\n  getPlantsWithStats: jest.fn(),\n  validatePlantTaxonomy: jest.fn(),\n}));\n\njest.mock('@/lib/db/queries/plant-instances', () => ({\n  PlantInstanceQueries: {\n    getWithFilters: jest.fn(),\n    create: jest.fn(),\n    getEnhancedById: jest.fn(),\n    update: jest.fn(),\n    delete: jest.fn(),\n  },\n}));\n\n// Mock validation schemas\njest.mock('@/lib/validation/plant-schemas', () => ({\n  createPlantSchema: {\n    parse: jest.fn(),\n  },\n  plantFilterSchema: {\n    parse: jest.fn(),\n  },\n  createPlantInstanceSchema: {\n    parse: jest.fn(),\n  },\n  plantInstanceFilterSchema: {\n    parse: jest.fn(),\n  },\n  updatePlantInstanceSchema: {\n    parse: jest.fn(),\n  },\n}));\n\n// Import mocked functions\nimport { validateRequest } from '@/lib/auth/server';\nimport { createPlant, getPlantsWithStats, validatePlantTaxonomy } from '@/lib/db/queries/plant-taxonomy';\nimport { PlantInstanceQueries } from '@/lib/db/queries/plant-instances';\nimport { \n  createPlantSchema, \n  plantFilterSchema, \n  createPlantInstanceSchema, \n  plantInstanceFilterSchema,\n  updatePlantInstanceSchema \n} from '@/lib/validation/plant-schemas';\n\ndescribe('Plant Management API Endpoints', () => {\n  let testUser;\n  let testSession;\n\n  beforeEach(() => {\n    jest.clearAllMocks();\n    resetApiMocks();\n    \n    testUser = createTestUser();\n    testSession = createTestSession(testUser);\n    \n    // Default auth mock\n    validateRequest.mockResolvedValue({\n      user: testUser,\n      session: testSession,\n    });\n  });\n\n  afterEach(() => {\n    jest.restoreAllMocks();\n  });\n\n  describe('GET /api/plants - Plant filtering and pagination', () => {\n    it('should return plants with default filters', async () => {\n      // Arrange\n      const mockPlants = [\n        createTestPlant({ family: 'Araceae', genus: 'Monstera' }),\n        createTestPlant({ family: 'Araceae', genus: 'Philodendron' }),\n      ];\n\n      plantFilterSchema.parse.mockReturnValue({\n        family: undefined,\n        genus: undefined,\n        isVerified: undefined,\n        createdBy: undefined,\n        limit: 20,\n        offset: 0,\n      });\n\n      getPlantsWithStats.mockResolvedValue(mockPlants);\n\n      const request = new NextRequest('http://localhost:3000/api/plants');\n\n      // Act\n      const response = await getPlantsHandler(request);\n      const responseData = await response.json();\n\n      // Assert\n      expect(response.status).toBe(200);\n      expect(responseData).toEqual({\n        success: true,\n        data: mockPlants,\n        pagination: {\n          page: 1,\n          limit: 20,\n          total: mockPlants.length,\n          totalPages: 1,\n        },\n      });\n\n      expect(validateRequest).toHaveBeenCalled();\n      expect(plantFilterSchema.parse).toHaveBeenCalledWith({\n        family: undefined,\n        genus: undefined,\n        isVerified: undefined,\n        createdBy: undefined,\n        limit: 20,\n        offset: 0,\n      });\n      expect(getPlantsWithStats).toHaveBeenCalledWith(expect.any(Object), testUser.id);\n    });\n\n    it('should return plants with family filter', async () => {\n      // Arrange\n      const mockPlants = [\n        createTestPlant({ family: 'Araceae', genus: 'Monstera' }),\n      ];\n\n      plantFilterSchema.parse.mockReturnValue({\n        family: 'Araceae',\n        genus: undefined,\n        isVerified: undefined,\n        createdBy: undefined,\n        limit: 20,\n        offset: 0,\n      });\n\n      getPlantsWithStats.mockResolvedValue(mockPlants);\n\n      const request = new NextRequest('http://localhost:3000/api/plants?family=Araceae');\n\n      // Act\n      const response = await getPlantsHandler(request);\n      const responseData = await response.json();\n\n      // Assert\n      expect(response.status).toBe(200);\n      expect(responseData.success).toBe(true);\n      expect(responseData.data).toEqual(mockPlants);\n\n      expect(plantFilterSchema.parse).toHaveBeenCalledWith({\n        family: 'Araceae',\n        genus: undefined,\n        isVerified: undefined,\n        createdBy: undefined,\n        limit: 20,\n        offset: 0,\n      });\n    });\n\n    it('should return plants with pagination parameters', async () => {\n      // Arrange\n      const mockPlants = [createTestPlant()];\n\n      plantFilterSchema.parse.mockReturnValue({\n        family: undefined,\n        genus: undefined,\n        isVerified: undefined,\n        createdBy: undefined,\n        limit: 10,\n        offset: 20,\n      });\n\n      getPlantsWithStats.mockResolvedValue(mockPlants);\n\n      const request = new NextRequest('http://localhost:3000/api/plants?limit=10&offset=20');\n\n      // Act\n      const response = await getPlantsHandler(request);\n      const responseData = await response.json();\n\n      // Assert\n      expect(response.status).toBe(200);\n      expect(responseData.success).toBe(true);\n\n      expect(plantFilterSchema.parse).toHaveBeenCalledWith({\n        family: undefined,\n        genus: undefined,\n        isVerified: undefined,\n        createdBy: undefined,\n        limit: 10,\n        offset: 20,\n      });\n    });\n\n    it('should return unauthorized error when user not authenticated', async () => {\n      // Arrange\n      validateRequest.mockResolvedValue({\n        user: null,\n        session: null,\n      });\n\n      const request = new NextRequest('http://localhost:3000/api/plants');\n\n      // Act\n      const response = await getPlantsHandler(request);\n      const responseData = await response.json();\n\n      // Assert\n      expect(response.status).toBe(401);\n      expect(responseData).toEqual({\n        error: 'Unauthorized',\n      });\n\n      expect(getPlantsWithStats).not.toHaveBeenCalled();\n    });\n\n    it('should return validation error for invalid filter parameters', async () => {\n      // Arrange\n      const validationError = new Error('Validation failed');\n      validationError.name = 'ZodError';\n      validationError.issues = [\n        { path: ['limit'], message: 'Limit must be a positive number' }\n      ];\n\n      plantFilterSchema.parse.mockImplementation(() => {\n        throw validationError;\n      });\n\n      const request = new NextRequest('http://localhost:3000/api/plants?limit=invalid');\n\n      // Act\n      const response = await getPlantsHandler(request);\n      const responseData = await response.json();\n\n      // Assert\n      expect(response.status).toBe(400);\n      expect(responseData).toEqual({\n        error: 'Invalid filter parameters',\n        details: validationError.issues,\n      });\n\n      expect(getPlantsWithStats).not.toHaveBeenCalled();\n    });\n\n    it('should handle database errors gracefully', async () => {\n      // Arrange\n      plantFilterSchema.parse.mockReturnValue({\n        limit: 20,\n        offset: 0,\n      });\n\n      getPlantsWithStats.mockRejectedValue(new Error('Database connection failed'));\n\n      const request = new NextRequest('http://localhost:3000/api/plants');\n\n      // Act\n      const response = await getPlantsHandler(request);\n      const responseData = await response.json();\n\n      // Assert\n      expect(response.status).toBe(500);\n      expect(responseData).toEqual({\n        error: 'Internal server error',\n      });\n    });\n  });\n\n  describe('POST /api/plant-instances - Plant instance creation with data validation', () => {\n    it('should create plant instance with valid JSON data', async () => {\n      // Arrange\n      const testPlant = createTestPlant();\n      const requestBody = {\n        plantId: testPlant.id,\n        nickname: 'My Monstera',\n        location: 'Living Room',\n        notes: 'Beautiful plant',\n        isActive: true,\n      };\n\n      const expectedInstanceData = {\n        ...requestBody,\n        userId: testUser.id,\n        lastFertilized: null,\n        lastRepot: null,\n      };\n\n      const createdInstance = createTestPlantInstance({\n        ...expectedInstanceData,\n        id: 1,\n      });\n\n      const enhancedInstance = {\n        ...createdInstance,\n        plant: testPlant,\n      };\n\n      createPlantInstanceSchema.parse.mockReturnValue(expectedInstanceData);\n      PlantInstanceQueries.create.mockResolvedValue(createdInstance);\n      PlantInstanceQueries.getEnhancedById.mockResolvedValue(enhancedInstance);\n\n      const request = new NextRequest('http://localhost:3000/api/plant-instances', {\n        method: 'POST',\n        body: JSON.stringify(requestBody),\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      // Act\n      const response = await createPlantInstanceHandler(request);\n      const responseData = await response.json();\n\n      // Assert\n      expect(response.status).toBe(201);\n      expect(responseData).toEqual({\n        success: true,\n        data: enhancedInstance,\n      });\n\n      expect(createPlantInstanceSchema.parse).toHaveBeenCalledWith(expectedInstanceData);\n      expect(PlantInstanceQueries.create).toHaveBeenCalledWith(expectedInstanceData);\n      expect(PlantInstanceQueries.getEnhancedById).toHaveBeenCalledWith(createdInstance.id);\n    });\n\n    it('should create plant instance with FormData (file upload)', async () => {\n      // Arrange\n      const testPlant = createTestPlant();\n      const formData = new FormData();\n      formData.append('plantId', testPlant.id.toString());\n      formData.append('nickname', 'My Monstera');\n      formData.append('location', 'Living Room');\n      formData.append('isActive', 'true');\n\n      // Mock file\n      const mockFile = new File(['test image'], 'test.jpg', { type: 'image/jpeg' });\n      formData.append('imageFiles[0]', mockFile);\n\n      const expectedInstanceData = {\n        plantId: testPlant.id,\n        nickname: 'My Monstera',\n        location: 'Living Room',\n        isActive: true,\n        userId: testUser.id,\n        lastFertilized: null,\n        lastRepot: null,\n        images: ['data:image/jpeg;base64,dGVzdCBpbWFnZQ=='], // base64 of \"test image\"\n      };\n\n      const createdInstance = createTestPlantInstance(expectedInstanceData);\n      const enhancedInstance = { ...createdInstance, plant: testPlant };\n\n      createPlantInstanceSchema.parse.mockReturnValue(expectedInstanceData);\n      PlantInstanceQueries.create.mockResolvedValue(createdInstance);\n      PlantInstanceQueries.getEnhancedById.mockResolvedValue(enhancedInstance);\n\n      const request = new NextRequest('http://localhost:3000/api/plant-instances', {\n        method: 'POST',\n        body: formData,\n      });\n\n      // Act\n      const response = await createPlantInstanceHandler(request);\n      const responseData = await response.json();\n\n      // Assert\n      expect(response.status).toBe(201);\n      expect(responseData.success).toBe(true);\n      expect(responseData.data).toEqual(enhancedInstance);\n\n      expect(PlantInstanceQueries.create).toHaveBeenCalledWith(expectedInstanceData);\n    });\n\n    it('should return validation error for invalid plant instance data', async () => {\n      // Arrange\n      const requestBody = {\n        plantId: 'invalid',\n        nickname: '',\n        location: '',\n      };\n\n      const validationError = new Error('Validation failed');\n      validationError.name = 'ZodError';\n      validationError.issues = [\n        { path: ['plantId'], message: 'Plant ID must be a number' },\n        { path: ['nickname'], message: 'Nickname is required' },\n      ];\n\n      createPlantInstanceSchema.parse.mockImplementation(() => {\n        throw validationError;\n      });\n\n      const request = new NextRequest('http://localhost:3000/api/plant-instances', {\n        method: 'POST',\n        body: JSON.stringify(requestBody),\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      // Act\n      const response = await createPlantInstanceHandler(request);\n      const responseData = await response.json();\n\n      // Assert\n      expect(response.status).toBe(400);\n      expect(responseData).toEqual({\n        success: false,\n        error: 'Validation failed',\n        details: validationError.issues,\n      });\n\n      expect(PlantInstanceQueries.create).not.toHaveBeenCalled();\n    });\n\n    it('should return unauthorized error when user not authenticated', async () => {\n      // Arrange\n      validateRequest.mockResolvedValue({\n        user: null,\n        session: null,\n      });\n\n      const request = new NextRequest('http://localhost:3000/api/plant-instances', {\n        method: 'POST',\n        body: JSON.stringify({ plantId: 1 }),\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      // Act\n      const response = await createPlantInstanceHandler(request);\n      const responseData = await response.json();\n\n      // Assert\n      expect(response.status).toBe(401);\n      expect(responseData).toEqual({\n        success: false,\n        error: 'Unauthorized',\n      });\n\n      expect(PlantInstanceQueries.create).not.toHaveBeenCalled();\n    });\n\n    it('should handle empty request body', async () => {\n      // Arrange\n      const request = new NextRequest('http://localhost:3000/api/plant-instances', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      // Act\n      const response = await createPlantInstanceHandler(request);\n      const responseData = await response.json();\n\n      // Assert\n      expect(response.status).toBe(400);\n      expect(responseData).toEqual({\n        success: false,\n        error: 'Request body is required',\n      });\n\n      expect(PlantInstanceQueries.create).not.toHaveBeenCalled();\n    });\n\n    it('should handle malformed JSON', async () => {\n      // Arrange\n      const request = new NextRequest('http://localhost:3000/api/plant-instances', {\n        method: 'POST',\n        body: 'invalid json',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      // Act\n      const response = await createPlantInstanceHandler(request);\n      const responseData = await response.json();\n\n      // Assert\n      expect(response.status).toBe(400);\n      expect(responseData).toEqual({\n        success: false,\n        error: 'Invalid JSON in request body',\n      });\n\n      expect(PlantInstanceQueries.create).not.toHaveBeenCalled();\n    });\n\n    it('should calculate fertilizer due date from schedule', async () => {\n      // Arrange\n      const requestBody = {\n        plantId: 1,\n        nickname: 'Test Plant',\n        location: 'Test Location',\n        fertilizerSchedule: '2 weeks',\n      };\n\n      const expectedInstanceData = {\n        ...requestBody,\n        userId: testUser.id,\n        lastFertilized: null,\n        lastRepot: null,\n        fertilizerDue: expect.any(Date),\n      };\n\n      const createdInstance = createTestPlantInstance(expectedInstanceData);\n      const enhancedInstance = { ...createdInstance, plant: createTestPlant() };\n\n      createPlantInstanceSchema.parse.mockReturnValue(expectedInstanceData);\n      PlantInstanceQueries.create.mockResolvedValue(createdInstance);\n      PlantInstanceQueries.getEnhancedById.mockResolvedValue(enhancedInstance);\n\n      const request = new NextRequest('http://localhost:3000/api/plant-instances', {\n        method: 'POST',\n        body: JSON.stringify(requestBody),\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      // Act\n      const response = await createPlantInstanceHandler(request);\n      const responseData = await response.json();\n\n      // Assert\n      expect(response.status).toBe(201);\n      expect(responseData.success).toBe(true);\n\n      // Verify fertilizer due date was calculated (should be 2 weeks from now)\n      const callArgs = PlantInstanceQueries.create.mock.calls[0][0];\n      expect(callArgs.fertilizerDue).toBeInstanceOf(Date);\n      \n      const now = new Date();\n      const expectedDue = new Date(now);\n      expectedDue.setDate(expectedDue.getDate() + 14); // 2 weeks\n      \n      // Allow for small time differences in test execution\n      const timeDiff = Math.abs(callArgs.fertilizerDue.getTime() - expectedDue.getTime());\n      expect(timeDiff).toBeLessThan(1000); // Less than 1 second difference\n    });\n  });\n\n  describe('PUT /api/plant-instances/[id] - Plant instance updates with authorization checks', () => {\n    it('should update plant instance with valid data and authorization', async () => {\n      // Arrange\n      const testPlant = createTestPlant();\n      const existingInstance = createTestPlantInstance({\n        id: 1,\n        userId: testUser.id,\n        plantId: testPlant.id,\n      });\n\n      const updateData = {\n        nickname: 'Updated Nickname',\n        location: 'New Location',\n        notes: 'Updated notes',\n      };\n\n      const expectedUpdateData = {\n        ...updateData,\n        id: 1,\n        userId: testUser.id,\n        lastFertilized: null,\n        lastRepot: null,\n      };\n\n      const updatedInstance = { ...existingInstance, ...updateData };\n      const enhancedInstance = { ...updatedInstance, plant: testPlant };\n\n      PlantInstanceQueries.getEnhancedById.mockResolvedValueOnce(existingInstance);\n      updatePlantInstanceSchema.parse.mockReturnValue(expectedUpdateData);\n      PlantInstanceQueries.update.mockResolvedValue(updatedInstance);\n      PlantInstanceQueries.getEnhancedById.mockResolvedValueOnce(enhancedInstance);\n\n      const request = new NextRequest('http://localhost:3000/api/plant-instances/1', {\n        method: 'PUT',\n        body: JSON.stringify(updateData),\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      const params = Promise.resolve({ id: '1' });\n\n      // Act\n      const response = await updatePlantInstanceHandler(request, { params });\n      const responseData = await response.json();\n\n      // Assert\n      expect(response.status).toBe(200);\n      expect(responseData).toEqual(enhancedInstance);\n\n      expect(PlantInstanceQueries.getEnhancedById).toHaveBeenCalledWith(1);\n      expect(updatePlantInstanceSchema.parse).toHaveBeenCalledWith(expectedUpdateData);\n      expect(PlantInstanceQueries.update).toHaveBeenCalledWith(1, updateData);\n    });\n\n    it('should return forbidden error when user does not own plant instance', async () => {\n      // Arrange\n      const otherUser = createTestUser({ id: 999 });\n      const existingInstance = createTestPlantInstance({\n        id: 1,\n        userId: otherUser.id, // Different user\n      });\n\n      PlantInstanceQueries.getEnhancedById.mockResolvedValue(existingInstance);\n\n      const request = new NextRequest('http://localhost:3000/api/plant-instances/1', {\n        method: 'PUT',\n        body: JSON.stringify({ nickname: 'Updated' }),\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      const params = Promise.resolve({ id: '1' });\n\n      // Act\n      const response = await updatePlantInstanceHandler(request, { params });\n      const responseData = await response.json();\n\n      // Assert\n      expect(response.status).toBe(403);\n      expect(responseData).toEqual({\n        error: 'Forbidden',\n      });\n\n      expect(PlantInstanceQueries.update).not.toHaveBeenCalled();\n    });\n\n    it('should return not found error when plant instance does not exist', async () => {\n      // Arrange\n      PlantInstanceQueries.getEnhancedById.mockResolvedValue(null);\n\n      const request = new NextRequest('http://localhost:3000/api/plant-instances/999', {\n        method: 'PUT',\n        body: JSON.stringify({ nickname: 'Updated' }),\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      const params = Promise.resolve({ id: '999' });\n\n      // Act\n      const response = await updatePlantInstanceHandler(request, { params });\n      const responseData = await response.json();\n\n      // Assert\n      expect(response.status).toBe(404);\n      expect(responseData).toEqual({\n        error: 'Plant instance not found',\n      });\n\n      expect(PlantInstanceQueries.update).not.toHaveBeenCalled();\n    });\n\n    it('should return bad request error for invalid plant instance ID', async () => {\n      // Arrange\n      const request = new NextRequest('http://localhost:3000/api/plant-instances/invalid', {\n        method: 'PUT',\n        body: JSON.stringify({ nickname: 'Updated' }),\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      const params = Promise.resolve({ id: 'invalid' });\n\n      // Act\n      const response = await updatePlantInstanceHandler(request, { params });\n      const responseData = await response.json();\n\n      // Assert\n      expect(response.status).toBe(400);\n      expect(responseData).toEqual({\n        error: 'Invalid plant instance ID',\n      });\n\n      expect(PlantInstanceQueries.getEnhancedById).not.toHaveBeenCalled();\n    });\n\n    it('should return unauthorized error when user not authenticated', async () => {\n      // Arrange\n      validateRequest.mockResolvedValue({\n        user: null,\n        session: null,\n      });\n\n      const request = new NextRequest('http://localhost:3000/api/plant-instances/1', {\n        method: 'PUT',\n        body: JSON.stringify({ nickname: 'Updated' }),\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      const params = Promise.resolve({ id: '1' });\n\n      // Act\n      const response = await updatePlantInstanceHandler(request, { params });\n      const responseData = await response.json();\n\n      // Assert\n      expect(response.status).toBe(401);\n      expect(responseData).toEqual({\n        error: 'Unauthorized',\n      });\n\n      expect(PlantInstanceQueries.getEnhancedById).not.toHaveBeenCalled();\n    });\n\n    it('should handle FormData updates with file uploads', async () => {\n      // Arrange\n      const testPlant = createTestPlant();\n      const existingInstance = createTestPlantInstance({\n        id: 1,\n        userId: testUser.id,\n        plantId: testPlant.id,\n      });\n\n      const formData = new FormData();\n      formData.append('nickname', 'Updated Nickname');\n      formData.append('location', 'New Location');\n      formData.append('existingImages[0]', 'existing-image-url');\n\n      const mockFile = new File(['new image'], 'new.jpg', { type: 'image/jpeg' });\n      formData.append('imageFiles[0]', mockFile);\n\n      const expectedUpdateData = {\n        nickname: 'Updated Nickname',\n        location: 'New Location',\n        images: ['existing-image-url', 'data:image/jpeg;base64,bmV3IGltYWdl'], // base64 of \"new image\"\n        id: 1,\n        userId: testUser.id,\n        lastFertilized: null,\n        lastRepot: null,\n      };\n\n      const updatedInstance = { ...existingInstance, ...expectedUpdateData };\n      const enhancedInstance = { ...updatedInstance, plant: testPlant };\n\n      PlantInstanceQueries.getEnhancedById.mockResolvedValueOnce(existingInstance);\n      updatePlantInstanceSchema.parse.mockReturnValue(expectedUpdateData);\n      PlantInstanceQueries.update.mockResolvedValue(updatedInstance);\n      PlantInstanceQueries.getEnhancedById.mockResolvedValueOnce(enhancedInstance);\n\n      const request = new NextRequest('http://localhost:3000/api/plant-instances/1', {\n        method: 'PUT',\n        body: formData,\n      });\n\n      const params = Promise.resolve({ id: '1' });\n\n      // Act\n      const response = await updatePlantInstanceHandler(request, { params });\n      const responseData = await response.json();\n\n      // Assert\n      expect(response.status).toBe(200);\n      expect(responseData).toEqual(enhancedInstance);\n\n      // Verify the update was called with correct data (excluding id and userId)\n      const { id, userId, ...updateDataWithoutIds } = expectedUpdateData;\n      expect(PlantInstanceQueries.update).toHaveBeenCalledWith(1, updateDataWithoutIds);\n    });\n\n    it('should handle validation errors during update', async () => {\n      // Arrange\n      const existingInstance = createTestPlantInstance({\n        id: 1,\n        userId: testUser.id,\n      });\n\n      const validationError = new Error('Validation failed');\n      validationError.name = 'ZodError';\n      validationError.issues = [\n        { path: ['nickname'], message: 'Nickname is required' }\n      ];\n\n      PlantInstanceQueries.getEnhancedById.mockResolvedValue(existingInstance);\n      updatePlantInstanceSchema.parse.mockImplementation(() => {\n        throw validationError;\n      });\n\n      const request = new NextRequest('http://localhost:3000/api/plant-instances/1', {\n        method: 'PUT',\n        body: JSON.stringify({ nickname: '' }),\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      const params = Promise.resolve({ id: '1' });\n\n      // Act\n      const response = await updatePlantInstanceHandler(request, { params });\n      const responseData = await response.json();\n\n      // Assert\n      expect(response.status).toBe(400);\n      expect(responseData.error).toContain('Invalid plant instance data');\n\n      expect(PlantInstanceQueries.update).not.toHaveBeenCalled();\n    });\n  });\n\n  describe('Plant Management Integration Tests', () => {\n    it('should handle complete plant management workflow: create -> read -> update -> delete', async () => {\n      const testPlant = createTestPlant();\n      \n      // Step 1: Create plant instance\n      const createData = {\n        plantId: testPlant.id,\n        nickname: 'Test Plant',\n        location: 'Test Location',\n      };\n\n      const createdInstance = createTestPlantInstance({\n        id: 1,\n        ...createData,\n        userId: testUser.id,\n      });\n\n      const enhancedInstance = { ...createdInstance, plant: testPlant };\n\n      createPlantInstanceSchema.parse.mockReturnValue({\n        ...createData,\n        userId: testUser.id,\n        lastFertilized: null,\n        lastRepot: null,\n      });\n      PlantInstanceQueries.create.mockResolvedValue(createdInstance);\n      PlantInstanceQueries.getEnhancedById.mockResolvedValue(enhancedInstance);\n\n      const createRequest = new NextRequest('http://localhost:3000/api/plant-instances', {\n        method: 'POST',\n        body: JSON.stringify(createData),\n        headers: { 'Content-Type': 'application/json' },\n      });\n\n      const createResponse = await createPlantInstanceHandler(createRequest);\n      const createResponseData = await createResponse.json();\n\n      expect(createResponse.status).toBe(201);\n      expect(createResponseData.success).toBe(true);\n\n      // Step 2: Read plant instance\n      PlantInstanceQueries.getEnhancedById.mockResolvedValue(enhancedInstance);\n\n      const readRequest = new NextRequest('http://localhost:3000/api/plant-instances/1');\n      const readParams = Promise.resolve({ id: '1' });\n\n      const readResponse = await getPlantInstanceHandler(readRequest, { params: readParams });\n      const readResponseData = await readResponse.json();\n\n      expect(readResponse.status).toBe(200);\n      expect(readResponseData).toEqual(enhancedInstance);\n\n      // Step 3: Update plant instance\n      const updateData = { nickname: 'Updated Plant' };\n      const updatedInstance = { ...enhancedInstance, ...updateData };\n\n      updatePlantInstanceSchema.parse.mockReturnValue({\n        ...updateData,\n        id: 1,\n        userId: testUser.id,\n        lastFertilized: null,\n        lastRepot: null,\n      });\n      PlantInstanceQueries.update.mockResolvedValue(updatedInstance);\n      PlantInstanceQueries.getEnhancedById.mockResolvedValue(updatedInstance);\n\n      const updateRequest = new NextRequest('http://localhost:3000/api/plant-instances/1', {\n        method: 'PUT',\n        body: JSON.stringify(updateData),\n        headers: { 'Content-Type': 'application/json' },\n      });\n      const updateParams = Promise.resolve({ id: '1' });\n\n      const updateResponse = await updatePlantInstanceHandler(updateRequest, { params: updateParams });\n      const updateResponseData = await updateResponse.json();\n\n      expect(updateResponse.status).toBe(200);\n      expect(updateResponseData.nickname).toBe('Updated Plant');\n\n      // Step 4: Delete plant instance\n      PlantInstanceQueries.delete.mockResolvedValue(true);\n\n      const deleteRequest = new NextRequest('http://localhost:3000/api/plant-instances/1', {\n        method: 'DELETE',\n      });\n      const deleteParams = Promise.resolve({ id: '1' });\n\n      const deleteResponse = await deletePlantInstanceHandler(deleteRequest, { params: deleteParams });\n      const deleteResponseData = await deleteResponse.json();\n\n      expect(deleteResponse.status).toBe(200);\n      expect(deleteResponseData).toEqual({\n        success: true,\n        message: 'Plant instance deleted successfully',\n      });\n\n      // Verify all operations were called\n      expect(PlantInstanceQueries.create).toHaveBeenCalled();\n      expect(PlantInstanceQueries.update).toHaveBeenCalled();\n      expect(PlantInstanceQueries.delete).toHaveBeenCalledWith(1);\n    });\n\n    it('should handle authorization checks across all endpoints', async () => {\n      // Test unauthorized access to all endpoints\n      validateRequest.mockResolvedValue({ user: null, session: null });\n\n      // GET /api/plants\n      const getPlantsRequest = new NextRequest('http://localhost:3000/api/plants');\n      const getPlantsResponse = await getPlantsHandler(getPlantsRequest);\n      expect(getPlantsResponse.status).toBe(401);\n\n      // POST /api/plant-instances\n      const createRequest = new NextRequest('http://localhost:3000/api/plant-instances', {\n        method: 'POST',\n        body: JSON.stringify({}),\n        headers: { 'Content-Type': 'application/json' },\n      });\n      const createResponse = await createPlantInstanceHandler(createRequest);\n      expect(createResponse.status).toBe(401);\n\n      // GET /api/plant-instances/1\n      const getRequest = new NextRequest('http://localhost:3000/api/plant-instances/1');\n      const getParams = Promise.resolve({ id: '1' });\n      const getResponse = await getPlantInstanceHandler(getRequest, { params: getParams });\n      expect(getResponse.status).toBe(401);\n\n      // PUT /api/plant-instances/1\n      const updateRequest = new NextRequest('http://localhost:3000/api/plant-instances/1', {\n        method: 'PUT',\n        body: JSON.stringify({}),\n        headers: { 'Content-Type': 'application/json' },\n      });\n      const updateParams = Promise.resolve({ id: '1' });\n      const updateResponse = await updatePlantInstanceHandler(updateRequest, { params: updateParams });\n      expect(updateResponse.status).toBe(401);\n\n      // DELETE /api/plant-instances/1\n      const deleteRequest = new NextRequest('http://localhost:3000/api/plant-instances/1', {\n        method: 'DELETE',\n      });\n      const deleteParams = Promise.resolve({ id: '1' });\n      const deleteResponse = await deletePlantInstanceHandler(deleteRequest, { params: deleteParams });\n      expect(deleteResponse.status).toBe(401);\n    });\n  });\n});"],"names":["jest","mock","validateRequest","fn","createPlant","getPlantsWithStats","validatePlantTaxonomy","PlantInstanceQueries","getWithFilters","create","getEnhancedById","update","delete","createPlantSchema","parse","plantFilterSchema","createPlantInstanceSchema","plantInstanceFilterSchema","updatePlantInstanceSchema","describe","testUser","testSession","beforeEach","clearAllMocks","resetApiMocks","createTestUser","createTestSession","mockResolvedValue","user","session","afterEach","restoreAllMocks","it","mockPlants","createTestPlant","family","genus","mockReturnValue","undefined","isVerified","createdBy","limit","offset","request","NextRequest","response","getPlantsHandler","responseData","json","expect","status","toBe","toEqual","success","data","pagination","page","total","length","totalPages","toHaveBeenCalled","toHaveBeenCalledWith","any","Object","id","error","not","validationError","Error","name","issues","path","message","mockImplementation","details","mockRejectedValue","testPlant","requestBody","plantId","nickname","location","notes","isActive","expectedInstanceData","userId","lastFertilized","lastRepot","createdInstance","createTestPlantInstance","enhancedInstance","plant","method","body","JSON","stringify","headers","createPlantInstanceHandler","formData","FormData","append","toString","mockFile","File","type","images","fertilizerSchedule","fertilizerDue","Date","callArgs","calls","toBeInstanceOf","now","expectedDue","setDate","getDate","timeDiff","Math","abs","getTime","toBeLessThan","existingInstance","updateData","expectedUpdateData","updatedInstance","mockResolvedValueOnce","params","Promise","resolve","updatePlantInstanceHandler","otherUser","updateDataWithoutIds","toContain","createData","createRequest","createResponse","createResponseData","readRequest","readParams","readResponse","getPlantInstanceHandler","readResponseData","updateRequest","updateParams","updateResponse","updateResponseData","deleteRequest","deleteParams","deleteResponse","deletePlantInstanceHandler","deleteResponseData","getPlantsRequest","getPlantsResponse","getRequest","getParams","getResponse"],"mappings":"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"}