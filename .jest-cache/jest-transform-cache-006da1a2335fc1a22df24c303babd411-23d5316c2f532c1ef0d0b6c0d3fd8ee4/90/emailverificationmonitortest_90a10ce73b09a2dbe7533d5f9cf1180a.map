{"version":3,"sources":["/Users/stefanbekker/projects/fancy-planties/src/__tests__/api/admin/email-verification-monitor.test.ts"],"sourcesContent":["/**\n * @jest-environment node\n */\n\nimport { NextRequest } from 'next/server';\n\n// Mock dependencies first, before importing the route\njest.mock('@/lib/auth/middleware', () => ({\n  requireAuth: jest.fn(),\n}));\njest.mock('@/lib/services/email-verification-cleanup', () => ({\n  emailVerificationCleanupService: {\n    getSystemStatus: jest.fn(),\n    getCleanupStats: jest.fn(),\n    forceCleanup: jest.fn(),\n  },\n}));\njest.mock('@/lib/services/email-service-monitor', () => ({\n  emailServiceMonitor: {\n    getStats: jest.fn(),\n    getHealthStatus: jest.fn(),\n    getRecentEvents: jest.fn(),\n    getErrorSummary: jest.fn(),\n    isQuotaNearLimit: jest.fn(),\n    forceReset: jest.fn(),\n  },\n}));\n\n// Now import the route and dependencies\nimport { GET, POST } from '@/app/api/admin/email-verification-monitor/route';\nimport { requireAuth } from '@/lib/auth/middleware';\nimport { emailVerificationCleanupService } from '@/lib/services/email-verification-cleanup';\nimport { emailServiceMonitor } from '@/lib/services/email-service-monitor';\n\nconst mockRequireAuth = requireAuth as jest.MockedFunction<typeof requireAuth>;\nconst mockCleanupService = emailVerificationCleanupService as jest.Mocked<typeof emailVerificationCleanupService>;\nconst mockEmailServiceMonitor = emailServiceMonitor as jest.Mocked<typeof emailServiceMonitor>;\n\ndescribe('/api/admin/email-verification-monitor', () => {\n  const mockUser = { id: 1, email: 'admin@example.com', name: 'Admin' };\n  \n  beforeEach(() => {\n    jest.clearAllMocks();\n    \n    // Mock authentication\n    mockRequireAuth.mockResolvedValue({ user: mockUser });\n    \n    // Mock system status\n    mockCleanupService.getSystemStatus.mockResolvedValue({\n      verificationCodes: {\n        totalActive: 10,\n        expiredCount: 2,\n        highAttemptCount: 1,\n      },\n      rateLimits: {\n        verificationAttempts: 5,\n        resendRequests: 3,\n        emailVerificationActivity: 8,\n        resendCooldowns: 1,\n        securityEvents: 0,\n      },\n      emailService: {\n        health: 'healthy',\n        quotaUsage: 45,\n        successRate: 98.5,\n        totalSent: 200,\n        totalFailed: 3,\n        averageResponseTime: 150,\n        issues: [],\n        recommendations: [],\n      },\n      cleanup: {\n        lastCleanup: Date.now() - 30 * 60 * 1000, // 30 minutes ago\n        isRunning: false,\n        nextCleanupDue: Date.now() + 30 * 60 * 1000, // 30 minutes from now\n      },\n    });\n    \n    // Mock email service monitor\n    mockEmailServiceMonitor.getStats.mockReturnValue({\n      totalSent: 200,\n      totalFailed: 3,\n      quotaUsed: 45,\n      quotaLimit: 100,\n      errorsByType: { API_ERROR: 2, NETWORK_ERROR: 1 },\n      successRate: 98.5,\n      averageResponseTime: 150,\n      lastResetTime: Date.now() - 2 * 60 * 60 * 1000, // 2 hours ago\n    });\n    \n    mockEmailServiceMonitor.getHealthStatus.mockReturnValue({\n      status: 'healthy',\n      issues: [],\n      recommendations: [],\n    });\n    \n    mockEmailServiceMonitor.getRecentEvents.mockReturnValue([\n      {\n        type: 'success',\n        timestamp: Date.now() - 5 * 60 * 1000,\n        responseTime: 120,\n      },\n      {\n        type: 'error',\n        timestamp: Date.now() - 10 * 60 * 1000,\n        responseTime: 300,\n        error: { message: 'API Error', code: 'API_ERROR' },\n      },\n    ]);\n    \n    mockEmailServiceMonitor.getErrorSummary.mockReturnValue({\n      totalErrors: 3,\n      errorsByType: { API_ERROR: 2, NETWORK_ERROR: 1 },\n      recentErrors: [\n        {\n          type: 'error',\n          timestamp: Date.now() - 10 * 60 * 1000,\n          responseTime: 300,\n          error: { message: 'API Error', code: 'API_ERROR' },\n        },\n      ],\n      criticalErrors: [],\n    });\n    \n    mockEmailServiceMonitor.isQuotaNearLimit.mockReturnValue(false);\n    \n    mockCleanupService.getCleanupStats.mockReturnValue({\n      lastCleanup: Date.now() - 30 * 60 * 1000,\n      isRunning: false,\n      recentStats: [\n        {\n          expiredCodes: 5,\n          rateLimitData: 3,\n          timestamp: Date.now() - 30 * 60 * 1000,\n        },\n      ],\n      totalExpiredCodes: 25,\n      totalRateLimitData: 15,\n    });\n  });\n\n  describe('GET', () => {\n    it('should return comprehensive monitoring data', async () => {\n      const request = new NextRequest('http://localhost/api/admin/email-verification-monitor');\n      const response = await GET(request);\n      \n      expect(response.status).toBe(200);\n      \n      const data = await response.json();\n      expect(data).toMatchObject({\n        timestamp: expect.any(Number),\n        systemStatus: expect.objectContaining({\n          verificationCodes: expect.any(Object),\n          rateLimits: expect.any(Object),\n          emailService: expect.any(Object),\n          cleanup: expect.any(Object),\n        }),\n        emailService: expect.objectContaining({\n          stats: expect.any(Object),\n          health: expect.any(Object),\n          recentEvents: expect.any(Array),\n          errorSummary: expect.any(Object),\n          quotaWarning: expect.any(Boolean),\n          quotaCritical: expect.any(Boolean),\n        }),\n        cleanup: expect.any(Object),\n        alerts: expect.any(Array),\n      });\n      \n      expect(mockRequireAuth).toHaveBeenCalledWith();\n      expect(mockCleanupService.getSystemStatus).toHaveBeenCalledWith();\n      expect(mockEmailServiceMonitor.getStats).toHaveBeenCalledWith();\n      expect(mockEmailServiceMonitor.getHealthStatus).toHaveBeenCalledWith();\n      expect(mockEmailServiceMonitor.getRecentEvents).toHaveBeenCalledWith(50);\n      expect(mockEmailServiceMonitor.getErrorSummary).toHaveBeenCalledWith();\n    });\n\n    it('should generate alerts for critical conditions', async () => {\n      // Mock critical email service health\n      mockCleanupService.getSystemStatus.mockResolvedValue({\n        verificationCodes: { totalActive: 10, expiredCount: 2, highAttemptCount: 1 },\n        rateLimits: { verificationAttempts: 5, resendRequests: 3, emailVerificationActivity: 8, resendCooldowns: 1, securityEvents: 15 },\n        emailService: {\n          health: 'critical',\n          quotaUsage: 96,\n          successRate: 75,\n          totalSent: 200,\n          totalFailed: 50,\n          averageResponseTime: 150,\n          issues: ['Critical quota usage', 'Low success rate'],\n          recommendations: ['Immediate action required'],\n        },\n        cleanup: { lastCleanup: Date.now() - 30 * 60 * 1000, isRunning: false, nextCleanupDue: Date.now() + 30 * 60 * 1000 },\n      });\n      \n      mockEmailServiceMonitor.getHealthStatus.mockReturnValue({\n        status: 'critical',\n        issues: ['Critical quota usage', 'Low success rate'],\n        recommendations: ['Immediate action required'],\n      });\n\n      const request = new NextRequest('http://localhost/api/admin/email-verification-monitor');\n      const response = await GET(request);\n      \n      expect(response.status).toBe(200);\n      \n      const data = await response.json();\n      expect(data.alerts.length).toBeGreaterThan(0);\n      \n      // Should have critical alerts\n      const criticalAlerts = data.alerts.filter((alert: any) => alert.level === 'critical');\n      expect(criticalAlerts.length).toBeGreaterThan(0);\n      \n      // Should have quota alert\n      const quotaAlert = data.alerts.find((alert: any) => alert.message.includes('quota'));\n      expect(quotaAlert).toBeDefined();\n      expect(quotaAlert.level).toBe('critical');\n      \n      // Should have success rate alert\n      const successRateAlert = data.alerts.find((alert: any) => alert.message.includes('success rate'));\n      expect(successRateAlert).toBeDefined();\n      expect(successRateAlert.level).toBe('critical');\n      \n      // Should have security events alert\n      const securityAlert = data.alerts.find((alert: any) => alert.message.includes('security events'));\n      expect(securityAlert).toBeDefined();\n      expect(securityAlert.level).toBe('warning');\n    });\n\n    it('should handle authentication errors', async () => {\n      mockRequireAuth.mockRejectedValue(new Error('Unauthorized'));\n      \n      const request = new NextRequest('http://localhost/api/admin/email-verification-monitor');\n      const response = await GET(request);\n      \n      expect(response.status).toBe(500);\n      \n      const data = await response.json();\n      expect(data.error).toBe('Failed to fetch monitoring data');\n    });\n\n    it('should handle system status errors', async () => {\n      mockCleanupService.getSystemStatus.mockRejectedValue(new Error('Database error'));\n      \n      const request = new NextRequest('http://localhost/api/admin/email-verification-monitor');\n      const response = await GET(request);\n      \n      expect(response.status).toBe(500);\n      \n      const data = await response.json();\n      expect(data.error).toBe('Failed to fetch monitoring data');\n      expect(data.details).toBe('Database error');\n    });\n  });\n\n  describe('POST', () => {\n    it('should handle force-cleanup action', async () => {\n      const cleanupResult = {\n        expiredCodes: 10,\n        rateLimitData: 5,\n        timestamp: Date.now(),\n      };\n      \n      mockCleanupService.forceCleanup.mockResolvedValue(cleanupResult);\n      \n      const request = new NextRequest('http://localhost/api/admin/email-verification-monitor', {\n        method: 'POST',\n        body: JSON.stringify({ action: 'force-cleanup' }),\n        headers: { 'Content-Type': 'application/json' },\n      });\n      \n      const response = await POST(request);\n      \n      expect(response.status).toBe(200);\n      \n      const data = await response.json();\n      expect(data).toEqual({\n        success: true,\n        message: 'Cleanup completed successfully',\n        result: cleanupResult,\n      });\n      \n      expect(mockCleanupService.forceCleanup).toHaveBeenCalledWith();\n    });\n\n    it('should handle reset-email-stats action', async () => {\n      const request = new NextRequest('http://localhost/api/admin/email-verification-monitor', {\n        method: 'POST',\n        body: JSON.stringify({ action: 'reset-email-stats' }),\n        headers: { 'Content-Type': 'application/json' },\n      });\n      \n      const response = await POST(request);\n      \n      expect(response.status).toBe(200);\n      \n      const data = await response.json();\n      expect(data).toEqual({\n        success: true,\n        message: 'Email service statistics reset successfully',\n      });\n      \n      expect(mockEmailServiceMonitor.forceReset).toHaveBeenCalledWith();\n    });\n\n    it('should handle get-error-details action', async () => {\n      const errorDetails = {\n        totalErrors: 5,\n        errorsByType: { API_ERROR: 3, NETWORK_ERROR: 2 },\n        recentErrors: [],\n        criticalErrors: [],\n      };\n      \n      const recentEvents = [\n        { type: 'error', timestamp: Date.now(), responseTime: 200, error: { message: 'Error', code: 'API_ERROR' } },\n      ];\n      \n      mockEmailServiceMonitor.getErrorSummary.mockReturnValue(errorDetails);\n      mockEmailServiceMonitor.getRecentEvents.mockReturnValue(recentEvents);\n      \n      const request = new NextRequest('http://localhost/api/admin/email-verification-monitor', {\n        method: 'POST',\n        body: JSON.stringify({ action: 'get-error-details' }),\n        headers: { 'Content-Type': 'application/json' },\n      });\n      \n      const response = await POST(request);\n      \n      expect(response.status).toBe(200);\n      \n      const data = await response.json();\n      expect(data).toEqual({\n        success: true,\n        errorDetails,\n        recentEvents,\n      });\n      \n      expect(mockEmailServiceMonitor.getErrorSummary).toHaveBeenCalledWith();\n      expect(mockEmailServiceMonitor.getRecentEvents).toHaveBeenCalledWith(200);\n    });\n\n    it('should handle invalid action', async () => {\n      const request = new NextRequest('http://localhost/api/admin/email-verification-monitor', {\n        method: 'POST',\n        body: JSON.stringify({ action: 'invalid-action' }),\n        headers: { 'Content-Type': 'application/json' },\n      });\n      \n      const response = await POST(request);\n      \n      expect(response.status).toBe(400);\n      \n      const data = await response.json();\n      expect(data.error).toBe('Invalid action specified');\n    });\n\n    it('should handle authentication errors', async () => {\n      mockRequireAuth.mockRejectedValue(new Error('Unauthorized'));\n      \n      const request = new NextRequest('http://localhost/api/admin/email-verification-monitor', {\n        method: 'POST',\n        body: JSON.stringify({ action: 'force-cleanup' }),\n        headers: { 'Content-Type': 'application/json' },\n      });\n      \n      const response = await POST(request);\n      \n      expect(response.status).toBe(500);\n      \n      const data = await response.json();\n      expect(data.error).toBe('Failed to perform admin action');\n    });\n\n    it('should handle cleanup errors', async () => {\n      mockCleanupService.forceCleanup.mockRejectedValue(new Error('Cleanup failed'));\n      \n      const request = new NextRequest('http://localhost/api/admin/email-verification-monitor', {\n        method: 'POST',\n        body: JSON.stringify({ action: 'force-cleanup' }),\n        headers: { 'Content-Type': 'application/json' },\n      });\n      \n      const response = await POST(request);\n      \n      expect(response.status).toBe(500);\n      \n      const data = await response.json();\n      expect(data.error).toBe('Failed to perform admin action');\n      expect(data.details).toBe('Cleanup failed');\n    });\n  });\n});"],"names":["jest","mock","requireAuth","fn","emailVerificationCleanupService","getSystemStatus","getCleanupStats","forceCleanup","emailServiceMonitor","getStats","getHealthStatus","getRecentEvents","getErrorSummary","isQuotaNearLimit","forceReset","mockRequireAuth","mockCleanupService","mockEmailServiceMonitor","describe","mockUser","id","email","name","beforeEach","clearAllMocks","mockResolvedValue","user","verificationCodes","totalActive","expiredCount","highAttemptCount","rateLimits","verificationAttempts","resendRequests","emailVerificationActivity","resendCooldowns","securityEvents","emailService","health","quotaUsage","successRate","totalSent","totalFailed","averageResponseTime","issues","recommendations","cleanup","lastCleanup","Date","now","isRunning","nextCleanupDue","mockReturnValue","quotaUsed","quotaLimit","errorsByType","API_ERROR","NETWORK_ERROR","lastResetTime","status","type","timestamp","responseTime","error","message","code","totalErrors","recentErrors","criticalErrors","recentStats","expiredCodes","rateLimitData","totalExpiredCodes","totalRateLimitData","it","request","NextRequest","response","GET","expect","toBe","data","json","toMatchObject","any","Number","systemStatus","objectContaining","Object","stats","recentEvents","Array","errorSummary","quotaWarning","Boolean","quotaCritical","alerts","toHaveBeenCalledWith","length","toBeGreaterThan","criticalAlerts","filter","alert","level","quotaAlert","find","includes","toBeDefined","successRateAlert","securityAlert","mockRejectedValue","Error","details","cleanupResult","method","body","JSON","stringify","action","headers","POST","toEqual","success","result","errorDetails"],"mappings":"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"}