f5787b498688a3dfb2b5af374bfb3e37
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: Object.getOwnPropertyDescriptor(all, name).get
    });
}
_export(exports, {
    get DEFAULT_EMAIL_VERIFICATION_RATE_LIMIT_CONFIG () {
        return DEFAULT_EMAIL_VERIFICATION_RATE_LIMIT_CONFIG;
    },
    get EmailVerificationRateLimiter () {
        return EmailVerificationRateLimiter;
    },
    get emailVerificationRateLimiter () {
        return emailVerificationRateLimiter;
    },
    get logSecurityEvent () {
        return logSecurityEvent;
    }
});
require("server-only");
const DEFAULT_EMAIL_VERIFICATION_RATE_LIMIT_CONFIG = {
    // Max 5 verification attempts per code (handled by service)
    maxVerificationAttempts: 10,
    verificationWindowMs: 60 * 60 * 1000,
    // Max 5 resend requests per hour per email
    maxResendRequests: 5,
    resendWindowMs: 60 * 60 * 1000,
    resendCooldownMs: 60 * 1000,
    // Overall email verification activity per IP
    maxEmailVerificationRequests: 20,
    emailVerificationWindowMs: 60 * 60 * 1000
};
// In-memory stores (in production, use Redis)
const verificationAttemptStore = new Map();
const resendRequestStore = new Map();
const emailVerificationStore = new Map();
const resendCooldownStore = new Map(); // email -> last resend timestamp
const securityEvents = [];
function logSecurityEvent(event) {
    securityEvents.push(event);
    // Log to console (in production, send to monitoring service)
    console.warn(`[SECURITY] ${event.type}:`, {
        identifier: event.identifier,
        email: event.email,
        timestamp: new Date(event.timestamp).toISOString(),
        details: event.details
    });
    // Keep only last 1000 events in memory
    if (securityEvents.length > 1000) {
        securityEvents.splice(0, securityEvents.length - 1000);
    }
}
// Generic rate limiting function
function checkRateLimit(store, identifier, maxRequests, windowMs) {
    const now = Date.now();
    // Clean up expired entries
    for (const [key, entry] of store.entries()){
        if (entry.resetTime < now) {
            store.delete(key);
        }
    }
    const entry = store.get(identifier);
    if (!entry || entry.resetTime < now) {
        // New window or expired window
        const resetTime = now + windowMs;
        store.set(identifier, {
            count: 1,
            resetTime,
            firstAttempt: now
        });
        return {
            allowed: true,
            remaining: maxRequests - 1,
            resetTime
        };
    }
    if (entry.count >= maxRequests) {
        // Rate limit exceeded
        const retryAfter = Math.ceil((entry.resetTime - now) / 1000);
        return {
            allowed: false,
            remaining: 0,
            resetTime: entry.resetTime,
            retryAfter
        };
    }
    // Increment count
    entry.count++;
    store.set(identifier, entry);
    return {
        allowed: true,
        remaining: maxRequests - entry.count,
        resetTime: entry.resetTime
    };
}
class EmailVerificationRateLimiter {
    constructor(config = DEFAULT_EMAIL_VERIFICATION_RATE_LIMIT_CONFIG){
        this.config = config;
    }
    /**
   * Check rate limit for verification attempts
   */ checkVerificationAttempts(identifier, email) {
        const result = checkRateLimit(verificationAttemptStore, identifier, this.config.maxVerificationAttempts, this.config.verificationWindowMs);
        if (!result.allowed) {
            logSecurityEvent({
                type: 'RATE_LIMIT_EXCEEDED',
                identifier,
                email,
                timestamp: Date.now(),
                details: {
                    limitType: 'verification_attempts',
                    maxRequests: this.config.maxVerificationAttempts,
                    windowMs: this.config.verificationWindowMs
                }
            });
        }
        return result;
    }
    /**
   * Check rate limit for resend requests
   */ checkResendRequests(email, identifier) {
        const normalizedEmail = email.toLowerCase();
        // Check cooldown first
        const lastResendTime = resendCooldownStore.get(normalizedEmail);
        const now = Date.now();
        if (lastResendTime && now - lastResendTime < this.config.resendCooldownMs) {
            const cooldownRemaining = Math.ceil((this.config.resendCooldownMs - (now - lastResendTime)) / 1000);
            logSecurityEvent({
                type: 'RATE_LIMIT_EXCEEDED',
                identifier,
                email: normalizedEmail,
                timestamp: now,
                details: {
                    limitType: 'resend_cooldown',
                    cooldownMs: this.config.resendCooldownMs,
                    cooldownRemaining
                }
            });
            return {
                allowed: false,
                remaining: 0,
                resetTime: lastResendTime + this.config.resendCooldownMs,
                cooldownRemaining
            };
        }
        // Check hourly rate limit
        const result = checkRateLimit(resendRequestStore, normalizedEmail, this.config.maxResendRequests, this.config.resendWindowMs);
        if (!result.allowed) {
            logSecurityEvent({
                type: 'RATE_LIMIT_EXCEEDED',
                identifier,
                email: normalizedEmail,
                timestamp: now,
                details: {
                    limitType: 'resend_requests',
                    maxRequests: this.config.maxResendRequests,
                    windowMs: this.config.resendWindowMs
                }
            });
        }
        return result;
    }
    /**
   * Record successful resend to update cooldown
   */ recordResendSuccess(email) {
        const normalizedEmail = email.toLowerCase();
        resendCooldownStore.set(normalizedEmail, Date.now());
    }
    /**
   * Check overall email verification activity rate limit
   */ checkEmailVerificationActivity(identifier, email) {
        const result = checkRateLimit(emailVerificationStore, identifier, this.config.maxEmailVerificationRequests, this.config.emailVerificationWindowMs);
        if (!result.allowed) {
            logSecurityEvent({
                type: 'RATE_LIMIT_EXCEEDED',
                identifier,
                email,
                timestamp: Date.now(),
                details: {
                    limitType: 'email_verification_activity',
                    maxRequests: this.config.maxEmailVerificationRequests,
                    windowMs: this.config.emailVerificationWindowMs
                }
            });
        }
        return result;
    }
    /**
   * Detect suspicious activity patterns
   */ detectSuspiciousActivity(identifier, email) {
        const now = Date.now();
        const oneHour = 60 * 60 * 1000;
        // Check for rapid-fire attempts from same IP
        const verificationEntry = verificationAttemptStore.get(identifier);
        if (verificationEntry && verificationEntry.count >= 8) {
            const timeSpan = now - verificationEntry.firstAttempt;
            if (timeSpan < 10 * 60 * 1000) {
                logSecurityEvent({
                    type: 'SUSPICIOUS_ACTIVITY',
                    identifier,
                    email,
                    timestamp: now,
                    details: {
                        pattern: 'rapid_verification_attempts',
                        attempts: verificationEntry.count,
                        timeSpanMs: timeSpan
                    }
                });
                return true;
            }
        }
        // Check for multiple email addresses from same IP
        const recentEvents = securityEvents.filter((event)=>event.identifier === identifier && event.timestamp > now - oneHour && event.email);
        const uniqueEmails = new Set(recentEvents.map((event)=>event.email));
        if (uniqueEmails.size >= 5) {
            logSecurityEvent({
                type: 'SUSPICIOUS_ACTIVITY',
                identifier,
                email,
                timestamp: now,
                details: {
                    pattern: 'multiple_email_addresses',
                    uniqueEmails: uniqueEmails.size,
                    timeSpanMs: oneHour
                }
            });
            return true;
        }
        return false;
    }
    /**
   * Get security events for monitoring
   */ getSecurityEvents(since) {
        const cutoff = since || Date.now() - 24 * 60 * 60 * 1000; // Last 24 hours
        return securityEvents.filter((event)=>event.timestamp >= cutoff);
    }
    /**
   * Clean up expired data
   */ cleanup() {
        const now = Date.now();
        const oneDayAgo = now - 24 * 60 * 60 * 1000;
        // Clean up rate limit stores
        for (const store of [
            verificationAttemptStore,
            resendRequestStore,
            emailVerificationStore
        ]){
            for (const [key, entry] of store.entries()){
                if (entry.resetTime < now) {
                    store.delete(key);
                }
            }
        }
        // Clean up cooldown store
        for (const [email, timestamp] of resendCooldownStore.entries()){
            if (timestamp < oneDayAgo) {
                resendCooldownStore.delete(email);
            }
        }
        // Clean up old security events
        const cutoffIndex = securityEvents.findIndex((event)=>event.timestamp >= oneDayAgo);
        if (cutoffIndex > 0) {
            securityEvents.splice(0, cutoffIndex);
        }
    }
    /**
   * Get rate limit statistics
   */ getStats() {
        return {
            verificationAttempts: verificationAttemptStore.size,
            resendRequests: resendRequestStore.size,
            emailVerificationActivity: emailVerificationStore.size,
            resendCooldowns: resendCooldownStore.size,
            securityEvents: securityEvents.length
        };
    }
}
const emailVerificationRateLimiter = new EmailVerificationRateLimiter();
// Cleanup job - run every hour (but not during tests)
if (process.env.NODE_ENV !== 'test') {
    setInterval(()=>{
        emailVerificationRateLimiter.cleanup();
    }, 60 * 60 * 1000);
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9zdGVmYW5iZWtrZXIvcHJvamVjdHMvZmFuY3ktcGxhbnRpZXMvc3JjL2xpYi9zZXJ2aWNlcy9lbWFpbC12ZXJpZmljYXRpb24tcmF0ZS1saW1pdGVyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAnc2VydmVyLW9ubHknO1xuXG4vLyBSYXRlIGxpbWl0aW5nIGNvbmZpZ3VyYXRpb24gZm9yIGVtYWlsIHZlcmlmaWNhdGlvblxuZXhwb3J0IGludGVyZmFjZSBFbWFpbFZlcmlmaWNhdGlvblJhdGVMaW1pdENvbmZpZyB7XG4gIC8vIFZlcmlmaWNhdGlvbiBhdHRlbXB0c1xuICBtYXhWZXJpZmljYXRpb25BdHRlbXB0czogbnVtYmVyO1xuICB2ZXJpZmljYXRpb25XaW5kb3dNczogbnVtYmVyO1xuICBcbiAgLy8gUmVzZW5kIHJlcXVlc3RzXG4gIG1heFJlc2VuZFJlcXVlc3RzOiBudW1iZXI7XG4gIHJlc2VuZFdpbmRvd01zOiBudW1iZXI7XG4gIHJlc2VuZENvb2xkb3duTXM6IG51bWJlcjtcbiAgXG4gIC8vIE92ZXJhbGwgZW1haWwgdmVyaWZpY2F0aW9uIGFjdGl2aXR5XG4gIG1heEVtYWlsVmVyaWZpY2F0aW9uUmVxdWVzdHM6IG51bWJlcjtcbiAgZW1haWxWZXJpZmljYXRpb25XaW5kb3dNczogbnVtYmVyO1xufVxuXG4vLyBEZWZhdWx0IGNvbmZpZ3VyYXRpb24gYmFzZWQgb24gcmVxdWlyZW1lbnRzXG5leHBvcnQgY29uc3QgREVGQVVMVF9FTUFJTF9WRVJJRklDQVRJT05fUkFURV9MSU1JVF9DT05GSUc6IEVtYWlsVmVyaWZpY2F0aW9uUmF0ZUxpbWl0Q29uZmlnID0ge1xuICAvLyBNYXggNSB2ZXJpZmljYXRpb24gYXR0ZW1wdHMgcGVyIGNvZGUgKGhhbmRsZWQgYnkgc2VydmljZSlcbiAgbWF4VmVyaWZpY2F0aW9uQXR0ZW1wdHM6IDEwLCAvLyBQZXIgSVAgcGVyIGhvdXJcbiAgdmVyaWZpY2F0aW9uV2luZG93TXM6IDYwICogNjAgKiAxMDAwLCAvLyAxIGhvdXJcbiAgXG4gIC8vIE1heCA1IHJlc2VuZCByZXF1ZXN0cyBwZXIgaG91ciBwZXIgZW1haWxcbiAgbWF4UmVzZW5kUmVxdWVzdHM6IDUsXG4gIHJlc2VuZFdpbmRvd01zOiA2MCAqIDYwICogMTAwMCwgLy8gMSBob3VyXG4gIHJlc2VuZENvb2xkb3duTXM6IDYwICogMTAwMCwgLy8gNjAgc2Vjb25kcyBiZXR3ZWVuIHJlc2VuZHNcbiAgXG4gIC8vIE92ZXJhbGwgZW1haWwgdmVyaWZpY2F0aW9uIGFjdGl2aXR5IHBlciBJUFxuICBtYXhFbWFpbFZlcmlmaWNhdGlvblJlcXVlc3RzOiAyMCxcbiAgZW1haWxWZXJpZmljYXRpb25XaW5kb3dNczogNjAgKiA2MCAqIDEwMDAsIC8vIDEgaG91clxufTtcblxuLy8gUmF0ZSBsaW1pdCBlbnRyeSBzdHJ1Y3R1cmVcbmludGVyZmFjZSBSYXRlTGltaXRFbnRyeSB7XG4gIGNvdW50OiBudW1iZXI7XG4gIHJlc2V0VGltZTogbnVtYmVyO1xuICBmaXJzdEF0dGVtcHQ6IG51bWJlcjtcbn1cblxuLy8gSW4tbWVtb3J5IHN0b3JlcyAoaW4gcHJvZHVjdGlvbiwgdXNlIFJlZGlzKVxuY29uc3QgdmVyaWZpY2F0aW9uQXR0ZW1wdFN0b3JlID0gbmV3IE1hcDxzdHJpbmcsIFJhdGVMaW1pdEVudHJ5PigpO1xuY29uc3QgcmVzZW5kUmVxdWVzdFN0b3JlID0gbmV3IE1hcDxzdHJpbmcsIFJhdGVMaW1pdEVudHJ5PigpO1xuY29uc3QgZW1haWxWZXJpZmljYXRpb25TdG9yZSA9IG5ldyBNYXA8c3RyaW5nLCBSYXRlTGltaXRFbnRyeT4oKTtcbmNvbnN0IHJlc2VuZENvb2xkb3duU3RvcmUgPSBuZXcgTWFwPHN0cmluZywgbnVtYmVyPigpOyAvLyBlbWFpbCAtPiBsYXN0IHJlc2VuZCB0aW1lc3RhbXBcblxuLy8gU2VjdXJpdHkgZXZlbnQgbG9nZ2luZ1xuZXhwb3J0IGludGVyZmFjZSBTZWN1cml0eUV2ZW50IHtcbiAgdHlwZTogJ1JBVEVfTElNSVRfRVhDRUVERUQnIHwgJ1NVU1BJQ0lPVVNfQUNUSVZJVFknIHwgJ0JSVVRFX0ZPUkNFX0FUVEVNUFQnO1xuICBpZGVudGlmaWVyOiBzdHJpbmc7XG4gIGVtYWlsPzogc3RyaW5nO1xuICB0aW1lc3RhbXA6IG51bWJlcjtcbiAgZGV0YWlsczogUmVjb3JkPHN0cmluZywgYW55Pjtcbn1cblxuY29uc3Qgc2VjdXJpdHlFdmVudHM6IFNlY3VyaXR5RXZlbnRbXSA9IFtdO1xuXG5leHBvcnQgZnVuY3Rpb24gbG9nU2VjdXJpdHlFdmVudChldmVudDogU2VjdXJpdHlFdmVudCk6IHZvaWQge1xuICBzZWN1cml0eUV2ZW50cy5wdXNoKGV2ZW50KTtcbiAgXG4gIC8vIExvZyB0byBjb25zb2xlIChpbiBwcm9kdWN0aW9uLCBzZW5kIHRvIG1vbml0b3Jpbmcgc2VydmljZSlcbiAgY29uc29sZS53YXJuKGBbU0VDVVJJVFldICR7ZXZlbnQudHlwZX06YCwge1xuICAgIGlkZW50aWZpZXI6IGV2ZW50LmlkZW50aWZpZXIsXG4gICAgZW1haWw6IGV2ZW50LmVtYWlsLFxuICAgIHRpbWVzdGFtcDogbmV3IERhdGUoZXZlbnQudGltZXN0YW1wKS50b0lTT1N0cmluZygpLFxuICAgIGRldGFpbHM6IGV2ZW50LmRldGFpbHMsXG4gIH0pO1xuICBcbiAgLy8gS2VlcCBvbmx5IGxhc3QgMTAwMCBldmVudHMgaW4gbWVtb3J5XG4gIGlmIChzZWN1cml0eUV2ZW50cy5sZW5ndGggPiAxMDAwKSB7XG4gICAgc2VjdXJpdHlFdmVudHMuc3BsaWNlKDAsIHNlY3VyaXR5RXZlbnRzLmxlbmd0aCAtIDEwMDApO1xuICB9XG59XG5cbi8vIEdlbmVyaWMgcmF0ZSBsaW1pdGluZyBmdW5jdGlvblxuZnVuY3Rpb24gY2hlY2tSYXRlTGltaXQoXG4gIHN0b3JlOiBNYXA8c3RyaW5nLCBSYXRlTGltaXRFbnRyeT4sXG4gIGlkZW50aWZpZXI6IHN0cmluZyxcbiAgbWF4UmVxdWVzdHM6IG51bWJlcixcbiAgd2luZG93TXM6IG51bWJlclxuKTogeyBhbGxvd2VkOiBib29sZWFuOyByZW1haW5pbmc6IG51bWJlcjsgcmVzZXRUaW1lOiBudW1iZXI7IHJldHJ5QWZ0ZXI/OiBudW1iZXIgfSB7XG4gIGNvbnN0IG5vdyA9IERhdGUubm93KCk7XG4gIFxuICAvLyBDbGVhbiB1cCBleHBpcmVkIGVudHJpZXNcbiAgZm9yIChjb25zdCBba2V5LCBlbnRyeV0gb2Ygc3RvcmUuZW50cmllcygpKSB7XG4gICAgaWYgKGVudHJ5LnJlc2V0VGltZSA8IG5vdykge1xuICAgICAgc3RvcmUuZGVsZXRlKGtleSk7XG4gICAgfVxuICB9XG4gIFxuICBjb25zdCBlbnRyeSA9IHN0b3JlLmdldChpZGVudGlmaWVyKTtcbiAgXG4gIGlmICghZW50cnkgfHwgZW50cnkucmVzZXRUaW1lIDwgbm93KSB7XG4gICAgLy8gTmV3IHdpbmRvdyBvciBleHBpcmVkIHdpbmRvd1xuICAgIGNvbnN0IHJlc2V0VGltZSA9IG5vdyArIHdpbmRvd01zO1xuICAgIHN0b3JlLnNldChpZGVudGlmaWVyLCB7XG4gICAgICBjb3VudDogMSxcbiAgICAgIHJlc2V0VGltZSxcbiAgICAgIGZpcnN0QXR0ZW1wdDogbm93LFxuICAgIH0pO1xuICAgIFxuICAgIHJldHVybiB7XG4gICAgICBhbGxvd2VkOiB0cnVlLFxuICAgICAgcmVtYWluaW5nOiBtYXhSZXF1ZXN0cyAtIDEsXG4gICAgICByZXNldFRpbWUsXG4gICAgfTtcbiAgfVxuICBcbiAgaWYgKGVudHJ5LmNvdW50ID49IG1heFJlcXVlc3RzKSB7XG4gICAgLy8gUmF0ZSBsaW1pdCBleGNlZWRlZFxuICAgIGNvbnN0IHJldHJ5QWZ0ZXIgPSBNYXRoLmNlaWwoKGVudHJ5LnJlc2V0VGltZSAtIG5vdykgLyAxMDAwKTtcbiAgICBcbiAgICByZXR1cm4ge1xuICAgICAgYWxsb3dlZDogZmFsc2UsXG4gICAgICByZW1haW5pbmc6IDAsXG4gICAgICByZXNldFRpbWU6IGVudHJ5LnJlc2V0VGltZSxcbiAgICAgIHJldHJ5QWZ0ZXIsXG4gICAgfTtcbiAgfVxuICBcbiAgLy8gSW5jcmVtZW50IGNvdW50XG4gIGVudHJ5LmNvdW50Kys7XG4gIHN0b3JlLnNldChpZGVudGlmaWVyLCBlbnRyeSk7XG4gIFxuICByZXR1cm4ge1xuICAgIGFsbG93ZWQ6IHRydWUsXG4gICAgcmVtYWluaW5nOiBtYXhSZXF1ZXN0cyAtIGVudHJ5LmNvdW50LFxuICAgIHJlc2V0VGltZTogZW50cnkucmVzZXRUaW1lLFxuICB9O1xufVxuXG5leHBvcnQgY2xhc3MgRW1haWxWZXJpZmljYXRpb25SYXRlTGltaXRlciB7XG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgY29uZmlnOiBFbWFpbFZlcmlmaWNhdGlvblJhdGVMaW1pdENvbmZpZyA9IERFRkFVTFRfRU1BSUxfVkVSSUZJQ0FUSU9OX1JBVEVfTElNSVRfQ09ORklHKSB7fVxuICBcbiAgLyoqXG4gICAqIENoZWNrIHJhdGUgbGltaXQgZm9yIHZlcmlmaWNhdGlvbiBhdHRlbXB0c1xuICAgKi9cbiAgY2hlY2tWZXJpZmljYXRpb25BdHRlbXB0cyhpZGVudGlmaWVyOiBzdHJpbmcsIGVtYWlsPzogc3RyaW5nKToge1xuICAgIGFsbG93ZWQ6IGJvb2xlYW47XG4gICAgcmVtYWluaW5nOiBudW1iZXI7XG4gICAgcmVzZXRUaW1lOiBudW1iZXI7XG4gICAgcmV0cnlBZnRlcj86IG51bWJlcjtcbiAgfSB7XG4gICAgY29uc3QgcmVzdWx0ID0gY2hlY2tSYXRlTGltaXQoXG4gICAgICB2ZXJpZmljYXRpb25BdHRlbXB0U3RvcmUsXG4gICAgICBpZGVudGlmaWVyLFxuICAgICAgdGhpcy5jb25maWcubWF4VmVyaWZpY2F0aW9uQXR0ZW1wdHMsXG4gICAgICB0aGlzLmNvbmZpZy52ZXJpZmljYXRpb25XaW5kb3dNc1xuICAgICk7XG4gICAgXG4gICAgaWYgKCFyZXN1bHQuYWxsb3dlZCkge1xuICAgICAgbG9nU2VjdXJpdHlFdmVudCh7XG4gICAgICAgIHR5cGU6ICdSQVRFX0xJTUlUX0VYQ0VFREVEJyxcbiAgICAgICAgaWRlbnRpZmllcixcbiAgICAgICAgZW1haWwsXG4gICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSxcbiAgICAgICAgZGV0YWlsczoge1xuICAgICAgICAgIGxpbWl0VHlwZTogJ3ZlcmlmaWNhdGlvbl9hdHRlbXB0cycsXG4gICAgICAgICAgbWF4UmVxdWVzdHM6IHRoaXMuY29uZmlnLm1heFZlcmlmaWNhdGlvbkF0dGVtcHRzLFxuICAgICAgICAgIHdpbmRvd01zOiB0aGlzLmNvbmZpZy52ZXJpZmljYXRpb25XaW5kb3dNcyxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH1cbiAgICBcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG4gIFxuICAvKipcbiAgICogQ2hlY2sgcmF0ZSBsaW1pdCBmb3IgcmVzZW5kIHJlcXVlc3RzXG4gICAqL1xuICBjaGVja1Jlc2VuZFJlcXVlc3RzKGVtYWlsOiBzdHJpbmcsIGlkZW50aWZpZXI6IHN0cmluZyk6IHtcbiAgICBhbGxvd2VkOiBib29sZWFuO1xuICAgIHJlbWFpbmluZzogbnVtYmVyO1xuICAgIHJlc2V0VGltZTogbnVtYmVyO1xuICAgIHJldHJ5QWZ0ZXI/OiBudW1iZXI7XG4gICAgY29vbGRvd25SZW1haW5pbmc/OiBudW1iZXI7XG4gIH0ge1xuICAgIGNvbnN0IG5vcm1hbGl6ZWRFbWFpbCA9IGVtYWlsLnRvTG93ZXJDYXNlKCk7XG4gICAgXG4gICAgLy8gQ2hlY2sgY29vbGRvd24gZmlyc3RcbiAgICBjb25zdCBsYXN0UmVzZW5kVGltZSA9IHJlc2VuZENvb2xkb3duU3RvcmUuZ2V0KG5vcm1hbGl6ZWRFbWFpbCk7XG4gICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTtcbiAgICBcbiAgICBpZiAobGFzdFJlc2VuZFRpbWUgJiYgKG5vdyAtIGxhc3RSZXNlbmRUaW1lKSA8IHRoaXMuY29uZmlnLnJlc2VuZENvb2xkb3duTXMpIHtcbiAgICAgIGNvbnN0IGNvb2xkb3duUmVtYWluaW5nID0gTWF0aC5jZWlsKCh0aGlzLmNvbmZpZy5yZXNlbmRDb29sZG93bk1zIC0gKG5vdyAtIGxhc3RSZXNlbmRUaW1lKSkgLyAxMDAwKTtcbiAgICAgIFxuICAgICAgbG9nU2VjdXJpdHlFdmVudCh7XG4gICAgICAgIHR5cGU6ICdSQVRFX0xJTUlUX0VYQ0VFREVEJyxcbiAgICAgICAgaWRlbnRpZmllcixcbiAgICAgICAgZW1haWw6IG5vcm1hbGl6ZWRFbWFpbCxcbiAgICAgICAgdGltZXN0YW1wOiBub3csXG4gICAgICAgIGRldGFpbHM6IHtcbiAgICAgICAgICBsaW1pdFR5cGU6ICdyZXNlbmRfY29vbGRvd24nLFxuICAgICAgICAgIGNvb2xkb3duTXM6IHRoaXMuY29uZmlnLnJlc2VuZENvb2xkb3duTXMsXG4gICAgICAgICAgY29vbGRvd25SZW1haW5pbmcsXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgYWxsb3dlZDogZmFsc2UsXG4gICAgICAgIHJlbWFpbmluZzogMCxcbiAgICAgICAgcmVzZXRUaW1lOiBsYXN0UmVzZW5kVGltZSArIHRoaXMuY29uZmlnLnJlc2VuZENvb2xkb3duTXMsXG4gICAgICAgIGNvb2xkb3duUmVtYWluaW5nLFxuICAgICAgfTtcbiAgICB9XG4gICAgXG4gICAgLy8gQ2hlY2sgaG91cmx5IHJhdGUgbGltaXRcbiAgICBjb25zdCByZXN1bHQgPSBjaGVja1JhdGVMaW1pdChcbiAgICAgIHJlc2VuZFJlcXVlc3RTdG9yZSxcbiAgICAgIG5vcm1hbGl6ZWRFbWFpbCxcbiAgICAgIHRoaXMuY29uZmlnLm1heFJlc2VuZFJlcXVlc3RzLFxuICAgICAgdGhpcy5jb25maWcucmVzZW5kV2luZG93TXNcbiAgICApO1xuICAgIFxuICAgIGlmICghcmVzdWx0LmFsbG93ZWQpIHtcbiAgICAgIGxvZ1NlY3VyaXR5RXZlbnQoe1xuICAgICAgICB0eXBlOiAnUkFURV9MSU1JVF9FWENFRURFRCcsXG4gICAgICAgIGlkZW50aWZpZXIsXG4gICAgICAgIGVtYWlsOiBub3JtYWxpemVkRW1haWwsXG4gICAgICAgIHRpbWVzdGFtcDogbm93LFxuICAgICAgICBkZXRhaWxzOiB7XG4gICAgICAgICAgbGltaXRUeXBlOiAncmVzZW5kX3JlcXVlc3RzJyxcbiAgICAgICAgICBtYXhSZXF1ZXN0czogdGhpcy5jb25maWcubWF4UmVzZW5kUmVxdWVzdHMsXG4gICAgICAgICAgd2luZG93TXM6IHRoaXMuY29uZmlnLnJlc2VuZFdpbmRvd01zLFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfVxuICAgIFxuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cbiAgXG4gIC8qKlxuICAgKiBSZWNvcmQgc3VjY2Vzc2Z1bCByZXNlbmQgdG8gdXBkYXRlIGNvb2xkb3duXG4gICAqL1xuICByZWNvcmRSZXNlbmRTdWNjZXNzKGVtYWlsOiBzdHJpbmcpOiB2b2lkIHtcbiAgICBjb25zdCBub3JtYWxpemVkRW1haWwgPSBlbWFpbC50b0xvd2VyQ2FzZSgpO1xuICAgIHJlc2VuZENvb2xkb3duU3RvcmUuc2V0KG5vcm1hbGl6ZWRFbWFpbCwgRGF0ZS5ub3coKSk7XG4gIH1cbiAgXG4gIC8qKlxuICAgKiBDaGVjayBvdmVyYWxsIGVtYWlsIHZlcmlmaWNhdGlvbiBhY3Rpdml0eSByYXRlIGxpbWl0XG4gICAqL1xuICBjaGVja0VtYWlsVmVyaWZpY2F0aW9uQWN0aXZpdHkoaWRlbnRpZmllcjogc3RyaW5nLCBlbWFpbD86IHN0cmluZyk6IHtcbiAgICBhbGxvd2VkOiBib29sZWFuO1xuICAgIHJlbWFpbmluZzogbnVtYmVyO1xuICAgIHJlc2V0VGltZTogbnVtYmVyO1xuICAgIHJldHJ5QWZ0ZXI/OiBudW1iZXI7XG4gIH0ge1xuICAgIGNvbnN0IHJlc3VsdCA9IGNoZWNrUmF0ZUxpbWl0KFxuICAgICAgZW1haWxWZXJpZmljYXRpb25TdG9yZSxcbiAgICAgIGlkZW50aWZpZXIsXG4gICAgICB0aGlzLmNvbmZpZy5tYXhFbWFpbFZlcmlmaWNhdGlvblJlcXVlc3RzLFxuICAgICAgdGhpcy5jb25maWcuZW1haWxWZXJpZmljYXRpb25XaW5kb3dNc1xuICAgICk7XG4gICAgXG4gICAgaWYgKCFyZXN1bHQuYWxsb3dlZCkge1xuICAgICAgbG9nU2VjdXJpdHlFdmVudCh7XG4gICAgICAgIHR5cGU6ICdSQVRFX0xJTUlUX0VYQ0VFREVEJyxcbiAgICAgICAgaWRlbnRpZmllcixcbiAgICAgICAgZW1haWwsXG4gICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSxcbiAgICAgICAgZGV0YWlsczoge1xuICAgICAgICAgIGxpbWl0VHlwZTogJ2VtYWlsX3ZlcmlmaWNhdGlvbl9hY3Rpdml0eScsXG4gICAgICAgICAgbWF4UmVxdWVzdHM6IHRoaXMuY29uZmlnLm1heEVtYWlsVmVyaWZpY2F0aW9uUmVxdWVzdHMsXG4gICAgICAgICAgd2luZG93TXM6IHRoaXMuY29uZmlnLmVtYWlsVmVyaWZpY2F0aW9uV2luZG93TXMsXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuICBcbiAgLyoqXG4gICAqIERldGVjdCBzdXNwaWNpb3VzIGFjdGl2aXR5IHBhdHRlcm5zXG4gICAqL1xuICBkZXRlY3RTdXNwaWNpb3VzQWN0aXZpdHkoaWRlbnRpZmllcjogc3RyaW5nLCBlbWFpbD86IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IG5vdyA9IERhdGUubm93KCk7XG4gICAgY29uc3Qgb25lSG91ciA9IDYwICogNjAgKiAxMDAwO1xuICAgIFxuICAgIC8vIENoZWNrIGZvciByYXBpZC1maXJlIGF0dGVtcHRzIGZyb20gc2FtZSBJUFxuICAgIGNvbnN0IHZlcmlmaWNhdGlvbkVudHJ5ID0gdmVyaWZpY2F0aW9uQXR0ZW1wdFN0b3JlLmdldChpZGVudGlmaWVyKTtcbiAgICBpZiAodmVyaWZpY2F0aW9uRW50cnkgJiYgdmVyaWZpY2F0aW9uRW50cnkuY291bnQgPj0gOCkge1xuICAgICAgY29uc3QgdGltZVNwYW4gPSBub3cgLSB2ZXJpZmljYXRpb25FbnRyeS5maXJzdEF0dGVtcHQ7XG4gICAgICBpZiAodGltZVNwYW4gPCAxMCAqIDYwICogMTAwMCkgeyAvLyA4KyBhdHRlbXB0cyBpbiAxMCBtaW51dGVzXG4gICAgICAgIGxvZ1NlY3VyaXR5RXZlbnQoe1xuICAgICAgICAgIHR5cGU6ICdTVVNQSUNJT1VTX0FDVElWSVRZJyxcbiAgICAgICAgICBpZGVudGlmaWVyLFxuICAgICAgICAgIGVtYWlsLFxuICAgICAgICAgIHRpbWVzdGFtcDogbm93LFxuICAgICAgICAgIGRldGFpbHM6IHtcbiAgICAgICAgICAgIHBhdHRlcm46ICdyYXBpZF92ZXJpZmljYXRpb25fYXR0ZW1wdHMnLFxuICAgICAgICAgICAgYXR0ZW1wdHM6IHZlcmlmaWNhdGlvbkVudHJ5LmNvdW50LFxuICAgICAgICAgICAgdGltZVNwYW5NczogdGltZVNwYW4sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICAvLyBDaGVjayBmb3IgbXVsdGlwbGUgZW1haWwgYWRkcmVzc2VzIGZyb20gc2FtZSBJUFxuICAgIGNvbnN0IHJlY2VudEV2ZW50cyA9IHNlY3VyaXR5RXZlbnRzLmZpbHRlcihcbiAgICAgIGV2ZW50ID0+IGV2ZW50LmlkZW50aWZpZXIgPT09IGlkZW50aWZpZXIgJiYgXG4gICAgICAgICAgICAgICBldmVudC50aW1lc3RhbXAgPiAobm93IC0gb25lSG91cikgJiZcbiAgICAgICAgICAgICAgIGV2ZW50LmVtYWlsXG4gICAgKTtcbiAgICBcbiAgICBjb25zdCB1bmlxdWVFbWFpbHMgPSBuZXcgU2V0KHJlY2VudEV2ZW50cy5tYXAoZXZlbnQgPT4gZXZlbnQuZW1haWwpKTtcbiAgICBpZiAodW5pcXVlRW1haWxzLnNpemUgPj0gNSkgeyAvLyA1KyBkaWZmZXJlbnQgZW1haWxzIGluIDEgaG91clxuICAgICAgbG9nU2VjdXJpdHlFdmVudCh7XG4gICAgICAgIHR5cGU6ICdTVVNQSUNJT1VTX0FDVElWSVRZJyxcbiAgICAgICAgaWRlbnRpZmllcixcbiAgICAgICAgZW1haWwsXG4gICAgICAgIHRpbWVzdGFtcDogbm93LFxuICAgICAgICBkZXRhaWxzOiB7XG4gICAgICAgICAgcGF0dGVybjogJ211bHRpcGxlX2VtYWlsX2FkZHJlc3NlcycsXG4gICAgICAgICAgdW5pcXVlRW1haWxzOiB1bmlxdWVFbWFpbHMuc2l6ZSxcbiAgICAgICAgICB0aW1lU3Bhbk1zOiBvbmVIb3VyLFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIFxuICAvKipcbiAgICogR2V0IHNlY3VyaXR5IGV2ZW50cyBmb3IgbW9uaXRvcmluZ1xuICAgKi9cbiAgZ2V0U2VjdXJpdHlFdmVudHMoc2luY2U/OiBudW1iZXIpOiBTZWN1cml0eUV2ZW50W10ge1xuICAgIGNvbnN0IGN1dG9mZiA9IHNpbmNlIHx8IChEYXRlLm5vdygpIC0gMjQgKiA2MCAqIDYwICogMTAwMCk7IC8vIExhc3QgMjQgaG91cnNcbiAgICByZXR1cm4gc2VjdXJpdHlFdmVudHMuZmlsdGVyKGV2ZW50ID0+IGV2ZW50LnRpbWVzdGFtcCA+PSBjdXRvZmYpO1xuICB9XG4gIFxuICAvKipcbiAgICogQ2xlYW4gdXAgZXhwaXJlZCBkYXRhXG4gICAqL1xuICBjbGVhbnVwKCk6IHZvaWQge1xuICAgIGNvbnN0IG5vdyA9IERhdGUubm93KCk7XG4gICAgY29uc3Qgb25lRGF5QWdvID0gbm93IC0gMjQgKiA2MCAqIDYwICogMTAwMDtcbiAgICBcbiAgICAvLyBDbGVhbiB1cCByYXRlIGxpbWl0IHN0b3Jlc1xuICAgIGZvciAoY29uc3Qgc3RvcmUgb2YgW3ZlcmlmaWNhdGlvbkF0dGVtcHRTdG9yZSwgcmVzZW5kUmVxdWVzdFN0b3JlLCBlbWFpbFZlcmlmaWNhdGlvblN0b3JlXSkge1xuICAgICAgZm9yIChjb25zdCBba2V5LCBlbnRyeV0gb2Ygc3RvcmUuZW50cmllcygpKSB7XG4gICAgICAgIGlmIChlbnRyeS5yZXNldFRpbWUgPCBub3cpIHtcbiAgICAgICAgICBzdG9yZS5kZWxldGUoa2V5KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICAvLyBDbGVhbiB1cCBjb29sZG93biBzdG9yZVxuICAgIGZvciAoY29uc3QgW2VtYWlsLCB0aW1lc3RhbXBdIG9mIHJlc2VuZENvb2xkb3duU3RvcmUuZW50cmllcygpKSB7XG4gICAgICBpZiAodGltZXN0YW1wIDwgb25lRGF5QWdvKSB7XG4gICAgICAgIHJlc2VuZENvb2xkb3duU3RvcmUuZGVsZXRlKGVtYWlsKTtcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgLy8gQ2xlYW4gdXAgb2xkIHNlY3VyaXR5IGV2ZW50c1xuICAgIGNvbnN0IGN1dG9mZkluZGV4ID0gc2VjdXJpdHlFdmVudHMuZmluZEluZGV4KGV2ZW50ID0+IGV2ZW50LnRpbWVzdGFtcCA+PSBvbmVEYXlBZ28pO1xuICAgIGlmIChjdXRvZmZJbmRleCA+IDApIHtcbiAgICAgIHNlY3VyaXR5RXZlbnRzLnNwbGljZSgwLCBjdXRvZmZJbmRleCk7XG4gICAgfVxuICB9XG4gIFxuICAvKipcbiAgICogR2V0IHJhdGUgbGltaXQgc3RhdGlzdGljc1xuICAgKi9cbiAgZ2V0U3RhdHMoKToge1xuICAgIHZlcmlmaWNhdGlvbkF0dGVtcHRzOiBudW1iZXI7XG4gICAgcmVzZW5kUmVxdWVzdHM6IG51bWJlcjtcbiAgICBlbWFpbFZlcmlmaWNhdGlvbkFjdGl2aXR5OiBudW1iZXI7XG4gICAgcmVzZW5kQ29vbGRvd25zOiBudW1iZXI7XG4gICAgc2VjdXJpdHlFdmVudHM6IG51bWJlcjtcbiAgfSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHZlcmlmaWNhdGlvbkF0dGVtcHRzOiB2ZXJpZmljYXRpb25BdHRlbXB0U3RvcmUuc2l6ZSxcbiAgICAgIHJlc2VuZFJlcXVlc3RzOiByZXNlbmRSZXF1ZXN0U3RvcmUuc2l6ZSxcbiAgICAgIGVtYWlsVmVyaWZpY2F0aW9uQWN0aXZpdHk6IGVtYWlsVmVyaWZpY2F0aW9uU3RvcmUuc2l6ZSxcbiAgICAgIHJlc2VuZENvb2xkb3duczogcmVzZW5kQ29vbGRvd25TdG9yZS5zaXplLFxuICAgICAgc2VjdXJpdHlFdmVudHM6IHNlY3VyaXR5RXZlbnRzLmxlbmd0aCxcbiAgICB9O1xuICB9XG59XG5cbi8vIEV4cG9ydCBzaW5nbGV0b24gaW5zdGFuY2VcbmV4cG9ydCBjb25zdCBlbWFpbFZlcmlmaWNhdGlvblJhdGVMaW1pdGVyID0gbmV3IEVtYWlsVmVyaWZpY2F0aW9uUmF0ZUxpbWl0ZXIoKTtcblxuLy8gQ2xlYW51cCBqb2IgLSBydW4gZXZlcnkgaG91ciAoYnV0IG5vdCBkdXJpbmcgdGVzdHMpXG5pZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICd0ZXN0Jykge1xuICBzZXRJbnRlcnZhbCgoKSA9PiB7XG4gICAgZW1haWxWZXJpZmljYXRpb25SYXRlTGltaXRlci5jbGVhbnVwKCk7XG4gIH0sIDYwICogNjAgKiAxMDAwKTtcbn0iXSwibmFtZXMiOlsiREVGQVVMVF9FTUFJTF9WRVJJRklDQVRJT05fUkFURV9MSU1JVF9DT05GSUciLCJFbWFpbFZlcmlmaWNhdGlvblJhdGVMaW1pdGVyIiwiZW1haWxWZXJpZmljYXRpb25SYXRlTGltaXRlciIsImxvZ1NlY3VyaXR5RXZlbnQiLCJtYXhWZXJpZmljYXRpb25BdHRlbXB0cyIsInZlcmlmaWNhdGlvbldpbmRvd01zIiwibWF4UmVzZW5kUmVxdWVzdHMiLCJyZXNlbmRXaW5kb3dNcyIsInJlc2VuZENvb2xkb3duTXMiLCJtYXhFbWFpbFZlcmlmaWNhdGlvblJlcXVlc3RzIiwiZW1haWxWZXJpZmljYXRpb25XaW5kb3dNcyIsInZlcmlmaWNhdGlvbkF0dGVtcHRTdG9yZSIsIk1hcCIsInJlc2VuZFJlcXVlc3RTdG9yZSIsImVtYWlsVmVyaWZpY2F0aW9uU3RvcmUiLCJyZXNlbmRDb29sZG93blN0b3JlIiwic2VjdXJpdHlFdmVudHMiLCJldmVudCIsInB1c2giLCJjb25zb2xlIiwid2FybiIsInR5cGUiLCJpZGVudGlmaWVyIiwiZW1haWwiLCJ0aW1lc3RhbXAiLCJEYXRlIiwidG9JU09TdHJpbmciLCJkZXRhaWxzIiwibGVuZ3RoIiwic3BsaWNlIiwiY2hlY2tSYXRlTGltaXQiLCJzdG9yZSIsIm1heFJlcXVlc3RzIiwid2luZG93TXMiLCJub3ciLCJrZXkiLCJlbnRyeSIsImVudHJpZXMiLCJyZXNldFRpbWUiLCJkZWxldGUiLCJnZXQiLCJzZXQiLCJjb3VudCIsImZpcnN0QXR0ZW1wdCIsImFsbG93ZWQiLCJyZW1haW5pbmciLCJyZXRyeUFmdGVyIiwiTWF0aCIsImNlaWwiLCJjb25maWciLCJjaGVja1ZlcmlmaWNhdGlvbkF0dGVtcHRzIiwicmVzdWx0IiwibGltaXRUeXBlIiwiY2hlY2tSZXNlbmRSZXF1ZXN0cyIsIm5vcm1hbGl6ZWRFbWFpbCIsInRvTG93ZXJDYXNlIiwibGFzdFJlc2VuZFRpbWUiLCJjb29sZG93blJlbWFpbmluZyIsImNvb2xkb3duTXMiLCJyZWNvcmRSZXNlbmRTdWNjZXNzIiwiY2hlY2tFbWFpbFZlcmlmaWNhdGlvbkFjdGl2aXR5IiwiZGV0ZWN0U3VzcGljaW91c0FjdGl2aXR5Iiwib25lSG91ciIsInZlcmlmaWNhdGlvbkVudHJ5IiwidGltZVNwYW4iLCJwYXR0ZXJuIiwiYXR0ZW1wdHMiLCJ0aW1lU3Bhbk1zIiwicmVjZW50RXZlbnRzIiwiZmlsdGVyIiwidW5pcXVlRW1haWxzIiwiU2V0IiwibWFwIiwic2l6ZSIsImdldFNlY3VyaXR5RXZlbnRzIiwic2luY2UiLCJjdXRvZmYiLCJjbGVhbnVwIiwib25lRGF5QWdvIiwiY3V0b2ZmSW5kZXgiLCJmaW5kSW5kZXgiLCJnZXRTdGF0cyIsInZlcmlmaWNhdGlvbkF0dGVtcHRzIiwicmVzZW5kUmVxdWVzdHMiLCJlbWFpbFZlcmlmaWNhdGlvbkFjdGl2aXR5IiwicmVzZW5kQ29vbGRvd25zIiwicHJvY2VzcyIsImVudiIsIk5PREVfRU5WIiwic2V0SW50ZXJ2YWwiXSwibWFwcGluZ3MiOiI7Ozs7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