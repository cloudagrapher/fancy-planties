{"version":3,"names":["createSession","cov_1kcfy4c2nf","f","s","createUser","getUserByEmail","getUserById","hashPassword","invalidateSession","invalidateUserSessions","signIn","signOut","signUp","signUpUnverified","verifyPassword","exports","password","saltRounds","_bcryptjs","default","hash","compare","userId","sessionId","_crypto","generateRandomString","expiresAt","Date","now","session","_db","db","insert","_schema","sessions","values","id","returning","_lucia","lucia","toString","email","name","hashedPassword","user","users","toLowerCase","select","from","where","_drizzleorm","eq","b","validPassword","luciaSession","existingUser","Error"],"sources":["/Users/stefanbekker/projects/fancy-planties/src/lib/auth/index.ts"],"sourcesContent":["import 'server-only';\n\nimport bcrypt from 'bcryptjs';\nimport { generateRandomString } from 'oslo/crypto';\nimport { db } from '../db';\nimport { users, sessions, type User as DatabaseUser, type Session as DatabaseSession } from '../db/schema';\nimport { eq } from 'drizzle-orm';\nimport { lucia } from './lucia';\n\n// Export types for use throughout the application\nexport type User = DatabaseUser;\nexport type Session = DatabaseSession;\n\n// Password hashing utilities\nexport async function hashPassword(password: string): Promise<string> {\n  const saltRounds = 12;\n  return await bcrypt.hash(password, saltRounds);\n}\n\nexport async function verifyPassword(password: string, hash: string): Promise<boolean> {\n  return await bcrypt.compare(password, hash);\n}\n\n// Session management utilities\nexport async function createSession(userId: number): Promise<Session> {\n  const sessionId = generateRandomString(40, '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ');\n  const expiresAt = new Date(Date.now() + 1000 * 60 * 60 * 24 * 30); // 30 days\n  \n  const [session] = await db.insert(sessions).values({\n    id: sessionId,\n    userId,\n    expiresAt,\n  }).returning();\n  \n  return session;\n}\n\nexport async function invalidateSession(sessionId: string): Promise<void> {\n  await lucia.invalidateSession(sessionId);\n}\n\nexport async function invalidateUserSessions(userId: number): Promise<void> {\n  await lucia.invalidateUserSessions(userId.toString());\n}\n\n\n// User management utilities\nexport async function createUser(email: string, password: string, name: string): Promise<User> {\n  const hashedPassword = await hashPassword(password);\n  \n  const [user] = await db.insert(users).values({\n    email: email.toLowerCase(),\n    hashedPassword,\n    name,\n  }).returning();\n  \n  return user;\n}\n\nexport async function getUserByEmail(email: string): Promise<User | null> {\n  const [user] = await db.select().from(users).where(eq(users.email, email.toLowerCase()));\n  return user || null;\n}\n\nexport async function getUserById(id: number): Promise<User | null> {\n  const [user] = await db.select().from(users).where(eq(users.id, id));\n  return user || null;\n}\n\n// Authentication flow helpers\nexport async function signIn(email: string, password: string): Promise<{ user: User; session: Session } | null> {\n  const user = await getUserByEmail(email);\n  \n  if (!user) {\n    return null;\n  }\n  \n  const validPassword = await verifyPassword(password, user.hashedPassword);\n  \n  if (!validPassword) {\n    return null;\n  }\n  \n  const luciaSession = await lucia.createSession(user.id.toString(), {});\n  \n  const session: Session = {\n    id: luciaSession.id,\n    userId: user.id,\n    expiresAt: luciaSession.expiresAt,\n  };\n  \n  return {\n    user,\n    session,\n  };\n}\n\nexport async function signUp(email: string, password: string, name: string): Promise<{ user: User; session: Session }> {\n  // Check if user already exists\n  const existingUser = await getUserByEmail(email);\n  \n  if (existingUser) {\n    throw new Error('User already exists');\n  }\n  \n  // Create new user\n  const user = await createUser(email, password, name);\n  \n  // Create session\n  const luciaSession = await lucia.createSession(user.id.toString(), {});\n  \n  const session: Session = {\n    id: luciaSession.id,\n    userId: user.id,\n    expiresAt: luciaSession.expiresAt,\n  };\n  \n  return {\n    user,\n    session,\n  };\n}\n\nexport async function signUpUnverified(email: string, password: string, name: string): Promise<User> {\n  // Check if user already exists\n  const existingUser = await getUserByEmail(email);\n  \n  if (existingUser) {\n    throw new Error('User already exists');\n  }\n  \n  // Create new unverified user (no session created)\n  const user = await createUser(email, password, name);\n  \n  return user;\n}\n\nexport async function signOut(sessionId: string): Promise<void> {\n  await lucia.invalidateSession(sessionId);\n}\n\n// Re-export utilities from other auth modules  \nexport * from './validation';\nexport * from './middleware';\nexport * from './session';"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}