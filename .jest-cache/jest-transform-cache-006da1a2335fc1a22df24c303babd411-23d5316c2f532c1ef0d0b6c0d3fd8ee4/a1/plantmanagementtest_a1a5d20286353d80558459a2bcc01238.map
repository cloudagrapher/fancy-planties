{"version":3,"sources":["/Users/stefanbekker/projects/fancy-planties/src/__tests__/api/plant-management.test.js"],"sourcesContent":["// Plant Management API Endpoint Tests\n// Tests GET /api/plants, POST /api/plant-instances, PUT /api/plant-instances/[id] endpoints\n\nimport { NextRequest, NextResponse } from 'next/server';\nimport { GET as getPlantsHandler, POST as createPlantHandler } from '@/app/api/plants/route';\nimport { GET as getPlantInstancesHandler, POST as createPlantInstanceHandler } from '@/app/api/plant-instances/route';\nimport { GET as getPlantInstanceHandler, PUT as updatePlantInstanceHandler, DELETE as deletePlantInstanceHandler } from '@/app/api/plant-instances/[id]/route';\nimport { createTestUser, createTestSession } from '@/test-utils/factories/user-factory';\nimport { createTestPlant, createTestPlantInstance } from '@/test-utils/factories/plant-factory';\nimport { resetApiMocks } from '@/test-utils/helpers/api-helpers';\n\n// Mock the auth functions\njest.mock('@/lib/auth/server', () => ({\n  validateRequest: jest.fn(),\n  validateVerifiedRequest: jest.fn(),\n}));\n\n// Mock the database queries\njest.mock('@/lib/db/queries/plant-taxonomy', () => ({\n  createPlant: jest.fn(),\n  getPlantsWithStats: jest.fn(),\n  validatePlantTaxonomy: jest.fn(),\n}));\n\njest.mock('@/lib/db/queries/plant-instances', () => ({\n  PlantInstanceQueries: {\n    getWithFilters: jest.fn(),\n    create: jest.fn(),\n    getEnhancedById: jest.fn(),\n    update: jest.fn(),\n    delete: jest.fn(),\n  },\n}));\n\n// Mock validation schemas\njest.mock('@/lib/validation/plant-schemas', () => ({\n  createPlantSchema: {\n    parse: jest.fn(),\n  },\n  plantFilterSchema: {\n    parse: jest.fn(),\n  },\n  createPlantInstanceSchema: {\n    parse: jest.fn(),\n  },\n  plantInstanceFilterSchema: {\n    parse: jest.fn(),\n  },\n  updatePlantInstanceSchema: {\n    parse: jest.fn(),\n  },\n}));\n\n// Import mocked functions\nimport { validateRequest, validateVerifiedRequest } from '@/lib/auth/server';\nimport { createPlant, getPlantsWithStats, validatePlantTaxonomy } from '@/lib/db/queries/plant-taxonomy';\nimport { PlantInstanceQueries } from '@/lib/db/queries/plant-instances';\nimport { \n  createPlantSchema, \n  plantFilterSchema, \n  createPlantInstanceSchema, \n  plantInstanceFilterSchema,\n  updatePlantInstanceSchema \n} from '@/lib/validation/plant-schemas';\n\ndescribe('Plant Management API Endpoints', () => {\n  let testUser;\n  let testSession;\n\n  beforeEach(() => {\n    jest.clearAllMocks();\n    resetApiMocks();\n    \n    testUser = createTestUser();\n    testSession = createTestSession(testUser);\n    \n    // Default auth mock\n    validateRequest.mockResolvedValue({\n      user: testUser,\n      session: testSession,\n    });\n    \n    validateVerifiedRequest.mockResolvedValue({\n      user: testUser,\n      session: testSession,\n    });\n  });\n\n  afterEach(() => {\n    jest.restoreAllMocks();\n  });\n\n  describe('GET /api/plants - Plant filtering and pagination', () => {\n    it('should return plants with default filters', async () => {\n      // Arrange\n      const mockPlants = [\n        { ...createTestPlant({ family: 'Araceae', genus: 'Monstera' }), id: 1 },\n        { ...createTestPlant({ family: 'Araceae', genus: 'Philodendron' }), id: 2 },\n      ];\n\n      plantFilterSchema.parse.mockReturnValue({\n        family: undefined,\n        genus: undefined,\n        isVerified: undefined,\n        createdBy: undefined,\n        limit: 20,\n        offset: 0,\n      });\n\n      getPlantsWithStats.mockResolvedValue(mockPlants);\n\n      const request = new NextRequest('http://localhost:3000/api/plants');\n\n      // Act\n      const response = await getPlantsHandler(request);\n      const responseData = await response.json();\n\n      // Assert\n      expect(response.status).toBe(200);\n      expect(responseData).toEqual({\n        success: true,\n        data: expect.arrayContaining([\n          expect.objectContaining({\n            id: expect.any(Number),\n            family: expect.any(String),\n            genus: expect.any(String),\n            species: expect.any(String),\n            commonName: expect.any(String),\n            isVerified: true,\n            createdAt: expect.any(String),\n            updatedAt: expect.any(String),\n          })\n        ]),\n        metadata: {\n          operation: 'search',\n          timestamp: expect.any(String),\n        },\n      });\n\n      expect(validateRequest).toHaveBeenCalled();\n      expect(plantFilterSchema.parse).toHaveBeenCalledWith({\n        family: undefined,\n        genus: undefined,\n        isVerified: undefined,\n        createdBy: undefined,\n        limit: 20,\n        offset: 0,\n      });\n      expect(getPlantsWithStats).toHaveBeenCalledWith(expect.any(Object), testUser.id);\n    });\n\n    it('should return plants with family filter', async () => {\n      // Arrange\n      const mockPlants = [\n        { ...createTestPlant({ family: 'Araceae', genus: 'Monstera' }), id: 1 },\n      ];\n\n      plantFilterSchema.parse.mockReturnValue({\n        family: 'Araceae',\n        genus: undefined,\n        isVerified: undefined,\n        createdBy: undefined,\n        limit: 20,\n        offset: 0,\n      });\n\n      getPlantsWithStats.mockResolvedValue(mockPlants);\n\n      const request = new NextRequest('http://localhost:3000/api/plants?family=Araceae');\n\n      // Act\n      const response = await getPlantsHandler(request);\n      const responseData = await response.json();\n\n      // Assert\n      expect(response.status).toBe(200);\n      expect(responseData.success).toBe(true);\n      expect(responseData.data).toEqual(expect.arrayContaining([\n        expect.objectContaining({\n          id: expect.any(Number),\n          family: 'Araceae',\n          genus: 'Monstera',\n          commonName: expect.any(String),\n          isVerified: true,\n        })\n      ]));\n\n      expect(plantFilterSchema.parse).toHaveBeenCalledWith({\n        family: 'Araceae',\n        genus: undefined,\n        isVerified: undefined,\n        createdBy: undefined,\n        limit: 20,\n        offset: 0,\n      });\n    });\n\n    it('should return plants with pagination parameters', async () => {\n      // Arrange\n      const mockPlants = [{ ...createTestPlant(), id: 1 }];\n\n      plantFilterSchema.parse.mockReturnValue({\n        family: undefined,\n        genus: undefined,\n        isVerified: undefined,\n        createdBy: undefined,\n        limit: 10,\n        offset: 20,\n      });\n\n      getPlantsWithStats.mockResolvedValue(mockPlants);\n\n      const request = new NextRequest('http://localhost:3000/api/plants?limit=10&offset=20');\n\n      // Act\n      const response = await getPlantsHandler(request);\n      const responseData = await response.json();\n\n      // Assert\n      expect(response.status).toBe(200);\n      expect(responseData.success).toBe(true);\n\n      expect(plantFilterSchema.parse).toHaveBeenCalledWith({\n        family: undefined,\n        genus: undefined,\n        isVerified: undefined,\n        createdBy: undefined,\n        limit: 10,\n        offset: 20,\n      });\n    });\n\n    it('should return unauthorized error when user not authenticated', async () => {\n      // Arrange\n      validateRequest.mockResolvedValue({\n        user: null,\n        session: null,\n      });\n\n      const request = new NextRequest('http://localhost:3000/api/plants');\n\n      // Act\n      const response = await getPlantsHandler(request);\n      const responseData = await response.json();\n\n      // Assert\n      expect(response.status).toBe(401);\n      expect(responseData).toEqual({\n        error: 'Unauthorized',\n      });\n\n      expect(getPlantsWithStats).not.toHaveBeenCalled();\n    });\n\n    it('should return validation error for invalid filter parameters', async () => {\n      // Arrange\n      const validationError = new Error('Validation failed');\n      validationError.name = 'ZodError';\n      validationError.issues = [\n        { path: ['limit'], message: 'Limit must be a positive number' }\n      ];\n\n      plantFilterSchema.parse.mockImplementation(() => {\n        throw validationError;\n      });\n\n      const request = new NextRequest('http://localhost:3000/api/plants?limit=invalid');\n\n      // Act\n      const response = await getPlantsHandler(request);\n      const responseData = await response.json();\n\n      // Assert\n      expect(response.status).toBe(400);\n      expect(responseData).toEqual({\n        error: 'Invalid filter parameters',\n        details: validationError.issues,\n      });\n\n      expect(getPlantsWithStats).not.toHaveBeenCalled();\n    });\n\n    it('should handle database errors gracefully', async () => {\n      // Arrange\n      plantFilterSchema.parse.mockReturnValue({\n        limit: 20,\n        offset: 0,\n      });\n\n      getPlantsWithStats.mockRejectedValue(new Error('Database connection failed'));\n\n      const request = new NextRequest('http://localhost:3000/api/plants');\n\n      // Act\n      const response = await getPlantsHandler(request);\n      const responseData = await response.json();\n\n      // Assert\n      expect(response.status).toBe(500);\n      expect(responseData).toEqual({\n        error: 'Internal server error',\n      });\n    });\n  });\n\n  describe('POST /api/plant-instances - Plant instance creation with data validation', () => {\n    it('should create plant instance with valid JSON data', async () => {\n      // Arrange\n      const testPlant = { ...createTestPlant(), id: 1 };\n      const requestBody = {\n        plantId: testPlant.id,\n        nickname: 'My Monstera',\n        location: 'Living Room',\n        notes: 'Beautiful plant',\n        isActive: true,\n      };\n\n      const expectedInstanceData = {\n        ...requestBody,\n        userId: testUser.id,\n        lastFertilized: null,\n        lastRepot: null,\n      };\n\n      const createdInstance = createTestPlantInstance({\n        ...expectedInstanceData,\n        id: 1,\n      });\n\n      const enhancedInstance = {\n        ...createdInstance,\n        plant: testPlant,\n      };\n\n      createPlantInstanceSchema.parse.mockReturnValue(expectedInstanceData);\n      PlantInstanceQueries.create.mockResolvedValue(createdInstance);\n      PlantInstanceQueries.getEnhancedById.mockResolvedValue(enhancedInstance);\n\n      const request = new NextRequest('http://localhost:3000/api/plant-instances', {\n        method: 'POST',\n        body: JSON.stringify(requestBody),\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      // Act\n      const response = await createPlantInstanceHandler(request);\n      const responseData = await response.json();\n\n      // Assert\n      expect(response.status).toBe(201);\n      expect(responseData).toEqual({\n        success: true,\n        data: enhancedInstance,\n      });\n\n      expect(createPlantInstanceSchema.parse).toHaveBeenCalledWith(expectedInstanceData);\n      expect(PlantInstanceQueries.create).toHaveBeenCalledWith(expectedInstanceData);\n      expect(PlantInstanceQueries.getEnhancedById).toHaveBeenCalledWith(createdInstance.id);\n    });\n\n    it('should create plant instance with FormData (file upload)', async () => {\n      // Arrange\n      const testPlant = { ...createTestPlant(), id: 1 };\n      const formData = new FormData();\n      formData.append('plantId', testPlant.id.toString());\n      formData.append('nickname', 'My Monstera');\n      formData.append('location', 'Living Room');\n      formData.append('isActive', 'true');\n\n      // Mock file\n      const mockFile = new File(['test image'], 'test.jpg', { type: 'image/jpeg' });\n      formData.append('imageFiles[0]', mockFile);\n\n      const expectedInstanceData = {\n        plantId: testPlant.id,\n        nickname: 'My Monstera',\n        location: 'Living Room',\n        isActive: true,\n        userId: testUser.id,\n        lastFertilized: null,\n        lastRepot: null,\n        images: ['data:image/jpeg;base64,dGVzdCBpbWFnZQ=='], // base64 of \"test image\"\n      };\n\n      const createdInstance = createTestPlantInstance(expectedInstanceData);\n      const enhancedInstance = { ...createdInstance, plant: testPlant };\n\n      createPlantInstanceSchema.parse.mockReturnValue(expectedInstanceData);\n      PlantInstanceQueries.create.mockResolvedValue(createdInstance);\n      PlantInstanceQueries.getEnhancedById.mockResolvedValue(enhancedInstance);\n\n      const request = new NextRequest('http://localhost:3000/api/plant-instances', {\n        method: 'POST',\n        body: formData,\n      });\n\n      // Act\n      const response = await createPlantInstanceHandler(request);\n      const responseData = await response.json();\n\n      // Assert\n      expect(response.status).toBe(201);\n      expect(responseData.success).toBe(true);\n      expect(responseData.data).toEqual(enhancedInstance);\n\n      expect(PlantInstanceQueries.create).toHaveBeenCalledWith(expectedInstanceData);\n    });\n\n    it('should return validation error for invalid plant instance data', async () => {\n      // Arrange\n      const requestBody = {\n        plantId: 'invalid',\n        nickname: '',\n        location: '',\n      };\n\n      const validationError = new Error('Validation failed');\n      validationError.name = 'ZodError';\n      validationError.issues = [\n        { path: ['plantId'], message: 'Plant ID must be a number' },\n        { path: ['nickname'], message: 'Nickname is required' },\n      ];\n\n      createPlantInstanceSchema.parse.mockImplementation(() => {\n        throw validationError;\n      });\n\n      const request = new NextRequest('http://localhost:3000/api/plant-instances', {\n        method: 'POST',\n        body: JSON.stringify(requestBody),\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      // Act\n      const response = await createPlantInstanceHandler(request);\n      const responseData = await response.json();\n\n      // Assert\n      expect(response.status).toBe(400);\n      expect(responseData).toEqual({\n        success: false,\n        error: 'Validation failed',\n        details: validationError.issues,\n      });\n\n      expect(PlantInstanceQueries.create).not.toHaveBeenCalled();\n    });\n\n    it('should return unauthorized error when user not authenticated', async () => {\n      // Arrange\n      validateVerifiedRequest.mockResolvedValue({\n        user: null,\n        error: 'Unauthorized',\n      });\n\n      const request = new NextRequest('http://localhost:3000/api/plant-instances', {\n        method: 'POST',\n        body: JSON.stringify({ plantId: 1 }),\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      // Act\n      const response = await createPlantInstanceHandler(request);\n      const responseData = await response.json();\n\n      // Assert\n      expect(response.status).toBe(401);\n      expect(responseData).toEqual({\n        success: false,\n        error: 'Unauthorized',\n      });\n\n      expect(PlantInstanceQueries.create).not.toHaveBeenCalled();\n    });\n\n    it('should handle empty request body', async () => {\n      // Arrange\n      const request = new NextRequest('http://localhost:3000/api/plant-instances', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      // Act\n      const response = await createPlantInstanceHandler(request);\n      const responseData = await response.json();\n\n      // Assert\n      expect(response.status).toBe(400);\n      expect(responseData).toEqual({\n        success: false,\n        error: 'Request body is required',\n      });\n\n      expect(PlantInstanceQueries.create).not.toHaveBeenCalled();\n    });\n\n    it('should handle malformed JSON', async () => {\n      // Arrange\n      const request = new NextRequest('http://localhost:3000/api/plant-instances', {\n        method: 'POST',\n        body: 'invalid json',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      // Act\n      const response = await createPlantInstanceHandler(request);\n      const responseData = await response.json();\n\n      // Assert\n      expect(response.status).toBe(400);\n      expect(responseData).toEqual({\n        success: false,\n        error: 'Invalid JSON in request body',\n      });\n\n      expect(PlantInstanceQueries.create).not.toHaveBeenCalled();\n    });\n\n    it('should calculate fertilizer due date from schedule', async () => {\n      // Arrange\n      const requestBody = {\n        plantId: 1,\n        nickname: 'Test Plant',\n        location: 'Test Location',\n        fertilizerSchedule: '2 weeks',\n      };\n\n      const expectedInstanceData = {\n        ...requestBody,\n        userId: testUser.id,\n        lastFertilized: null,\n        lastRepot: null,\n        fertilizerDue: expect.any(Date),\n      };\n\n      const createdInstance = createTestPlantInstance(expectedInstanceData);\n      const enhancedInstance = { ...createdInstance, plant: createTestPlant() };\n\n      createPlantInstanceSchema.parse.mockReturnValue(expectedInstanceData);\n      PlantInstanceQueries.create.mockResolvedValue(createdInstance);\n      PlantInstanceQueries.getEnhancedById.mockResolvedValue(enhancedInstance);\n\n      const request = new NextRequest('http://localhost:3000/api/plant-instances', {\n        method: 'POST',\n        body: JSON.stringify(requestBody),\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      // Act\n      const response = await createPlantInstanceHandler(request);\n      const responseData = await response.json();\n\n      // Assert\n      expect(response.status).toBe(201);\n      expect(responseData.success).toBe(true);\n\n      // Verify fertilizer due date was calculated (should be 2 weeks from now)\n      const callArgs = PlantInstanceQueries.create.mock.calls[0][0];\n      expect(callArgs.fertilizerDue).toBeInstanceOf(Date);\n      \n      const now = new Date();\n      const expectedDue = new Date(now);\n      expectedDue.setDate(expectedDue.getDate() + 14); // 2 weeks\n      \n      // Allow for small time differences in test execution\n      const timeDiff = Math.abs(callArgs.fertilizerDue.getTime() - expectedDue.getTime());\n      expect(timeDiff).toBeLessThan(1000); // Less than 1 second difference\n    });\n  });\n\n  describe('PUT /api/plant-instances/[id] - Plant instance updates with authorization checks', () => {\n    it('should update plant instance with valid data and authorization', async () => {\n      // Arrange\n      const testPlant = createTestPlant();\n      const existingInstance = createTestPlantInstance({\n        id: 1,\n        userId: testUser.id,\n        plantId: testPlant.id,\n      });\n\n      const updateData = {\n        nickname: 'Updated Nickname',\n        location: 'New Location',\n        notes: 'Updated notes',\n      };\n\n      const expectedUpdateData = {\n        ...updateData,\n        id: 1,\n        userId: testUser.id,\n        lastFertilized: null,\n        lastRepot: null,\n      };\n\n      const updatedInstance = { ...existingInstance, ...updateData };\n      const enhancedInstance = { ...updatedInstance, plant: testPlant };\n\n      PlantInstanceQueries.getEnhancedById.mockResolvedValueOnce(existingInstance);\n      updatePlantInstanceSchema.parse.mockReturnValue(expectedUpdateData);\n      PlantInstanceQueries.update.mockResolvedValue(updatedInstance);\n      PlantInstanceQueries.getEnhancedById.mockResolvedValueOnce(enhancedInstance);\n\n      const request = new NextRequest('http://localhost:3000/api/plant-instances/1', {\n        method: 'PUT',\n        body: JSON.stringify(updateData),\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      const params = Promise.resolve({ id: '1' });\n\n      // Act\n      const response = await updatePlantInstanceHandler(request, { params });\n      const responseData = await response.json();\n\n      // Assert\n      expect(response.status).toBe(200);\n      expect(responseData).toEqual(enhancedInstance);\n\n      expect(PlantInstanceQueries.getEnhancedById).toHaveBeenCalledWith(1);\n      expect(updatePlantInstanceSchema.parse).toHaveBeenCalledWith(expectedUpdateData);\n      expect(PlantInstanceQueries.update).toHaveBeenCalledWith(1, updateData);\n    });\n\n    it('should return forbidden error when user does not own plant instance', async () => {\n      // Arrange\n      const otherUser = createTestUser({ id: 999 });\n      const existingInstance = createTestPlantInstance({\n        id: 1,\n        userId: otherUser.id, // Different user\n      });\n\n      PlantInstanceQueries.getEnhancedById.mockResolvedValue(existingInstance);\n\n      const request = new NextRequest('http://localhost:3000/api/plant-instances/1', {\n        method: 'PUT',\n        body: JSON.stringify({ nickname: 'Updated' }),\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      const params = Promise.resolve({ id: '1' });\n\n      // Act\n      const response = await updatePlantInstanceHandler(request, { params });\n      const responseData = await response.json();\n\n      // Assert\n      expect(response.status).toBe(403);\n      expect(responseData).toEqual({\n        error: 'Forbidden',\n      });\n\n      expect(PlantInstanceQueries.update).not.toHaveBeenCalled();\n    });\n\n    it('should return not found error when plant instance does not exist', async () => {\n      // Arrange\n      PlantInstanceQueries.getEnhancedById.mockResolvedValue(null);\n\n      const request = new NextRequest('http://localhost:3000/api/plant-instances/999', {\n        method: 'PUT',\n        body: JSON.stringify({ nickname: 'Updated' }),\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      const params = Promise.resolve({ id: '999' });\n\n      // Act\n      const response = await updatePlantInstanceHandler(request, { params });\n      const responseData = await response.json();\n\n      // Assert\n      expect(response.status).toBe(404);\n      expect(responseData).toEqual({\n        error: 'Plant instance not found',\n      });\n\n      expect(PlantInstanceQueries.update).not.toHaveBeenCalled();\n    });\n\n    it('should return bad request error for invalid plant instance ID', async () => {\n      // Arrange\n      const request = new NextRequest('http://localhost:3000/api/plant-instances/invalid', {\n        method: 'PUT',\n        body: JSON.stringify({ nickname: 'Updated' }),\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      const params = Promise.resolve({ id: 'invalid' });\n\n      // Act\n      const response = await updatePlantInstanceHandler(request, { params });\n      const responseData = await response.json();\n\n      // Assert\n      expect(response.status).toBe(400);\n      expect(responseData).toEqual({\n        error: 'Invalid plant instance ID',\n      });\n\n      expect(PlantInstanceQueries.getEnhancedById).not.toHaveBeenCalled();\n    });\n\n    it('should return unauthorized error when user not authenticated', async () => {\n      // Arrange\n      validateRequest.mockResolvedValue({\n        user: null,\n        session: null,\n      });\n\n      const request = new NextRequest('http://localhost:3000/api/plant-instances/1', {\n        method: 'PUT',\n        body: JSON.stringify({ nickname: 'Updated' }),\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      const params = Promise.resolve({ id: '1' });\n\n      // Act\n      const response = await updatePlantInstanceHandler(request, { params });\n      const responseData = await response.json();\n\n      // Assert\n      expect(response.status).toBe(401);\n      expect(responseData).toEqual({\n        error: 'Unauthorized',\n      });\n\n      expect(PlantInstanceQueries.getEnhancedById).not.toHaveBeenCalled();\n    });\n\n    it('should handle FormData updates with file uploads', async () => {\n      // Arrange\n      const testPlant = createTestPlant();\n      const existingInstance = createTestPlantInstance({\n        id: 1,\n        userId: testUser.id,\n        plantId: testPlant.id,\n      });\n\n      const formData = new FormData();\n      formData.append('nickname', 'Updated Nickname');\n      formData.append('location', 'New Location');\n      formData.append('existingImages[0]', 'existing-image-url');\n\n      const mockFile = new File(['new image'], 'new.jpg', { type: 'image/jpeg' });\n      formData.append('imageFiles[0]', mockFile);\n\n      const expectedUpdateData = {\n        nickname: 'Updated Nickname',\n        location: 'New Location',\n        images: ['existing-image-url', 'data:image/jpeg;base64,bmV3IGltYWdl'], // base64 of \"new image\"\n        id: 1,\n        userId: testUser.id,\n        lastFertilized: null,\n        lastRepot: null,\n      };\n\n      const updatedInstance = { ...existingInstance, ...expectedUpdateData };\n      const enhancedInstance = { ...updatedInstance, plant: testPlant };\n\n      PlantInstanceQueries.getEnhancedById.mockResolvedValueOnce(existingInstance);\n      updatePlantInstanceSchema.parse.mockReturnValue(expectedUpdateData);\n      PlantInstanceQueries.update.mockResolvedValue(updatedInstance);\n      PlantInstanceQueries.getEnhancedById.mockResolvedValueOnce(enhancedInstance);\n\n      const request = new NextRequest('http://localhost:3000/api/plant-instances/1', {\n        method: 'PUT',\n        body: formData,\n      });\n\n      const params = Promise.resolve({ id: '1' });\n\n      // Act\n      const response = await updatePlantInstanceHandler(request, { params });\n      const responseData = await response.json();\n\n      // Assert\n      expect(response.status).toBe(200);\n      expect(responseData).toEqual(enhancedInstance);\n\n      // Verify the update was called with correct data (excluding id and userId)\n      const { id, userId, ...updateDataWithoutIds } = expectedUpdateData;\n      expect(PlantInstanceQueries.update).toHaveBeenCalledWith(1, updateDataWithoutIds);\n    });\n\n    it('should handle validation errors during update', async () => {\n      // Arrange\n      const existingInstance = createTestPlantInstance({\n        id: 1,\n        userId: testUser.id,\n      });\n\n      const validationError = new Error('Validation failed');\n      validationError.name = 'ZodError';\n      validationError.issues = [\n        { path: ['nickname'], message: 'Nickname is required' }\n      ];\n\n      PlantInstanceQueries.getEnhancedById.mockResolvedValue(existingInstance);\n      updatePlantInstanceSchema.parse.mockImplementation(() => {\n        throw validationError;\n      });\n\n      const request = new NextRequest('http://localhost:3000/api/plant-instances/1', {\n        method: 'PUT',\n        body: JSON.stringify({ nickname: '' }),\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      const params = Promise.resolve({ id: '1' });\n\n      // Act\n      const response = await updatePlantInstanceHandler(request, { params });\n      const responseData = await response.json();\n\n      // Assert\n      expect(response.status).toBe(400);\n      expect(responseData.error).toContain('Invalid plant instance data');\n\n      expect(PlantInstanceQueries.update).not.toHaveBeenCalled();\n    });\n  });\n\n  describe('Plant Management Integration Tests', () => {\n    it('should handle complete plant management workflow: create -> read -> update -> delete', async () => {\n      const testPlant = createTestPlant();\n      \n      // Step 1: Create plant instance\n      const createData = {\n        plantId: testPlant.id,\n        nickname: 'Test Plant',\n        location: 'Test Location',\n      };\n\n      const createdInstance = createTestPlantInstance({\n        id: 1,\n        ...createData,\n        userId: testUser.id,\n      });\n\n      const enhancedInstance = { ...createdInstance, plant: testPlant };\n\n      createPlantInstanceSchema.parse.mockReturnValue({\n        ...createData,\n        userId: testUser.id,\n        lastFertilized: null,\n        lastRepot: null,\n      });\n      PlantInstanceQueries.create.mockResolvedValue(createdInstance);\n      PlantInstanceQueries.getEnhancedById.mockResolvedValue(enhancedInstance);\n\n      const createRequest = new NextRequest('http://localhost:3000/api/plant-instances', {\n        method: 'POST',\n        body: JSON.stringify(createData),\n        headers: { 'Content-Type': 'application/json' },\n      });\n\n      const createResponse = await createPlantInstanceHandler(createRequest);\n      const createResponseData = await createResponse.json();\n\n      expect(createResponse.status).toBe(201);\n      expect(createResponseData.success).toBe(true);\n\n      // Step 2: Read plant instance\n      PlantInstanceQueries.getEnhancedById.mockResolvedValue(enhancedInstance);\n\n      const readRequest = new NextRequest('http://localhost:3000/api/plant-instances/1');\n      const readParams = Promise.resolve({ id: '1' });\n\n      const readResponse = await getPlantInstanceHandler(readRequest, { params: readParams });\n      const readResponseData = await readResponse.json();\n\n      expect(readResponse.status).toBe(200);\n      expect(readResponseData).toEqual(enhancedInstance);\n\n      // Step 3: Update plant instance\n      const updateData = { nickname: 'Updated Plant' };\n      const updatedInstance = { ...enhancedInstance, ...updateData };\n\n      updatePlantInstanceSchema.parse.mockReturnValue({\n        ...updateData,\n        id: 1,\n        userId: testUser.id,\n        lastFertilized: null,\n        lastRepot: null,\n      });\n      PlantInstanceQueries.update.mockResolvedValue(updatedInstance);\n      PlantInstanceQueries.getEnhancedById.mockResolvedValue(updatedInstance);\n\n      const updateRequest = new NextRequest('http://localhost:3000/api/plant-instances/1', {\n        method: 'PUT',\n        body: JSON.stringify(updateData),\n        headers: { 'Content-Type': 'application/json' },\n      });\n      const updateParams = Promise.resolve({ id: '1' });\n\n      const updateResponse = await updatePlantInstanceHandler(updateRequest, { params: updateParams });\n      const updateResponseData = await updateResponse.json();\n\n      expect(updateResponse.status).toBe(200);\n      expect(updateResponseData.nickname).toBe('Updated Plant');\n\n      // Step 4: Delete plant instance\n      PlantInstanceQueries.delete.mockResolvedValue(true);\n\n      const deleteRequest = new NextRequest('http://localhost:3000/api/plant-instances/1', {\n        method: 'DELETE',\n      });\n      const deleteParams = Promise.resolve({ id: '1' });\n\n      const deleteResponse = await deletePlantInstanceHandler(deleteRequest, { params: deleteParams });\n      const deleteResponseData = await deleteResponse.json();\n\n      expect(deleteResponse.status).toBe(200);\n      expect(deleteResponseData).toEqual({\n        success: true,\n        message: 'Plant instance deleted successfully',\n      });\n\n      // Verify all operations were called\n      expect(PlantInstanceQueries.create).toHaveBeenCalled();\n      expect(PlantInstanceQueries.update).toHaveBeenCalled();\n      expect(PlantInstanceQueries.delete).toHaveBeenCalledWith(1);\n    });\n\n    it('should handle authorization checks across all endpoints', async () => {\n      // Test unauthorized access to all endpoints\n      validateRequest.mockResolvedValue({ user: null, session: null });\n\n      // GET /api/plants\n      const getPlantsRequest = new NextRequest('http://localhost:3000/api/plants');\n      const getPlantsResponse = await getPlantsHandler(getPlantsRequest);\n      expect(getPlantsResponse.status).toBe(401);\n\n      // POST /api/plant-instances\n      const createRequest = new NextRequest('http://localhost:3000/api/plant-instances', {\n        method: 'POST',\n        body: JSON.stringify({}),\n        headers: { 'Content-Type': 'application/json' },\n      });\n      const createResponse = await createPlantInstanceHandler(createRequest);\n      expect(createResponse.status).toBe(401);\n\n      // GET /api/plant-instances/1\n      const getRequest = new NextRequest('http://localhost:3000/api/plant-instances/1');\n      const getParams = Promise.resolve({ id: '1' });\n      const getResponse = await getPlantInstanceHandler(getRequest, { params: getParams });\n      expect(getResponse.status).toBe(401);\n\n      // PUT /api/plant-instances/1\n      const updateRequest = new NextRequest('http://localhost:3000/api/plant-instances/1', {\n        method: 'PUT',\n        body: JSON.stringify({}),\n        headers: { 'Content-Type': 'application/json' },\n      });\n      const updateParams = Promise.resolve({ id: '1' });\n      const updateResponse = await updatePlantInstanceHandler(updateRequest, { params: updateParams });\n      expect(updateResponse.status).toBe(401);\n\n      // DELETE /api/plant-instances/1\n      const deleteRequest = new NextRequest('http://localhost:3000/api/plant-instances/1', {\n        method: 'DELETE',\n      });\n      const deleteParams = Promise.resolve({ id: '1' });\n      const deleteResponse = await deletePlantInstanceHandler(deleteRequest, { params: deleteParams });\n      expect(deleteResponse.status).toBe(401);\n    });\n  });\n});"],"names":["jest","mock","validateRequest","fn","validateVerifiedRequest","createPlant","getPlantsWithStats","validatePlantTaxonomy","PlantInstanceQueries","getWithFilters","create","getEnhancedById","update","delete","createPlantSchema","parse","plantFilterSchema","createPlantInstanceSchema","plantInstanceFilterSchema","updatePlantInstanceSchema","describe","testUser","testSession","beforeEach","clearAllMocks","resetApiMocks","createTestUser","createTestSession","mockResolvedValue","user","session","afterEach","restoreAllMocks","it","mockPlants","createTestPlant","family","genus","id","mockReturnValue","undefined","isVerified","createdBy","limit","offset","request","NextRequest","response","getPlantsHandler","responseData","json","expect","status","toBe","toEqual","success","data","arrayContaining","objectContaining","any","Number","String","species","commonName","createdAt","updatedAt","metadata","operation","timestamp","toHaveBeenCalled","toHaveBeenCalledWith","Object","error","not","validationError","Error","name","issues","path","message","mockImplementation","details","mockRejectedValue","testPlant","requestBody","plantId","nickname","location","notes","isActive","expectedInstanceData","userId","lastFertilized","lastRepot","createdInstance","createTestPlantInstance","enhancedInstance","plant","method","body","JSON","stringify","headers","createPlantInstanceHandler","formData","FormData","append","toString","mockFile","File","type","images","fertilizerSchedule","fertilizerDue","Date","callArgs","calls","toBeInstanceOf","now","expectedDue","setDate","getDate","timeDiff","Math","abs","getTime","toBeLessThan","existingInstance","updateData","expectedUpdateData","updatedInstance","mockResolvedValueOnce","params","Promise","resolve","updatePlantInstanceHandler","otherUser","updateDataWithoutIds","toContain","createData","createRequest","createResponse","createResponseData","readRequest","readParams","readResponse","getPlantInstanceHandler","readResponseData","updateRequest","updateParams","updateResponse","updateResponseData","deleteRequest","deleteParams","deleteResponse","deletePlantInstanceHandler","deleteResponseData","getPlantsRequest","getPlantsResponse","getRequest","getParams","getResponse"],"mappings":"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"}