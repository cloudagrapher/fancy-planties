51e2fe0f675d626381ba01f2f152c9e5
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: Object.getOwnPropertyDescriptor(all, name).get
    });
}
_export(exports, {
    get createDatabaseTestManager () {
        return createDatabaseTestManager;
    },
    get default () {
        return _default;
    },
    get globalDatabaseTestManager () {
        return globalDatabaseTestManager;
    }
});
require("server-only");
const _db = require("../../lib/db");
const _schema = require("../../lib/db/schema");
const _drizzleorm = require("drizzle-orm");
/**
 * Database Test Manager
 * Provides isolated database operations for testing with proper cleanup
 */ class DatabaseTestManager {
    constructor(){
        this.createdUsers = [];
        this.createdSessions = [];
        this.createdEmailCodes = [];
    }
    /**
   * Create a test user in the database
   * @param {Object} userData - User data to insert
   * @returns {Promise<Object>} Created user
   */ async createTestUser(userData) {
        const [user] = await _db.db.insert(_schema.users).values(userData).returning();
        this.createdUsers.push(user.id);
        return user;
    }
    /**
   * Create a test session in the database
   * @param {Object} sessionData - Session data to insert
   * @returns {Promise<Object>} Created session
   */ async createTestSession(sessionData) {
        const [session] = await _db.db.insert(_schema.sessions).values(sessionData).returning();
        this.createdSessions.push(session.id);
        return session;
    }
    /**
   * Create a test email verification code in the database
   * @param {Object} codeData - Email verification code data to insert
   * @returns {Promise<Object>} Created email verification code
   */ async createTestEmailCode(codeData) {
        const [code] = await _db.db.insert(_schema.emailVerificationCodes).values(codeData).returning();
        this.createdEmailCodes.push(code.id);
        return code;
    }
    /**
   * Get a user by ID from the database
   * @param {number} userId - User ID to retrieve
   * @returns {Promise<Object|null>} User or null if not found
   */ async getUserById(userId) {
        const [user] = await _db.db.select().from(_schema.users).where((0, _drizzleorm.eq)(_schema.users.id, userId));
        return user || null;
    }
    /**
   * Get a user by email from the database
   * @param {string} email - Email to search for
   * @returns {Promise<Object|null>} User or null if not found
   */ async getUserByEmail(email) {
        const [user] = await _db.db.select().from(_schema.users).where((0, _drizzleorm.eq)(_schema.users.email, email.toLowerCase()));
        return user || null;
    }
    /**
   * Get a session by ID from the database
   * @param {string} sessionId - Session ID to retrieve
   * @returns {Promise<Object|null>} Session or null if not found
   */ async getSessionById(sessionId) {
        const [session] = await _db.db.select().from(_schema.sessions).where((0, _drizzleorm.eq)(_schema.sessions.id, sessionId));
        return session || null;
    }
    /**
   * Get sessions for a user from the database
   * @param {number} userId - User ID to get sessions for
   * @returns {Promise<Array>} Array of sessions
   */ async getSessionsByUserId(userId) {
        return await _db.db.select().from(_schema.sessions).where((0, _drizzleorm.eq)(_schema.sessions.userId, userId));
    }
    /**
   * Get email verification codes for a user
   * @param {number} userId - User ID to get codes for
   * @returns {Promise<Array>} Array of email verification codes
   */ async getEmailCodesByUserId(userId) {
        return await _db.db.select().from(_schema.emailVerificationCodes).where((0, _drizzleorm.eq)(_schema.emailVerificationCodes.userId, userId));
    }
    /**
   * Update a user in the database
   * @param {number} userId - User ID to update
   * @param {Object} updates - Updates to apply
   * @returns {Promise<Object>} Updated user
   */ async updateUser(userId, updates) {
        const [user] = await _db.db.update(_schema.users).set({
            ...updates,
            updatedAt: new Date()
        }).where((0, _drizzleorm.eq)(_schema.users.id, userId)).returning();
        return user;
    }
    /**
   * Delete a user from the database
   * @param {number} userId - User ID to delete
   * @returns {Promise<void>}
   */ async deleteUser(userId) {
        await _db.db.delete(_schema.users).where((0, _drizzleorm.eq)(_schema.users.id, userId));
        // Remove from tracking
        this.createdUsers = this.createdUsers.filter((id)=>id !== userId);
    }
    /**
   * Delete a session from the database
   * @param {string} sessionId - Session ID to delete
   * @returns {Promise<void>}
   */ async deleteSession(sessionId) {
        await _db.db.delete(_schema.sessions).where((0, _drizzleorm.eq)(_schema.sessions.id, sessionId));
        // Remove from tracking
        this.createdSessions = this.createdSessions.filter((id)=>id !== sessionId);
    }
    /**
   * Delete an email verification code from the database
   * @param {number} codeId - Code ID to delete
   * @returns {Promise<void>}
   */ async deleteEmailCode(codeId) {
        await _db.db.delete(_schema.emailVerificationCodes).where((0, _drizzleorm.eq)(_schema.emailVerificationCodes.id, codeId));
        // Remove from tracking
        this.createdEmailCodes = this.createdEmailCodes.filter((id)=>id !== codeId);
    }
    /**
   * Clean up all test data created by this manager
   * @returns {Promise<void>}
   */ async cleanup() {
        try {
            // Clean up email verification codes first (foreign key constraints)
            for (const codeId of this.createdEmailCodes){
                await _db.db.delete(_schema.emailVerificationCodes).where((0, _drizzleorm.eq)(_schema.emailVerificationCodes.id, codeId));
            }
            // Clean up sessions
            for (const sessionId of this.createdSessions){
                await _db.db.delete(_schema.sessions).where((0, _drizzleorm.eq)(_schema.sessions.id, sessionId));
            }
            // Clean up users last
            for (const userId of this.createdUsers){
                await _db.db.delete(_schema.users).where((0, _drizzleorm.eq)(_schema.users.id, userId));
            }
            // Reset tracking arrays
            this.createdUsers = [];
            this.createdSessions = [];
            this.createdEmailCodes = [];
        } catch (error) {
            console.error('Database cleanup error:', error);
            // Reset tracking arrays even if cleanup fails
            this.createdUsers = [];
            this.createdSessions = [];
            this.createdEmailCodes = [];
        }
    }
    /**
   * Check if the database connection is working
   * @returns {Promise<boolean>} True if connection is working
   */ async isConnected() {
        try {
            // Simple query to test connection
            await _db.db.select().from(_schema.users).limit(1);
            return true;
        } catch (error) {
            console.error('Database connection test failed:', error);
            return false;
        }
    }
}
const createDatabaseTestManager = ()=>{
    return new DatabaseTestManager();
};
const globalDatabaseTestManager = new DatabaseTestManager();
const _default = DatabaseTestManager;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9zdGVmYW5iZWtrZXIvcHJvamVjdHMvZmFuY3ktcGxhbnRpZXMvc3JjL3Rlc3QtdXRpbHMvc2V0dXAvZGF0YWJhc2UtdGVzdC1tYW5hZ2VyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAnc2VydmVyLW9ubHknO1xuXG5pbXBvcnQgeyBkYiB9IGZyb20gJy4uLy4uL2xpYi9kYic7XG5pbXBvcnQgeyB1c2Vycywgc2Vzc2lvbnMsIGVtYWlsVmVyaWZpY2F0aW9uQ29kZXMgfSBmcm9tICcuLi8uLi9saWIvZGIvc2NoZW1hJztcbmltcG9ydCB7IGVxIH0gZnJvbSAnZHJpenpsZS1vcm0nO1xuXG4vKipcbiAqIERhdGFiYXNlIFRlc3QgTWFuYWdlclxuICogUHJvdmlkZXMgaXNvbGF0ZWQgZGF0YWJhc2Ugb3BlcmF0aW9ucyBmb3IgdGVzdGluZyB3aXRoIHByb3BlciBjbGVhbnVwXG4gKi9cbmNsYXNzIERhdGFiYXNlVGVzdE1hbmFnZXIge1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLmNyZWF0ZWRVc2VycyA9IFtdO1xuICAgIHRoaXMuY3JlYXRlZFNlc3Npb25zID0gW107XG4gICAgdGhpcy5jcmVhdGVkRW1haWxDb2RlcyA9IFtdO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBhIHRlc3QgdXNlciBpbiB0aGUgZGF0YWJhc2VcbiAgICogQHBhcmFtIHtPYmplY3R9IHVzZXJEYXRhIC0gVXNlciBkYXRhIHRvIGluc2VydFxuICAgKiBAcmV0dXJucyB7UHJvbWlzZTxPYmplY3Q+fSBDcmVhdGVkIHVzZXJcbiAgICovXG4gIGFzeW5jIGNyZWF0ZVRlc3RVc2VyKHVzZXJEYXRhKSB7XG4gICAgY29uc3QgW3VzZXJdID0gYXdhaXQgZGIuaW5zZXJ0KHVzZXJzKS52YWx1ZXModXNlckRhdGEpLnJldHVybmluZygpO1xuICAgIHRoaXMuY3JlYXRlZFVzZXJzLnB1c2godXNlci5pZCk7XG4gICAgcmV0dXJuIHVzZXI7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIGEgdGVzdCBzZXNzaW9uIGluIHRoZSBkYXRhYmFzZVxuICAgKiBAcGFyYW0ge09iamVjdH0gc2Vzc2lvbkRhdGEgLSBTZXNzaW9uIGRhdGEgdG8gaW5zZXJ0XG4gICAqIEByZXR1cm5zIHtQcm9taXNlPE9iamVjdD59IENyZWF0ZWQgc2Vzc2lvblxuICAgKi9cbiAgYXN5bmMgY3JlYXRlVGVzdFNlc3Npb24oc2Vzc2lvbkRhdGEpIHtcbiAgICBjb25zdCBbc2Vzc2lvbl0gPSBhd2FpdCBkYi5pbnNlcnQoc2Vzc2lvbnMpLnZhbHVlcyhzZXNzaW9uRGF0YSkucmV0dXJuaW5nKCk7XG4gICAgdGhpcy5jcmVhdGVkU2Vzc2lvbnMucHVzaChzZXNzaW9uLmlkKTtcbiAgICByZXR1cm4gc2Vzc2lvbjtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgYSB0ZXN0IGVtYWlsIHZlcmlmaWNhdGlvbiBjb2RlIGluIHRoZSBkYXRhYmFzZVxuICAgKiBAcGFyYW0ge09iamVjdH0gY29kZURhdGEgLSBFbWFpbCB2ZXJpZmljYXRpb24gY29kZSBkYXRhIHRvIGluc2VydFxuICAgKiBAcmV0dXJucyB7UHJvbWlzZTxPYmplY3Q+fSBDcmVhdGVkIGVtYWlsIHZlcmlmaWNhdGlvbiBjb2RlXG4gICAqL1xuICBhc3luYyBjcmVhdGVUZXN0RW1haWxDb2RlKGNvZGVEYXRhKSB7XG4gICAgY29uc3QgW2NvZGVdID0gYXdhaXQgZGIuaW5zZXJ0KGVtYWlsVmVyaWZpY2F0aW9uQ29kZXMpLnZhbHVlcyhjb2RlRGF0YSkucmV0dXJuaW5nKCk7XG4gICAgdGhpcy5jcmVhdGVkRW1haWxDb2Rlcy5wdXNoKGNvZGUuaWQpO1xuICAgIHJldHVybiBjb2RlO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBhIHVzZXIgYnkgSUQgZnJvbSB0aGUgZGF0YWJhc2VcbiAgICogQHBhcmFtIHtudW1iZXJ9IHVzZXJJZCAtIFVzZXIgSUQgdG8gcmV0cmlldmVcbiAgICogQHJldHVybnMge1Byb21pc2U8T2JqZWN0fG51bGw+fSBVc2VyIG9yIG51bGwgaWYgbm90IGZvdW5kXG4gICAqL1xuICBhc3luYyBnZXRVc2VyQnlJZCh1c2VySWQpIHtcbiAgICBjb25zdCBbdXNlcl0gPSBhd2FpdCBkYi5zZWxlY3QoKS5mcm9tKHVzZXJzKS53aGVyZShlcSh1c2Vycy5pZCwgdXNlcklkKSk7XG4gICAgcmV0dXJuIHVzZXIgfHwgbnVsbDtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgYSB1c2VyIGJ5IGVtYWlsIGZyb20gdGhlIGRhdGFiYXNlXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBlbWFpbCAtIEVtYWlsIHRvIHNlYXJjaCBmb3JcbiAgICogQHJldHVybnMge1Byb21pc2U8T2JqZWN0fG51bGw+fSBVc2VyIG9yIG51bGwgaWYgbm90IGZvdW5kXG4gICAqL1xuICBhc3luYyBnZXRVc2VyQnlFbWFpbChlbWFpbCkge1xuICAgIGNvbnN0IFt1c2VyXSA9IGF3YWl0IGRiLnNlbGVjdCgpLmZyb20odXNlcnMpLndoZXJlKGVxKHVzZXJzLmVtYWlsLCBlbWFpbC50b0xvd2VyQ2FzZSgpKSk7XG4gICAgcmV0dXJuIHVzZXIgfHwgbnVsbDtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgYSBzZXNzaW9uIGJ5IElEIGZyb20gdGhlIGRhdGFiYXNlXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBzZXNzaW9uSWQgLSBTZXNzaW9uIElEIHRvIHJldHJpZXZlXG4gICAqIEByZXR1cm5zIHtQcm9taXNlPE9iamVjdHxudWxsPn0gU2Vzc2lvbiBvciBudWxsIGlmIG5vdCBmb3VuZFxuICAgKi9cbiAgYXN5bmMgZ2V0U2Vzc2lvbkJ5SWQoc2Vzc2lvbklkKSB7XG4gICAgY29uc3QgW3Nlc3Npb25dID0gYXdhaXQgZGIuc2VsZWN0KCkuZnJvbShzZXNzaW9ucykud2hlcmUoZXEoc2Vzc2lvbnMuaWQsIHNlc3Npb25JZCkpO1xuICAgIHJldHVybiBzZXNzaW9uIHx8IG51bGw7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHNlc3Npb25zIGZvciBhIHVzZXIgZnJvbSB0aGUgZGF0YWJhc2VcbiAgICogQHBhcmFtIHtudW1iZXJ9IHVzZXJJZCAtIFVzZXIgSUQgdG8gZ2V0IHNlc3Npb25zIGZvclxuICAgKiBAcmV0dXJucyB7UHJvbWlzZTxBcnJheT59IEFycmF5IG9mIHNlc3Npb25zXG4gICAqL1xuICBhc3luYyBnZXRTZXNzaW9uc0J5VXNlcklkKHVzZXJJZCkge1xuICAgIHJldHVybiBhd2FpdCBkYi5zZWxlY3QoKS5mcm9tKHNlc3Npb25zKS53aGVyZShlcShzZXNzaW9ucy51c2VySWQsIHVzZXJJZCkpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBlbWFpbCB2ZXJpZmljYXRpb24gY29kZXMgZm9yIGEgdXNlclxuICAgKiBAcGFyYW0ge251bWJlcn0gdXNlcklkIC0gVXNlciBJRCB0byBnZXQgY29kZXMgZm9yXG4gICAqIEByZXR1cm5zIHtQcm9taXNlPEFycmF5Pn0gQXJyYXkgb2YgZW1haWwgdmVyaWZpY2F0aW9uIGNvZGVzXG4gICAqL1xuICBhc3luYyBnZXRFbWFpbENvZGVzQnlVc2VySWQodXNlcklkKSB7XG4gICAgcmV0dXJuIGF3YWl0IGRiLnNlbGVjdCgpLmZyb20oZW1haWxWZXJpZmljYXRpb25Db2Rlcykud2hlcmUoZXEoZW1haWxWZXJpZmljYXRpb25Db2Rlcy51c2VySWQsIHVzZXJJZCkpO1xuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZSBhIHVzZXIgaW4gdGhlIGRhdGFiYXNlXG4gICAqIEBwYXJhbSB7bnVtYmVyfSB1c2VySWQgLSBVc2VyIElEIHRvIHVwZGF0ZVxuICAgKiBAcGFyYW0ge09iamVjdH0gdXBkYXRlcyAtIFVwZGF0ZXMgdG8gYXBwbHlcbiAgICogQHJldHVybnMge1Byb21pc2U8T2JqZWN0Pn0gVXBkYXRlZCB1c2VyXG4gICAqL1xuICBhc3luYyB1cGRhdGVVc2VyKHVzZXJJZCwgdXBkYXRlcykge1xuICAgIGNvbnN0IFt1c2VyXSA9IGF3YWl0IGRiLnVwZGF0ZSh1c2VycylcbiAgICAgIC5zZXQoeyAuLi51cGRhdGVzLCB1cGRhdGVkQXQ6IG5ldyBEYXRlKCkgfSlcbiAgICAgIC53aGVyZShlcSh1c2Vycy5pZCwgdXNlcklkKSlcbiAgICAgIC5yZXR1cm5pbmcoKTtcbiAgICByZXR1cm4gdXNlcjtcbiAgfVxuXG4gIC8qKlxuICAgKiBEZWxldGUgYSB1c2VyIGZyb20gdGhlIGRhdGFiYXNlXG4gICAqIEBwYXJhbSB7bnVtYmVyfSB1c2VySWQgLSBVc2VyIElEIHRvIGRlbGV0ZVxuICAgKiBAcmV0dXJucyB7UHJvbWlzZTx2b2lkPn1cbiAgICovXG4gIGFzeW5jIGRlbGV0ZVVzZXIodXNlcklkKSB7XG4gICAgYXdhaXQgZGIuZGVsZXRlKHVzZXJzKS53aGVyZShlcSh1c2Vycy5pZCwgdXNlcklkKSk7XG4gICAgLy8gUmVtb3ZlIGZyb20gdHJhY2tpbmdcbiAgICB0aGlzLmNyZWF0ZWRVc2VycyA9IHRoaXMuY3JlYXRlZFVzZXJzLmZpbHRlcihpZCA9PiBpZCAhPT0gdXNlcklkKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBEZWxldGUgYSBzZXNzaW9uIGZyb20gdGhlIGRhdGFiYXNlXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBzZXNzaW9uSWQgLSBTZXNzaW9uIElEIHRvIGRlbGV0ZVxuICAgKiBAcmV0dXJucyB7UHJvbWlzZTx2b2lkPn1cbiAgICovXG4gIGFzeW5jIGRlbGV0ZVNlc3Npb24oc2Vzc2lvbklkKSB7XG4gICAgYXdhaXQgZGIuZGVsZXRlKHNlc3Npb25zKS53aGVyZShlcShzZXNzaW9ucy5pZCwgc2Vzc2lvbklkKSk7XG4gICAgLy8gUmVtb3ZlIGZyb20gdHJhY2tpbmdcbiAgICB0aGlzLmNyZWF0ZWRTZXNzaW9ucyA9IHRoaXMuY3JlYXRlZFNlc3Npb25zLmZpbHRlcihpZCA9PiBpZCAhPT0gc2Vzc2lvbklkKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBEZWxldGUgYW4gZW1haWwgdmVyaWZpY2F0aW9uIGNvZGUgZnJvbSB0aGUgZGF0YWJhc2VcbiAgICogQHBhcmFtIHtudW1iZXJ9IGNvZGVJZCAtIENvZGUgSUQgdG8gZGVsZXRlXG4gICAqIEByZXR1cm5zIHtQcm9taXNlPHZvaWQ+fVxuICAgKi9cbiAgYXN5bmMgZGVsZXRlRW1haWxDb2RlKGNvZGVJZCkge1xuICAgIGF3YWl0IGRiLmRlbGV0ZShlbWFpbFZlcmlmaWNhdGlvbkNvZGVzKS53aGVyZShlcShlbWFpbFZlcmlmaWNhdGlvbkNvZGVzLmlkLCBjb2RlSWQpKTtcbiAgICAvLyBSZW1vdmUgZnJvbSB0cmFja2luZ1xuICAgIHRoaXMuY3JlYXRlZEVtYWlsQ29kZXMgPSB0aGlzLmNyZWF0ZWRFbWFpbENvZGVzLmZpbHRlcihpZCA9PiBpZCAhPT0gY29kZUlkKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDbGVhbiB1cCBhbGwgdGVzdCBkYXRhIGNyZWF0ZWQgYnkgdGhpcyBtYW5hZ2VyXG4gICAqIEByZXR1cm5zIHtQcm9taXNlPHZvaWQ+fVxuICAgKi9cbiAgYXN5bmMgY2xlYW51cCgpIHtcbiAgICB0cnkge1xuICAgICAgLy8gQ2xlYW4gdXAgZW1haWwgdmVyaWZpY2F0aW9uIGNvZGVzIGZpcnN0IChmb3JlaWduIGtleSBjb25zdHJhaW50cylcbiAgICAgIGZvciAoY29uc3QgY29kZUlkIG9mIHRoaXMuY3JlYXRlZEVtYWlsQ29kZXMpIHtcbiAgICAgICAgYXdhaXQgZGIuZGVsZXRlKGVtYWlsVmVyaWZpY2F0aW9uQ29kZXMpLndoZXJlKGVxKGVtYWlsVmVyaWZpY2F0aW9uQ29kZXMuaWQsIGNvZGVJZCkpO1xuICAgICAgfVxuXG4gICAgICAvLyBDbGVhbiB1cCBzZXNzaW9uc1xuICAgICAgZm9yIChjb25zdCBzZXNzaW9uSWQgb2YgdGhpcy5jcmVhdGVkU2Vzc2lvbnMpIHtcbiAgICAgICAgYXdhaXQgZGIuZGVsZXRlKHNlc3Npb25zKS53aGVyZShlcShzZXNzaW9ucy5pZCwgc2Vzc2lvbklkKSk7XG4gICAgICB9XG5cbiAgICAgIC8vIENsZWFuIHVwIHVzZXJzIGxhc3RcbiAgICAgIGZvciAoY29uc3QgdXNlcklkIG9mIHRoaXMuY3JlYXRlZFVzZXJzKSB7XG4gICAgICAgIGF3YWl0IGRiLmRlbGV0ZSh1c2Vycykud2hlcmUoZXEodXNlcnMuaWQsIHVzZXJJZCkpO1xuICAgICAgfVxuXG4gICAgICAvLyBSZXNldCB0cmFja2luZyBhcnJheXNcbiAgICAgIHRoaXMuY3JlYXRlZFVzZXJzID0gW107XG4gICAgICB0aGlzLmNyZWF0ZWRTZXNzaW9ucyA9IFtdO1xuICAgICAgdGhpcy5jcmVhdGVkRW1haWxDb2RlcyA9IFtdO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdEYXRhYmFzZSBjbGVhbnVwIGVycm9yOicsIGVycm9yKTtcbiAgICAgIC8vIFJlc2V0IHRyYWNraW5nIGFycmF5cyBldmVuIGlmIGNsZWFudXAgZmFpbHNcbiAgICAgIHRoaXMuY3JlYXRlZFVzZXJzID0gW107XG4gICAgICB0aGlzLmNyZWF0ZWRTZXNzaW9ucyA9IFtdO1xuICAgICAgdGhpcy5jcmVhdGVkRW1haWxDb2RlcyA9IFtdO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVjayBpZiB0aGUgZGF0YWJhc2UgY29ubmVjdGlvbiBpcyB3b3JraW5nXG4gICAqIEByZXR1cm5zIHtQcm9taXNlPGJvb2xlYW4+fSBUcnVlIGlmIGNvbm5lY3Rpb24gaXMgd29ya2luZ1xuICAgKi9cbiAgYXN5bmMgaXNDb25uZWN0ZWQoKSB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIFNpbXBsZSBxdWVyeSB0byB0ZXN0IGNvbm5lY3Rpb25cbiAgICAgIGF3YWl0IGRiLnNlbGVjdCgpLmZyb20odXNlcnMpLmxpbWl0KDEpO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0RhdGFiYXNlIGNvbm5lY3Rpb24gdGVzdCBmYWlsZWQ6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxufVxuXG4vKipcbiAqIENyZWF0ZSBhIG5ldyBkYXRhYmFzZSB0ZXN0IG1hbmFnZXIgaW5zdGFuY2VcbiAqIEByZXR1cm5zIHtEYXRhYmFzZVRlc3RNYW5hZ2VyfSBOZXcgZGF0YWJhc2UgdGVzdCBtYW5hZ2VyXG4gKi9cbmV4cG9ydCBjb25zdCBjcmVhdGVEYXRhYmFzZVRlc3RNYW5hZ2VyID0gKCkgPT4ge1xuICByZXR1cm4gbmV3IERhdGFiYXNlVGVzdE1hbmFnZXIoKTtcbn07XG5cbi8qKlxuICogR2xvYmFsIGRhdGFiYXNlIHRlc3QgbWFuYWdlciBmb3Igc2hhcmVkIHVzZVxuICovXG5leHBvcnQgY29uc3QgZ2xvYmFsRGF0YWJhc2VUZXN0TWFuYWdlciA9IG5ldyBEYXRhYmFzZVRlc3RNYW5hZ2VyKCk7XG5cbmV4cG9ydCBkZWZhdWx0IERhdGFiYXNlVGVzdE1hbmFnZXI7Il0sIm5hbWVzIjpbImNyZWF0ZURhdGFiYXNlVGVzdE1hbmFnZXIiLCJnbG9iYWxEYXRhYmFzZVRlc3RNYW5hZ2VyIiwiRGF0YWJhc2VUZXN0TWFuYWdlciIsImNyZWF0ZWRVc2VycyIsImNyZWF0ZWRTZXNzaW9ucyIsImNyZWF0ZWRFbWFpbENvZGVzIiwiY3JlYXRlVGVzdFVzZXIiLCJ1c2VyRGF0YSIsInVzZXIiLCJkYiIsImluc2VydCIsInVzZXJzIiwidmFsdWVzIiwicmV0dXJuaW5nIiwicHVzaCIsImlkIiwiY3JlYXRlVGVzdFNlc3Npb24iLCJzZXNzaW9uRGF0YSIsInNlc3Npb24iLCJzZXNzaW9ucyIsImNyZWF0ZVRlc3RFbWFpbENvZGUiLCJjb2RlRGF0YSIsImNvZGUiLCJlbWFpbFZlcmlmaWNhdGlvbkNvZGVzIiwiZ2V0VXNlckJ5SWQiLCJ1c2VySWQiLCJzZWxlY3QiLCJmcm9tIiwid2hlcmUiLCJlcSIsImdldFVzZXJCeUVtYWlsIiwiZW1haWwiLCJ0b0xvd2VyQ2FzZSIsImdldFNlc3Npb25CeUlkIiwic2Vzc2lvbklkIiwiZ2V0U2Vzc2lvbnNCeVVzZXJJZCIsImdldEVtYWlsQ29kZXNCeVVzZXJJZCIsInVwZGF0ZVVzZXIiLCJ1cGRhdGVzIiwidXBkYXRlIiwic2V0IiwidXBkYXRlZEF0IiwiRGF0ZSIsImRlbGV0ZVVzZXIiLCJkZWxldGUiLCJmaWx0ZXIiLCJkZWxldGVTZXNzaW9uIiwiZGVsZXRlRW1haWxDb2RlIiwiY29kZUlkIiwiY2xlYW51cCIsImVycm9yIiwiY29uc29sZSIsImlzQ29ubmVjdGVkIiwibGltaXQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O1FBdU1hQTtlQUFBQTs7UUFTYjtlQUFBOztRQUZhQztlQUFBQTs7O1FBOU1OO29CQUVZO3dCQUNxQzs0QkFDckM7QUFFbkI7OztDQUdDLEdBQ0QsTUFBTUM7SUFDSixhQUFjO1FBQ1osSUFBSSxDQUFDQyxZQUFZLEdBQUcsRUFBRTtRQUN0QixJQUFJLENBQUNDLGVBQWUsR0FBRyxFQUFFO1FBQ3pCLElBQUksQ0FBQ0MsaUJBQWlCLEdBQUcsRUFBRTtJQUM3QjtJQUVBOzs7O0dBSUMsR0FDRCxNQUFNQyxlQUFlQyxRQUFRLEVBQUU7UUFDN0IsTUFBTSxDQUFDQyxLQUFLLEdBQUcsTUFBTUMsTUFBRSxDQUFDQyxNQUFNLENBQUNDLGFBQUssRUFBRUMsTUFBTSxDQUFDTCxVQUFVTSxTQUFTO1FBQ2hFLElBQUksQ0FBQ1YsWUFBWSxDQUFDVyxJQUFJLENBQUNOLEtBQUtPLEVBQUU7UUFDOUIsT0FBT1A7SUFDVDtJQUVBOzs7O0dBSUMsR0FDRCxNQUFNUSxrQkFBa0JDLFdBQVcsRUFBRTtRQUNuQyxNQUFNLENBQUNDLFFBQVEsR0FBRyxNQUFNVCxNQUFFLENBQUNDLE1BQU0sQ0FBQ1MsZ0JBQVEsRUFBRVAsTUFBTSxDQUFDSyxhQUFhSixTQUFTO1FBQ3pFLElBQUksQ0FBQ1QsZUFBZSxDQUFDVSxJQUFJLENBQUNJLFFBQVFILEVBQUU7UUFDcEMsT0FBT0c7SUFDVDtJQUVBOzs7O0dBSUMsR0FDRCxNQUFNRSxvQkFBb0JDLFFBQVEsRUFBRTtRQUNsQyxNQUFNLENBQUNDLEtBQUssR0FBRyxNQUFNYixNQUFFLENBQUNDLE1BQU0sQ0FBQ2EsOEJBQXNCLEVBQUVYLE1BQU0sQ0FBQ1MsVUFBVVIsU0FBUztRQUNqRixJQUFJLENBQUNSLGlC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