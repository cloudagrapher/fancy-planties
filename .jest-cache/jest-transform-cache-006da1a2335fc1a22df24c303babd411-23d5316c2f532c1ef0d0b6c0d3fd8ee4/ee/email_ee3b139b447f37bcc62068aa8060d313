17edf2e9576c2365cceaad21dd861046
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: Object.getOwnPropertyDescriptor(all, name).get
    });
}
_export(exports, {
    get EmailServiceError () {
        return EmailServiceError;
    },
    get ResendEmailService () {
        return ResendEmailService;
    },
    get createEmailService () {
        return createEmailService;
    }
});
require("server-only");
const _resend = require("resend");
class EmailServiceError extends Error {
    constructor(message, code){
        super(message), this.code = code;
        this.name = 'EmailServiceError';
    }
}
class ResendEmailService {
    constructor(config){
        this.resend = new _resend.Resend(config.apiKey);
        this.config = config;
    }
    async sendVerificationEmail(email, code, name) {
        return await this.sendEmailWithRetry(email, code, name, 3);
    }
    async sendEmailWithRetry(email, code, name, maxRetries) {
        let lastError = null;
        for(let attempt = 1; attempt <= maxRetries; attempt++){
            try {
                const { data, error } = await this.resend.emails.send({
                    from: `${this.config.fromName} <${this.config.fromEmail}>`,
                    to: [
                        email
                    ],
                    subject: 'Verify your email address',
                    html: this.generateVerificationEmailTemplate(code, name)
                });
                if (error) {
                    throw new EmailServiceError(`Resend API error: ${error.message}`, this.mapResendErrorCode(error));
                }
                if (data?.id) {
                    // Log success in development
                    if (process.env.NODE_ENV === 'development') {
                        console.log(`‚úÖ Verification email sent to ${email} with code: ${code}`);
                    }
                    return true;
                }
                throw new EmailServiceError('No email ID returned from Resend', 'API_ERROR');
            } catch (error) {
                lastError = error instanceof Error ? error : new Error(String(error));
                // Log attempt in development
                if (process.env.NODE_ENV === 'development') {
                    console.log(`‚ùå Email send attempt ${attempt}/${maxRetries} failed:`, lastError.message);
                }
                // Don't retry on certain errors
                if (error instanceof EmailServiceError && (error.code === 'INVALID_EMAIL' || error.code === 'QUOTA_EXCEEDED')) {
                    throw error;
                }
                // Wait before retry with exponential backoff
                if (attempt < maxRetries) {
                    const delay = Math.pow(2, attempt - 1) * 1000; // 1s, 2s, 4s
                    await new Promise((resolve)=>setTimeout(resolve, delay));
                }
            }
        }
        throw lastError || new EmailServiceError('All retry attempts failed', 'API_ERROR');
    }
    mapResendErrorCode(error) {
        const message = error.message?.toLowerCase() || '';
        if (message.includes('quota') || message.includes('limit')) {
            return 'QUOTA_EXCEEDED';
        }
        if (message.includes('invalid') && message.includes('email')) {
            return 'INVALID_EMAIL';
        }
        if (message.includes('network') || message.includes('timeout')) {
            return 'NETWORK_ERROR';
        }
        return 'API_ERROR';
    }
    generateVerificationEmailTemplate(code, name) {
        return `
      <!DOCTYPE html>
      <html lang="en">
      <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Verify Your Email</title>
        <style>
          body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f9f9f9;
          }
          .container {
            background: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
          }
          .header {
            text-align: center;
            margin-bottom: 30px;
          }
          .logo {
            font-size: 24px;
            font-weight: bold;
            color: #22c55e;
            margin-bottom: 10px;
          }
          .code-container {
            background: #f8f9fa;
            border: 2px dashed #22c55e;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            margin: 30px 0;
          }
          .verification-code {
            font-size: 32px;
            font-weight: bold;
            letter-spacing: 8px;
            color: #22c55e;
            font-family: 'Courier New', monospace;
          }
          .instructions {
            background: #e7f3ff;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin: 20px 0;
          }
          .footer {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
            color: #666;
            font-size: 14px;
          }
          .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 4px;
            padding: 12px;
            margin: 20px 0;
            color: #856404;
          }
        </style>
      </head>
      <body>
        <div class="container">
          <div class="header">
            <div class="logo">üå± Fancy Planties</div>
            <h1>Verify Your Email Address</h1>
          </div>
          
          <p>Hi ${name},</p>
          
          <p>Welcome to Fancy Planties! To complete your account setup and start tracking your plants, please verify your email address using the code below:</p>
          
          <div class="code-container">
            <div class="verification-code">${code}</div>
          </div>
          
          <div class="instructions">
            <strong>How to verify:</strong>
            <ol>
              <li>Return to the Fancy Planties verification page</li>
              <li>Enter the 6-digit code above</li>
              <li>Click "Verify Email" to complete your registration</li>
            </ol>
          </div>
          
          <div class="warning">
            <strong>‚è∞ Important:</strong> This verification code will expire in 10 minutes for security reasons. If you need a new code, you can request one on the verification page.
          </div>
          
          <p>If you didn't create an account with Fancy Planties, you can safely ignore this email.</p>
          
          <div class="footer">
            <p>Happy planting! üåø</p>
            <p><strong>The Fancy Planties Team</strong></p>
            <hr style="margin: 20px 0; border: none; border-top: 1px solid #eee;">
            <p style="font-size: 12px; color: #999;">
              This is an automated message. Please do not reply to this email.<br>
              If you have questions, visit our support page or contact us through the app.
            </p>
          </div>
        </div>
      </body>
      </html>
    `;
    }
}
function createEmailService() {
    const config = {
        apiKey: process.env.RESEND_API_KEY,
        fromEmail: process.env.FROM_EMAIL || 'send.mail.fancy-planties.cloudagrapher.com',
        fromName: process.env.FROM_NAME || 'Fancy Planties'
    };
    if (!config.apiKey) {
        throw new Error('RESEND_API_KEY environment variable is required');
    }
    return new ResendEmailService(config);
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9zdGVmYW5iZWtrZXIvcHJvamVjdHMvZmFuY3ktcGxhbnRpZXMvc3JjL2xpYi9zZXJ2aWNlcy9lbWFpbC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgJ3NlcnZlci1vbmx5JztcblxuaW1wb3J0IHsgUmVzZW5kIH0gZnJvbSAncmVzZW5kJztcblxuZXhwb3J0IGludGVyZmFjZSBFbWFpbFNlcnZpY2Uge1xuICBzZW5kVmVyaWZpY2F0aW9uRW1haWwoZW1haWw6IHN0cmluZywgY29kZTogc3RyaW5nLCBuYW1lOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEVtYWlsQ29uZmlnIHtcbiAgYXBpS2V5OiBzdHJpbmc7XG4gIGZyb21FbWFpbDogc3RyaW5nO1xuICBmcm9tTmFtZTogc3RyaW5nO1xufVxuXG5leHBvcnQgY2xhc3MgRW1haWxTZXJ2aWNlRXJyb3IgZXh0ZW5kcyBFcnJvciB7XG4gIGNvbnN0cnVjdG9yKFxuICAgIG1lc3NhZ2U6IHN0cmluZyxcbiAgICBwdWJsaWMgY29kZTogJ1FVT1RBX0VYQ0VFREVEJyB8ICdBUElfRVJST1InIHwgJ05FVFdPUktfRVJST1InIHwgJ0lOVkFMSURfRU1BSUwnXG4gICkge1xuICAgIHN1cGVyKG1lc3NhZ2UpO1xuICAgIHRoaXMubmFtZSA9ICdFbWFpbFNlcnZpY2VFcnJvcic7XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIFJlc2VuZEVtYWlsU2VydmljZSBpbXBsZW1lbnRzIEVtYWlsU2VydmljZSB7XG4gIHByaXZhdGUgcmVzZW5kOiBSZXNlbmQ7XG4gIHByaXZhdGUgY29uZmlnOiBFbWFpbENvbmZpZztcblxuICBjb25zdHJ1Y3Rvcihjb25maWc6IEVtYWlsQ29uZmlnKSB7XG4gICAgdGhpcy5yZXNlbmQgPSBuZXcgUmVzZW5kKGNvbmZpZy5hcGlLZXkpO1xuICAgIHRoaXMuY29uZmlnID0gY29uZmlnO1xuICB9XG5cbiAgYXN5bmMgc2VuZFZlcmlmaWNhdGlvbkVtYWlsKGVtYWlsOiBzdHJpbmcsIGNvZGU6IHN0cmluZywgbmFtZTogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuc2VuZEVtYWlsV2l0aFJldHJ5KGVtYWlsLCBjb2RlLCBuYW1lLCAzKTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgc2VuZEVtYWlsV2l0aFJldHJ5KFxuICAgIGVtYWlsOiBzdHJpbmcsXG4gICAgY29kZTogc3RyaW5nLFxuICAgIG5hbWU6IHN0cmluZyxcbiAgICBtYXhSZXRyaWVzOiBudW1iZXJcbiAgKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgbGV0IGxhc3RFcnJvcjogRXJyb3IgfCBudWxsID0gbnVsbDtcblxuICAgIGZvciAobGV0IGF0dGVtcHQgPSAxOyBhdHRlbXB0IDw9IG1heFJldHJpZXM7IGF0dGVtcHQrKykge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgdGhpcy5yZXNlbmQuZW1haWxzLnNlbmQoe1xuICAgICAgICAgIGZyb206IGAke3RoaXMuY29uZmlnLmZyb21OYW1lfSA8JHt0aGlzLmNvbmZpZy5mcm9tRW1haWx9PmAsXG4gICAgICAgICAgdG86IFtlbWFpbF0sXG4gICAgICAgICAgc3ViamVjdDogJ1ZlcmlmeSB5b3VyIGVtYWlsIGFkZHJlc3MnLFxuICAgICAgICAgIGh0bWw6IHRoaXMuZ2VuZXJhdGVWZXJpZmljYXRpb25FbWFpbFRlbXBsYXRlKGNvZGUsIG5hbWUpLFxuICAgICAgICB9KTtcblxuICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRW1haWxTZXJ2aWNlRXJyb3IoXG4gICAgICAgICAgICBgUmVzZW5kIEFQSSBlcnJvcjogJHtlcnJvci5tZXNzYWdlfWAsXG4gICAgICAgICAgICB0aGlzLm1hcFJlc2VuZEVycm9yQ29kZShlcnJvcilcbiAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGRhdGE/LmlkKSB7XG4gICAgICAgICAgLy8gTG9nIHN1Y2Nlc3MgaW4gZGV2ZWxvcG1lbnRcbiAgICAgICAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGDinIUgVmVyaWZpY2F0aW9uIGVtYWlsIHNlbnQgdG8gJHtlbWFpbH0gd2l0aCBjb2RlOiAke2NvZGV9YCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhyb3cgbmV3IEVtYWlsU2VydmljZUVycm9yKCdObyBlbWFpbCBJRCByZXR1cm5lZCBmcm9tIFJlc2VuZCcsICdBUElfRVJST1InKTtcblxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgbGFzdEVycm9yID0gZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yIDogbmV3IEVycm9yKFN0cmluZyhlcnJvcikpO1xuICAgICAgICBcbiAgICAgICAgLy8gTG9nIGF0dGVtcHQgaW4gZGV2ZWxvcG1lbnRcbiAgICAgICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coYOKdjCBFbWFpbCBzZW5kIGF0dGVtcHQgJHthdHRlbXB0fS8ke21heFJldHJpZXN9IGZhaWxlZDpgLCBsYXN0RXJyb3IubWVzc2FnZSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBEb24ndCByZXRyeSBvbiBjZXJ0YWluIGVycm9yc1xuICAgICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBFbWFpbFNlcnZpY2VFcnJvciAmJiBcbiAgICAgICAgICAgIChlcnJvci5jb2RlID09PSAnSU5WQUxJRF9FTUFJTCcgfHwgZXJyb3IuY29kZSA9PT0gJ1FVT1RBX0VYQ0VFREVEJykpIHtcbiAgICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFdhaXQgYmVmb3JlIHJldHJ5IHdpdGggZXhwb25lbnRpYWwgYmFja29mZlxuICAgICAgICBpZiAoYXR0ZW1wdCA8IG1heFJldHJpZXMpIHtcbiAgICAgICAgICBjb25zdCBkZWxheSA9IE1hdGgucG93KDIsIGF0dGVtcHQgLSAxKSAqIDEwMDA7IC8vIDFzLCAycywgNHNcbiAgICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgZGVsYXkpKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHRocm93IGxhc3RFcnJvciB8fCBuZXcgRW1haWxTZXJ2aWNlRXJyb3IoJ0FsbCByZXRyeSBhdHRlbXB0cyBmYWlsZWQnLCAnQVBJX0VSUk9SJyk7XG4gIH1cblxuICBwcml2YXRlIG1hcFJlc2VuZEVycm9yQ29kZShlcnJvcjogYW55KTogRW1haWxTZXJ2aWNlRXJyb3JbJ2NvZGUnXSB7XG4gICAgY29uc3QgbWVzc2FnZSA9IGVycm9yLm1lc3NhZ2U/LnRvTG93ZXJDYXNlKCkgfHwgJyc7XG4gICAgXG4gICAgaWYgKG1lc3NhZ2UuaW5jbHVkZXMoJ3F1b3RhJykgfHwgbWVzc2FnZS5pbmNsdWRlcygnbGltaXQnKSkge1xuICAgICAgcmV0dXJuICdRVU9UQV9FWENFRURFRCc7XG4gICAgfVxuICAgIGlmIChtZXNzYWdlLmluY2x1ZGVzKCdpbnZhbGlkJykgJiYgbWVzc2FnZS5pbmNsdWRlcygnZW1haWwnKSkge1xuICAgICAgcmV0dXJuICdJTlZBTElEX0VNQUlMJztcbiAgICB9XG4gICAgaWYgKG1lc3NhZ2UuaW5jbHVkZXMoJ25ldHdvcmsnKSB8fCBtZXNzYWdlLmluY2x1ZGVzKCd0aW1lb3V0JykpIHtcbiAgICAgIHJldHVybiAnTkVUV09SS19FUlJPUic7XG4gICAgfVxuICAgIFxuICAgIHJldHVybiAnQVBJX0VSUk9SJztcbiAgfVxuXG4gIHByaXZhdGUgZ2VuZXJhdGVWZXJpZmljYXRpb25FbWFpbFRlbXBsYXRlKGNvZGU6IHN0cmluZywgbmFtZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgICByZXR1cm4gYFxuICAgICAgPCFET0NUWVBFIGh0bWw+XG4gICAgICA8aHRtbCBsYW5nPVwiZW5cIj5cbiAgICAgIDxoZWFkPlxuICAgICAgICA8bWV0YSBjaGFyc2V0PVwiVVRGLThcIj5cbiAgICAgICAgPG1ldGEgbmFtZT1cInZpZXdwb3J0XCIgY29udGVudD1cIndpZHRoPWRldmljZS13aWR0aCwgaW5pdGlhbC1zY2FsZT0xLjBcIj5cbiAgICAgICAgPHRpdGxlPlZlcmlmeSBZb3VyIEVtYWlsPC90aXRsZT5cbiAgICAgICAgPHN0eWxlPlxuICAgICAgICAgIGJvZHkge1xuICAgICAgICAgICAgZm9udC1mYW1pbHk6IC1hcHBsZS1zeXN0ZW0sIEJsaW5rTWFjU3lzdGVtRm9udCwgJ1NlZ29lIFVJJywgUm9ib3RvLCBzYW5zLXNlcmlmO1xuICAgICAgICAgICAgbGluZS1oZWlnaHQ6IDEuNjtcbiAgICAgICAgICAgIGNvbG9yOiAjMzMzO1xuICAgICAgICAgICAgbWF4LXdpZHRoOiA2MDBweDtcbiAgICAgICAgICAgIG1hcmdpbjogMCBhdXRvO1xuICAgICAgICAgICAgcGFkZGluZzogMjBweDtcbiAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6ICNmOWY5Zjk7XG4gICAgICAgICAgfVxuICAgICAgICAgIC5jb250YWluZXIge1xuICAgICAgICAgICAgYmFja2dyb3VuZDogd2hpdGU7XG4gICAgICAgICAgICBwYWRkaW5nOiA0MHB4O1xuICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogOHB4O1xuICAgICAgICAgICAgYm94LXNoYWRvdzogMCAycHggMTBweCByZ2JhKDAsIDAsIDAsIDAuMSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIC5oZWFkZXIge1xuICAgICAgICAgICAgdGV4dC1hbGlnbjogY2VudGVyO1xuICAgICAgICAgICAgbWFyZ2luLWJvdHRvbTogMzBweDtcbiAgICAgICAgICB9XG4gICAgICAgICAgLmxvZ28ge1xuICAgICAgICAgICAgZm9udC1zaXplOiAyNHB4O1xuICAgICAgICAgICAgZm9udC13ZWlnaHQ6IGJvbGQ7XG4gICAgICAgICAgICBjb2xvcjogIzIyYzU1ZTtcbiAgICAgICAgICAgIG1hcmdpbi1ib3R0b206IDEwcHg7XG4gICAgICAgICAgfVxuICAgICAgICAgIC5jb2RlLWNvbnRhaW5lciB7XG4gICAgICAgICAgICBiYWNrZ3JvdW5kOiAjZjhmOWZhO1xuICAgICAgICAgICAgYm9yZGVyOiAycHggZGFzaGVkICMyMmM1NWU7XG4gICAgICAgICAgICBib3JkZXItcmFkaXVzOiA4cHg7XG4gICAgICAgICAgICBwYWRkaW5nOiAyMHB4O1xuICAgICAgICAgICAgdGV4dC1hbGlnbjogY2VudGVyO1xuICAgICAgICAgICAgbWFyZ2luOiAzMHB4IDA7XG4gICAgICAgICAgfVxuICAgICAgICAgIC52ZXJpZmljYXRpb24tY29kZSB7XG4gICAgICAgICAgICBmb250LXNpemU6IDMycHg7XG4gICAgICAgICAgICBmb250LXdlaWdodDogYm9sZDtcbiAgICAgICAgICAgIGxldHRlci1zcGFjaW5nOiA4cHg7XG4gICAgICAgICAgICBjb2xvcjogIzIyYzU1ZTtcbiAgICAgICAgICAgIGZvbnQtZmFtaWx5OiAnQ291cmllciBOZXcnLCBtb25vc3BhY2U7XG4gICAgICAgICAgfVxuICAgICAgICAgIC5pbnN0cnVjdGlvbnMge1xuICAgICAgICAgICAgYmFja2dyb3VuZDogI2U3ZjNmZjtcbiAgICAgICAgICAgIGJvcmRlci1sZWZ0OiA0cHggc29saWQgIzIxOTZmMztcbiAgICAgICAgICAgIHBhZGRpbmc6IDE1cHg7XG4gICAgICAgICAgICBtYXJnaW46IDIwcHggMDtcbiAgICAgICAgICB9XG4gICAgICAgICAgLmZvb3RlciB7XG4gICAgICAgICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7XG4gICAgICAgICAgICBtYXJnaW4tdG9wOiAzMHB4O1xuICAgICAgICAgICAgcGFkZGluZy10b3A6IDIwcHg7XG4gICAgICAgICAgICBib3JkZXItdG9wOiAxcHggc29saWQgI2VlZTtcbiAgICAgICAgICAgIGNvbG9yOiAjNjY2O1xuICAgICAgICAgICAgZm9udC1zaXplOiAxNHB4O1xuICAgICAgICAgIH1cbiAgICAgICAgICAud2FybmluZyB7XG4gICAgICAgICAgICBiYWNrZ3JvdW5kOiAjZmZmM2NkO1xuICAgICAgICAgICAgYm9yZGVyOiAxcHggc29saWQgI2ZmZWFhNztcbiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDRweDtcbiAgICAgICAgICAgIHBhZGRpbmc6IDEycHg7XG4gICAgICAgICAgICBtYXJnaW46IDIwcHggMDtcbiAgICAgICAgICAgIGNvbG9yOiAjODU2NDA0O1xuICAgICAgICAgIH1cbiAgICAgICAgPC9zdHlsZT5cbiAgICAgIDwvaGVhZD5cbiAgICAgIDxib2R5PlxuICAgICAgICA8ZGl2IGNsYXNzPVwiY29udGFpbmVyXCI+XG4gICAgICAgICAgPGRpdiBjbGFzcz1cImhlYWRlclwiPlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cImxvZ29cIj7wn4yxIEZhbmN5IFBsYW50aWVzPC9kaXY+XG4gICAgICAgICAgICA8aDE+VmVyaWZ5IFlvdXIgRW1haWwgQWRkcmVzczwvaDE+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgXG4gICAgICAgICAgPHA+SGkgJHtuYW1lfSw8L3A+XG4gICAgICAgICAgXG4gICAgICAgICAgPHA+V2VsY29tZSB0byBGYW5jeSBQbGFudGllcyEgVG8gY29tcGxldGUgeW91ciBhY2NvdW50IHNldHVwIGFuZCBzdGFydCB0cmFja2luZyB5b3VyIHBsYW50cywgcGxlYXNlIHZlcmlmeSB5b3VyIGVtYWlsIGFkZHJlc3MgdXNpbmcgdGhlIGNvZGUgYmVsb3c6PC9wPlxuICAgICAgICAgIFxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJjb2RlLWNvbnRhaW5lclwiPlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cInZlcmlmaWNhdGlvbi1jb2RlXCI+JHtjb2RlfTwvZGl2PlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIFxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJpbnN0cnVjdGlvbnNcIj5cbiAgICAgICAgICAgIDxzdHJvbmc+SG93IHRvIHZlcmlmeTo8L3N0cm9uZz5cbiAgICAgICAgICAgIDxvbD5cbiAgICAgICAgICAgICAgPGxpPlJldHVybiB0byB0aGUgRmFuY3kgUGxhbnRpZXMgdmVyaWZpY2F0aW9uIHBhZ2U8L2xpPlxuICAgICAgICAgICAgICA8bGk+RW50ZXIgdGhlIDYtZGlnaXQgY29kZSBhYm92ZTwvbGk+XG4gICAgICAgICAgICAgIDxsaT5DbGljayBcIlZlcmlmeSBFbWFpbFwiIHRvIGNvbXBsZXRlIHlvdXIgcmVnaXN0cmF0aW9uPC9saT5cbiAgICAgICAgICAgIDwvb2w+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgXG4gICAgICAgICAgPGRpdiBjbGFzcz1cIndhcm5pbmdcIj5cbiAgICAgICAgICAgIDxzdHJvbmc+4o+wIEltcG9ydGFudDo8L3N0cm9uZz4gVGhpcyB2ZXJpZmljYXRpb24gY29kZSB3aWxsIGV4cGlyZSBpbiAxMCBtaW51dGVzIGZvciBzZWN1cml0eSByZWFzb25zLiBJZiB5b3UgbmVlZCBhIG5ldyBjb2RlLCB5b3UgY2FuIHJlcXVlc3Qgb25lIG9uIHRoZSB2ZXJpZmljYXRpb24gcGFnZS5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICBcbiAgICAgICAgICA8cD5JZiB5b3UgZGlkbid0IGNyZWF0ZSBhbiBhY2NvdW50IHdpdGggRmFuY3kgUGxhbnRpZXMsIHlvdSBjYW4gc2FmZWx5IGlnbm9yZSB0aGlzIGVtYWlsLjwvcD5cbiAgICAgICAgICBcbiAgICAgICAgICA8ZGl2IGNsYXNzPVwiZm9vdGVyXCI+XG4gICAgICAgICAgICA8cD5IYXBweSBwbGFudGluZyEg8J+MvzwvcD5cbiAgICAgICAgICAgIDxwPjxzdHJvbmc+VGhlIEZhbmN5IFBsYW50aWVzIFRlYW08L3N0cm9uZz48L3A+XG4gICAgICAgICAgICA8aHIgc3R5bGU9XCJtYXJnaW46IDIwcHggMDsgYm9yZGVyOiBub25lOyBib3JkZXItdG9wOiAxcHggc29saWQgI2VlZTtcIj5cbiAgICAgICAgICAgIDxwIHN0eWxlPVwiZm9udC1zaXplOiAxMnB4OyBjb2xvcjogIzk5OTtcIj5cbiAgICAgICAgICAgICAgVGhpcyBpcyBhbiBhdXRvbWF0ZWQgbWVzc2FnZS4gUGxlYXNlIGRvIG5vdCByZXBseSB0byB0aGlzIGVtYWlsLjxicj5cbiAgICAgICAgICAgICAgSWYgeW91IGhhdmUgcXVlc3Rpb25zLCB2aXNpdCBvdXIgc3VwcG9ydCBwYWdlIG9yIGNvbnRhY3QgdXMgdGhyb3VnaCB0aGUgYXBwLlxuICAgICAgICAgICAgPC9wPlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvYm9keT5cbiAgICAgIDwvaHRtbD5cbiAgICBgO1xuICB9XG59XG5cbi8vIEZhY3RvcnkgZnVuY3Rpb24gdG8gY3JlYXRlIGVtYWlsIHNlcnZpY2UgaW5zdGFuY2VcbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVFbWFpbFNlcnZpY2UoKTogRW1haWxTZXJ2aWNlIHtcbiAgY29uc3QgY29uZmlnOiBFbWFpbENvbmZpZyA9IHtcbiAgICBhcGlLZXk6IHByb2Nlc3MuZW52LlJFU0VORF9BUElfS0VZISxcbiAgICBmcm9tRW1haWw6IHByb2Nlc3MuZW52LkZST01fRU1BSUwgfHwgJ3NlbmQubWFpbC5mYW5jeS1wbGFudGllcy5jbG91ZGFncmFwaGVyLmNvbScsXG4gICAgZnJvbU5hbWU6IHByb2Nlc3MuZW52LkZST01fTkFNRSB8fCAnRmFuY3kgUGxhbnRpZXMnLFxuICB9O1xuXG4gIGlmICghY29uZmlnLmFwaUtleSkge1xuICAgIHRocm93IG5ldyBFcnJvcignUkVTRU5EX0FQSV9LRVkgZW52aXJvbm1lbnQgdmFyaWFibGUgaXMgcmVxdWlyZWQnKTtcbiAgfVxuXG4gIHJldHVybiBuZXcgUmVzZW5kRW1haWxTZXJ2aWNlKGNvbmZpZyk7XG59Il0sIm5hbWVzIjpbIkVtYWlsU2VydmljZUVycm9yIiwiUmVzZW5kRW1haWxTZXJ2aWNlIiwiY3JlYXRlRW1haWxTZXJ2aWNlIiwiRXJyb3IiLCJtZXNzYWdlIiwiY29kZSIsIm5hbWUiLCJjb25maWciLCJyZXNlbmQiLCJSZXNlbmQiLCJhcGlLZXkiLCJzZW5kVmVyaWZpY2F0aW9uRW1haWwiLCJlbWFpbCIsInNlbmRFbWFpbFdpdGhSZXRyeSIsIm1heFJldHJpZXMiLCJsYXN0RXJyb3IiLCJhdHRlbXB0IiwiZGF0YSIsImVycm9yIiwiZW1haWxzIiwic2VuZCIsImZyb20iLCJmcm9tTmFtZSIsImZyb21FbWFpbCIsInRvIiwic3ViamVjdCIsImh0bWwiLCJnZW5lcmF0ZVZlcmlmaWNhdGlvbkVtYWlsVGVtcGxhdGUiLCJtYXBSZXNlbmRFcnJvckNvZGUiLCJpZCIsInByb2Nlc3MiLCJlbnYiLCJOT0RFX0VOViIsImNvbnNvbGUiLCJsb2ciLCJTdHJpbmciLCJkZWxheSIsIk1hdGgiLCJwb3ciLCJQcm9taXNlIiwicmVzb2x2ZSIsInNldFRpbWVvdXQiLCJ0b0xvd2VyQ2FzZSIsImluY2x1ZGVzIiwiUkVTRU5EX0FQSV9LRVkiLCJGUk9NX0VNQUlMIiwiRlJPTV9OQU1FIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztRQWNhQTtlQUFBQTs7UUFVQUM7ZUFBQUE7O1FBZ05HQztlQUFBQTs7O1FBeE9UO3dCQUVnQjtBQVloQixNQUFNRiwwQkFBMEJHO0lBQ3JDLFlBQ0VDLE9BQWUsRUFDZixBQUFPQyxJQUF3RSxDQUMvRTtRQUNBLEtBQUssQ0FBQ0QsZUFGQ0MsT0FBQUE7UUFHUCxJQUFJLENBQUNDLElBQUksR0FBRztJQUNkO0FBQ0Y7QUFFTyxNQUFNTDtJQUlYLFlBQVlNLE1BQW1CLENBQUU7UUFDL0IsSUFBSSxDQUFDQyxNQUFNLEdBQUcsSUFBSUMsY0FBTSxDQUFDRixPQUFPRyxNQUFNO1FBQ3RDLElBQUksQ0FBQ0gsTUFBTSxHQUFHQTtJQUNoQjtJQUVBLE1BQU1JLHNCQUFzQkMsS0FBYSxFQUFFUCxJQUFZLEVBQUVDLElBQVksRUFBb0I7UUFDdkYsT0FBTyxNQUFNLElBQUksQ0FBQ08sa0JBQWtCLENBQUNELE9BQU9QLE1BQU1DLE1BQU07SUFDMUQ7SUFFQSxNQUFjTyxtQkFDWkQsS0FBYSxFQUNiUCxJQUFZLEVBQ1pDLElBQVksRUFDWlEsVUFBa0IsRUFDQTtRQUNsQixJQUFJQyxZQUEwQjtRQUU5QixJQUFLLElBQUlDLFVBQVUsR0FBR0EsV0FBV0YsWUFBWUUsVUFBVztZQUN0RCxJQUFJO2dCQUNGLE1BQU0sRUFBRUMsSUFBSSxFQUFFQyxLQUFLLEVBQUUsR0FBRyxNQUFNLElBQUksQ0FBQ1YsTUFBTSxDQUFDVyxNQUFNLENBQUNDLElBQUksQ0FBQztvQkFDcERDLE1BQU0sR0FBRyxJQUFJLENBQUNkLE1BQU0sQ0FBQ2UsUUFBUSxDQUFDLEVBQUUsRUFBRSxJQUFJLENBQUNmLE1BQU0sQ0FBQ2dCLFNBQVMsQ0FBQyxDQUFDLENBQUM7b0JBQzFEQyxJQUFJO3dCQUFDWjtxQkFBTTtvQkFDWGEsU0FBUztvQkFDVEMsTUFBTSxJQUFJLENBQUNDLGlDQUFpQyxDQUFDdEIsTUFBTUM7Z0JBQ3JEO2dCQUVBLElBQUlZLE9BQU87b0JBQ1QsTUFBTSxJQUFJbEIsa0JBQ1IsQ0FBQyxrQkFBa0IsRUFBRWtCLE1BQU1kLE9BQU8sRUFBRSxFQUNwQyxJQUFJLENBQUN3QixrQkFBa0IsQ0FBQ1Y7Z0JBRTVCO2dCQUVBLElBQUlELE1BQU1ZLElBQUk7b0JBQ1osNkJBQTZCO29CQUM3QixJQUFJQyxRQUFRQyxHQUFHLENBQUNDLFFBQVEsS0FBSyxlQUFlO3dCQUMxQ0MsUUFBUUMsR0FBRyxDQUFDLENBQUMsNkJBQTZCLEVBQUV0QixNQUFNLFlBQVksRUFBRVAsTUFBTTtvQkFDeEU7b0JBQ0EsT0FBTztnQkFDVDtnQkFFQSxNQUFNLElBQUlMLGtCQUFrQixvQ0FBb0M7WUFFbEUsRUFBRSxPQUFPa0IsT0FBTztnQkFDZEgsWUFBWUcsaUJBQWlCZixRQUFRZSxRQUFRLElBQUlmLE1BQU1nQyxPQUFPakI7Z0JBRTlELDZCQUE2QjtnQkFDN0IsSUFBSVksUUFBUUMsR0FBRyxDQUFDQyxRQUFRLEtBQUssZUFBZTtvQkFDMUNDLFFBQVFDLEdBQUcsQ0FBQyxDQUFDLHFCQUFxQixFQUFFbEIsUUFBUSxDQUFDLEVBQUVGLFdBQVcsUUFBUSxDQUFDLEVBQUVDLFVBQVVYLE9BQU87Z0JBQ3hGO2dCQUVBLGdDQUFnQztnQkFDaEMsSUFBSWMsaUJBQWlCbEIscUJBQ2hCa0IsQ0FBQUEsTUFBTWIsSUFBSSxLQUFLLG1CQUFtQmEsTUFBTWIsSUFBSSxLQUFLLGdCQUFlLEdBQUk7b0JBQ3ZFLE1BQU1hO2dCQUNSO2dCQUVBLDZDQUE2QztnQkFDN0MsSUFBSUYsVUFBVUYsWUFBWTtvQkFDeEIsTUFBTXNCLFFBQVFDLEtBQUtDLEdBQUcsQ0FBQyxHQUFHdEIsVUFBVSxLQUFLLE1BQU0sYUFBYTtvQkFDNUQsTUFBTSxJQUFJdUIsUUFBUUMsQ0FBQUEsVUFBV0MsV0FBV0QsU0FBU0o7Z0JBQ25EO1lBQ0Y7UUFDRjtRQUVBLE1BQU1yQixhQUFhLElBQUlmLGtCQUFrQiw2QkFBNkI7SUFDeEU7SUFFUTRCLG1CQUFtQlYsS0FBVSxFQUE2QjtRQUNoRSxNQUFNZCxVQUFVYyxNQUFNZCxPQUFPLEVBQUVzQyxpQkFBaUI7UUFFaEQsSUFBSXRDLFFBQVF1QyxRQUFRLENBQUMsWUFBWXZDLFFBQVF1QyxRQUFRLENBQUMsVUFBVTtZQUMxRCxPQUFPO1FBQ1Q7UUFDQSxJQUFJdkMsUUFBUXVDLFFBQVEsQ0FBQyxjQUFjdkMsUUFBUXVDLFFBQVEsQ0FBQyxVQUFVO1lBQzVELE9BQU87UUFDVDtRQUNBLElBQUl2QyxRQUFRdUMsUUFBUSxDQUFDLGNBQWN2QyxRQUFRdUMsUUFBUSxDQUFDLFlBQVk7WUFDOUQsT0FBTztRQUNUO1FBRUEsT0FBTztJQUNUO0lBRVFoQixrQ0FBa0N0QixJQUFZLEVBQUVDLElBQVksRUFBVTtRQUM1RSxPQUFPLENBQUM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Z0JBK0VJLEVBQUVBLEtBQUs7Ozs7OzJDQUtvQixFQUFFRCxLQUFLOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7SUE4QjlDLENBQUM7SUFDSDtBQUNGO0FBR08sU0FBU0g7SUFDZCxNQUFNSyxTQUFzQjtRQUMxQkcsUUFBUW9CLFFBQVFDLEdBQUcsQ0FBQ2EsY0FBYztRQUNsQ3JCLFdBQVdPLFFBQVFDLEdBQUcsQ0FBQ2MsVUFBVSxJQUFJO1FBQ3JDdkIsVUFBVVEsUUFBUUMsR0FBRyxDQUFDZSxTQUFTLElBQUk7SUFDckM7SUFFQSxJQUFJLENBQUN2QyxPQUFPRyxNQUFNLEVBQUU7UUFDbEIsTUFBTSxJQUFJUCxNQUFNO0lBQ2xCO0lBRUEsT0FBTyxJQUFJRixtQkFBbUJNO0FBQ2hDIn0=