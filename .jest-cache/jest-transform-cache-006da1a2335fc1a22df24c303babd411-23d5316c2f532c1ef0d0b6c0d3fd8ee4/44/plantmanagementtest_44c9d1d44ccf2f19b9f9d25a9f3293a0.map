{"version":3,"sources":["/Users/stefanbekker/projects/fancy-planties/src/__tests__/api/plant-management.test.js"],"sourcesContent":["// Plant Management API Endpoint Tests\n// Tests GET /api/plants, POST /api/plant-instances, PUT /api/plant-instances/[id] endpoints\n\nimport { NextRequest, NextResponse } from 'next/server';\nimport { GET as getPlantsHandler, POST as createPlantHandler } from '@/app/api/plants/route';\nimport { GET as getPlantInstancesHandler, POST as createPlantInstanceHandler } from '@/app/api/plant-instances/route';\nimport { GET as getPlantInstanceHandler, PUT as updatePlantInstanceHandler, DELETE as deletePlantInstanceHandler } from '@/app/api/plant-instances/[id]/route';\nimport { createTestUser, createTestSession } from '@/test-utils/factories/user-factory';\nimport { createTestPlant, createTestPlantInstance } from '@/test-utils/factories/plant-factory';\nimport { resetApiMocks } from '@/test-utils/helpers/api-helpers';\n\n// Mock the auth functions\njest.mock('@/lib/auth/server', () => ({\n  validateRequest: jest.fn(),\n}));\n\n// Mock the database queries\njest.mock('@/lib/db/queries/plant-taxonomy', () => ({\n  createPlant: jest.fn(),\n  getPlantsWithStats: jest.fn(),\n  validatePlantTaxonomy: jest.fn(),\n}));\n\njest.mock('@/lib/db/queries/plant-instances', () => ({\n  PlantInstanceQueries: {\n    getWithFilters: jest.fn(),\n    create: jest.fn(),\n    getEnhancedById: jest.fn(),\n    update: jest.fn(),\n    delete: jest.fn(),\n  },\n}));\n\n// Mock validation schemas\njest.mock('@/lib/validation/plant-schemas', () => ({\n  createPlantSchema: {\n    parse: jest.fn(),\n  },\n  plantFilterSchema: {\n    parse: jest.fn(),\n  },\n  createPlantInstanceSchema: {\n    parse: jest.fn(),\n  },\n  plantInstanceFilterSchema: {\n    parse: jest.fn(),\n  },\n  updatePlantInstanceSchema: {\n    parse: jest.fn(),\n  },\n}));\n\n// Import mocked functions\nimport { validateRequest } from '@/lib/auth/server';\nimport { createPlant, getPlantsWithStats, validatePlantTaxonomy } from '@/lib/db/queries/plant-taxonomy';\nimport { PlantInstanceQueries } from '@/lib/db/queries/plant-instances';\nimport { \n  createPlantSchema, \n  plantFilterSchema, \n  createPlantInstanceSchema, \n  plantInstanceFilterSchema,\n  updatePlantInstanceSchema \n} from '@/lib/validation/plant-schemas';\n\ndescribe('Plant Management API Endpoints', () => {\n  let testUser;\n  let testSession;\n\n  beforeEach(() => {\n    jest.clearAllMocks();\n    resetApiMocks();\n    \n    testUser = createTestUser();\n    testSession = createTestSession(testUser);\n    \n    // Default auth mock\n    validateRequest.mockResolvedValue({\n      user: testUser,\n      session: testSession,\n    });\n  });\n\n  afterEach(() => {\n    jest.restoreAllMocks();\n  });\n\n  describe('GET /api/plants - Plant filtering and pagination', () => {\n    it('should return plants with default filters', async () => {\n      // Arrange\n      const mockPlants = [\n        createTestPlant({ family: 'Araceae', genus: 'Monstera' }),\n        createTestPlant({ family: 'Araceae', genus: 'Philodendron' }),\n      ];\n\n      plantFilterSchema.parse.mockReturnValue({\n        family: undefined,\n        genus: undefined,\n        isVerified: undefined,\n        createdBy: undefined,\n        limit: 20,\n        offset: 0,\n      });\n\n      getPlantsWithStats.mockResolvedValue(mockPlants);\n\n      const request = new NextRequest('http://localhost:3000/api/plants');\n\n      // Act\n      const response = await getPlantsHandler(request);\n      const responseData = await response.json();\n\n      // Assert\n      expect(response.status).toBe(200);\n      expect(responseData).toEqual({\n        success: true,\n        data: mockPlants,\n        metadata: {\n          operation: 'search',\n          timestamp: expect.any(Date),\n          userId: testUser.id,\n        },\n      });\n\n      expect(validateRequest).toHaveBeenCalled();\n      expect(plantFilterSchema.parse).toHaveBeenCalledWith({\n        family: undefined,\n        genus: undefined,\n        isVerified: undefined,\n        createdBy: undefined,\n        limit: 20,\n        offset: 0,\n      });\n      expect(getPlantsWithStats).toHaveBeenCalledWith(expect.any(Object), testUser.id);\n    });\n\n    it('should return plants with family filter', async () => {\n      // Arrange\n      const mockPlants = [\n        createTestPlant({ family: 'Araceae', genus: 'Monstera' }),\n      ];\n\n      plantFilterSchema.parse.mockReturnValue({\n        family: 'Araceae',\n        genus: undefined,\n        isVerified: undefined,\n        createdBy: undefined,\n        limit: 20,\n        offset: 0,\n      });\n\n      getPlantsWithStats.mockResolvedValue(mockPlants);\n\n      const request = new NextRequest('http://localhost:3000/api/plants?family=Araceae');\n\n      // Act\n      const response = await getPlantsHandler(request);\n      const responseData = await response.json();\n\n      // Assert\n      expect(response.status).toBe(200);\n      expect(responseData.success).toBe(true);\n      expect(responseData.data).toEqual(mockPlants);\n\n      expect(plantFilterSchema.parse).toHaveBeenCalledWith({\n        family: 'Araceae',\n        genus: undefined,\n        isVerified: undefined,\n        createdBy: undefined,\n        limit: 20,\n        offset: 0,\n      });\n    });\n\n    it('should return plants with pagination parameters', async () => {\n      // Arrange\n      const mockPlants = [createTestPlant()];\n\n      plantFilterSchema.parse.mockReturnValue({\n        family: undefined,\n        genus: undefined,\n        isVerified: undefined,\n        createdBy: undefined,\n        limit: 10,\n        offset: 20,\n      });\n\n      getPlantsWithStats.mockResolvedValue(mockPlants);\n\n      const request = new NextRequest('http://localhost:3000/api/plants?limit=10&offset=20');\n\n      // Act\n      const response = await getPlantsHandler(request);\n      const responseData = await response.json();\n\n      // Assert\n      expect(response.status).toBe(200);\n      expect(responseData.success).toBe(true);\n\n      expect(plantFilterSchema.parse).toHaveBeenCalledWith({\n        family: undefined,\n        genus: undefined,\n        isVerified: undefined,\n        createdBy: undefined,\n        limit: 10,\n        offset: 20,\n      });\n    });\n\n    it('should return unauthorized error when user not authenticated', async () => {\n      // Arrange\n      validateRequest.mockResolvedValue({\n        user: null,\n        session: null,\n      });\n\n      const request = new NextRequest('http://localhost:3000/api/plants');\n\n      // Act\n      const response = await getPlantsHandler(request);\n      const responseData = await response.json();\n\n      // Assert\n      expect(response.status).toBe(401);\n      expect(responseData).toEqual({\n        error: 'Unauthorized',\n      });\n\n      expect(getPlantsWithStats).not.toHaveBeenCalled();\n    });\n\n    it('should return validation error for invalid filter parameters', async () => {\n      // Arrange\n      const validationError = new Error('Validation failed');\n      validationError.name = 'ZodError';\n      validationError.issues = [\n        { path: ['limit'], message: 'Limit must be a positive number' }\n      ];\n\n      plantFilterSchema.parse.mockImplementation(() => {\n        throw validationError;\n      });\n\n      const request = new NextRequest('http://localhost:3000/api/plants?limit=invalid');\n\n      // Act\n      const response = await getPlantsHandler(request);\n      const responseData = await response.json();\n\n      // Assert\n      expect(response.status).toBe(400);\n      expect(responseData).toEqual({\n        error: 'Invalid filter parameters',\n        details: validationError.issues,\n      });\n\n      expect(getPlantsWithStats).not.toHaveBeenCalled();\n    });\n\n    it('should handle database errors gracefully', async () => {\n      // Arrange\n      plantFilterSchema.parse.mockReturnValue({\n        limit: 20,\n        offset: 0,\n      });\n\n      getPlantsWithStats.mockRejectedValue(new Error('Database connection failed'));\n\n      const request = new NextRequest('http://localhost:3000/api/plants');\n\n      // Act\n      const response = await getPlantsHandler(request);\n      const responseData = await response.json();\n\n      // Assert\n      expect(response.status).toBe(500);\n      expect(responseData).toEqual({\n        error: 'Internal server error',\n      });\n    });\n  });\n\n  describe('POST /api/plant-instances - Plant instance creation with data validation', () => {\n    it('should create plant instance with valid JSON data', async () => {\n      // Arrange\n      const testPlant = createTestPlant();\n      const requestBody = {\n        plantId: testPlant.id,\n        nickname: 'My Monstera',\n        location: 'Living Room',\n        notes: 'Beautiful plant',\n        isActive: true,\n      };\n\n      const expectedInstanceData = {\n        ...requestBody,\n        userId: testUser.id,\n        lastFertilized: null,\n        lastRepot: null,\n      };\n\n      const createdInstance = createTestPlantInstance({\n        ...expectedInstanceData,\n        id: 1,\n      });\n\n      const enhancedInstance = {\n        ...createdInstance,\n        plant: testPlant,\n      };\n\n      createPlantInstanceSchema.parse.mockReturnValue(expectedInstanceData);\n      PlantInstanceQueries.create.mockResolvedValue(createdInstance);\n      PlantInstanceQueries.getEnhancedById.mockResolvedValue(enhancedInstance);\n\n      const request = new NextRequest('http://localhost:3000/api/plant-instances', {\n        method: 'POST',\n        body: JSON.stringify(requestBody),\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      // Act\n      const response = await createPlantInstanceHandler(request);\n      const responseData = await response.json();\n\n      // Assert\n      expect(response.status).toBe(201);\n      expect(responseData).toEqual({\n        success: true,\n        data: enhancedInstance,\n      });\n\n      expect(createPlantInstanceSchema.parse).toHaveBeenCalledWith(expectedInstanceData);\n      expect(PlantInstanceQueries.create).toHaveBeenCalledWith(expectedInstanceData);\n      expect(PlantInstanceQueries.getEnhancedById).toHaveBeenCalledWith(createdInstance.id);\n    });\n\n    it('should create plant instance with FormData (file upload)', async () => {\n      // Arrange\n      const testPlant = createTestPlant();\n      const formData = new FormData();\n      formData.append('plantId', testPlant.id.toString());\n      formData.append('nickname', 'My Monstera');\n      formData.append('location', 'Living Room');\n      formData.append('isActive', 'true');\n\n      // Mock file\n      const mockFile = new File(['test image'], 'test.jpg', { type: 'image/jpeg' });\n      formData.append('imageFiles[0]', mockFile);\n\n      const expectedInstanceData = {\n        plantId: testPlant.id,\n        nickname: 'My Monstera',\n        location: 'Living Room',\n        isActive: true,\n        userId: testUser.id,\n        lastFertilized: null,\n        lastRepot: null,\n        images: ['data:image/jpeg;base64,dGVzdCBpbWFnZQ=='], // base64 of \"test image\"\n      };\n\n      const createdInstance = createTestPlantInstance(expectedInstanceData);\n      const enhancedInstance = { ...createdInstance, plant: testPlant };\n\n      createPlantInstanceSchema.parse.mockReturnValue(expectedInstanceData);\n      PlantInstanceQueries.create.mockResolvedValue(createdInstance);\n      PlantInstanceQueries.getEnhancedById.mockResolvedValue(enhancedInstance);\n\n      const request = new NextRequest('http://localhost:3000/api/plant-instances', {\n        method: 'POST',\n        body: formData,\n      });\n\n      // Act\n      const response = await createPlantInstanceHandler(request);\n      const responseData = await response.json();\n\n      // Assert\n      expect(response.status).toBe(201);\n      expect(responseData.success).toBe(true);\n      expect(responseData.data).toEqual(enhancedInstance);\n\n      expect(PlantInstanceQueries.create).toHaveBeenCalledWith(expectedInstanceData);\n    });\n\n    it('should return validation error for invalid plant instance data', async () => {\n      // Arrange\n      const requestBody = {\n        plantId: 'invalid',\n        nickname: '',\n        location: '',\n      };\n\n      const validationError = new Error('Validation failed');\n      validationError.name = 'ZodError';\n      validationError.issues = [\n        { path: ['plantId'], message: 'Plant ID must be a number' },\n        { path: ['nickname'], message: 'Nickname is required' },\n      ];\n\n      createPlantInstanceSchema.parse.mockImplementation(() => {\n        throw validationError;\n      });\n\n      const request = new NextRequest('http://localhost:3000/api/plant-instances', {\n        method: 'POST',\n        body: JSON.stringify(requestBody),\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      // Act\n      const response = await createPlantInstanceHandler(request);\n      const responseData = await response.json();\n\n      // Assert\n      expect(response.status).toBe(400);\n      expect(responseData).toEqual({\n        success: false,\n        error: 'Validation failed',\n        details: validationError.issues,\n      });\n\n      expect(PlantInstanceQueries.create).not.toHaveBeenCalled();\n    });\n\n    it('should return unauthorized error when user not authenticated', async () => {\n      // Arrange\n      validateRequest.mockResolvedValue({\n        user: null,\n        session: null,\n      });\n\n      const request = new NextRequest('http://localhost:3000/api/plant-instances', {\n        method: 'POST',\n        body: JSON.stringify({ plantId: 1 }),\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      // Act\n      const response = await createPlantInstanceHandler(request);\n      const responseData = await response.json();\n\n      // Assert\n      expect(response.status).toBe(401);\n      expect(responseData).toEqual({\n        success: false,\n        error: 'Unauthorized',\n      });\n\n      expect(PlantInstanceQueries.create).not.toHaveBeenCalled();\n    });\n\n    it('should handle empty request body', async () => {\n      // Arrange\n      const request = new NextRequest('http://localhost:3000/api/plant-instances', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      // Act\n      const response = await createPlantInstanceHandler(request);\n      const responseData = await response.json();\n\n      // Assert\n      expect(response.status).toBe(400);\n      expect(responseData).toEqual({\n        success: false,\n        error: 'Request body is required',\n      });\n\n      expect(PlantInstanceQueries.create).not.toHaveBeenCalled();\n    });\n\n    it('should handle malformed JSON', async () => {\n      // Arrange\n      const request = new NextRequest('http://localhost:3000/api/plant-instances', {\n        method: 'POST',\n        body: 'invalid json',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      // Act\n      const response = await createPlantInstanceHandler(request);\n      const responseData = await response.json();\n\n      // Assert\n      expect(response.status).toBe(400);\n      expect(responseData).toEqual({\n        success: false,\n        error: 'Invalid JSON in request body',\n      });\n\n      expect(PlantInstanceQueries.create).not.toHaveBeenCalled();\n    });\n\n    it('should calculate fertilizer due date from schedule', async () => {\n      // Arrange\n      const requestBody = {\n        plantId: 1,\n        nickname: 'Test Plant',\n        location: 'Test Location',\n        fertilizerSchedule: '2 weeks',\n      };\n\n      const expectedInstanceData = {\n        ...requestBody,\n        userId: testUser.id,\n        lastFertilized: null,\n        lastRepot: null,\n        fertilizerDue: expect.any(Date),\n      };\n\n      const createdInstance = createTestPlantInstance(expectedInstanceData);\n      const enhancedInstance = { ...createdInstance, plant: createTestPlant() };\n\n      createPlantInstanceSchema.parse.mockReturnValue(expectedInstanceData);\n      PlantInstanceQueries.create.mockResolvedValue(createdInstance);\n      PlantInstanceQueries.getEnhancedById.mockResolvedValue(enhancedInstance);\n\n      const request = new NextRequest('http://localhost:3000/api/plant-instances', {\n        method: 'POST',\n        body: JSON.stringify(requestBody),\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      // Act\n      const response = await createPlantInstanceHandler(request);\n      const responseData = await response.json();\n\n      // Assert\n      expect(response.status).toBe(201);\n      expect(responseData.success).toBe(true);\n\n      // Verify fertilizer due date was calculated (should be 2 weeks from now)\n      const callArgs = PlantInstanceQueries.create.mock.calls[0][0];\n      expect(callArgs.fertilizerDue).toBeInstanceOf(Date);\n      \n      const now = new Date();\n      const expectedDue = new Date(now);\n      expectedDue.setDate(expectedDue.getDate() + 14); // 2 weeks\n      \n      // Allow for small time differences in test execution\n      const timeDiff = Math.abs(callArgs.fertilizerDue.getTime() - expectedDue.getTime());\n      expect(timeDiff).toBeLessThan(1000); // Less than 1 second difference\n    });\n  });\n\n  describe('PUT /api/plant-instances/[id] - Plant instance updates with authorization checks', () => {\n    it('should update plant instance with valid data and authorization', async () => {\n      // Arrange\n      const testPlant = createTestPlant();\n      const existingInstance = createTestPlantInstance({\n        id: 1,\n        userId: testUser.id,\n        plantId: testPlant.id,\n      });\n\n      const updateData = {\n        nickname: 'Updated Nickname',\n        location: 'New Location',\n        notes: 'Updated notes',\n      };\n\n      const expectedUpdateData = {\n        ...updateData,\n        id: 1,\n        userId: testUser.id,\n        lastFertilized: null,\n        lastRepot: null,\n      };\n\n      const updatedInstance = { ...existingInstance, ...updateData };\n      const enhancedInstance = { ...updatedInstance, plant: testPlant };\n\n      PlantInstanceQueries.getEnhancedById.mockResolvedValueOnce(existingInstance);\n      updatePlantInstanceSchema.parse.mockReturnValue(expectedUpdateData);\n      PlantInstanceQueries.update.mockResolvedValue(updatedInstance);\n      PlantInstanceQueries.getEnhancedById.mockResolvedValueOnce(enhancedInstance);\n\n      const request = new NextRequest('http://localhost:3000/api/plant-instances/1', {\n        method: 'PUT',\n        body: JSON.stringify(updateData),\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      const params = Promise.resolve({ id: '1' });\n\n      // Act\n      const response = await updatePlantInstanceHandler(request, { params });\n      const responseData = await response.json();\n\n      // Assert\n      expect(response.status).toBe(200);\n      expect(responseData).toEqual(enhancedInstance);\n\n      expect(PlantInstanceQueries.getEnhancedById).toHaveBeenCalledWith(1);\n      expect(updatePlantInstanceSchema.parse).toHaveBeenCalledWith(expectedUpdateData);\n      expect(PlantInstanceQueries.update).toHaveBeenCalledWith(1, updateData);\n    });\n\n    it('should return forbidden error when user does not own plant instance', async () => {\n      // Arrange\n      const otherUser = createTestUser({ id: 999 });\n      const existingInstance = createTestPlantInstance({\n        id: 1,\n        userId: otherUser.id, // Different user\n      });\n\n      PlantInstanceQueries.getEnhancedById.mockResolvedValue(existingInstance);\n\n      const request = new NextRequest('http://localhost:3000/api/plant-instances/1', {\n        method: 'PUT',\n        body: JSON.stringify({ nickname: 'Updated' }),\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      const params = Promise.resolve({ id: '1' });\n\n      // Act\n      const response = await updatePlantInstanceHandler(request, { params });\n      const responseData = await response.json();\n\n      // Assert\n      expect(response.status).toBe(403);\n      expect(responseData).toEqual({\n        error: 'Forbidden',\n      });\n\n      expect(PlantInstanceQueries.update).not.toHaveBeenCalled();\n    });\n\n    it('should return not found error when plant instance does not exist', async () => {\n      // Arrange\n      PlantInstanceQueries.getEnhancedById.mockResolvedValue(null);\n\n      const request = new NextRequest('http://localhost:3000/api/plant-instances/999', {\n        method: 'PUT',\n        body: JSON.stringify({ nickname: 'Updated' }),\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      const params = Promise.resolve({ id: '999' });\n\n      // Act\n      const response = await updatePlantInstanceHandler(request, { params });\n      const responseData = await response.json();\n\n      // Assert\n      expect(response.status).toBe(404);\n      expect(responseData).toEqual({\n        error: 'Plant instance not found',\n      });\n\n      expect(PlantInstanceQueries.update).not.toHaveBeenCalled();\n    });\n\n    it('should return bad request error for invalid plant instance ID', async () => {\n      // Arrange\n      const request = new NextRequest('http://localhost:3000/api/plant-instances/invalid', {\n        method: 'PUT',\n        body: JSON.stringify({ nickname: 'Updated' }),\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      const params = Promise.resolve({ id: 'invalid' });\n\n      // Act\n      const response = await updatePlantInstanceHandler(request, { params });\n      const responseData = await response.json();\n\n      // Assert\n      expect(response.status).toBe(400);\n      expect(responseData).toEqual({\n        error: 'Invalid plant instance ID',\n      });\n\n      expect(PlantInstanceQueries.getEnhancedById).not.toHaveBeenCalled();\n    });\n\n    it('should return unauthorized error when user not authenticated', async () => {\n      // Arrange\n      validateRequest.mockResolvedValue({\n        user: null,\n        session: null,\n      });\n\n      const request = new NextRequest('http://localhost:3000/api/plant-instances/1', {\n        method: 'PUT',\n        body: JSON.stringify({ nickname: 'Updated' }),\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      const params = Promise.resolve({ id: '1' });\n\n      // Act\n      const response = await updatePlantInstanceHandler(request, { params });\n      const responseData = await response.json();\n\n      // Assert\n      expect(response.status).toBe(401);\n      expect(responseData).toEqual({\n        error: 'Unauthorized',\n      });\n\n      expect(PlantInstanceQueries.getEnhancedById).not.toHaveBeenCalled();\n    });\n\n    it('should handle FormData updates with file uploads', async () => {\n      // Arrange\n      const testPlant = createTestPlant();\n      const existingInstance = createTestPlantInstance({\n        id: 1,\n        userId: testUser.id,\n        plantId: testPlant.id,\n      });\n\n      const formData = new FormData();\n      formData.append('nickname', 'Updated Nickname');\n      formData.append('location', 'New Location');\n      formData.append('existingImages[0]', 'existing-image-url');\n\n      const mockFile = new File(['new image'], 'new.jpg', { type: 'image/jpeg' });\n      formData.append('imageFiles[0]', mockFile);\n\n      const expectedUpdateData = {\n        nickname: 'Updated Nickname',\n        location: 'New Location',\n        images: ['existing-image-url', 'data:image/jpeg;base64,bmV3IGltYWdl'], // base64 of \"new image\"\n        id: 1,\n        userId: testUser.id,\n        lastFertilized: null,\n        lastRepot: null,\n      };\n\n      const updatedInstance = { ...existingInstance, ...expectedUpdateData };\n      const enhancedInstance = { ...updatedInstance, plant: testPlant };\n\n      PlantInstanceQueries.getEnhancedById.mockResolvedValueOnce(existingInstance);\n      updatePlantInstanceSchema.parse.mockReturnValue(expectedUpdateData);\n      PlantInstanceQueries.update.mockResolvedValue(updatedInstance);\n      PlantInstanceQueries.getEnhancedById.mockResolvedValueOnce(enhancedInstance);\n\n      const request = new NextRequest('http://localhost:3000/api/plant-instances/1', {\n        method: 'PUT',\n        body: formData,\n      });\n\n      const params = Promise.resolve({ id: '1' });\n\n      // Act\n      const response = await updatePlantInstanceHandler(request, { params });\n      const responseData = await response.json();\n\n      // Assert\n      expect(response.status).toBe(200);\n      expect(responseData).toEqual(enhancedInstance);\n\n      // Verify the update was called with correct data (excluding id and userId)\n      const { id, userId, ...updateDataWithoutIds } = expectedUpdateData;\n      expect(PlantInstanceQueries.update).toHaveBeenCalledWith(1, updateDataWithoutIds);\n    });\n\n    it('should handle validation errors during update', async () => {\n      // Arrange\n      const existingInstance = createTestPlantInstance({\n        id: 1,\n        userId: testUser.id,\n      });\n\n      const validationError = new Error('Validation failed');\n      validationError.name = 'ZodError';\n      validationError.issues = [\n        { path: ['nickname'], message: 'Nickname is required' }\n      ];\n\n      PlantInstanceQueries.getEnhancedById.mockResolvedValue(existingInstance);\n      updatePlantInstanceSchema.parse.mockImplementation(() => {\n        throw validationError;\n      });\n\n      const request = new NextRequest('http://localhost:3000/api/plant-instances/1', {\n        method: 'PUT',\n        body: JSON.stringify({ nickname: '' }),\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      const params = Promise.resolve({ id: '1' });\n\n      // Act\n      const response = await updatePlantInstanceHandler(request, { params });\n      const responseData = await response.json();\n\n      // Assert\n      expect(response.status).toBe(400);\n      expect(responseData.error).toContain('Invalid plant instance data');\n\n      expect(PlantInstanceQueries.update).not.toHaveBeenCalled();\n    });\n  });\n\n  describe('Plant Management Integration Tests', () => {\n    it('should handle complete plant management workflow: create -> read -> update -> delete', async () => {\n      const testPlant = createTestPlant();\n      \n      // Step 1: Create plant instance\n      const createData = {\n        plantId: testPlant.id,\n        nickname: 'Test Plant',\n        location: 'Test Location',\n      };\n\n      const createdInstance = createTestPlantInstance({\n        id: 1,\n        ...createData,\n        userId: testUser.id,\n      });\n\n      const enhancedInstance = { ...createdInstance, plant: testPlant };\n\n      createPlantInstanceSchema.parse.mockReturnValue({\n        ...createData,\n        userId: testUser.id,\n        lastFertilized: null,\n        lastRepot: null,\n      });\n      PlantInstanceQueries.create.mockResolvedValue(createdInstance);\n      PlantInstanceQueries.getEnhancedById.mockResolvedValue(enhancedInstance);\n\n      const createRequest = new NextRequest('http://localhost:3000/api/plant-instances', {\n        method: 'POST',\n        body: JSON.stringify(createData),\n        headers: { 'Content-Type': 'application/json' },\n      });\n\n      const createResponse = await createPlantInstanceHandler(createRequest);\n      const createResponseData = await createResponse.json();\n\n      expect(createResponse.status).toBe(201);\n      expect(createResponseData.success).toBe(true);\n\n      // Step 2: Read plant instance\n      PlantInstanceQueries.getEnhancedById.mockResolvedValue(enhancedInstance);\n\n      const readRequest = new NextRequest('http://localhost:3000/api/plant-instances/1');\n      const readParams = Promise.resolve({ id: '1' });\n\n      const readResponse = await getPlantInstanceHandler(readRequest, { params: readParams });\n      const readResponseData = await readResponse.json();\n\n      expect(readResponse.status).toBe(200);\n      expect(readResponseData).toEqual(enhancedInstance);\n\n      // Step 3: Update plant instance\n      const updateData = { nickname: 'Updated Plant' };\n      const updatedInstance = { ...enhancedInstance, ...updateData };\n\n      updatePlantInstanceSchema.parse.mockReturnValue({\n        ...updateData,\n        id: 1,\n        userId: testUser.id,\n        lastFertilized: null,\n        lastRepot: null,\n      });\n      PlantInstanceQueries.update.mockResolvedValue(updatedInstance);\n      PlantInstanceQueries.getEnhancedById.mockResolvedValue(updatedInstance);\n\n      const updateRequest = new NextRequest('http://localhost:3000/api/plant-instances/1', {\n        method: 'PUT',\n        body: JSON.stringify(updateData),\n        headers: { 'Content-Type': 'application/json' },\n      });\n      const updateParams = Promise.resolve({ id: '1' });\n\n      const updateResponse = await updatePlantInstanceHandler(updateRequest, { params: updateParams });\n      const updateResponseData = await updateResponse.json();\n\n      expect(updateResponse.status).toBe(200);\n      expect(updateResponseData.nickname).toBe('Updated Plant');\n\n      // Step 4: Delete plant instance\n      PlantInstanceQueries.delete.mockResolvedValue(true);\n\n      const deleteRequest = new NextRequest('http://localhost:3000/api/plant-instances/1', {\n        method: 'DELETE',\n      });\n      const deleteParams = Promise.resolve({ id: '1' });\n\n      const deleteResponse = await deletePlantInstanceHandler(deleteRequest, { params: deleteParams });\n      const deleteResponseData = await deleteResponse.json();\n\n      expect(deleteResponse.status).toBe(200);\n      expect(deleteResponseData).toEqual({\n        success: true,\n        message: 'Plant instance deleted successfully',\n      });\n\n      // Verify all operations were called\n      expect(PlantInstanceQueries.create).toHaveBeenCalled();\n      expect(PlantInstanceQueries.update).toHaveBeenCalled();\n      expect(PlantInstanceQueries.delete).toHaveBeenCalledWith(1);\n    });\n\n    it('should handle authorization checks across all endpoints', async () => {\n      // Test unauthorized access to all endpoints\n      validateRequest.mockResolvedValue({ user: null, session: null });\n\n      // GET /api/plants\n      const getPlantsRequest = new NextRequest('http://localhost:3000/api/plants');\n      const getPlantsResponse = await getPlantsHandler(getPlantsRequest);\n      expect(getPlantsResponse.status).toBe(401);\n\n      // POST /api/plant-instances\n      const createRequest = new NextRequest('http://localhost:3000/api/plant-instances', {\n        method: 'POST',\n        body: JSON.stringify({}),\n        headers: { 'Content-Type': 'application/json' },\n      });\n      const createResponse = await createPlantInstanceHandler(createRequest);\n      expect(createResponse.status).toBe(401);\n\n      // GET /api/plant-instances/1\n      const getRequest = new NextRequest('http://localhost:3000/api/plant-instances/1');\n      const getParams = Promise.resolve({ id: '1' });\n      const getResponse = await getPlantInstanceHandler(getRequest, { params: getParams });\n      expect(getResponse.status).toBe(401);\n\n      // PUT /api/plant-instances/1\n      const updateRequest = new NextRequest('http://localhost:3000/api/plant-instances/1', {\n        method: 'PUT',\n        body: JSON.stringify({}),\n        headers: { 'Content-Type': 'application/json' },\n      });\n      const updateParams = Promise.resolve({ id: '1' });\n      const updateResponse = await updatePlantInstanceHandler(updateRequest, { params: updateParams });\n      expect(updateResponse.status).toBe(401);\n\n      // DELETE /api/plant-instances/1\n      const deleteRequest = new NextRequest('http://localhost:3000/api/plant-instances/1', {\n        method: 'DELETE',\n      });\n      const deleteParams = Promise.resolve({ id: '1' });\n      const deleteResponse = await deletePlantInstanceHandler(deleteRequest, { params: deleteParams });\n      expect(deleteResponse.status).toBe(401);\n    });\n  });\n});"],"names":["jest","mock","validateRequest","fn","createPlant","getPlantsWithStats","validatePlantTaxonomy","PlantInstanceQueries","getWithFilters","create","getEnhancedById","update","delete","createPlantSchema","parse","plantFilterSchema","createPlantInstanceSchema","plantInstanceFilterSchema","updatePlantInstanceSchema","describe","testUser","testSession","beforeEach","clearAllMocks","resetApiMocks","createTestUser","createTestSession","mockResolvedValue","user","session","afterEach","restoreAllMocks","it","mockPlants","createTestPlant","family","genus","mockReturnValue","undefined","isVerified","createdBy","limit","offset","request","NextRequest","response","getPlantsHandler","responseData","json","expect","status","toBe","toEqual","success","data","metadata","operation","timestamp","any","Date","userId","id","toHaveBeenCalled","toHaveBeenCalledWith","Object","error","not","validationError","Error","name","issues","path","message","mockImplementation","details","mockRejectedValue","testPlant","requestBody","plantId","nickname","location","notes","isActive","expectedInstanceData","lastFertilized","lastRepot","createdInstance","createTestPlantInstance","enhancedInstance","plant","method","body","JSON","stringify","headers","createPlantInstanceHandler","formData","FormData","append","toString","mockFile","File","type","images","fertilizerSchedule","fertilizerDue","callArgs","calls","toBeInstanceOf","now","expectedDue","setDate","getDate","timeDiff","Math","abs","getTime","toBeLessThan","existingInstance","updateData","expectedUpdateData","updatedInstance","mockResolvedValueOnce","params","Promise","resolve","updatePlantInstanceHandler","otherUser","updateDataWithoutIds","toContain","createData","createRequest","createResponse","createResponseData","readRequest","readParams","readResponse","getPlantInstanceHandler","readResponseData","updateRequest","updateParams","updateResponse","updateResponseData","deleteRequest","deleteParams","deleteResponse","deletePlantInstanceHandler","deleteResponseData","getPlantsRequest","getPlantsResponse","getRequest","getParams","getResponse"],"mappings":"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"}