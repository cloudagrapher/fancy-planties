15fb081f32a71aabab1a1e28bbe1ab8c
/**
 * Care Data Database Query Tests
 * Tests care record creation, retrieval, care history aggregation, and statistics
 */ "use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
const _carehistory = require("../../lib/db/queries/care-history");
const _plants = require("../../lib/db/queries/plants");
const _plantinstances = require("../../lib/db/queries/plant-instances");
const _databasetestmanager = require("../../test-utils/setup/database-test-manager.js");
const _carefactory = require("../../test-utils/factories/care-factory.js");
const _userfactory = require("../../test-utils/factories/user-factory.js");
const _plantfactory = require("../../test-utils/factories/plant-factory.js");
describe('Care Data Database Queries', ()=>{
    let dbManager;
    beforeEach(()=>{
        dbManager = (0, _databasetestmanager.createDatabaseTestManager)();
        (0, _carefactory.resetCareCounter)();
        (0, _userfactory.resetUserCounter)();
        (0, _plantfactory.resetPlantCounters)();
    });
    afterEach(async ()=>{
        await dbManager.cleanup();
    });
    describe('Care Record CRUD Operations', ()=>{
        test('should create a new care record', async ()=>{
            const testUser = (0, _userfactory.createTestUser)();
            const createdUser = await dbManager.createTestUser(testUser);
            const plant = (0, _plantfactory.createTestPlant)({
                createdBy: createdUser.id
            });
            const createdPlant = await dbManager.createTestPlant(plant);
            const plantInstance = (0, _plantfactory.createTestPlantInstance)({
                userId: createdUser.id,
                plantId: createdPlant.id
            });
            const createdInstance = await dbManager.createTestPlantInstance(plantInstance);
            const careData = {
                userId: createdUser.id,
                plantInstanceId: createdInstance.id,
                careType: 'fertilizer',
                careDate: new Date(),
                notes: 'Applied balanced liquid fertilizer',
                fertilizerType: 'Balanced liquid fertilizer (10-10-10)',
                images: []
            };
            const careRecord = await _carehistory.CareHistoryQueries.createCareHistory(careData);
            expect(careRecord).toBeDefined();
            expect(careRecord.id).toBeDefined();
            expect(careRecord.userId).toBe(createdUser.id);
            expect(careRecord.plantInstanceId).toBe(createdInstance.id);
            expect(careRecord.careType).toBe('fertilizer');
            expect(careRecord.notes).toBe('Applied balanced liquid fertilizer');
            expect(careRecord.fertilizerType).toBe('Balanced liquid fertilizer (10-10-10)');
            expect(careRecord.createdAt).toBeInstanceOf(Date);
            expect(careRecord.updatedAt).toBeInstanceOf(Date);
        });
        test('should retrieve care record by ID', async ()=>{
            const testUser = (0, _userfactory.createTestUser)();
            const createdUser = await dbManager.createTestUser(testUser);
            const plant = (0, _plantfactory.createTestPlant)({
                createdBy: createdUser.id
            });
            const createdPlant = await dbManager.createTestPlant(plant);
            const plantInstance = (0, _plantfactory.createTestPlantInstance)({
                userId: createdUser.id,
                plantId: createdPlant.id
            });
            const createdInstance = await dbManager.createTestPlantInstance(plantInstance);
            const careData = (0, _carefactory.createTestCareRecord)({
                userId: createdUser.id,
                plantInstanceId: createdInstance.id
            });
            const createdCare = await _carehistory.CareHistoryQueries.createCareHistory(careData);
            const foundCare = await _carehistory.CareHistoryQueries.getCareHistoryById(createdCare.id);
            expect(foundCare).toBeDefined();
            expect(foundCare.id).toBe(createdCare.id);
            expect(foundCare.careType).toBe(createdCare.careType);
            expect(foundCare.notes).toBe(createdCare.notes);
        });
        test('should return null for non-existent care record ID', async ()=>{
            const careRecord = await _carehistory.CareHistoryQueries.getCareHistoryById(99999);
            expect(careRecord).toBeNull();
        });
        test('should update care record', async ()=>{
            const testUser = (0, _userfactory.createTestUser)();
            const createdUser = await dbManager.createTestUser(testUser);
            const plant = (0, _plantfactory.createTestPlant)({
                createdBy: createdUser.id
            });
            const createdPlant = await dbManager.createTestPlant(plant);
            const plantInstance = (0, _plantfactory.createTestPlantInstance)({
                userId: createdUser.id,
                plantId: createdPlant.id
            });
            const createdInstance = await dbManager.createTestPlantInstance(plantInstance);
            const careData = (0, _carefactory.createTestCareRecord)({
                userId: createdUser.id,
                plantInstanceId: createdInstance.id
            });
            const createdCare = await _carehistory.CareHistoryQueries.createCareHistory(careData);
            const updates = {
                notes: 'Updated care notes',
                fertilizerType: 'Updated fertilizer type'
            };
            const updatedCare = await _carehistory.CareHistoryQueries.updateCareHistory(createdCare.id, createdUser.id, updates);
            expect(updatedCare).toBeDefined();
            expect(updatedCare.notes).toBe('Updated care notes');
            expect(updatedCare.fertilizerType).toBe('Updated fertilizer type');
            expect(updatedCare.updatedAt.getTime()).toBeGreaterThan(createdCare.updatedAt.getTime());
        });
        test('should delete care record', async ()=>{
            const testUser = (0, _userfactory.createTestUser)();
            const createdUser = await dbManager.createTestUser(testUser);
            const plant = (0, _plantfactory.createTestPlant)({
                createdBy: createdUser.id
            });
            const createdPlant = await dbManager.createTestPlant(plant);
            const plantInstance = (0, _plantfactory.createTestPlantInstance)({
                userId: createdUser.id,
                plantId: createdPlant.id
            });
            const createdInstance = await dbManager.createTestPlantInstance(plantInstance);
            const careData = (0, _carefactory.createTestCareRecord)({
                userId: createdUser.id,
                plantInstanceId: createdInstance.id
            });
            const createdCare = await _carehistory.CareHistoryQueries.createCareHistory(careData);
            const deleted = await _carehistory.CareHistoryQueries.deleteCareHistory(createdCare.id, createdUser.id);
            expect(deleted).toBe(true);
            const foundCare = await _carehistory.CareHistoryQueries.getCareHistoryById(createdCare.id);
            expect(foundCare).toBeNull();
        });
    });
    describe('Care History Retrieval and Filtering', ()=>{
        test('should get care history for a specific plant instance', async ()=>{
            const testUser = (0, _userfactory.createTestUser)();
            const createdUser = await dbManager.createTestUser(testUser);
            const plant = (0, _plantfactory.createTestPlant)({
                createdBy: createdUser.id
            });
            const createdPlant = await dbManager.createTestPlant(plant);
            const plantInstance = (0, _plantfactory.createTestPlantInstance)({
                userId: createdUser.id,
                plantId: createdPlant.id
            });
            const createdInstance = await dbManager.createTestPlantInstance(plantInstance);
            // Create multiple care records
            const careRecords = [
                (0, _carefactory.createTestCareRecord)({
                    userId: createdUser.id,
                    plantInstanceId: createdInstance.id,
                    careType: 'fertilizer'
                }),
                (0, _carefactory.createTestCareRecord)({
                    userId: createdUser.id,
                    plantInstanceId: createdInstance.id,
                    careType: 'water'
                }),
                (0, _carefactory.createTestCareRecord)({
                    userId: createdUser.id,
                    plantInstanceId: createdInstance.id,
                    careType: 'prune'
                })
            ];
            for (const care of careRecords){
                await _carehistory.CareHistoryQueries.createCareHistory(care);
            }
            const history = await _carehistory.CareHistoryQueries.getCareHistoryForPlant(createdInstance.id, createdUser.id);
            expect(history.length).toBe(3);
            expect(history.every((h)=>h.plantInstanceId === createdInstance.id)).toBe(true);
            expect(history.every((h)=>h.userId === createdUser.id)).toBe(true);
        });
        test('should filter care history by care type', async ()=>{
            const testUser = (0, _userfactory.createTestUser)();
            const createdUser = await dbManager.createTestUser(testUser);
            const plant = (0, _plantfactory.createTestPlant)({
                createdBy: createdUser.id
            });
            const createdPlant = await dbManager.createTestPlant(plant);
            const plantInstance = (0, _plantfactory.createTestPlantInstance)({
                userId: createdUser.id,
                plantId: createdPlant.id
            });
            const createdInstance = await dbManager.createTestPlantInstance(plantInstance);
            // Create care records of different types
            const fertilizerCare = (0, _carefactory.createTestCareRecord)({
                userId: createdUser.id,
                plantInstanceId: createdInstance.id,
                careType: 'fertilizer'
            });
            const waterCare = (0, _carefactory.createTestCareRecord)({
                userId: createdUser.id,
                plantInstanceId: createdInstance.id,
                careType: 'water'
            });
            await _carehistory.CareHistoryQueries.createCareHistory(fertilizerCare);
            await _carehistory.CareHistoryQueries.createCareHistory(waterCare);
            // Filter by fertilizer type
            const fertilizerHistory = await _carehistory.CareHistoryQueries.getCareHistoryForPlant(createdInstance.id, createdUser.id, {
                careType: 'fertilizer'
            });
            expect(fertilizerHistory.length).toBe(1);
            expect(fertilizerHistory[0].careType).toBe('fertilizer');
        });
        test('should filter care history by date range', async ()=>{
            const testUser = (0, _userfactory.createTestUser)();
            const createdUser = await dbManager.createTestUser(testUser);
            const plant = (0, _plantfactory.createTestPlant)({
                createdBy: createdUser.id
            });
            const createdPlant = await dbManager.createTestPlant(plant);
            const plantInstance = (0, _plantfactory.createTestPlantInstance)({
                userId: createdUser.id,
                plantId: createdPlant.id
            });
            const createdInstance = await dbManager.createTestPlantInstance(plantInstance);
            const now = new Date();
            const oneWeekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
            const twoWeeksAgo = new Date(now.getTime() - 14 * 24 * 60 * 60 * 1000);
            // Create care records with different dates
            const recentCare = (0, _carefactory.createTestCareRecord)({
                userId: createdUser.id,
                plantInstanceId: createdInstance.id,
                careDate: now
            });
            const oldCare = (0, _carefactory.createTestCareRecord)({
                userId: createdUser.id,
                plantInstanceId: createdInstance.id,
                careDate: twoWeeksAgo
            });
            await _carehistory.CareHistoryQueries.createCareHistory(recentCare);
            await _carehistory.CareHistoryQueries.createCareHistory(oldCare);
            // Filter by date range (last week)
            const recentHistory = await _carehistory.CareHistoryQueries.getCareHistoryForPlant(createdInstance.id, createdUser.id, {
                startDate: oneWeekAgo,
                endDate: now
            });
            expect(recentHistory.length).toBe(1);
            expect(recentHistory[0].careDate.getTime()).toBeGreaterThanOrEqual(oneWeekAgo.getTime());
        });
        test('should get recent care history for user', async ()=>{
            const testUser = (0, _userfactory.createTestUser)();
            const createdUser = await dbManager.createTestUser(testUser);
            const plant = (0, _plantfactory.createTestPlant)({
                createdBy: createdUser.id
            });
            const createdPlant = await dbManager.createTestPlant(plant);
            // Create multiple plant instances
            const instance1 = (0, _plantfactory.createTestPlantInstance)({
                userId: createdUser.id,
                plantId: createdPlant.id
            });
            const instance2 = (0, _plantfactory.createTestPlantInstance)({
                userId: createdUser.id,
                plantId: createdPlant.id
            });
            const createdInstance1 = await dbManager.createTestPlantInstance(instance1);
            const createdInstance2 = await dbManager.createTestPlantInstance(instance2);
            // Create care records for both instances
            const care1 = (0, _carefactory.createTestCareRecord)({
                userId: createdUser.id,
                plantInstanceId: createdInstance1.id
            });
            const care2 = (0, _carefactory.createTestCareRecord)({
                userId: createdUser.id,
                plantInstanceId: createdInstance2.id
            });
            await _carehistory.CareHistoryQueries.createCareHistory(care1);
            await _carehistory.CareHistoryQueries.createCareHistory(care2);
            const recentHistory = await _carehistory.CareHistoryQueries.getRecentCareHistory(createdUser.id, 10);
            expect(recentHistory.length).toBe(2);
            expect(recentHistory.every((h)=>h.userId === createdUser.id)).toBe(true);
            // Should be sorted by date (most recent first)
            expect(recentHistory[0].careDate.getTime()).toBeGreaterThanOrEqual(recentHistory[1].careDate.getTime());
        });
    });
    describe('Care Statistics and Aggregation', ()=>{
        test('should get care history count for plant instance', async ()=>{
            const testUser = (0, _userfactory.createTestUser)();
            const createdUser = await dbManager.createTestUser(testUser);
            const plant = (0, _plantfactory.createTestPlant)({
                createdBy: createdUser.id
            });
            const createdPlant = await dbManager.createTestPlant(plant);
            const plantInstance = (0, _plantfactory.createTestPlantInstance)({
                userId: createdUser.id,
                plantId: createdPlant.id
            });
            const createdInstance = await dbManager.createTestPlantInstance(plantInstance);
            // Create multiple care records
            const careRecords = [
                (0, _carefactory.createTestCareRecord)({
                    userId: createdUser.id,
                    plantInstanceId: createdInstance.id,
                    careType: 'fertilizer'
                }),
                (0, _carefactory.createTestCareRecord)({
                    userId: createdUser.id,
                    plantInstanceId: createdInstance.id,
                    careType: 'fertilizer'
                }),
                (0, _carefactory.createTestCareRecord)({
                    userId: createdUser.id,
                    plantInstanceId: createdInstance.id,
                    careType: 'water'
                })
            ];
            for (const care of careRecords){
                await _carehistory.CareHistoryQueries.createCareHistory(care);
            }
            // Get total count
            const totalCount = await _carehistory.CareHistoryQueries.getCareHistoryCount(createdInstance.id, createdUser.id);
            expect(totalCount).toBe(3);
            // Get count by care type
            const fertilizerCount = await _carehistory.CareHistoryQueries.getCareHistoryCount(createdInstance.id, createdUser.id, 'fertilizer');
            expect(fertilizerCount).toBe(2);
            const waterCount = await _carehistory.CareHistoryQueries.getCareHistoryCount(createdInstance.id, createdUser.id, 'water');
            expect(waterCount).toBe(1);
        });
        test('should get last care date for specific care type', async ()=>{
            const testUser = (0, _userfactory.createTestUser)();
            const createdUser = await dbManager.createTestUser(testUser);
            const plant = (0, _plantfactory.createTestPlant)({
                createdBy: createdUser.id
            });
            const createdPlant = await dbManager.createTestPlant(plant);
            const plantInstance = (0, _plantfactory.createTestPlantInstance)({
                userId: createdUser.id,
                plantId: createdPlant.id
            });
            const createdInstance = await dbManager.createTestPlantInstance(plantInstance);
            const now = new Date();
            const yesterday = new Date(now.getTime() - 24 * 60 * 60 * 1000);
            // Create care records with different dates
            const oldFertilizer = (0, _carefactory.createTestCareRecord)({
                userId: createdUser.id,
                plantInstanceId: createdInstance.id,
                careType: 'fertilizer',
                careDate: yesterday
            });
            const recentFertilizer = (0, _carefactory.createTestCareRecord)({
                userId: createdUser.id,
                plantInstanceId: createdInstance.id,
                careType: 'fertilizer',
                careDate: now
            });
            await _carehistory.CareHistoryQueries.createCareHistory(oldFertilizer);
            await _carehistory.CareHistoryQueries.createCareHistory(recentFertilizer);
            const lastFertilizerDate = await _carehistory.CareHistoryQueries.getLastCareDate(createdInstance.id, createdUser.id, 'fertilizer');
            expect(lastFertilizerDate).toBeDefined();
            expect(lastFertilizerDate.getTime()).toBe(now.getTime());
        });
        test('should return null for care type with no history', async ()=>{
            const testUser = (0, _userfactory.createTestUser)();
            const createdUser = await dbManager.createTestUser(testUser);
            const plant = (0, _plantfactory.createTestPlant)({
                createdBy: createdUser.id
            });
            const createdPlant = await dbManager.createTestPlant(plant);
            const plantInstance = (0, _plantfactory.createTestPlantInstance)({
                userId: createdUser.id,
                plantId: createdPlant.id
            });
            const createdInstance = await dbManager.createTestPlantInstance(plantInstance);
            const lastRepotDate = await _carehistory.CareHistoryQueries.getLastCareDate(createdInstance.id, createdUser.id, 'repot');
            expect(lastRepotDate).toBeNull();
        });
        test('should get care dashboard data for user', async ()=>{
            const testUser = (0, _userfactory.createTestUser)();
            const createdUser = await dbManager.createTestUser(testUser);
            const plant = (0, _plantfactory.createTestPlant)({
                createdBy: createdUser.id
            });
            const createdPlant = await dbManager.createTestPlant(plant);
            // Create plant instances with different care statuses
            const overdueInstance = (0, _plantfactory.createTestPlantInstance)({
                userId: createdUser.id,
                plantId: createdPlant.id,
                fertilizerDue: new Date(Date.now() - 24 * 60 * 60 * 1000),
                isActive: true
            });
            const dueTodayInstance = (0, _plantfactory.createTestPlantInstance)({
                userId: createdUser.id,
                plantId: createdPlant.id,
                fertilizerDue: new Date(),
                isActive: true
            });
            const dueSoonInstance = (0, _plantfactory.createTestPlantInstance)({
                userId: createdUser.id,
                plantId: createdPlant.id,
                fertilizerDue: new Date(Date.now() + 3 * 24 * 60 * 60 * 1000),
                isActive: true
            });
            await dbManager.createTestPlantInstance(overdueInstance);
            await dbManager.createTestPlantInstance(dueTodayInstance);
            await dbManager.createTestPlantInstance(dueSoonInstance);
            const dashboardData = await _carehistory.CareHistoryQueries.getCareDashboardData(createdUser.id);
            expect(dashboardData).toBeDefined();
            expect(dashboardData.statistics).toBeDefined();
            expect(dashboardData.statistics.totalActivePlants).toBe(3);
            expect(dashboardData.overdue.length).toBeGreaterThanOrEqual(1);
            expect(dashboardData.dueToday.length).toBeGreaterThanOrEqual(1);
            expect(dashboardData.dueSoon.length).toBeGreaterThanOrEqual(1);
        });
    });
    describe('Bulk Operations', ()=>{
        test('should bulk create care history entries', async ()=>{
            const testUser = (0, _userfactory.createTestUser)();
            const createdUser = await dbManager.createTestUser(testUser);
            const plant = (0, _plantfactory.createTestPlant)({
                createdBy: createdUser.id
            });
            const createdPlant = await dbManager.createTestPlant(plant);
            const plantInstance = (0, _plantfactory.createTestPlantInstance)({
                userId: createdUser.id,
                plantId: createdPlant.id
            });
            const createdInstance = await dbManager.createTestPlantInstance(plantInstance);
            const careEntries = [
                {
                    userId: createdUser.id,
                    plantInstanceId: createdInstance.id,
                    careType: 'fertilizer',
                    careDate: new Date(),
                    notes: 'Bulk fertilizer 1'
                },
                {
                    userId: createdUser.id,
                    plantInstanceId: createdInstance.id,
                    careType: 'water',
                    careDate: new Date(),
                    notes: 'Bulk water 1'
                },
                {
                    userId: createdUser.id,
                    plantInstanceId: createdInstance.id,
                    careType: 'prune',
                    careDate: new Date(),
                    notes: 'Bulk prune 1'
                }
            ];
            const createdEntries = await _carehistory.CareHistoryQueries.bulkCreateCareHistory(careEntries);
            expect(createdEntries.length).toBe(3);
            expect(createdEntries.every((entry)=>entry.id)).toBe(true);
            expect(createdEntries.every((entry)=>entry.userId === createdUser.id)).toBe(true);
        });
        test('should handle empty bulk create gracefully', async ()=>{
            const result = await _carehistory.CareHistoryQueries.bulkCreateCareHistory([]);
            expect(result).toEqual([]);
        });
        test('should get care history for multiple plant instances', async ()=>{
            const testUser = (0, _userfactory.createTestUser)();
            const createdUser = await dbManager.createTestUser(testUser);
            const plant = (0, _plantfactory.createTestPlant)({
                createdBy: createdUser.id
            });
            const createdPlant = await dbManager.createTestPlant(plant);
            // Create multiple plant instances
            const instance1 = (0, _plantfactory.createTestPlantInstance)({
                userId: createdUser.id,
                plantId: createdPlant.id
            });
            const instance2 = (0, _plantfactory.createTestPlantInstance)({
                userId: createdUser.id,
                plantId: createdPlant.id
            });
            const createdInstance1 = await dbManager.createTestPlantInstance(instance1);
            const createdInstance2 = await dbManager.createTestPlantInstance(instance2);
            // Create care records for both instances
            const care1 = (0, _carefactory.createTestCareRecord)({
                userId: createdUser.id,
                plantInstanceId: createdInstance1.id
            });
            const care2 = (0, _carefactory.createTestCareRecord)({
                userId: createdUser.id,
                plantInstanceId: createdInstance2.id
            });
            await _carehistory.CareHistoryQueries.createCareHistory(care1);
            await _carehistory.CareHistoryQueries.createCareHistory(care2);
            const plantInstanceIds = [
                createdInstance1.id,
                createdInstance2.id
            ];
            const history = await _carehistory.CareHistoryQueries.getCareHistoryForPlants(plantInstanceIds, createdUser.id);
            expect(history.length).toBe(2);
            expect(history.every((h)=>plantInstanceIds.includes(h.plantInstanceId))).toBe(true);
        });
    });
    describe('Care Type Specific Operations', ()=>{
        test('should create fertilizer care record with specific data', async ()=>{
            const testUser = (0, _userfactory.createTestUser)();
            const createdUser = await dbManager.createTestUser(testUser);
            const plant = (0, _plantfactory.createTestPlant)({
                createdBy: createdUser.id
            });
            const createdPlant = await dbManager.createTestPlant(plant);
            const plantInstance = (0, _plantfactory.createTestPlantInstance)({
                userId: createdUser.id,
                plantId: createdPlant.id
            });
            const createdInstance = await dbManager.createTestPlantInstance(plantInstance);
            const fertilizerCare = {
                userId: createdUser.id,
                plantInstanceId: createdInstance.id,
                careType: 'fertilizer',
                careDate: new Date(),
                notes: 'Applied balanced liquid fertilizer at half strength',
                fertilizerType: 'Balanced liquid fertilizer (10-10-10)',
                images: []
            };
            const createdCare = await _carehistory.CareHistoryQueries.createCareHistory(fertilizerCare);
            expect(createdCare.careType).toBe('fertilizer');
            expect(createdCare.fertilizerType).toBe('Balanced liquid fertilizer (10-10-10)');
            expect(createdCare.potSize).toBeNull();
            expect(createdCare.soilType).toBeNull();
        });
        test('should create repotting care record with specific data', async ()=>{
            const testUser = (0, _userfactory.createTestUser)();
            const createdUser = await dbManager.createTestUser(testUser);
            const plant = (0, _plantfactory.createTestPlant)({
                createdBy: createdUser.id
            });
            const createdPlant = await dbManager.createTestPlant(plant);
            const plantInstance = (0, _plantfactory.createTestPlantInstance)({
                userId: createdUser.id,
                plantId: createdPlant.id
            });
            const createdInstance = await dbManager.createTestPlantInstance(plantInstance);
            const repotCare = {
                userId: createdUser.id,
                plantInstanceId: createdInstance.id,
                careType: 'repot',
                careDate: new Date(),
                notes: 'Repotted into larger container with fresh soil',
                potSize: '8 inch',
                soilType: 'Standard potting mix',
                images: []
            };
            const createdCare = await _carehistory.CareHistoryQueries.createCareHistory(repotCare);
            expect(createdCare.careType).toBe('repot');
            expect(createdCare.potSize).toBe('8 inch');
            expect(createdCare.soilType).toBe('Standard potting mix');
            expect(createdCare.fertilizerType).toBeNull();
        });
        test('should create water care record', async ()=>{
            const testUser = (0, _userfactory.createTestUser)();
            const createdUser = await dbManager.createTestUser(testUser);
            const plant = (0, _plantfactory.createTestPlant)({
                createdBy: createdUser.id
            });
            const createdPlant = await dbManager.createTestPlant(plant);
            const plantInstance = (0, _plantfactory.createTestPlantInstance)({
                userId: createdUser.id,
                plantId: createdPlant.id
            });
            const createdInstance = await dbManager.createTestPlantInstance(plantInstance);
            const waterCare = {
                userId: createdUser.id,
                plantInstanceId: createdInstance.id,
                careType: 'water',
                careDate: new Date(),
                notes: 'Watered thoroughly until water drained from bottom',
                images: []
            };
            const createdCare = await _carehistory.CareHistoryQueries.createCareHistory(waterCare);
            expect(createdCare.careType).toBe('water');
            expect(createdCare.notes).toBe('Watered thoroughly until water drained from bottom');
            expect(createdCare.fertilizerType).toBeNull();
            expect(createdCare.potSize).toBeNull();
            expect(createdCare.soilType).toBeNull();
        });
    });
    describe('Error Handling and Edge Cases', ()=>{
        test('should handle non-existent plant instance in care operations', async ()=>{
            const testUser = (0, _userfactory.createTestUser)();
            const createdUser = await dbManager.createTestUser(testUser);
            const careData = (0, _carefactory.createTestCareRecord)({
                userId: createdUser.id,
                plantInstanceId: 99999
            });
            // Should not crash, but may fail due to foreign key constraint
            await expect(_carehistory.CareHistoryQueries.createCareHistory(careData)).rejects.toThrow();
        });
        test('should handle unauthorized care record access', async ()=>{
            const testUser1 = (0, _userfactory.createTestUser)({
                email: 'user1@example.com'
            });
            const testUser2 = (0, _userfactory.createTestUser)({
                email: 'user2@example.com'
            });
            const createdUser1 = await dbManager.createTestUser(testUser1);
            const createdUser2 = await dbManager.createTestUser(testUser2);
            const plant = (0, _plantfactory.createTestPlant)({
                createdBy: createdUser1.id
            });
            const createdPlant = await dbManager.createTestPlant(plant);
            const plantInstance = (0, _plantfactory.createTestPlantInstance)({
                userId: createdUser1.id,
                plantId: createdPlant.id
            });
            const createdInstance = await dbManager.createTestPlantInstance(plantInstance);
            const careData = (0, _carefactory.createTestCareRecord)({
                userId: createdUser1.id,
                plantInstanceId: createdInstance.id
            });
            const createdCare = await _carehistory.CareHistoryQueries.createCareHistory(careData);
            // User 2 should not be able to update User 1's care record
            const updatedCare = await _carehistory.CareHistoryQueries.updateCareHistory(createdCare.id, createdUser2.id, {
                notes: 'Unauthorized update'
            });
            expect(updatedCare).toBeNull();
        });
        test('should handle invalid care type gracefully', async ()=>{
            const testUser = (0, _userfactory.createTestUser)();
            const createdUser = await dbManager.createTestUser(testUser);
            const plant = (0, _plantfactory.createTestPlant)({
                createdBy: createdUser.id
            });
            const createdPlant = await dbManager.createTestPlant(plant);
            const plantInstance = (0, _plantfactory.createTestPlantInstance)({
                userId: createdUser.id,
                plantId: createdPlant.id
            });
            const createdInstance = await dbManager.createTestPlantInstance(plantInstance);
            const careData = {
                userId: createdUser.id,
                plantInstanceId: createdInstance.id,
                careType: 'invalid_care_type',
                careDate: new Date(),
                notes: 'Test notes'
            };
            // Should fail due to enum constraint
            await expect(_carehistory.CareHistoryQueries.createCareHistory(careData)).rejects.toThrow();
        });
        test('should handle empty care history queries', async ()=>{
            const testUser = (0, _userfactory.createTestUser)();
            const createdUser = await dbManager.createTestUser(testUser);
            const plant = (0, _plantfactory.createTestPlant)({
                createdBy: createdUser.id
            });
            const createdPlant = await dbManager.createTestPlant(plant);
            const plantInstance = (0, _plantfactory.createTestPlantInstance)({
                userId: createdUser.id,
                plantId: createdPlant.id
            });
            const createdInstance = await dbManager.createTestPlantInstance(plantInstance);
            // No care records created
            const history = await _carehistory.CareHistoryQueries.getCareHistoryForPlant(createdInstance.id, createdUser.id);
            expect(history).toEqual([]);
            const count = await _carehistory.CareHistoryQueries.getCareHistoryCount(createdInstance.id, createdUser.id);
            expect(count).toBe(0);
        });
    });
    describe('Performance and Concurrency', ()=>{
        test('should handle concurrent care record creation', async ()=>{
            const testUser = (0, _userfactory.createTestUser)();
            const createdUser = await dbManager.createTestUser(testUser);
            const plant = (0, _plantfactory.createTestPlant)({
                createdBy: createdUser.id
            });
            const createdPlant = await dbManager.createTestPlant(plant);
            const plantInstance = (0, _plantfactory.createTestPlantInstance)({
                userId: createdUser.id,
                plantId: createdPlant.id
            });
            const createdInstance = await dbManager.createTestPlantInstance(plantInstance);
            // Create multiple care records concurrently
            const carePromises = Array.from({
                length: 5
            }, (_, index)=>{
                const careData = (0, _carefactory.createTestCareRecord)({
                    userId: createdUser.id,
                    plantInstanceId: createdInstance.id,
                    notes: `Concurrent care ${index}`
                });
                return _carehistory.CareHistoryQueries.createCareHistory(careData);
            });
            const careRecords = await Promise.all(carePromises);
            expect(careRecords.length).toBe(5);
            expect(careRecords.every((c)=>c.id)).toBe(true);
        });
        test('should handle large care history efficiently', async ()=>{
            const testUser = (0, _userfactory.createTestUser)();
            const createdUser = await dbManager.createTestUser(testUser);
            const plant = (0, _plantfactory.createTestPlant)({
                createdBy: createdUser.id
            });
            const createdPlant = await dbManager.createTestPlant(plant);
            const plantInstance = (0, _plantfactory.createTestPlantInstance)({
                userId: createdUser.id,
                plantId: createdPlant.id
            });
            const createdInstance = await dbManager.createTestPlantInstance(plantInstance);
            // Create many care records
            const careEntries = Array.from({
                length: 50
            }, (_, index)=>({
                    userId: createdUser.id,
                    plantInstanceId: createdInstance.id,
                    careType: 'water',
                    careDate: new Date(Date.now() - index * 24 * 60 * 60 * 1000),
                    notes: `Daily water ${index}`
                }));
            await _carehistory.CareHistoryQueries.bulkCreateCareHistory(careEntries);
            const startTime = Date.now();
            const history = await _carehistory.CareHistoryQueries.getCareHistoryForPlant(createdInstance.id, createdUser.id, {
                limit: 20
            });
            const queryTime = Date.now() - startTime;
            expect(history.length).toBe(20);
            expect(queryTime).toBeLessThan(1000); // Should complete within 1 second
        });
    });
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9zdGVmYW5iZWtrZXIvcHJvamVjdHMvZmFuY3ktcGxhbnRpZXMvc3JjL19fdGVzdHNfXy9kYXRhYmFzZS9jYXJlLWRhdGEtcXVlcmllcy50ZXN0LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ2FyZSBEYXRhIERhdGFiYXNlIFF1ZXJ5IFRlc3RzXG4gKiBUZXN0cyBjYXJlIHJlY29yZCBjcmVhdGlvbiwgcmV0cmlldmFsLCBjYXJlIGhpc3RvcnkgYWdncmVnYXRpb24sIGFuZCBzdGF0aXN0aWNzXG4gKi9cblxuaW1wb3J0IHsgQ2FyZUhpc3RvcnlRdWVyaWVzIH0gZnJvbSAnLi4vLi4vbGliL2RiL3F1ZXJpZXMvY2FyZS1oaXN0b3J5JztcbmltcG9ydCB7IFBsYW50UXVlcmllcyB9IGZyb20gJy4uLy4uL2xpYi9kYi9xdWVyaWVzL3BsYW50cyc7XG5pbXBvcnQgeyBQbGFudEluc3RhbmNlUXVlcmllcyB9IGZyb20gJy4uLy4uL2xpYi9kYi9xdWVyaWVzL3BsYW50LWluc3RhbmNlcyc7XG5pbXBvcnQgeyBjcmVhdGVEYXRhYmFzZVRlc3RNYW5hZ2VyIH0gZnJvbSAnLi4vLi4vdGVzdC11dGlscy9zZXR1cC9kYXRhYmFzZS10ZXN0LW1hbmFnZXInO1xuaW1wb3J0IHsgXG4gIGNyZWF0ZVRlc3RDYXJlUmVjb3JkLFxuICBjcmVhdGVUZXN0RmVydGlsaXplclJlY29yZCxcbiAgY3JlYXRlVGVzdFdhdGVyaW5nUmVjb3JkLFxuICBjcmVhdGVUZXN0UmVwb3R0aW5nUmVjb3JkLFxuICBjcmVhdGVUZXN0Q2FyZUhpc3RvcnksXG4gIGNyZWF0ZVJlYWxpc3RpY0NhcmVTY2hlZHVsZSxcbiAgcmVzZXRDYXJlQ291bnRlclxufSBmcm9tICcuLi8uLi90ZXN0LXV0aWxzL2ZhY3Rvcmllcy9jYXJlLWZhY3RvcnknO1xuaW1wb3J0IHsgY3JlYXRlVGVzdFVzZXIsIHJlc2V0VXNlckNvdW50ZXIgfSBmcm9tICcuLi8uLi90ZXN0LXV0aWxzL2ZhY3Rvcmllcy91c2VyLWZhY3RvcnknO1xuaW1wb3J0IHsgY3JlYXRlVGVzdFBsYW50LCBjcmVhdGVUZXN0UGxhbnRJbnN0YW5jZSwgcmVzZXRQbGFudENvdW50ZXJzIH0gZnJvbSAnLi4vLi4vdGVzdC11dGlscy9mYWN0b3JpZXMvcGxhbnQtZmFjdG9yeSc7XG5cbmRlc2NyaWJlKCdDYXJlIERhdGEgRGF0YWJhc2UgUXVlcmllcycsICgpID0+IHtcbiAgbGV0IGRiTWFuYWdlcjtcblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBkYk1hbmFnZXIgPSBjcmVhdGVEYXRhYmFzZVRlc3RNYW5hZ2VyKCk7XG4gICAgcmVzZXRDYXJlQ291bnRlcigpO1xuICAgIHJlc2V0VXNlckNvdW50ZXIoKTtcbiAgICByZXNldFBsYW50Q291bnRlcnMoKTtcbiAgfSk7XG5cbiAgYWZ0ZXJFYWNoKGFzeW5jICgpID0+IHtcbiAgICBhd2FpdCBkYk1hbmFnZXIuY2xlYW51cCgpO1xuICB9KTtcblxuICBkZXNjcmliZSgnQ2FyZSBSZWNvcmQgQ1JVRCBPcGVyYXRpb25zJywgKCkgPT4ge1xuICAgIHRlc3QoJ3Nob3VsZCBjcmVhdGUgYSBuZXcgY2FyZSByZWNvcmQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB0ZXN0VXNlciA9IGNyZWF0ZVRlc3RVc2VyKCk7XG4gICAgICBjb25zdCBjcmVhdGVkVXNlciA9IGF3YWl0IGRiTWFuYWdlci5jcmVhdGVUZXN0VXNlcih0ZXN0VXNlcik7XG5cbiAgICAgIGNvbnN0IHBsYW50ID0gY3JlYXRlVGVzdFBsYW50KHsgY3JlYXRlZEJ5OiBjcmVhdGVkVXNlci5pZCB9KTtcbiAgICAgIGNvbnN0IGNyZWF0ZWRQbGFudCA9IGF3YWl0IGRiTWFuYWdlci5jcmVhdGVUZXN0UGxhbnQocGxhbnQpO1xuXG4gICAgICBjb25zdCBwbGFudEluc3RhbmNlID0gY3JlYXRlVGVzdFBsYW50SW5zdGFuY2Uoe1xuICAgICAgICB1c2VySWQ6IGNyZWF0ZWRVc2VyLmlkLFxuICAgICAgICBwbGFudElkOiBjcmVhdGVkUGxhbnQuaWQsXG4gICAgICB9KTtcbiAgICAgIGNvbnN0IGNyZWF0ZWRJbnN0YW5jZSA9IGF3YWl0IGRiTWFuYWdlci5jcmVhdGVUZXN0UGxhbnRJbnN0YW5jZShwbGFudEluc3RhbmNlKTtcblxuICAgICAgY29uc3QgY2FyZURhdGEgPSB7XG4gICAgICAgIHVzZXJJZDogY3JlYXRlZFVzZXIuaWQsXG4gICAgICAgIHBsYW50SW5zdGFuY2VJZDogY3JlYXRlZEluc3RhbmNlLmlkLFxuICAgICAgICBjYXJlVHlwZTogJ2ZlcnRpbGl6ZXInLFxuICAgICAgICBjYXJlRGF0ZTogbmV3IERhdGUoKSxcbiAgICAgICAgbm90ZXM6ICdBcHBsaWVkIGJhbGFuY2VkIGxpcXVpZCBmZXJ0aWxpemVyJyxcbiAgICAgICAgZmVydGlsaXplclR5cGU6ICdCYWxhbmNlZCBsaXF1aWQgZmVydGlsaXplciAoMTAtMTAtMTApJyxcbiAgICAgICAgaW1hZ2VzOiBbXSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IGNhcmVSZWNvcmQgPSBhd2FpdCBDYXJlSGlzdG9yeVF1ZXJpZXMuY3JlYXRlQ2FyZUhpc3RvcnkoY2FyZURhdGEpO1xuXG4gICAgICBleHBlY3QoY2FyZVJlY29yZCkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChjYXJlUmVjb3JkLmlkKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KGNhcmVSZWNvcmQudXNlcklkKS50b0JlKGNyZWF0ZWRVc2VyLmlkKTtcbiAgICAgIGV4cGVjdChjYXJlUmVjb3JkLnBsYW50SW5zdGFuY2VJZCkudG9CZShjcmVhdGVkSW5zdGFuY2UuaWQpO1xuICAgICAgZXhwZWN0KGNhcmVSZWNvcmQuY2FyZVR5cGUpLnRvQmUoJ2ZlcnRpbGl6ZXInKTtcbiAgICAgIGV4cGVjdChjYXJlUmVjb3JkLm5vdGVzKS50b0JlKCdBcHBsaWVkIGJhbGFuY2VkIGxpcXVpZCBmZXJ0aWxpemVyJyk7XG4gICAgICBleHBlY3QoY2FyZVJlY29yZC5mZXJ0aWxpemVyVHlwZSkudG9CZSgnQmFsYW5jZWQgbGlxdWlkIGZlcnRpbGl6ZXIgKDEwLTEwLTEwKScpO1xuICAgICAgZXhwZWN0KGNhcmVSZWNvcmQuY3JlYXRlZEF0KS50b0JlSW5zdGFuY2VPZihEYXRlKTtcbiAgICAgIGV4cGVjdChjYXJlUmVjb3JkLnVwZGF0ZWRBdCkudG9CZUluc3RhbmNlT2YoRGF0ZSk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgcmV0cmlldmUgY2FyZSByZWNvcmQgYnkgSUQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB0ZXN0VXNlciA9IGNyZWF0ZVRlc3RVc2VyKCk7XG4gICAgICBjb25zdCBjcmVhdGVkVXNlciA9IGF3YWl0IGRiTWFuYWdlci5jcmVhdGVUZXN0VXNlcih0ZXN0VXNlcik7XG5cbiAgICAgIGNvbnN0IHBsYW50ID0gY3JlYXRlVGVzdFBsYW50KHsgY3JlYXRlZEJ5OiBjcmVhdGVkVXNlci5pZCB9KTtcbiAgICAgIGNvbnN0IGNyZWF0ZWRQbGFudCA9IGF3YWl0IGRiTWFuYWdlci5jcmVhdGVUZXN0UGxhbnQocGxhbnQpO1xuXG4gICAgICBjb25zdCBwbGFudEluc3RhbmNlID0gY3JlYXRlVGVzdFBsYW50SW5zdGFuY2Uoe1xuICAgICAgICB1c2VySWQ6IGNyZWF0ZWRVc2VyLmlkLFxuICAgICAgICBwbGFudElkOiBjcmVhdGVkUGxhbnQuaWQsXG4gICAgICB9KTtcbiAgICAgIGNvbnN0IGNyZWF0ZWRJbnN0YW5jZSA9IGF3YWl0IGRiTWFuYWdlci5jcmVhdGVUZXN0UGxhbnRJbnN0YW5jZShwbGFudEluc3RhbmNlKTtcblxuICAgICAgY29uc3QgY2FyZURhdGEgPSBjcmVhdGVUZXN0Q2FyZVJlY29yZCh7XG4gICAgICAgIHVzZXJJZDogY3JlYXRlZFVzZXIuaWQsXG4gICAgICAgIHBsYW50SW5zdGFuY2VJZDogY3JlYXRlZEluc3RhbmNlLmlkLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IGNyZWF0ZWRDYXJlID0gYXdhaXQgQ2FyZUhpc3RvcnlRdWVyaWVzLmNyZWF0ZUNhcmVIaXN0b3J5KGNhcmVEYXRhKTtcbiAgICAgIGNvbnN0IGZvdW5kQ2FyZSA9IGF3YWl0IENhcmVIaXN0b3J5UXVlcmllcy5nZXRDYXJlSGlzdG9yeUJ5SWQoY3JlYXRlZENhcmUuaWQpO1xuXG4gICAgICBleHBlY3QoZm91bmRDYXJlKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KGZvdW5kQ2FyZS5pZCkudG9CZShjcmVhdGVkQ2FyZS5pZCk7XG4gICAgICBleHBlY3QoZm91bmRDYXJlLmNhcmVUeXBlKS50b0JlKGNyZWF0ZWRDYXJlLmNhcmVUeXBlKTtcbiAgICAgIGV4cGVjdChmb3VuZENhcmUubm90ZXMpLnRvQmUoY3JlYXRlZENhcmUubm90ZXMpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIHJldHVybiBudWxsIGZvciBub24tZXhpc3RlbnQgY2FyZSByZWNvcmQgSUQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjYXJlUmVjb3JkID0gYXdhaXQgQ2FyZUhpc3RvcnlRdWVyaWVzLmdldENhcmVIaXN0b3J5QnlJZCg5OTk5OSk7XG4gICAgICBleHBlY3QoY2FyZVJlY29yZCkudG9CZU51bGwoKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCB1cGRhdGUgY2FyZSByZWNvcmQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB0ZXN0VXNlciA9IGNyZWF0ZVRlc3RVc2VyKCk7XG4gICAgICBjb25zdCBjcmVhdGVkVXNlciA9IGF3YWl0IGRiTWFuYWdlci5jcmVhdGVUZXN0VXNlcih0ZXN0VXNlcik7XG5cbiAgICAgIGNvbnN0IHBsYW50ID0gY3JlYXRlVGVzdFBsYW50KHsgY3JlYXRlZEJ5OiBjcmVhdGVkVXNlci5pZCB9KTtcbiAgICAgIGNvbnN0IGNyZWF0ZWRQbGFudCA9IGF3YWl0IGRiTWFuYWdlci5jcmVhdGVUZXN0UGxhbnQocGxhbnQpO1xuXG4gICAgICBjb25zdCBwbGFudEluc3RhbmNlID0gY3JlYXRlVGVzdFBsYW50SW5zdGFuY2Uoe1xuICAgICAgICB1c2VySWQ6IGNyZWF0ZWRVc2VyLmlkLFxuICAgICAgICBwbGFudElkOiBjcmVhdGVkUGxhbnQuaWQsXG4gICAgICB9KTtcbiAgICAgIGNvbnN0IGNyZWF0ZWRJbnN0YW5jZSA9IGF3YWl0IGRiTWFuYWdlci5jcmVhdGVUZXN0UGxhbnRJbnN0YW5jZShwbGFudEluc3RhbmNlKTtcblxuICAgICAgY29uc3QgY2FyZURhdGEgPSBjcmVhdGVUZXN0Q2FyZVJlY29yZCh7XG4gICAgICAgIHVzZXJJZDogY3JlYXRlZFVzZXIuaWQsXG4gICAgICAgIHBsYW50SW5zdGFuY2VJZDogY3JlYXRlZEluc3RhbmNlLmlkLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IGNyZWF0ZWRDYXJlID0gYXdhaXQgQ2FyZUhpc3RvcnlRdWVyaWVzLmNyZWF0ZUNhcmVIaXN0b3J5KGNhcmVEYXRhKTtcblxuICAgICAgY29uc3QgdXBkYXRlcyA9IHtcbiAgICAgICAgbm90ZXM6ICdVcGRhdGVkIGNhcmUgbm90ZXMnLFxuICAgICAgICBmZXJ0aWxpemVyVHlwZTogJ1VwZGF0ZWQgZmVydGlsaXplciB0eXBlJyxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHVwZGF0ZWRDYXJlID0gYXdhaXQgQ2FyZUhpc3RvcnlRdWVyaWVzLnVwZGF0ZUNhcmVIaXN0b3J5KFxuICAgICAgICBjcmVhdGVkQ2FyZS5pZCxcbiAgICAgICAgY3JlYXRlZFVzZXIuaWQsXG4gICAgICAgIHVwZGF0ZXNcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdCh1cGRhdGVkQ2FyZSkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdCh1cGRhdGVkQ2FyZS5ub3RlcykudG9CZSgnVXBkYXRlZCBjYXJlIG5vdGVzJyk7XG4gICAgICBleHBlY3QodXBkYXRlZENhcmUuZmVydGlsaXplclR5cGUpLnRvQmUoJ1VwZGF0ZWQgZmVydGlsaXplciB0eXBlJyk7XG4gICAgICBleHBlY3QodXBkYXRlZENhcmUudXBkYXRlZEF0LmdldFRpbWUoKSkudG9CZUdyZWF0ZXJUaGFuKGNyZWF0ZWRDYXJlLnVwZGF0ZWRBdC5nZXRUaW1lKCkpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIGRlbGV0ZSBjYXJlIHJlY29yZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHRlc3RVc2VyID0gY3JlYXRlVGVzdFVzZXIoKTtcbiAgICAgIGNvbnN0IGNyZWF0ZWRVc2VyID0gYXdhaXQgZGJNYW5hZ2VyLmNyZWF0ZVRlc3RVc2VyKHRlc3RVc2VyKTtcblxuICAgICAgY29uc3QgcGxhbnQgPSBjcmVhdGVUZXN0UGxhbnQoeyBjcmVhdGVkQnk6IGNyZWF0ZWRVc2VyLmlkIH0pO1xuICAgICAgY29uc3QgY3JlYXRlZFBsYW50ID0gYXdhaXQgZGJNYW5hZ2VyLmNyZWF0ZVRlc3RQbGFudChwbGFudCk7XG5cbiAgICAgIGNvbnN0IHBsYW50SW5zdGFuY2UgPSBjcmVhdGVUZXN0UGxhbnRJbnN0YW5jZSh7XG4gICAgICAgIHVzZXJJZDogY3JlYXRlZFVzZXIuaWQsXG4gICAgICAgIHBsYW50SWQ6IGNyZWF0ZWRQbGFudC5pZCxcbiAgICAgIH0pO1xuICAgICAgY29uc3QgY3JlYXRlZEluc3RhbmNlID0gYXdhaXQgZGJNYW5hZ2VyLmNyZWF0ZVRlc3RQbGFudEluc3RhbmNlKHBsYW50SW5zdGFuY2UpO1xuXG4gICAgICBjb25zdCBjYXJlRGF0YSA9IGNyZWF0ZVRlc3RDYXJlUmVjb3JkKHtcbiAgICAgICAgdXNlcklkOiBjcmVhdGVkVXNlci5pZCxcbiAgICAgICAgcGxhbnRJbnN0YW5jZUlkOiBjcmVhdGVkSW5zdGFuY2UuaWQsXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgY3JlYXRlZENhcmUgPSBhd2FpdCBDYXJlSGlzdG9yeVF1ZXJpZXMuY3JlYXRlQ2FyZUhpc3RvcnkoY2FyZURhdGEpO1xuXG4gICAgICBjb25zdCBkZWxldGVkID0gYXdhaXQgQ2FyZUhpc3RvcnlRdWVyaWVzLmRlbGV0ZUNhcmVIaXN0b3J5KGNyZWF0ZWRDYXJlLmlkLCBjcmVhdGVkVXNlci5pZCk7XG4gICAgICBleHBlY3QoZGVsZXRlZCkudG9CZSh0cnVlKTtcblxuICAgICAgY29uc3QgZm91bmRDYXJlID0gYXdhaXQgQ2FyZUhpc3RvcnlRdWVyaWVzLmdldENhcmVIaXN0b3J5QnlJZChjcmVhdGVkQ2FyZS5pZCk7XG4gICAgICBleHBlY3QoZm91bmRDYXJlKS50b0JlTnVsbCgpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnQ2FyZSBIaXN0b3J5IFJldHJpZXZhbCBhbmQgRmlsdGVyaW5nJywgKCkgPT4ge1xuICAgIHRlc3QoJ3Nob3VsZCBnZXQgY2FyZSBoaXN0b3J5IGZvciBhIHNwZWNpZmljIHBsYW50IGluc3RhbmNlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdGVzdFVzZXIgPSBjcmVhdGVUZXN0VXNlcigpO1xuICAgICAgY29uc3QgY3JlYXRlZFVzZXIgPSBhd2FpdCBkYk1hbmFnZXIuY3JlYXRlVGVzdFVzZXIodGVzdFVzZXIpO1xuXG4gICAgICBjb25zdCBwbGFudCA9IGNyZWF0ZVRlc3RQbGFudCh7IGNyZWF0ZWRCeTogY3JlYXRlZFVzZXIuaWQgfSk7XG4gICAgICBjb25zdCBjcmVhdGVkUGxhbnQgPSBhd2FpdCBkYk1hbmFnZXIuY3JlYXRlVGVzdFBsYW50KHBsYW50KTtcblxuICAgICAgY29uc3QgcGxhbnRJbnN0YW5jZSA9IGNyZWF0ZVRlc3RQbGFudEluc3RhbmNlKHtcbiAgICAgICAgdXNlcklkOiBjcmVhdGVkVXNlci5pZCxcbiAgICAgICAgcGxhbnRJZDogY3JlYXRlZFBsYW50LmlkLFxuICAgICAgfSk7XG4gICAgICBjb25zdCBjcmVhdGVkSW5zdGFuY2UgPSBhd2FpdCBkYk1hbmFnZXIuY3JlYXRlVGVzdFBsYW50SW5zdGFuY2UocGxhbnRJbnN0YW5jZSk7XG5cbiAgICAgIC8vIENyZWF0ZSBtdWx0aXBsZSBjYXJlIHJlY29yZHNcbiAgICAgIGNvbnN0IGNhcmVSZWNvcmRzID0gW1xuICAgICAgICBjcmVhdGVUZXN0Q2FyZVJlY29yZCh7XG4gICAgICAgICAgdXNlcklkOiBjcmVhdGVkVXNlci5pZCxcbiAgICAgICAgICBwbGFudEluc3RhbmNlSWQ6IGNyZWF0ZWRJbnN0YW5jZS5pZCxcbiAgICAgICAgICBjYXJlVHlwZTogJ2ZlcnRpbGl6ZXInLFxuICAgICAgICB9KSxcbiAgICAgICAgY3JlYXRlVGVzdENhcmVSZWNvcmQoe1xuICAgICAgICAgIHVzZXJJZDogY3JlYXRlZFVzZXIuaWQsXG4gICAgICAgICAgcGxhbnRJbnN0YW5jZUlkOiBjcmVhdGVkSW5zdGFuY2UuaWQsXG4gICAgICAgICAgY2FyZVR5cGU6ICd3YXRlcicsXG4gICAgICAgIH0pLFxuICAgICAgICBjcmVhdGVUZXN0Q2FyZVJlY29yZCh7XG4gICAgICAgICAgdXNlcklkOiBjcmVhdGVkVXNlci5pZCxcbiAgICAgICAgICBwbGFudEluc3RhbmNlSWQ6IGNyZWF0ZWRJbnN0YW5jZS5pZCxcbiAgICAgICAgICBjYXJlVHlwZTogJ3BydW5lJyxcbiAgICAgICAgfSksXG4gICAgICBdO1xuXG4gICAgICBmb3IgKGNvbnN0IGNhcmUgb2YgY2FyZVJlY29yZHMpIHtcbiAgICAgICAgYXdhaXQgQ2FyZUhpc3RvcnlRdWVyaWVzLmNyZWF0ZUNhcmVIaXN0b3J5KGNhcmUpO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBoaXN0b3J5ID0gYXdhaXQgQ2FyZUhpc3RvcnlRdWVyaWVzLmdldENhcmVIaXN0b3J5Rm9yUGxhbnQoXG4gICAgICAgIGNyZWF0ZWRJbnN0YW5jZS5pZCxcbiAgICAgICAgY3JlYXRlZFVzZXIuaWRcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChoaXN0b3J5Lmxlbmd0aCkudG9CZSgzKTtcbiAgICAgIGV4cGVjdChoaXN0b3J5LmV2ZXJ5KGggPT4gaC5wbGFudEluc3RhbmNlSWQgPT09IGNyZWF0ZWRJbnN0YW5jZS5pZCkpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QoaGlzdG9yeS5ldmVyeShoID0+IGgudXNlcklkID09PSBjcmVhdGVkVXNlci5pZCkpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgZmlsdGVyIGNhcmUgaGlzdG9yeSBieSBjYXJlIHR5cGUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB0ZXN0VXNlciA9IGNyZWF0ZVRlc3RVc2VyKCk7XG4gICAgICBjb25zdCBjcmVhdGVkVXNlciA9IGF3YWl0IGRiTWFuYWdlci5jcmVhdGVUZXN0VXNlcih0ZXN0VXNlcik7XG5cbiAgICAgIGNvbnN0IHBsYW50ID0gY3JlYXRlVGVzdFBsYW50KHsgY3JlYXRlZEJ5OiBjcmVhdGVkVXNlci5pZCB9KTtcbiAgICAgIGNvbnN0IGNyZWF0ZWRQbGFudCA9IGF3YWl0IGRiTWFuYWdlci5jcmVhdGVUZXN0UGxhbnQocGxhbnQpO1xuXG4gICAgICBjb25zdCBwbGFudEluc3RhbmNlID0gY3JlYXRlVGVzdFBsYW50SW5zdGFuY2Uoe1xuICAgICAgICB1c2VySWQ6IGNyZWF0ZWRVc2VyLmlkLFxuICAgICAgICBwbGFudElkOiBjcmVhdGVkUGxhbnQuaWQsXG4gICAgICB9KTtcbiAgICAgIGNvbnN0IGNyZWF0ZWRJbnN0YW5jZSA9IGF3YWl0IGRiTWFuYWdlci5jcmVhdGVUZXN0UGxhbnRJbnN0YW5jZShwbGFudEluc3RhbmNlKTtcblxuICAgICAgLy8gQ3JlYXRlIGNhcmUgcmVjb3JkcyBvZiBkaWZmZXJlbnQgdHlwZXNcbiAgICAgIGNvbnN0IGZlcnRpbGl6ZXJDYXJlID0gY3JlYXRlVGVzdENhcmVSZWNvcmQoe1xuICAgICAgICB1c2VySWQ6IGNyZWF0ZWRVc2VyLmlkLFxuICAgICAgICBwbGFudEluc3RhbmNlSWQ6IGNyZWF0ZWRJbnN0YW5jZS5pZCxcbiAgICAgICAgY2FyZVR5cGU6ICdmZXJ0aWxpemVyJyxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCB3YXRlckNhcmUgPSBjcmVhdGVUZXN0Q2FyZVJlY29yZCh7XG4gICAgICAgIHVzZXJJZDogY3JlYXRlZFVzZXIuaWQsXG4gICAgICAgIHBsYW50SW5zdGFuY2VJZDogY3JlYXRlZEluc3RhbmNlLmlkLFxuICAgICAgICBjYXJlVHlwZTogJ3dhdGVyJyxcbiAgICAgIH0pO1xuXG4gICAgICBhd2FpdCBDYXJlSGlzdG9yeVF1ZXJpZXMuY3JlYXRlQ2FyZUhpc3RvcnkoZmVydGlsaXplckNhcmUpO1xuICAgICAgYXdhaXQgQ2FyZUhpc3RvcnlRdWVyaWVzLmNyZWF0ZUNhcmVIaXN0b3J5KHdhdGVyQ2FyZSk7XG5cbiAgICAgIC8vIEZpbHRlciBieSBmZXJ0aWxpemVyIHR5cGVcbiAgICAgIGNvbnN0IGZlcnRpbGl6ZXJIaXN0b3J5ID0gYXdhaXQgQ2FyZUhpc3RvcnlRdWVyaWVzLmdldENhcmVIaXN0b3J5Rm9yUGxhbnQoXG4gICAgICAgIGNyZWF0ZWRJbnN0YW5jZS5pZCxcbiAgICAgICAgY3JlYXRlZFVzZXIuaWQsXG4gICAgICAgIHsgY2FyZVR5cGU6ICdmZXJ0aWxpemVyJyB9XG4gICAgICApO1xuXG4gICAgICBleHBlY3QoZmVydGlsaXplckhpc3RvcnkubGVuZ3RoKS50b0JlKDEpO1xuICAgICAgZXhwZWN0KGZlcnRpbGl6ZXJIaXN0b3J5WzBdLmNhcmVUeXBlKS50b0JlKCdmZXJ0aWxpemVyJyk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgZmlsdGVyIGNhcmUgaGlzdG9yeSBieSBkYXRlIHJhbmdlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdGVzdFVzZXIgPSBjcmVhdGVUZXN0VXNlcigpO1xuICAgICAgY29uc3QgY3JlYXRlZFVzZXIgPSBhd2FpdCBkYk1hbmFnZXIuY3JlYXRlVGVzdFVzZXIodGVzdFVzZXIpO1xuXG4gICAgICBjb25zdCBwbGFudCA9IGNyZWF0ZVRlc3RQbGFudCh7IGNyZWF0ZWRCeTogY3JlYXRlZFVzZXIuaWQgfSk7XG4gICAgICBjb25zdCBjcmVhdGVkUGxhbnQgPSBhd2FpdCBkYk1hbmFnZXIuY3JlYXRlVGVzdFBsYW50KHBsYW50KTtcblxuICAgICAgY29uc3QgcGxhbnRJbnN0YW5jZSA9IGNyZWF0ZVRlc3RQbGFudEluc3RhbmNlKHtcbiAgICAgICAgdXNlcklkOiBjcmVhdGVkVXNlci5pZCxcbiAgICAgICAgcGxhbnRJZDogY3JlYXRlZFBsYW50LmlkLFxuICAgICAgfSk7XG4gICAgICBjb25zdCBjcmVhdGVkSW5zdGFuY2UgPSBhd2FpdCBkYk1hbmFnZXIuY3JlYXRlVGVzdFBsYW50SW5zdGFuY2UocGxhbnRJbnN0YW5jZSk7XG5cbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG4gICAgICBjb25zdCBvbmVXZWVrQWdvID0gbmV3IERhdGUobm93LmdldFRpbWUoKSAtIDcgKiAyNCAqIDYwICogNjAgKiAxMDAwKTtcbiAgICAgIGNvbnN0IHR3b1dlZWtzQWdvID0gbmV3IERhdGUobm93LmdldFRpbWUoKSAtIDE0ICogMjQgKiA2MCAqIDYwICogMTAwMCk7XG5cbiAgICAgIC8vIENyZWF0ZSBjYXJlIHJlY29yZHMgd2l0aCBkaWZmZXJlbnQgZGF0ZXNcbiAgICAgIGNvbnN0IHJlY2VudENhcmUgPSBjcmVhdGVUZXN0Q2FyZVJlY29yZCh7XG4gICAgICAgIHVzZXJJZDogY3JlYXRlZFVzZXIuaWQsXG4gICAgICAgIHBsYW50SW5zdGFuY2VJZDogY3JlYXRlZEluc3RhbmNlLmlkLFxuICAgICAgICBjYXJlRGF0ZTogbm93LFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IG9sZENhcmUgPSBjcmVhdGVUZXN0Q2FyZVJlY29yZCh7XG4gICAgICAgIHVzZXJJZDogY3JlYXRlZFVzZXIuaWQsXG4gICAgICAgIHBsYW50SW5zdGFuY2VJZDogY3JlYXRlZEluc3RhbmNlLmlkLFxuICAgICAgICBjYXJlRGF0ZTogdHdvV2Vla3NBZ28sXG4gICAgICB9KTtcblxuICAgICAgYXdhaXQgQ2FyZUhpc3RvcnlRdWVyaWVzLmNyZWF0ZUNhcmVIaXN0b3J5KHJlY2VudENhcmUpO1xuICAgICAgYXdhaXQgQ2FyZUhpc3RvcnlRdWVyaWVzLmNyZWF0ZUNhcmVIaXN0b3J5KG9sZENhcmUpO1xuXG4gICAgICAvLyBGaWx0ZXIgYnkgZGF0ZSByYW5nZSAobGFzdCB3ZWVrKVxuICAgICAgY29uc3QgcmVjZW50SGlzdG9yeSA9IGF3YWl0IENhcmVIaXN0b3J5UXVlcmllcy5nZXRDYXJlSGlzdG9yeUZvclBsYW50KFxuICAgICAgICBjcmVhdGVkSW5zdGFuY2UuaWQsXG4gICAgICAgIGNyZWF0ZWRVc2VyLmlkLFxuICAgICAgICB7IFxuICAgICAgICAgIHN0YXJ0RGF0ZTogb25lV2Vla0FnbyxcbiAgICAgICAgICBlbmREYXRlOiBub3cgXG4gICAgICAgIH1cbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChyZWNlbnRIaXN0b3J5Lmxlbmd0aCkudG9CZSgxKTtcbiAgICAgIGV4cGVjdChyZWNlbnRIaXN0b3J5WzBdLmNhcmVEYXRlLmdldFRpbWUoKSkudG9CZUdyZWF0ZXJUaGFuT3JFcXVhbChvbmVXZWVrQWdvLmdldFRpbWUoKSk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgZ2V0IHJlY2VudCBjYXJlIGhpc3RvcnkgZm9yIHVzZXInLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB0ZXN0VXNlciA9IGNyZWF0ZVRlc3RVc2VyKCk7XG4gICAgICBjb25zdCBjcmVhdGVkVXNlciA9IGF3YWl0IGRiTWFuYWdlci5jcmVhdGVUZXN0VXNlcih0ZXN0VXNlcik7XG5cbiAgICAgIGNvbnN0IHBsYW50ID0gY3JlYXRlVGVzdFBsYW50KHsgY3JlYXRlZEJ5OiBjcmVhdGVkVXNlci5pZCB9KTtcbiAgICAgIGNvbnN0IGNyZWF0ZWRQbGFudCA9IGF3YWl0IGRiTWFuYWdlci5jcmVhdGVUZXN0UGxhbnQocGxhbnQpO1xuXG4gICAgICAvLyBDcmVhdGUgbXVsdGlwbGUgcGxhbnQgaW5zdGFuY2VzXG4gICAgICBjb25zdCBpbnN0YW5jZTEgPSBjcmVhdGVUZXN0UGxhbnRJbnN0YW5jZSh7XG4gICAgICAgIHVzZXJJZDogY3JlYXRlZFVzZXIuaWQsXG4gICAgICAgIHBsYW50SWQ6IGNyZWF0ZWRQbGFudC5pZCxcbiAgICAgIH0pO1xuICAgICAgY29uc3QgaW5zdGFuY2UyID0gY3JlYXRlVGVzdFBsYW50SW5zdGFuY2Uoe1xuICAgICAgICB1c2VySWQ6IGNyZWF0ZWRVc2VyLmlkLFxuICAgICAgICBwbGFudElkOiBjcmVhdGVkUGxhbnQuaWQsXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgY3JlYXRlZEluc3RhbmNlMSA9IGF3YWl0IGRiTWFuYWdlci5jcmVhdGVUZXN0UGxhbnRJbnN0YW5jZShpbnN0YW5jZTEpO1xuICAgICAgY29uc3QgY3JlYXRlZEluc3RhbmNlMiA9IGF3YWl0IGRiTWFuYWdlci5jcmVhdGVUZXN0UGxhbnRJbnN0YW5jZShpbnN0YW5jZTIpO1xuXG4gICAgICAvLyBDcmVhdGUgY2FyZSByZWNvcmRzIGZvciBib3RoIGluc3RhbmNlc1xuICAgICAgY29uc3QgY2FyZTEgPSBjcmVhdGVUZXN0Q2FyZVJlY29yZCh7XG4gICAgICAgIHVzZXJJZDogY3JlYXRlZFVzZXIuaWQsXG4gICAgICAgIHBsYW50SW5zdGFuY2VJZDogY3JlYXRlZEluc3RhbmNlMS5pZCxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBjYXJlMiA9IGNyZWF0ZVRlc3RDYXJlUmVjb3JkKHtcbiAgICAgICAgdXNlcklkOiBjcmVhdGVkVXNlci5pZCxcbiAgICAgICAgcGxhbnRJbnN0YW5jZUlkOiBjcmVhdGVkSW5zdGFuY2UyLmlkLFxuICAgICAgfSk7XG5cbiAgICAgIGF3YWl0IENhcmVIaXN0b3J5UXVlcmllcy5jcmVhdGVDYXJlSGlzdG9yeShjYXJlMSk7XG4gICAgICBhd2FpdCBDYXJlSGlzdG9yeVF1ZXJpZXMuY3JlYXRlQ2FyZUhpc3RvcnkoY2FyZTIpO1xuXG4gICAgICBjb25zdCByZWNlbnRIaXN0b3J5ID0gYXdhaXQgQ2FyZUhpc3RvcnlRdWVyaWVzLmdldFJlY2VudENhcmVIaXN0b3J5KGNyZWF0ZWRVc2VyLmlkLCAxMCk7XG5cbiAgICAgIGV4cGVjdChyZWNlbnRIaXN0b3J5Lmxlbmd0aCkudG9CZSgyKTtcbiAgICAgIGV4cGVjdChyZWNlbnRIaXN0b3J5LmV2ZXJ5KGggPT4gaC51c2VySWQgPT09IGNyZWF0ZWRVc2VyLmlkKSkudG9CZSh0cnVlKTtcbiAgICAgIC8vIFNob3VsZCBiZSBzb3J0ZWQgYnkgZGF0ZSAobW9zdCByZWNlbnQgZmlyc3QpXG4gICAgICBleHBlY3QocmVjZW50SGlzdG9yeVswXS5jYXJlRGF0ZS5nZXRUaW1lKCkpLnRvQmVHcmVhdGVyVGhhbk9yRXF1YWwocmVjZW50SGlzdG9yeVsxXS5jYXJlRGF0ZS5nZXRUaW1lKCkpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnQ2FyZSBTdGF0aXN0aWNzIGFuZCBBZ2dyZWdhdGlvbicsICgpID0+IHtcbiAgICB0ZXN0KCdzaG91bGQgZ2V0IGNhcmUgaGlzdG9yeSBjb3VudCBmb3IgcGxhbnQgaW5zdGFuY2UnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB0ZXN0VXNlciA9IGNyZWF0ZVRlc3RVc2VyKCk7XG4gICAgICBjb25zdCBjcmVhdGVkVXNlciA9IGF3YWl0IGRiTWFuYWdlci5jcmVhdGVUZXN0VXNlcih0ZXN0VXNlcik7XG5cbiAgICAgIGNvbnN0IHBsYW50ID0gY3JlYXRlVGVzdFBsYW50KHsgY3JlYXRlZEJ5OiBjcmVhdGVkVXNlci5pZCB9KTtcbiAgICAgIGNvbnN0IGNyZWF0ZWRQbGFudCA9IGF3YWl0IGRiTWFuYWdlci5jcmVhdGVUZXN0UGxhbnQocGxhbnQpO1xuXG4gICAgICBjb25zdCBwbGFudEluc3RhbmNlID0gY3JlYXRlVGVzdFBsYW50SW5zdGFuY2Uoe1xuICAgICAgICB1c2VySWQ6IGNyZWF0ZWRVc2VyLmlkLFxuICAgICAgICBwbGFudElkOiBjcmVhdGVkUGxhbnQuaWQsXG4gICAgICB9KTtcbiAgICAgIGNvbnN0IGNyZWF0ZWRJbnN0YW5jZSA9IGF3YWl0IGRiTWFuYWdlci5jcmVhdGVUZXN0UGxhbnRJbnN0YW5jZShwbGFudEluc3RhbmNlKTtcblxuICAgICAgLy8gQ3JlYXRlIG11bHRpcGxlIGNhcmUgcmVjb3Jkc1xuICAgICAgY29uc3QgY2FyZVJlY29yZHMgPSBbXG4gICAgICAgIGNyZWF0ZVRlc3RDYXJlUmVjb3JkKHtcbiAgICAgICAgICB1c2VySWQ6IGNyZWF0ZWRVc2VyLmlkLFxuICAgICAgICAgIHBsYW50SW5zdGFuY2VJZDogY3JlYXRlZEluc3RhbmNlLmlkLFxuICAgICAgICAgIGNhcmVUeXBlOiAnZmVydGlsaXplcicsXG4gICAgICAgIH0pLFxuICAgICAgICBjcmVhdGVUZXN0Q2FyZVJlY29yZCh7XG4gICAgICAgICAgdXNlcklkOiBjcmVhdGVkVXNlci5pZCxcbiAgICAgICAgICBwbGFudEluc3RhbmNlSWQ6IGNyZWF0ZWRJbnN0YW5jZS5pZCxcbiAgICAgICAgICBjYXJlVHlwZTogJ2ZlcnRpbGl6ZXInLFxuICAgICAgICB9KSxcbiAgICAgICAgY3JlYXRlVGVzdENhcmVSZWNvcmQoe1xuICAgICAgICAgIHVzZXJJZDogY3JlYXRlZFVzZXIuaWQsXG4gICAgICAgICAgcGxhbnRJbnN0YW5jZUlkOiBjcmVhdGVkSW5zdGFuY2UuaWQsXG4gICAgICAgICAgY2FyZVR5cGU6ICd3YXRlcicsXG4gICAgICAgIH0pLFxuICAgICAgXTtcblxuICAgICAgZm9yIChjb25zdCBjYXJlIG9mIGNhcmVSZWNvcmRzKSB7XG4gICAgICAgIGF3YWl0IENhcmVIaXN0b3J5UXVlcmllcy5jcmVhdGVDYXJlSGlzdG9yeShjYXJlKTtcbiAgICAgIH1cblxuICAgICAgLy8gR2V0IHRvdGFsIGNvdW50XG4gICAgICBjb25zdCB0b3RhbENvdW50ID0gYXdhaXQgQ2FyZUhpc3RvcnlRdWVyaWVzLmdldENhcmVIaXN0b3J5Q291bnQoXG4gICAgICAgIGNyZWF0ZWRJbnN0YW5jZS5pZCxcbiAgICAgICAgY3JlYXRlZFVzZXIuaWRcbiAgICAgICk7XG4gICAgICBleHBlY3QodG90YWxDb3VudCkudG9CZSgzKTtcblxuICAgICAgLy8gR2V0IGNvdW50IGJ5IGNhcmUgdHlwZVxuICAgICAgY29uc3QgZmVydGlsaXplckNvdW50ID0gYXdhaXQgQ2FyZUhpc3RvcnlRdWVyaWVzLmdldENhcmVIaXN0b3J5Q291bnQoXG4gICAgICAgIGNyZWF0ZWRJbnN0YW5jZS5pZCxcbiAgICAgICAgY3JlYXRlZFVzZXIuaWQsXG4gICAgICAgICdmZXJ0aWxpemVyJ1xuICAgICAgKTtcbiAgICAgIGV4cGVjdChmZXJ0aWxpemVyQ291bnQpLnRvQmUoMik7XG5cbiAgICAgIGNvbnN0IHdhdGVyQ291bnQgPSBhd2FpdCBDYXJlSGlzdG9yeVF1ZXJpZXMuZ2V0Q2FyZUhpc3RvcnlDb3VudChcbiAgICAgICAgY3JlYXRlZEluc3RhbmNlLmlkLFxuICAgICAgICBjcmVhdGVkVXNlci5pZCxcbiAgICAgICAgJ3dhdGVyJ1xuICAgICAgKTtcbiAgICAgIGV4cGVjdCh3YXRlckNvdW50KS50b0JlKDEpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIGdldCBsYXN0IGNhcmUgZGF0ZSBmb3Igc3BlY2lmaWMgY2FyZSB0eXBlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdGVzdFVzZXIgPSBjcmVhdGVUZXN0VXNlcigpO1xuICAgICAgY29uc3QgY3JlYXRlZFVzZXIgPSBhd2FpdCBkYk1hbmFnZXIuY3JlYXRlVGVzdFVzZXIodGVzdFVzZXIpO1xuXG4gICAgICBjb25zdCBwbGFudCA9IGNyZWF0ZVRlc3RQbGFudCh7IGNyZWF0ZWRCeTogY3JlYXRlZFVzZXIuaWQgfSk7XG4gICAgICBjb25zdCBjcmVhdGVkUGxhbnQgPSBhd2FpdCBkYk1hbmFnZXIuY3JlYXRlVGVzdFBsYW50KHBsYW50KTtcblxuICAgICAgY29uc3QgcGxhbnRJbnN0YW5jZSA9IGNyZWF0ZVRlc3RQbGFudEluc3RhbmNlKHtcbiAgICAgICAgdXNlcklkOiBjcmVhdGVkVXNlci5pZCxcbiAgICAgICAgcGxhbnRJZDogY3JlYXRlZFBsYW50LmlkLFxuICAgICAgfSk7XG4gICAgICBjb25zdCBjcmVhdGVkSW5zdGFuY2UgPSBhd2FpdCBkYk1hbmFnZXIuY3JlYXRlVGVzdFBsYW50SW5zdGFuY2UocGxhbnRJbnN0YW5jZSk7XG5cbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG4gICAgICBjb25zdCB5ZXN0ZXJkYXkgPSBuZXcgRGF0ZShub3cuZ2V0VGltZSgpIC0gMjQgKiA2MCAqIDYwICogMTAwMCk7XG5cbiAgICAgIC8vIENyZWF0ZSBjYXJlIHJlY29yZHMgd2l0aCBkaWZmZXJlbnQgZGF0ZXNcbiAgICAgIGNvbnN0IG9sZEZlcnRpbGl6ZXIgPSBjcmVhdGVUZXN0Q2FyZVJlY29yZCh7XG4gICAgICAgIHVzZXJJZDogY3JlYXRlZFVzZXIuaWQsXG4gICAgICAgIHBsYW50SW5zdGFuY2VJZDogY3JlYXRlZEluc3RhbmNlLmlkLFxuICAgICAgICBjYXJlVHlwZTogJ2ZlcnRpbGl6ZXInLFxuICAgICAgICBjYXJlRGF0ZTogeWVzdGVyZGF5LFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHJlY2VudEZlcnRpbGl6ZXIgPSBjcmVhdGVUZXN0Q2FyZVJlY29yZCh7XG4gICAgICAgIHVzZXJJZDogY3JlYXRlZFVzZXIuaWQsXG4gICAgICAgIHBsYW50SW5zdGFuY2VJZDogY3JlYXRlZEluc3RhbmNlLmlkLFxuICAgICAgICBjYXJlVHlwZTogJ2ZlcnRpbGl6ZXInLFxuICAgICAgICBjYXJlRGF0ZTogbm93LFxuICAgICAgfSk7XG5cbiAgICAgIGF3YWl0IENhcmVIaXN0b3J5UXVlcmllcy5jcmVhdGVDYXJlSGlzdG9yeShvbGRGZXJ0aWxpemVyKTtcbiAgICAgIGF3YWl0IENhcmVIaXN0b3J5UXVlcmllcy5jcmVhdGVDYXJlSGlzdG9yeShyZWNlbnRGZXJ0aWxpemVyKTtcblxuICAgICAgY29uc3QgbGFzdEZlcnRpbGl6ZXJEYXRlID0gYXdhaXQgQ2FyZUhpc3RvcnlRdWVyaWVzLmdldExhc3RDYXJlRGF0ZShcbiAgICAgICAgY3JlYXRlZEluc3RhbmNlLmlkLFxuICAgICAgICBjcmVhdGVkVXNlci5pZCxcbiAgICAgICAgJ2ZlcnRpbGl6ZXInXG4gICAgICApO1xuXG4gICAgICBleHBlY3QobGFzdEZlcnRpbGl6ZXJEYXRlKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KGxhc3RGZXJ0aWxpemVyRGF0ZS5nZXRUaW1lKCkpLnRvQmUobm93LmdldFRpbWUoKSk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgcmV0dXJuIG51bGwgZm9yIGNhcmUgdHlwZSB3aXRoIG5vIGhpc3RvcnknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB0ZXN0VXNlciA9IGNyZWF0ZVRlc3RVc2VyKCk7XG4gICAgICBjb25zdCBjcmVhdGVkVXNlciA9IGF3YWl0IGRiTWFuYWdlci5jcmVhdGVUZXN0VXNlcih0ZXN0VXNlcik7XG5cbiAgICAgIGNvbnN0IHBsYW50ID0gY3JlYXRlVGVzdFBsYW50KHsgY3JlYXRlZEJ5OiBjcmVhdGVkVXNlci5pZCB9KTtcbiAgICAgIGNvbnN0IGNyZWF0ZWRQbGFudCA9IGF3YWl0IGRiTWFuYWdlci5jcmVhdGVUZXN0UGxhbnQocGxhbnQpO1xuXG4gICAgICBjb25zdCBwbGFudEluc3RhbmNlID0gY3JlYXRlVGVzdFBsYW50SW5zdGFuY2Uoe1xuICAgICAgICB1c2VySWQ6IGNyZWF0ZWRVc2VyLmlkLFxuICAgICAgICBwbGFudElkOiBjcmVhdGVkUGxhbnQuaWQsXG4gICAgICB9KTtcbiAgICAgIGNvbnN0IGNyZWF0ZWRJbnN0YW5jZSA9IGF3YWl0IGRiTWFuYWdlci5jcmVhdGVUZXN0UGxhbnRJbnN0YW5jZShwbGFudEluc3RhbmNlKTtcblxuICAgICAgY29uc3QgbGFzdFJlcG90RGF0ZSA9IGF3YWl0IENhcmVIaXN0b3J5UXVlcmllcy5nZXRMYXN0Q2FyZURhdGUoXG4gICAgICAgIGNyZWF0ZWRJbnN0YW5jZS5pZCxcbiAgICAgICAgY3JlYXRlZFVzZXIuaWQsXG4gICAgICAgICdyZXBvdCdcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChsYXN0UmVwb3REYXRlKS50b0JlTnVsbCgpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIGdldCBjYXJlIGRhc2hib2FyZCBkYXRhIGZvciB1c2VyJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdGVzdFVzZXIgPSBjcmVhdGVUZXN0VXNlcigpO1xuICAgICAgY29uc3QgY3JlYXRlZFVzZXIgPSBhd2FpdCBkYk1hbmFnZXIuY3JlYXRlVGVzdFVzZXIodGVzdFVzZXIpO1xuXG4gICAgICBjb25zdCBwbGFudCA9IGNyZWF0ZVRlc3RQbGFudCh7IGNyZWF0ZWRCeTogY3JlYXRlZFVzZXIuaWQgfSk7XG4gICAgICBjb25zdCBjcmVhdGVkUGxhbnQgPSBhd2FpdCBkYk1hbmFnZXIuY3JlYXRlVGVzdFBsYW50KHBsYW50KTtcblxuICAgICAgLy8gQ3JlYXRlIHBsYW50IGluc3RhbmNlcyB3aXRoIGRpZmZlcmVudCBjYXJlIHN0YXR1c2VzXG4gICAgICBjb25zdCBvdmVyZHVlSW5zdGFuY2UgPSBjcmVhdGVUZXN0UGxhbnRJbnN0YW5jZSh7XG4gICAgICAgIHVzZXJJZDogY3JlYXRlZFVzZXIuaWQsXG4gICAgICAgIHBsYW50SWQ6IGNyZWF0ZWRQbGFudC5pZCxcbiAgICAgICAgZmVydGlsaXplckR1ZTogbmV3IERhdGUoRGF0ZS5ub3coKSAtIDI0ICogNjAgKiA2MCAqIDEwMDApLCAvLyAxIGRheSBvdmVyZHVlXG4gICAgICAgIGlzQWN0aXZlOiB0cnVlLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IGR1ZVRvZGF5SW5zdGFuY2UgPSBjcmVhdGVUZXN0UGxhbnRJbnN0YW5jZSh7XG4gICAgICAgIHVzZXJJZDogY3JlYXRlZFVzZXIuaWQsXG4gICAgICAgIHBsYW50SWQ6IGNyZWF0ZWRQbGFudC5pZCxcbiAgICAgICAgZmVydGlsaXplckR1ZTogbmV3IERhdGUoKSwgLy8gRHVlIHRvZGF5XG4gICAgICAgIGlzQWN0aXZlOiB0cnVlLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IGR1ZVNvb25JbnN0YW5jZSA9IGNyZWF0ZVRlc3RQbGFudEluc3RhbmNlKHtcbiAgICAgICAgdXNlcklkOiBjcmVhdGVkVXNlci5pZCxcbiAgICAgICAgcGxhbnRJZDogY3JlYXRlZFBsYW50LmlkLFxuICAgICAgICBmZXJ0aWxpemVyRHVlOiBuZXcgRGF0ZShEYXRlLm5vdygpICsgMyAqIDI0ICogNjAgKiA2MCAqIDEwMDApLCAvLyBEdWUgaW4gMyBkYXlzXG4gICAgICAgIGlzQWN0aXZlOiB0cnVlLFxuICAgICAgfSk7XG5cbiAgICAgIGF3YWl0IGRiTWFuYWdlci5jcmVhdGVUZXN0UGxhbnRJbnN0YW5jZShvdmVyZHVlSW5zdGFuY2UpO1xuICAgICAgYXdhaXQgZGJNYW5hZ2VyLmNyZWF0ZVRlc3RQbGFudEluc3RhbmNlKGR1ZVRvZGF5SW5zdGFuY2UpO1xuICAgICAgYXdhaXQgZGJNYW5hZ2VyLmNyZWF0ZVRlc3RQbGFudEluc3RhbmNlKGR1ZVNvb25JbnN0YW5jZSk7XG5cbiAgICAgIGNvbnN0IGRhc2hib2FyZERhdGEgPSBhd2FpdCBDYXJlSGlzdG9yeVF1ZXJpZXMuZ2V0Q2FyZURhc2hib2FyZERhdGEoY3JlYXRlZFVzZXIuaWQpO1xuXG4gICAgICBleHBlY3QoZGFzaGJvYXJkRGF0YSkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChkYXNoYm9hcmREYXRhLnN0YXRpc3RpY3MpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QoZGFzaGJvYXJkRGF0YS5zdGF0aXN0aWNzLnRvdGFsQWN0aXZlUGxhbnRzKS50b0JlKDMpO1xuICAgICAgZXhwZWN0KGRhc2hib2FyZERhdGEub3ZlcmR1ZS5sZW5ndGgpLnRvQmVHcmVhdGVyVGhhbk9yRXF1YWwoMSk7XG4gICAgICBleHBlY3QoZGFzaGJvYXJkRGF0YS5kdWVUb2RheS5sZW5ndGgpLnRvQmVHcmVhdGVyVGhhbk9yRXF1YWwoMSk7XG4gICAgICBleHBlY3QoZGFzaGJvYXJkRGF0YS5kdWVTb29uLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuT3JFcXVhbCgxKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0J1bGsgT3BlcmF0aW9ucycsICgpID0+IHtcbiAgICB0ZXN0KCdzaG91bGQgYnVsayBjcmVhdGUgY2FyZSBoaXN0b3J5IGVudHJpZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB0ZXN0VXNlciA9IGNyZWF0ZVRlc3RVc2VyKCk7XG4gICAgICBjb25zdCBjcmVhdGVkVXNlciA9IGF3YWl0IGRiTWFuYWdlci5jcmVhdGVUZXN0VXNlcih0ZXN0VXNlcik7XG5cbiAgICAgIGNvbnN0IHBsYW50ID0gY3JlYXRlVGVzdFBsYW50KHsgY3JlYXRlZEJ5OiBjcmVhdGVkVXNlci5pZCB9KTtcbiAgICAgIGNvbnN0IGNyZWF0ZWRQbGFudCA9IGF3YWl0IGRiTWFuYWdlci5jcmVhdGVUZXN0UGxhbnQocGxhbnQpO1xuXG4gICAgICBjb25zdCBwbGFudEluc3RhbmNlID0gY3JlYXRlVGVzdFBsYW50SW5zdGFuY2Uoe1xuICAgICAgICB1c2VySWQ6IGNyZWF0ZWRVc2VyLmlkLFxuICAgICAgICBwbGFudElkOiBjcmVhdGVkUGxhbnQuaWQsXG4gICAgICB9KTtcbiAgICAgIGNvbnN0IGNyZWF0ZWRJbnN0YW5jZSA9IGF3YWl0IGRiTWFuYWdlci5jcmVhdGVUZXN0UGxhbnRJbnN0YW5jZShwbGFudEluc3RhbmNlKTtcblxuICAgICAgY29uc3QgY2FyZUVudHJpZXMgPSBbXG4gICAgICAgIHtcbiAgICAgICAgICB1c2VySWQ6IGNyZWF0ZWRVc2VyLmlkLFxuICAgICAgICAgIHBsYW50SW5zdGFuY2VJZDogY3JlYXRlZEluc3RhbmNlLmlkLFxuICAgICAgICAgIGNhcmVUeXBlOiAnZmVydGlsaXplcicsXG4gICAgICAgICAgY2FyZURhdGU6IG5ldyBEYXRlKCksXG4gICAgICAgICAgbm90ZXM6ICdCdWxrIGZlcnRpbGl6ZXIgMScsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICB1c2VySWQ6IGNyZWF0ZWRVc2VyLmlkLFxuICAgICAgICAgIHBsYW50SW5zdGFuY2VJZDogY3JlYXRlZEluc3RhbmNlLmlkLFxuICAgICAgICAgIGNhcmVUeXBlOiAnd2F0ZXInLFxuICAgICAgICAgIGNhcmVEYXRlOiBuZXcgRGF0ZSgpLFxuICAgICAgICAgIG5vdGVzOiAnQnVsayB3YXRlciAxJyxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHVzZXJJZDogY3JlYXRlZFVzZXIuaWQsXG4gICAgICAgICAgcGxhbnRJbnN0YW5jZUlkOiBjcmVhdGVkSW5zdGFuY2UuaWQsXG4gICAgICAgICAgY2FyZVR5cGU6ICdwcnVuZScsXG4gICAgICAgICAgY2FyZURhdGU6IG5ldyBEYXRlKCksXG4gICAgICAgICAgbm90ZXM6ICdCdWxrIHBydW5lIDEnLFxuICAgICAgICB9LFxuICAgICAgXTtcblxuICAgICAgY29uc3QgY3JlYXRlZEVudHJpZXMgPSBhd2FpdCBDYXJlSGlzdG9yeVF1ZXJpZXMuYnVsa0NyZWF0ZUNhcmVIaXN0b3J5KGNhcmVFbnRyaWVzKTtcblxuICAgICAgZXhwZWN0KGNyZWF0ZWRFbnRyaWVzLmxlbmd0aCkudG9CZSgzKTtcbiAgICAgIGV4cGVjdChjcmVhdGVkRW50cmllcy5ldmVyeShlbnRyeSA9PiBlbnRyeS5pZCkpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QoY3JlYXRlZEVudHJpZXMuZXZlcnkoZW50cnkgPT4gZW50cnkudXNlcklkID09PSBjcmVhdGVkVXNlci5pZCkpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgaGFuZGxlIGVtcHR5IGJ1bGsgY3JlYXRlIGdyYWNlZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBDYXJlSGlzdG9yeVF1ZXJpZXMuYnVsa0NyZWF0ZUNhcmVIaXN0b3J5KFtdKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoW10pO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIGdldCBjYXJlIGhpc3RvcnkgZm9yIG11bHRpcGxlIHBsYW50IGluc3RhbmNlcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHRlc3RVc2VyID0gY3JlYXRlVGVzdFVzZXIoKTtcbiAgICAgIGNvbnN0IGNyZWF0ZWRVc2VyID0gYXdhaXQgZGJNYW5hZ2VyLmNyZWF0ZVRlc3RVc2VyKHRlc3RVc2VyKTtcblxuICAgICAgY29uc3QgcGxhbnQgPSBjcmVhdGVUZXN0UGxhbnQoeyBjcmVhdGVkQnk6IGNyZWF0ZWRVc2VyLmlkIH0pO1xuICAgICAgY29uc3QgY3JlYXRlZFBsYW50ID0gYXdhaXQgZGJNYW5hZ2VyLmNyZWF0ZVRlc3RQbGFudChwbGFudCk7XG5cbiAgICAgIC8vIENyZWF0ZSBtdWx0aXBsZSBwbGFudCBpbnN0YW5jZXNcbiAgICAgIGNvbnN0IGluc3RhbmNlMSA9IGNyZWF0ZVRlc3RQbGFudEluc3RhbmNlKHtcbiAgICAgICAgdXNlcklkOiBjcmVhdGVkVXNlci5pZCxcbiAgICAgICAgcGxhbnRJZDogY3JlYXRlZFBsYW50LmlkLFxuICAgICAgfSk7XG4gICAgICBjb25zdCBpbnN0YW5jZTIgPSBjcmVhdGVUZXN0UGxhbnRJbnN0YW5jZSh7XG4gICAgICAgIHVzZXJJZDogY3JlYXRlZFVzZXIuaWQsXG4gICAgICAgIHBsYW50SWQ6IGNyZWF0ZWRQbGFudC5pZCxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBjcmVhdGVkSW5zdGFuY2UxID0gYXdhaXQgZGJNYW5hZ2VyLmNyZWF0ZVRlc3RQbGFudEluc3RhbmNlKGluc3RhbmNlMSk7XG4gICAgICBjb25zdCBjcmVhdGVkSW5zdGFuY2UyID0gYXdhaXQgZGJNYW5hZ2VyLmNyZWF0ZVRlc3RQbGFudEluc3RhbmNlKGluc3RhbmNlMik7XG5cbiAgICAgIC8vIENyZWF0ZSBjYXJlIHJlY29yZHMgZm9yIGJvdGggaW5zdGFuY2VzXG4gICAgICBjb25zdCBjYXJlMSA9IGNyZWF0ZVRlc3RDYXJlUmVjb3JkKHtcbiAgICAgICAgdXNlcklkOiBjcmVhdGVkVXNlci5pZCxcbiAgICAgICAgcGxhbnRJbnN0YW5jZUlkOiBjcmVhdGVkSW5zdGFuY2UxLmlkLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IGNhcmUyID0gY3JlYXRlVGVzdENhcmVSZWNvcmQoe1xuICAgICAgICB1c2VySWQ6IGNyZWF0ZWRVc2VyLmlkLFxuICAgICAgICBwbGFudEluc3RhbmNlSWQ6IGNyZWF0ZWRJbnN0YW5jZTIuaWQsXG4gICAgICB9KTtcblxuICAgICAgYXdhaXQgQ2FyZUhpc3RvcnlRdWVyaWVzLmNyZWF0ZUNhcmVIaXN0b3J5KGNhcmUxKTtcbiAgICAgIGF3YWl0IENhcmVIaXN0b3J5UXVlcmllcy5jcmVhdGVDYXJlSGlzdG9yeShjYXJlMik7XG5cbiAgICAgIGNvbnN0IHBsYW50SW5zdGFuY2VJZHMgPSBbY3JlYXRlZEluc3RhbmNlMS5pZCwgY3JlYXRlZEluc3RhbmNlMi5pZF07XG4gICAgICBjb25zdCBoaXN0b3J5ID0gYXdhaXQgQ2FyZUhpc3RvcnlRdWVyaWVzLmdldENhcmVIaXN0b3J5Rm9yUGxhbnRzKFxuICAgICAgICBwbGFudEluc3RhbmNlSWRzLFxuICAgICAgICBjcmVhdGVkVXNlci5pZFxuICAgICAgKTtcblxuICAgICAgZXhwZWN0KGhpc3RvcnkubGVuZ3RoKS50b0JlKDIpO1xuICAgICAgZXhwZWN0KGhpc3RvcnkuZXZlcnkoaCA9PiBwbGFudEluc3RhbmNlSWRzLmluY2x1ZGVzKGgucGxhbnRJbnN0YW5jZUlkKSkpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdDYXJlIFR5cGUgU3BlY2lmaWMgT3BlcmF0aW9ucycsICgpID0+IHtcbiAgICB0ZXN0KCdzaG91bGQgY3JlYXRlIGZlcnRpbGl6ZXIgY2FyZSByZWNvcmQgd2l0aCBzcGVjaWZpYyBkYXRhJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdGVzdFVzZXIgPSBjcmVhdGVUZXN0VXNlcigpO1xuICAgICAgY29uc3QgY3JlYXRlZFVzZXIgPSBhd2FpdCBkYk1hbmFnZXIuY3JlYXRlVGVzdFVzZXIodGVzdFVzZXIpO1xuXG4gICAgICBjb25zdCBwbGFudCA9IGNyZWF0ZVRlc3RQbGFudCh7IGNyZWF0ZWRCeTogY3JlYXRlZFVzZXIuaWQgfSk7XG4gICAgICBjb25zdCBjcmVhdGVkUGxhbnQgPSBhd2FpdCBkYk1hbmFnZXIuY3JlYXRlVGVzdFBsYW50KHBsYW50KTtcblxuICAgICAgY29uc3QgcGxhbnRJbnN0YW5jZSA9IGNyZWF0ZVRlc3RQbGFudEluc3RhbmNlKHtcbiAgICAgICAgdXNlcklkOiBjcmVhdGVkVXNlci5pZCxcbiAgICAgICAgcGxhbnRJZDogY3JlYXRlZFBsYW50LmlkLFxuICAgICAgfSk7XG4gICAgICBjb25zdCBjcmVhdGVkSW5zdGFuY2UgPSBhd2FpdCBkYk1hbmFnZXIuY3JlYXRlVGVzdFBsYW50SW5zdGFuY2UocGxhbnRJbnN0YW5jZSk7XG5cbiAgICAgIGNvbnN0IGZlcnRpbGl6ZXJDYXJlID0ge1xuICAgICAgICB1c2VySWQ6IGNyZWF0ZWRVc2VyLmlkLFxuICAgICAgICBwbGFudEluc3RhbmNlSWQ6IGNyZWF0ZWRJbnN0YW5jZS5pZCxcbiAgICAgICAgY2FyZVR5cGU6ICdmZXJ0aWxpemVyJyxcbiAgICAgICAgY2FyZURhdGU6IG5ldyBEYXRlKCksXG4gICAgICAgIG5vdGVzOiAnQXBwbGllZCBiYWxhbmNlZCBsaXF1aWQgZmVydGlsaXplciBhdCBoYWxmIHN0cmVuZ3RoJyxcbiAgICAgICAgZmVydGlsaXplclR5cGU6ICdCYWxhbmNlZCBsaXF1aWQgZmVydGlsaXplciAoMTAtMTAtMTApJyxcbiAgICAgICAgaW1hZ2VzOiBbXSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IGNyZWF0ZWRDYXJlID0gYXdhaXQgQ2FyZUhpc3RvcnlRdWVyaWVzLmNyZWF0ZUNhcmVIaXN0b3J5KGZlcnRpbGl6ZXJDYXJlKTtcblxuICAgICAgZXhwZWN0KGNyZWF0ZWRDYXJlLmNhcmVUeXBlKS50b0JlKCdmZXJ0aWxpemVyJyk7XG4gICAgICBleHBlY3QoY3JlYXRlZENhcmUuZmVydGlsaXplclR5cGUpLnRvQmUoJ0JhbGFuY2VkIGxpcXVpZCBmZXJ0aWxpemVyICgxMC0xMC0xMCknKTtcbiAgICAgIGV4cGVjdChjcmVhdGVkQ2FyZS5wb3RTaXplKS50b0JlTnVsbCgpO1xuICAgICAgZXhwZWN0KGNyZWF0ZWRDYXJlLnNvaWxUeXBlKS50b0JlTnVsbCgpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIGNyZWF0ZSByZXBvdHRpbmcgY2FyZSByZWNvcmQgd2l0aCBzcGVjaWZpYyBkYXRhJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdGVzdFVzZXIgPSBjcmVhdGVUZXN0VXNlcigpO1xuICAgICAgY29uc3QgY3JlYXRlZFVzZXIgPSBhd2FpdCBkYk1hbmFnZXIuY3JlYXRlVGVzdFVzZXIodGVzdFVzZXIpO1xuXG4gICAgICBjb25zdCBwbGFudCA9IGNyZWF0ZVRlc3RQbGFudCh7IGNyZWF0ZWRCeTogY3JlYXRlZFVzZXIuaWQgfSk7XG4gICAgICBjb25zdCBjcmVhdGVkUGxhbnQgPSBhd2FpdCBkYk1hbmFnZXIuY3JlYXRlVGVzdFBsYW50KHBsYW50KTtcblxuICAgICAgY29uc3QgcGxhbnRJbnN0YW5jZSA9IGNyZWF0ZVRlc3RQbGFudEluc3RhbmNlKHtcbiAgICAgICAgdXNlcklkOiBjcmVhdGVkVXNlci5pZCxcbiAgICAgICAgcGxhbnRJZDogY3JlYXRlZFBsYW50LmlkLFxuICAgICAgfSk7XG4gICAgICBjb25zdCBjcmVhdGVkSW5zdGFuY2UgPSBhd2FpdCBkYk1hbmFnZXIuY3JlYXRlVGVzdFBsYW50SW5zdGFuY2UocGxhbnRJbnN0YW5jZSk7XG5cbiAgICAgIGNvbnN0IHJlcG90Q2FyZSA9IHtcbiAgICAgICAgdXNlcklkOiBjcmVhdGVkVXNlci5pZCxcbiAgICAgICAgcGxhbnRJbnN0YW5jZUlkOiBjcmVhdGVkSW5zdGFuY2UuaWQsXG4gICAgICAgIGNhcmVUeXBlOiAncmVwb3QnLFxuICAgICAgICBjYXJlRGF0ZTogbmV3IERhdGUoKSxcbiAgICAgICAgbm90ZXM6ICdSZXBvdHRlZCBpbnRvIGxhcmdlciBjb250YWluZXIgd2l0aCBmcmVzaCBzb2lsJyxcbiAgICAgICAgcG90U2l6ZTogJzggaW5jaCcsXG4gICAgICAgIHNvaWxUeXBlOiAnU3RhbmRhcmQgcG90dGluZyBtaXgnLFxuICAgICAgICBpbWFnZXM6IFtdLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgY3JlYXRlZENhcmUgPSBhd2FpdCBDYXJlSGlzdG9yeVF1ZXJpZXMuY3JlYXRlQ2FyZUhpc3RvcnkocmVwb3RDYXJlKTtcblxuICAgICAgZXhwZWN0KGNyZWF0ZWRDYXJlLmNhcmVUeXBlKS50b0JlKCdyZXBvdCcpO1xuICAgICAgZXhwZWN0KGNyZWF0ZWRDYXJlLnBvdFNpemUpLnRvQmUoJzggaW5jaCcpO1xuICAgICAgZXhwZWN0KGNyZWF0ZWRDYXJlLnNvaWxUeXBlKS50b0JlKCdTdGFuZGFyZCBwb3R0aW5nIG1peCcpO1xuICAgICAgZXhwZWN0KGNyZWF0ZWRDYXJlLmZlcnRpbGl6ZXJUeXBlKS50b0JlTnVsbCgpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIGNyZWF0ZSB3YXRlciBjYXJlIHJlY29yZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHRlc3RVc2VyID0gY3JlYXRlVGVzdFVzZXIoKTtcbiAgICAgIGNvbnN0IGNyZWF0ZWRVc2VyID0gYXdhaXQgZGJNYW5hZ2VyLmNyZWF0ZVRlc3RVc2VyKHRlc3RVc2VyKTtcblxuICAgICAgY29uc3QgcGxhbnQgPSBjcmVhdGVUZXN0UGxhbnQoeyBjcmVhdGVkQnk6IGNyZWF0ZWRVc2VyLmlkIH0pO1xuICAgICAgY29uc3QgY3JlYXRlZFBsYW50ID0gYXdhaXQgZGJNYW5hZ2VyLmNyZWF0ZVRlc3RQbGFudChwbGFudCk7XG5cbiAgICAgIGNvbnN0IHBsYW50SW5zdGFuY2UgPSBjcmVhdGVUZXN0UGxhbnRJbnN0YW5jZSh7XG4gICAgICAgIHVzZXJJZDogY3JlYXRlZFVzZXIuaWQsXG4gICAgICAgIHBsYW50SWQ6IGNyZWF0ZWRQbGFudC5pZCxcbiAgICAgIH0pO1xuICAgICAgY29uc3QgY3JlYXRlZEluc3RhbmNlID0gYXdhaXQgZGJNYW5hZ2VyLmNyZWF0ZVRlc3RQbGFudEluc3RhbmNlKHBsYW50SW5zdGFuY2UpO1xuXG4gICAgICBjb25zdCB3YXRlckNhcmUgPSB7XG4gICAgICAgIHVzZXJJZDogY3JlYXRlZFVzZXIuaWQsXG4gICAgICAgIHBsYW50SW5zdGFuY2VJZDogY3JlYXRlZEluc3RhbmNlLmlkLFxuICAgICAgICBjYXJlVHlwZTogJ3dhdGVyJyxcbiAgICAgICAgY2FyZURhdGU6IG5ldyBEYXRlKCksXG4gICAgICAgIG5vdGVzOiAnV2F0ZXJlZCB0aG9yb3VnaGx5IHVudGlsIHdhdGVyIGRyYWluZWQgZnJvbSBib3R0b20nLFxuICAgICAgICBpbWFnZXM6IFtdLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgY3JlYXRlZENhcmUgPSBhd2FpdCBDYXJlSGlzdG9yeVF1ZXJpZXMuY3JlYXRlQ2FyZUhpc3Rvcnkod2F0ZXJDYXJlKTtcblxuICAgICAgZXhwZWN0KGNyZWF0ZWRDYXJlLmNhcmVUeXBlKS50b0JlKCd3YXRlcicpO1xuICAgICAgZXhwZWN0KGNyZWF0ZWRDYXJlLm5vdGVzKS50b0JlKCdXYXRlcmVkIHRob3JvdWdobHkgdW50aWwgd2F0ZXIgZHJhaW5lZCBmcm9tIGJvdHRvbScpO1xuICAgICAgZXhwZWN0KGNyZWF0ZWRDYXJlLmZlcnRpbGl6ZXJUeXBlKS50b0JlTnVsbCgpO1xuICAgICAgZXhwZWN0KGNyZWF0ZWRDYXJlLnBvdFNpemUpLnRvQmVOdWxsKCk7XG4gICAgICBleHBlY3QoY3JlYXRlZENhcmUuc29pbFR5cGUpLnRvQmVOdWxsKCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdFcnJvciBIYW5kbGluZyBhbmQgRWRnZSBDYXNlcycsICgpID0+IHtcbiAgICB0ZXN0KCdzaG91bGQgaGFuZGxlIG5vbi1leGlzdGVudCBwbGFudCBpbnN0YW5jZSBpbiBjYXJlIG9wZXJhdGlvbnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB0ZXN0VXNlciA9IGNyZWF0ZVRlc3RVc2VyKCk7XG4gICAgICBjb25zdCBjcmVhdGVkVXNlciA9IGF3YWl0IGRiTWFuYWdlci5jcmVhdGVUZXN0VXNlcih0ZXN0VXNlcik7XG5cbiAgICAgIGNvbnN0IGNhcmVEYXRhID0gY3JlYXRlVGVzdENhcmVSZWNvcmQoe1xuICAgICAgICB1c2VySWQ6IGNyZWF0ZWRVc2VyLmlkLFxuICAgICAgICBwbGFudEluc3RhbmNlSWQ6IDk5OTk5LCAvLyBOb24tZXhpc3RlbnRcbiAgICAgIH0pO1xuXG4gICAgICAvLyBTaG91bGQgbm90IGNyYXNoLCBidXQgbWF5IGZhaWwgZHVlIHRvIGZvcmVpZ24ga2V5IGNvbnN0cmFpbnRcbiAgICAgIGF3YWl0IGV4cGVjdChDYXJlSGlzdG9yeVF1ZXJpZXMuY3JlYXRlQ2FyZUhpc3RvcnkoY2FyZURhdGEpKVxuICAgICAgICAucmVqZWN0cy50b1Rocm93KCk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgaGFuZGxlIHVuYXV0aG9yaXplZCBjYXJlIHJlY29yZCBhY2Nlc3MnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB0ZXN0VXNlcjEgPSBjcmVhdGVUZXN0VXNlcih7IGVtYWlsOiAndXNlcjFAZXhhbXBsZS5jb20nIH0pO1xuICAgICAgY29uc3QgdGVzdFVzZXIyID0gY3JlYXRlVGVzdFVzZXIoeyBlbWFpbDogJ3VzZXIyQGV4YW1wbGUuY29tJyB9KTtcbiAgICAgIGNvbnN0IGNyZWF0ZWRVc2VyMSA9IGF3YWl0IGRiTWFuYWdlci5jcmVhdGVUZXN0VXNlcih0ZXN0VXNlcjEpO1xuICAgICAgY29uc3QgY3JlYXRlZFVzZXIyID0gYXdhaXQgZGJNYW5hZ2VyLmNyZWF0ZVRlc3RVc2VyKHRlc3RVc2VyMik7XG5cbiAgICAgIGNvbnN0IHBsYW50ID0gY3JlYXRlVGVzdFBsYW50KHsgY3JlYXRlZEJ5OiBjcmVhdGVkVXNlcjEuaWQgfSk7XG4gICAgICBjb25zdCBjcmVhdGVkUGxhbnQgPSBhd2FpdCBkYk1hbmFnZXIuY3JlYXRlVGVzdFBsYW50KHBsYW50KTtcblxuICAgICAgY29uc3QgcGxhbnRJbnN0YW5jZSA9IGNyZWF0ZVRlc3RQbGFudEluc3RhbmNlKHtcbiAgICAgICAgdXNlcklkOiBjcmVhdGVkVXNlcjEuaWQsXG4gICAgICAgIHBsYW50SWQ6IGNyZWF0ZWRQbGFudC5pZCxcbiAgICAgIH0pO1xuICAgICAgY29uc3QgY3JlYXRlZEluc3RhbmNlID0gYXdhaXQgZGJNYW5hZ2VyLmNyZWF0ZVRlc3RQbGFudEluc3RhbmNlKHBsYW50SW5zdGFuY2UpO1xuXG4gICAgICBjb25zdCBjYXJlRGF0YSA9IGNyZWF0ZVRlc3RDYXJlUmVjb3JkKHtcbiAgICAgICAgdXNlcklkOiBjcmVhdGVkVXNlcjEuaWQsXG4gICAgICAgIHBsYW50SW5zdGFuY2VJZDogY3JlYXRlZEluc3RhbmNlLmlkLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IGNyZWF0ZWRDYXJlID0gYXdhaXQgQ2FyZUhpc3RvcnlRdWVyaWVzLmNyZWF0ZUNhcmVIaXN0b3J5KGNhcmVEYXRhKTtcblxuICAgICAgLy8gVXNlciAyIHNob3VsZCBub3QgYmUgYWJsZSB0byB1cGRhdGUgVXNlciAxJ3MgY2FyZSByZWNvcmRcbiAgICAgIGNvbnN0IHVwZGF0ZWRDYXJlID0gYXdhaXQgQ2FyZUhpc3RvcnlRdWVyaWVzLnVwZGF0ZUNhcmVIaXN0b3J5KFxuICAgICAgICBjcmVhdGVkQ2FyZS5pZCxcbiAgICAgICAgY3JlYXRlZFVzZXIyLmlkLCAvLyBEaWZmZXJlbnQgdXNlclxuICAgICAgICB7IG5vdGVzOiAnVW5hdXRob3JpemVkIHVwZGF0ZScgfVxuICAgICAgKTtcblxuICAgICAgZXhwZWN0KHVwZGF0ZWRDYXJlKS50b0JlTnVsbCgpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIGhhbmRsZSBpbnZhbGlkIGNhcmUgdHlwZSBncmFjZWZ1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdGVzdFVzZXIgPSBjcmVhdGVUZXN0VXNlcigpO1xuICAgICAgY29uc3QgY3JlYXRlZFVzZXIgPSBhd2FpdCBkYk1hbmFnZXIuY3JlYXRlVGVzdFVzZXIodGVzdFVzZXIpO1xuXG4gICAgICBjb25zdCBwbGFudCA9IGNyZWF0ZVRlc3RQbGFudCh7IGNyZWF0ZWRCeTogY3JlYXRlZFVzZXIuaWQgfSk7XG4gICAgICBjb25zdCBjcmVhdGVkUGxhbnQgPSBhd2FpdCBkYk1hbmFnZXIuY3JlYXRlVGVzdFBsYW50KHBsYW50KTtcblxuICAgICAgY29uc3QgcGxhbnRJbnN0YW5jZSA9IGNyZWF0ZVRlc3RQbGFudEluc3RhbmNlKHtcbiAgICAgICAgdXNlcklkOiBjcmVhdGVkVXNlci5pZCxcbiAgICAgICAgcGxhbnRJZDogY3JlYXRlZFBsYW50LmlkLFxuICAgICAgfSk7XG4gICAgICBjb25zdCBjcmVhdGVkSW5zdGFuY2UgPSBhd2FpdCBkYk1hbmFnZXIuY3JlYXRlVGVzdFBsYW50SW5zdGFuY2UocGxhbnRJbnN0YW5jZSk7XG5cbiAgICAgIGNvbnN0IGNhcmVEYXRhID0ge1xuICAgICAgICB1c2VySWQ6IGNyZWF0ZWRVc2VyLmlkLFxuICAgICAgICBwbGFudEluc3RhbmNlSWQ6IGNyZWF0ZWRJbnN0YW5jZS5pZCxcbiAgICAgICAgY2FyZVR5cGU6ICdpbnZhbGlkX2NhcmVfdHlwZScsIC8vIEludmFsaWRcbiAgICAgICAgY2FyZURhdGU6IG5ldyBEYXRlKCksXG4gICAgICAgIG5vdGVzOiAnVGVzdCBub3RlcycsXG4gICAgICB9O1xuXG4gICAgICAvLyBTaG91bGQgZmFpbCBkdWUgdG8gZW51bSBjb25zdHJhaW50XG4gICAgICBhd2FpdCBleHBlY3QoQ2FyZUhpc3RvcnlRdWVyaWVzLmNyZWF0ZUNhcmVIaXN0b3J5KGNhcmVEYXRhKSlcbiAgICAgICAgLnJlamVjdHMudG9UaHJvdygpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIGhhbmRsZSBlbXB0eSBjYXJlIGhpc3RvcnkgcXVlcmllcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHRlc3RVc2VyID0gY3JlYXRlVGVzdFVzZXIoKTtcbiAgICAgIGNvbnN0IGNyZWF0ZWRVc2VyID0gYXdhaXQgZGJNYW5hZ2VyLmNyZWF0ZVRlc3RVc2VyKHRlc3RVc2VyKTtcblxuICAgICAgY29uc3QgcGxhbnQgPSBjcmVhdGVUZXN0UGxhbnQoeyBjcmVhdGVkQnk6IGNyZWF0ZWRVc2VyLmlkIH0pO1xuICAgICAgY29uc3QgY3JlYXRlZFBsYW50ID0gYXdhaXQgZGJNYW5hZ2VyLmNyZWF0ZVRlc3RQbGFudChwbGFudCk7XG5cbiAgICAgIGNvbnN0IHBsYW50SW5zdGFuY2UgPSBjcmVhdGVUZXN0UGxhbnRJbnN0YW5jZSh7XG4gICAgICAgIHVzZXJJZDogY3JlYXRlZFVzZXIuaWQsXG4gICAgICAgIHBsYW50SWQ6IGNyZWF0ZWRQbGFudC5pZCxcbiAgICAgIH0pO1xuICAgICAgY29uc3QgY3JlYXRlZEluc3RhbmNlID0gYXdhaXQgZGJNYW5hZ2VyLmNyZWF0ZVRlc3RQbGFudEluc3RhbmNlKHBsYW50SW5zdGFuY2UpO1xuXG4gICAgICAvLyBObyBjYXJlIHJlY29yZHMgY3JlYXRlZFxuICAgICAgY29uc3QgaGlzdG9yeSA9IGF3YWl0IENhcmVIaXN0b3J5UXVlcmllcy5nZXRDYXJlSGlzdG9yeUZvclBsYW50KFxuICAgICAgICBjcmVhdGVkSW5zdGFuY2UuaWQsXG4gICAgICAgIGNyZWF0ZWRVc2VyLmlkXG4gICAgICApO1xuXG4gICAgICBleHBlY3QoaGlzdG9yeSkudG9FcXVhbChbXSk7XG5cbiAgICAgIGNvbnN0IGNvdW50ID0gYXdhaXQgQ2FyZUhpc3RvcnlRdWVyaWVzLmdldENhcmVIaXN0b3J5Q291bnQoXG4gICAgICAgIGNyZWF0ZWRJbnN0YW5jZS5pZCxcbiAgICAgICAgY3JlYXRlZFVzZXIuaWRcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChjb3VudCkudG9CZSgwKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1BlcmZvcm1hbmNlIGFuZCBDb25jdXJyZW5jeScsICgpID0+IHtcbiAgICB0ZXN0KCdzaG91bGQgaGFuZGxlIGNvbmN1cnJlbnQgY2FyZSByZWNvcmQgY3JlYXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB0ZXN0VXNlciA9IGNyZWF0ZVRlc3RVc2VyKCk7XG4gICAgICBjb25zdCBjcmVhdGVkVXNlciA9IGF3YWl0IGRiTWFuYWdlci5jcmVhdGVUZXN0VXNlcih0ZXN0VXNlcik7XG5cbiAgICAgIGNvbnN0IHBsYW50ID0gY3JlYXRlVGVzdFBsYW50KHsgY3JlYXRlZEJ5OiBjcmVhdGVkVXNlci5pZCB9KTtcbiAgICAgIGNvbnN0IGNyZWF0ZWRQbGFudCA9IGF3YWl0IGRiTWFuYWdlci5jcmVhdGVUZXN0UGxhbnQocGxhbnQpO1xuXG4gICAgICBjb25zdCBwbGFudEluc3RhbmNlID0gY3JlYXRlVGVzdFBsYW50SW5zdGFuY2Uoe1xuICAgICAgICB1c2VySWQ6IGNyZWF0ZWRVc2VyLmlkLFxuICAgICAgICBwbGFudElkOiBjcmVhdGVkUGxhbnQuaWQsXG4gICAgICB9KTtcbiAgICAgIGNvbnN0IGNyZWF0ZWRJbnN0YW5jZSA9IGF3YWl0IGRiTWFuYWdlci5jcmVhdGVUZXN0UGxhbnRJbnN0YW5jZShwbGFudEluc3RhbmNlKTtcblxuICAgICAgLy8gQ3JlYXRlIG11bHRpcGxlIGNhcmUgcmVjb3JkcyBjb25jdXJyZW50bHlcbiAgICAgIGNvbnN0IGNhcmVQcm9taXNlcyA9IEFycmF5LmZyb20oeyBsZW5ndGg6IDUgfSwgKF8sIGluZGV4KSA9PiB7XG4gICAgICAgIGNvbnN0IGNhcmVEYXRhID0gY3JlYXRlVGVzdENhcmVSZWNvcmQoe1xuICAgICAgICAgIHVzZXJJZDogY3JlYXRlZFVzZXIuaWQsXG4gICAgICAgICAgcGxhbnRJbnN0YW5jZUlkOiBjcmVhdGVkSW5zdGFuY2UuaWQsXG4gICAgICAgICAgbm90ZXM6IGBDb25jdXJyZW50IGNhcmUgJHtpbmRleH1gLFxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIENhcmVIaXN0b3J5UXVlcmllcy5jcmVhdGVDYXJlSGlzdG9yeShjYXJlRGF0YSk7XG4gICAgICB9KTtcblxuICAgICAgY29uc3QgY2FyZVJlY29yZHMgPSBhd2FpdCBQcm9taXNlLmFsbChjYXJlUHJvbWlzZXMpO1xuICAgICAgZXhwZWN0KGNhcmVSZWNvcmRzLmxlbmd0aCkudG9CZSg1KTtcbiAgICAgIGV4cGVjdChjYXJlUmVjb3Jkcy5ldmVyeShjID0+IGMuaWQpKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIGhhbmRsZSBsYXJnZSBjYXJlIGhpc3RvcnkgZWZmaWNpZW50bHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB0ZXN0VXNlciA9IGNyZWF0ZVRlc3RVc2VyKCk7XG4gICAgICBjb25zdCBjcmVhdGVkVXNlciA9IGF3YWl0IGRiTWFuYWdlci5jcmVhdGVUZXN0VXNlcih0ZXN0VXNlcik7XG5cbiAgICAgIGNvbnN0IHBsYW50ID0gY3JlYXRlVGVzdFBsYW50KHsgY3JlYXRlZEJ5OiBjcmVhdGVkVXNlci5pZCB9KTtcbiAgICAgIGNvbnN0IGNyZWF0ZWRQbGFudCA9IGF3YWl0IGRiTWFuYWdlci5jcmVhdGVUZXN0UGxhbnQocGxhbnQpO1xuXG4gICAgICBjb25zdCBwbGFudEluc3RhbmNlID0gY3JlYXRlVGVzdFBsYW50SW5zdGFuY2Uoe1xuICAgICAgICB1c2VySWQ6IGNyZWF0ZWRVc2VyLmlkLFxuICAgICAgICBwbGFudElkOiBjcmVhdGVkUGxhbnQuaWQsXG4gICAgICB9KTtcbiAgICAgIGNvbnN0IGNyZWF0ZWRJbnN0YW5jZSA9IGF3YWl0IGRiTWFuYWdlci5jcmVhdGVUZXN0UGxhbnRJbnN0YW5jZShwbGFudEluc3RhbmNlKTtcblxuICAgICAgLy8gQ3JlYXRlIG1hbnkgY2FyZSByZWNvcmRzXG4gICAgICBjb25zdCBjYXJlRW50cmllcyA9IEFycmF5LmZyb20oeyBsZW5ndGg6IDUwIH0sIChfLCBpbmRleCkgPT4gKHtcbiAgICAgICAgdXNlcklkOiBjcmVhdGVkVXNlci5pZCxcbiAgICAgICAgcGxhbnRJbnN0YW5jZUlkOiBjcmVhdGVkSW5zdGFuY2UuaWQsXG4gICAgICAgIGNhcmVUeXBlOiAnd2F0ZXInLFxuICAgICAgICBjYXJlRGF0ZTogbmV3IERhdGUoRGF0ZS5ub3coKSAtIGluZGV4ICogMjQgKiA2MCAqIDYwICogMTAwMCksIC8vIE9uZSBwZXIgZGF5XG4gICAgICAgIG5vdGVzOiBgRGFpbHkgd2F0ZXIgJHtpbmRleH1gLFxuICAgICAgfSkpO1xuXG4gICAgICBhd2FpdCBDYXJlSGlzdG9yeVF1ZXJpZXMuYnVsa0NyZWF0ZUNhcmVIaXN0b3J5KGNhcmVFbnRyaWVzKTtcblxuICAgICAgY29uc3Qgc3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICAgIGNvbnN0IGhpc3RvcnkgPSBhd2FpdCBDYXJlSGlzdG9yeVF1ZXJpZXMuZ2V0Q2FyZUhpc3RvcnlGb3JQbGFudChcbiAgICAgICAgY3JlYXRlZEluc3RhbmNlLmlkLFxuICAgICAgICBjcmVhdGVkVXNlci5pZCxcbiAgICAgICAgeyBsaW1pdDogMjAgfVxuICAgICAgKTtcbiAgICAgIGNvbnN0IHF1ZXJ5VGltZSA9IERhdGUubm93KCkgLSBzdGFydFRpbWU7XG5cbiAgICAgIGV4cGVjdChoaXN0b3J5Lmxlbmd0aCkudG9CZSgyMCk7XG4gICAgICBleHBlY3QocXVlcnlUaW1lKS50b0JlTGVzc1RoYW4oMTAwMCk7IC8vIFNob3VsZCBjb21wbGV0ZSB3aXRoaW4gMSBzZWNvbmRcbiAgICB9KTtcbiAgfSk7XG59KTsiXSwibmFtZXMiOlsiZGVzY3JpYmUiLCJkYk1hbmFnZXIiLCJiZWZvcmVFYWNoIiwiY3JlYXRlRGF0YWJhc2VUZXN0TWFuYWdlciIsInJlc2V0Q2FyZUNvdW50ZXIiLCJyZXNldFVzZXJDb3VudGVyIiwicmVzZXRQbGFudENvdW50ZXJzIiwiYWZ0ZXJFYWNoIiwiY2xlYW51cCIsInRlc3QiLCJ0ZXN0VXNlciIsImNyZWF0ZVRlc3RVc2VyIiwiY3JlYXRlZFVzZXIiLCJwbGFudCIsImNyZWF0ZVRlc3RQbGFudCIsImNyZWF0ZWRCeSIsImlkIiwiY3JlYXRlZFBsYW50IiwicGxhbnRJbnN0YW5jZSIsImNyZWF0ZVRlc3RQbGFudEluc3RhbmNlIiwidXNlcklkIiwicGxhbnRJZCIsImNyZWF0ZWRJbnN0YW5jZSIsImNhcmVEYXRhIiwicGxhbnRJbnN0YW5jZUlkIiwiY2FyZVR5cGUiLCJjYXJlRGF0ZSIsIkRhdGUiLCJub3RlcyIsImZlcnRpbGl6ZXJUeXBlIiwiaW1hZ2VzIiwiY2FyZVJlY29yZCIsIkNhcmVIaXN0b3J5UXVlcmllcyIsImNyZWF0ZUNhcmVIaXN0b3J5IiwiZXhwZWN0IiwidG9CZURlZmluZWQiLCJ0b0JlIiwiY3JlYXRlZEF0IiwidG9CZUluc3RhbmNlT2YiLCJ1cGRhdGVkQXQiLCJjcmVhdGVUZXN0Q2FyZVJlY29yZCIsImNyZWF0ZWRDYXJlIiwiZm91bmRDYXJlIiwiZ2V0Q2FyZUhpc3RvcnlCeUlkIiwidG9CZU51bGwiLCJ1cGRhdGVzIiwidXBkYXRlZENhcmUiLCJ1cGRhdGVDYXJlSGlzdG9yeSIsImdldFRpbWUiLCJ0b0JlR3JlYXRlclRoYW4iLCJkZWxldGVkIiwiZGVsZXRlQ2FyZUhpc3RvcnkiLCJjYXJlUmVjb3JkcyIsImNhcmUiLCJoaXN0b3J5IiwiZ2V0Q2FyZUhpc3RvcnlGb3JQbGFudCIsImxlbmd0aCIsImV2ZXJ5IiwiaCIsImZlcnRpbGl6ZXJDYXJlIiwid2F0ZXJDYXJlIiwiZmVydGlsaXplckhpc3RvcnkiLCJub3ciLCJvbmVXZWVrQWdvIiwidHdvV2Vla3NBZ28iLCJyZWNlbnRDYXJlIiwib2xkQ2FyZSIsInJlY2VudEhpc3RvcnkiLCJzdGFydERhdGUiLCJlbmREYXRlIiwidG9CZUdyZWF0ZXJUaGFuT3JFcXVhbCIsImluc3RhbmNlMSIsImluc3RhbmNlMiIsImNyZWF0ZWRJbnN0YW5jZTEiLCJjcmVhdGVkSW5zdGFuY2UyIiwiY2FyZTEiLCJjYXJlMiIsImdldFJlY2VudENhcmVIaXN0b3J5IiwidG90YWxDb3VudCIsImdldENhcmVIaXN0b3J5Q291bnQiLCJmZXJ0aWxpemVyQ291bnQiLCJ3YXRlckNvdW50IiwieWVzdGVyZGF5Iiwib2xkRmVydGlsaXplciIsInJlY2VudEZlcnRpbGl6ZXIiLCJsYXN0RmVydGlsaXplckRhdGUiLCJnZXRMYXN0Q2FyZURhdGUiLCJsYXN0UmVwb3REYXRlIiwib3ZlcmR1ZUluc3RhbmNlIiwiZmVydGlsaXplckR1ZSIsImlzQWN0aXZlIiwiZHVlVG9kYXlJbnN0YW5jZSIsImR1ZVNvb25JbnN0YW5jZSIsImRhc2hib2FyZERhdGEiLCJnZXRDYXJlRGFzaGJvYXJkRGF0YSIsInN0YXRpc3RpY3MiLCJ0b3RhbEFjdGl2ZVBsYW50cyIsIm92ZXJkdWUiLCJkdWVUb2RheSIsImR1ZVNvb24iLCJjYXJlRW50cmllcyIsImNyZWF0ZWRFbnRyaWVzIiwiYnVsa0NyZWF0ZUNhcmVIaXN0b3J5IiwiZW50cnkiLCJyZXN1bHQiLCJ0b0VxdWFsIiwicGxhbnRJbnN0YW5jZUlkcyIsImdldENhcmVIaXN0b3J5Rm9yUGxhbnRzIiwiaW5jbHVkZXMiLCJwb3RTaXplIiwic29pbFR5cGUiLCJyZXBvdENhcmUiLCJyZWplY3RzIiwidG9UaHJvdyIsInRlc3RVc2VyMSIsImVtYWlsIiwidGVzdFVzZXIyIiwiY3JlYXRlZFVzZXIxIiwiY3JlYXRlZFVzZXIyIiwiY291bnQiLCJjYXJlUHJvbWlzZXMiLCJBcnJheSIsImZyb20iLCJfIiwiaW5kZXgiLCJQcm9taXNlIiwiYWxsIiwiYyIsInN0YXJ0VGltZSIsImxpbWl0IiwicXVlcnlUaW1lIiwidG9CZUxlc3NUaGFuIl0sIm1hcHBpbmdzIjoiQUFBQTs7O0NBR0M7Ozs7NkJBRWtDO3dCQUNOO2dDQUNRO3FDQUNLOzZCQVNuQzs2QkFDMEM7OEJBQzRCO0FBRTdFQSxTQUFTLDhCQUE4QjtJQUNyQyxJQUFJQztJQUVKQyxXQUFXO1FBQ1RELFlBQVlFLElBQUFBLDhDQUF5QjtRQUNyQ0MsSUFBQUEsNkJBQWdCO1FBQ2hCQyxJQUFBQSw2QkFBZ0I7UUFDaEJDLElBQUFBLGdDQUFrQjtJQUNwQjtJQUVBQyxVQUFVO1FBQ1IsTUFBTU4sVUFBVU8sT0FBTztJQUN6QjtJQUVBUixTQUFTLCtCQUErQjtRQUN0Q1MsS0FBSyxtQ0FBbUM7WUFD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