b6a135aa0b4b7457dd2a3f9a4eae28af
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "CareHistoryQueries", {
    enumerable: true,
    get: function() {
        return CareHistoryQueries;
    }
});
const _db = require("..");
const _schema = require("../schema");
const _drizzleorm = require("drizzle-orm");
const _carecalculator = require("../../services/care-calculator");
const _caretypes = require("../../types/care-types");
class CareHistoryQueries {
    /**
   * Create a new care history entry
   */ static async createCareHistory(data) {
        const [careEntry] = await _db.db.insert(_schema.careHistory).values({
            ...data,
            createdAt: new Date(),
            updatedAt: new Date()
        }).returning();
        return careEntry;
    }
    /**
   * Get care history by ID
   */ static async getCareHistoryById(id) {
        const [careEntry] = await _db.db.select().from(_schema.careHistory).where((0, _drizzleorm.eq)(_schema.careHistory.id, id)).limit(1);
        return careEntry || null;
    }
    /**
   * Get care history for a specific plant instance
   */ static async getCareHistoryForPlant(plantInstanceId, userId, filters) {
        // Build where conditions
        const conditions = [
            (0, _drizzleorm.eq)(_schema.careHistory.plantInstanceId, plantInstanceId),
            (0, _drizzleorm.eq)(_schema.careHistory.userId, userId)
        ];
        if (filters?.careType) {
            conditions.push((0, _drizzleorm.eq)(_schema.careHistory.careType, filters.careType));
        }
        if (filters?.startDate) {
            conditions.push((0, _drizzleorm.gte)(_schema.careHistory.careDate, filters.startDate));
        }
        if (filters?.endDate) {
            conditions.push((0, _drizzleorm.lte)(_schema.careHistory.careDate, filters.endDate));
        }
        // Apply sorting
        const sortField = filters?.sortBy === 'care_type' ? _schema.careHistory.careType : filters?.sortBy === 'created_at' ? _schema.careHistory.createdAt : _schema.careHistory.careDate;
        const sortOrder = filters?.sortOrder === 'asc' ? (0, _drizzleorm.asc)(sortField) : (0, _drizzleorm.desc)(sortField);
        // Build the query
        let query = _db.db.select({
            careHistory: _schema.careHistory,
            plantInstance: _schema.plantInstances,
            plant: _schema.plants
        }).from(_schema.careHistory).leftJoin(_schema.plantInstances, (0, _drizzleorm.eq)(_schema.careHistory.plantInstanceId, _schema.plantInstances.id)).leftJoin(_schema.plants, (0, _drizzleorm.eq)(_schema.plantInstances.plantId, _schema.plants.id)).where((0, _drizzleorm.and)(...conditions)).orderBy(sortOrder);
        // Apply pagination
        if (filters?.limit) {
            query = query.limit(filters.limit);
        }
        if (filters?.offset) {
            query = query.offset(filters.offset);
        }
        const results = await query;
        return results.map((result)=>this.enhanceCareHistory(result.careHistory, result.plantInstance, result.plant));
    }
    /**
   * Get care history for multiple plant instances (for dashboard)
   */ static async getCareHistoryForPlants(plantInstanceIds, userId, filters) {
        if (plantInstanceIds.length === 0) return [];
        // Build where conditions
        const conditions = [
            (0, _drizzleorm.inArray)(_schema.careHistory.plantInstanceId, plantInstanceIds),
            (0, _drizzleorm.eq)(_schema.careHistory.userId, userId)
        ];
        if (filters?.careType) {
            conditions.push((0, _drizzleorm.eq)(_schema.careHistory.careType, filters.careType));
        }
        if (filters?.startDate) {
            conditions.push((0, _drizzleorm.gte)(_schema.careHistory.careDate, filters.startDate));
        }
        if (filters?.endDate) {
            conditions.push((0, _drizzleorm.lte)(_schema.careHistory.careDate, filters.endDate));
        }
        // Apply sorting
        const sortField = filters?.sortBy === 'care_type' ? _schema.careHistory.careType : filters?.sortBy === 'created_at' ? _schema.careHistory.createdAt : _schema.careHistory.careDate;
        const sortOrder = filters?.sortOrder === 'asc' ? (0, _drizzleorm.asc)(sortField) : (0, _drizzleorm.desc)(sortField);
        // Build the query
        let query = _db.db.select({
            careHistory: _schema.careHistory,
            plantInstance: _schema.plantInstances,
            plant: _schema.plants
        }).from(_schema.careHistory).leftJoin(_schema.plantInstances, (0, _drizzleorm.eq)(_schema.careHistory.plantInstanceId, _schema.plantInstances.id)).leftJoin(_schema.plants, (0, _drizzleorm.eq)(_schema.plantInstances.plantId, _schema.plants.id)).where((0, _drizzleorm.and)(...conditions)).orderBy(sortOrder);
        // Apply pagination
        if (filters?.limit) {
            query = query.limit(filters.limit);
        }
        if (filters?.offset) {
            query = query.offset(filters.offset);
        }
        const results = await query;
        return results.map((result)=>this.enhanceCareHistory(result.careHistory, result.plantInstance, result.plant));
    }
    /**
   * Get recent care history for a user
   */ static async getRecentCareHistory(userId, limit = 20) {
        const results = await _db.db.select({
            careHistory: _schema.careHistory,
            plantInstance: _schema.plantInstances,
            plant: _schema.plants
        }).from(_schema.careHistory).leftJoin(_schema.plantInstances, (0, _drizzleorm.eq)(_schema.careHistory.plantInstanceId, _schema.plantInstances.id)).leftJoin(_schema.plants, (0, _drizzleorm.eq)(_schema.plantInstances.plantId, _schema.plants.id)).where((0, _drizzleorm.eq)(_schema.careHistory.userId, userId)).orderBy((0, _drizzleorm.desc)(_schema.careHistory.careDate)).limit(limit);
        return results.map((result)=>this.enhanceCareHistory(result.careHistory, result.plantInstance, result.plant));
    }
    /**
   * Update care history entry
   */ static async updateCareHistory(id, userId, updates) {
        const [updated] = await _db.db.update(_schema.careHistory).set({
            ...updates,
            updatedAt: new Date()
        }).where((0, _drizzleorm.and)((0, _drizzleorm.eq)(_schema.careHistory.id, id), (0, _drizzleorm.eq)(_schema.careHistory.userId, userId))).returning();
        return updated || null;
    }
    /**
   * Delete care history entry
   */ static async deleteCareHistory(id, userId) {
        console.log('Attempting to delete care:', id, 'for user:', userId);
        // First check if record exists
        const existing = await _db.db.select().from(_schema.careHistory).where((0, _drizzleorm.eq)(_schema.careHistory.id, id)).limit(1);
        console.log('Existing record:', existing);
        try {
            const result = await _db.db.delete(_schema.careHistory).where((0, _drizzleorm.and)((0, _drizzleorm.eq)(_schema.careHistory.id, id), (0, _drizzleorm.eq)(_schema.careHistory.userId, userId)));
            console.log('Delete result:', result, 'Length:', result.length);
            // Double check by trying to fetch the record again
            const stillExists = await _db.db.select().from(_schema.careHistory).where((0, _drizzleorm.eq)(_schema.careHistory.id, id)).limit(1);
            console.log('Record still exists after delete:', stillExists.length > 0);
            return result.length > 0;
        } catch (error) {
            console.error('Delete error:', error);
            throw error;
        }
    }
    /**
   * Get care statistics for a plant instance
   */ static async getPlantCareStatistics(plantInstanceId, userId) {
        // Get plant instance
        const [plantInstance] = await _db.db.select().from(_schema.plantInstances).where((0, _drizzleorm.and)((0, _drizzleorm.eq)(_schema.plantInstances.id, plantInstanceId), (0, _drizzleorm.eq)(_schema.plantInstances.userId, userId))).limit(1);
        if (!plantInstance) return null;
        // Get care history
        const careHistoryData = await _db.db.select().from(_schema.careHistory).where((0, _drizzleorm.and)((0, _drizzleorm.eq)(_schema.careHistory.plantInstanceId, plantInstanceId), (0, _drizzleorm.eq)(_schema.careHistory.userId, userId))).orderBy((0, _drizzleorm.asc)(_schema.careHistory.careDate));
        return _carecalculator.CareCalculator.calculatePlantCareStatistics(plantInstance, careHistoryData);
    }
    /**
   * Get care statistics for multiple plants
   */ static async getBulkCareStatistics(plantInstanceIds, userId) {
        if (plantInstanceIds.length === 0) return [];
        // Get plant instances
        const plantInstancesData = await _db.db.select().from(_schema.plantInstances).where((0, _drizzleorm.and)((0, _drizzleorm.inArray)(_schema.plantInstances.id, plantInstanceIds), (0, _drizzleorm.eq)(_schema.plantInstances.userId, userId)));
        // Get care history for all plants
        const careHistoryData = await _db.db.select().from(_schema.careHistory).where((0, _drizzleorm.and)((0, _drizzleorm.inArray)(_schema.careHistory.plantInstanceId, plantInstanceIds), (0, _drizzleorm.eq)(_schema.careHistory.userId, userId))).orderBy((0, _drizzleorm.asc)(_schema.careHistory.careDate));
        // Group care history by plant instance
        const careHistoryByPlant = careHistoryData.reduce((acc, care)=>{
            if (!acc[care.plantInstanceId]) {
                acc[care.plantInstanceId] = [];
            }
            acc[care.plantInstanceId].push(care);
            return acc;
        }, {});
        // Calculate statistics for each plant
        return plantInstancesData.map((plantInstance)=>_carecalculator.CareCalculator.calculatePlantCareStatistics(plantInstance, careHistoryByPlant[plantInstance.id] || []));
    }
    /**
   * Get care dashboard data
   */ static async getCareDashboardData(userId, options = {}) {
        const { includeInactive = false, daysAhead = 7 } = options;
        // Get all plant instances for the user
        const plantInstancesData = await _db.db.select({
            plantInstance: _schema.plantInstances,
            plant: _schema.plants
        }).from(_schema.plantInstances).leftJoin(_schema.plants, (0, _drizzleorm.eq)(_schema.plantInstances.plantId, _schema.plants.id)).where(includeInactive ? (0, _drizzleorm.eq)(_schema.plantInstances.userId, userId) : (0, _drizzleorm.and)((0, _drizzleorm.eq)(_schema.plantInstances.userId, userId), (0, _drizzleorm.eq)(_schema.plantInstances.isActive, true)));
        // Get recent care history for statistics
        const oneWeekAgo = new Date();
        oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);
        const recentCareHistory = await _db.db.select().from(_schema.careHistory).where((0, _drizzleorm.and)((0, _drizzleorm.eq)(_schema.careHistory.userId, userId), (0, _drizzleorm.gte)(_schema.careHistory.careDate, oneWeekAgo)));
        // Enhance plant instances with care calculations
        const enhancedPlants = plantInstancesData.map(({ plantInstance, plant })=>{
            if (!plant) return null;
            const careStatus = _carecalculator.CareCalculator.calculateCareStatus(plantInstance.fertilizerDue);
            const careUrgency = _carecalculator.CareCalculator.calculateCareUrgency(plantInstance.fertilizerDue);
            const daysUntilFertilizerDue = _carecalculator.CareCalculator.calculateDaysUntilFertilizerDue(plantInstance.fertilizerDue);
            const daysSinceLastFertilized = _carecalculator.CareCalculator.calculateDaysSinceLastFertilized(plantInstance.lastFertilized);
            const daysSinceLastRepot = _carecalculator.CareCalculator.calculateDaysSinceLastRepot(plantInstance.lastRepot);
            const displayName = plantInstance.nickname || plant.commonName;
            const primaryImage = plantInstance.images?.[0] || plant.defaultImage || null;
            return {
                ...plantInstance,
                plant,
                careStatus,
                careUrgency,
                daysUntilFertilizerDue,
                daysSinceLastFertilized,
                daysSinceLastRepot,
                displayName,
                primaryImage
            };
        }).filter((plant)=>plant !== null);
        // Categorize plants by care status
        const overdue = enhancedPlants.filter((p)=>p.careStatus === 'overdue');
        const dueToday = enhancedPlants.filter((p)=>p.careStatus === 'due_today');
        const dueSoon = enhancedPlants.filter((p)=>p.careStatus === 'due_soon');
        // Get recently cared plants (fertilized in last 3 days)
        const threeDaysAgo = new Date();
        threeDaysAgo.setDate(threeDaysAgo.getDate() - 3);
        const recentlyCared = enhancedPlants.filter((p)=>p.lastFertilized && p.lastFertilized >= threeDaysAgo);
        // Calculate care streak (consecutive days with proper care)
        const careStreakDays = this.calculateUserCareStreak(userId, recentCareHistory);
        // Calculate average care consistency across all plants
        const averageCareConsistency = enhancedPlants.length > 0 ? enhancedPlants.reduce((sum, plant)=>{
            // Simplified consistency calculation for dashboard
            const daysSince = plant.daysSinceLastFertilized || 0;
            const scheduleDays = _caretypes.careHelpers.parseFertilizerSchedule(plant.fertilizerSchedule);
            const consistency = Math.max(0, 100 - daysSince / scheduleDays * 50);
            return sum + consistency;
        }, 0) / enhancedPlants.length : 0;
        return {
            overdue,
            dueToday,
            dueSoon,
            recentlyCared,
            statistics: {
                totalActivePlants: enhancedPlants.length,
                overdueCount: overdue.length,
                dueTodayCount: dueToday.length,
                dueSoonCount: dueSoon.length,
                careStreakDays,
                totalCareEventsThisWeek: recentCareHistory.length,
                averageCareConsistency: Math.round(averageCareConsistency)
            },
            quickActions: _caretypes.careHelpers.getDefaultQuickCareActions()
        };
    }
    /**
   * Get care history count for a plant instance
   */ static async getCareHistoryCount(plantInstanceId, userId, careType) {
        const conditions = [
            (0, _drizzleorm.eq)(_schema.careHistory.plantInstanceId, plantInstanceId),
            (0, _drizzleorm.eq)(_schema.careHistory.userId, userId)
        ];
        if (careType) {
            conditions.push((0, _drizzleorm.eq)(_schema.careHistory.careType, careType));
        }
        const [result] = await _db.db.select({
            count: (0, _drizzleorm.count)()
        }).from(_schema.careHistory).where((0, _drizzleorm.and)(...conditions));
        return result.count;
    }
    /**
   * Get last care date for a specific care type
   */ static async getLastCareDate(plantInstanceId, userId, careType) {
        const [result] = await _db.db.select({
            careDate: _schema.careHistory.careDate
        }).from(_schema.careHistory).where((0, _drizzleorm.and)((0, _drizzleorm.eq)(_schema.careHistory.plantInstanceId, plantInstanceId), (0, _drizzleorm.eq)(_schema.careHistory.userId, userId), (0, _drizzleorm.eq)(_schema.careHistory.careType, careType))).orderBy((0, _drizzleorm.desc)(_schema.careHistory.careDate)).limit(1);
        return result?.careDate || null;
    }
    /**
   * Bulk create care history entries
   */ static async bulkCreateCareHistory(entries) {
        if (entries.length === 0) return [];
        const entriesWithTimestamps = entries.map((entry)=>({
                ...entry,
                createdAt: new Date(),
                updatedAt: new Date()
            }));
        return await _db.db.insert(_schema.careHistory).values(entriesWithTimestamps).returning();
    }
    /**
   * Private helper to enhance care history with computed properties
   */ static enhanceCareHistory(care, plantInstance, plant) {
        const now = new Date();
        const daysSinceCare = Math.floor((now.getTime() - care.careDate.getTime()) / (1000 * 60 * 60 * 24));
        const formattedDate = _caretypes.careHelpers.formatCareDate(care.careDate);
        const careTypeDisplay = _caretypes.careHelpers.getCareTypeDisplay(care.careType);
        return {
            ...care,
            plantInstance: plantInstance && plant ? {
                ...plantInstance,
                plant
            } : undefined,
            daysSinceCare,
            formattedDate,
            careTypeDisplay
        };
    }
    /**
   * Private helper to calculate user care streak
   */ static calculateUserCareStreak(userId, recentCareHistory) {
        // Simplified care streak calculation
        // Count consecutive days with at least one care event
        const careByDate = recentCareHistory.reduce((acc, care)=>{
            const dateKey = care.careDate.toISOString().split('T')[0];
            acc[dateKey] = true;
            return acc;
        }, {});
        let streak = 0;
        const today = new Date();
        for(let i = 0; i < 30; i++){
            const checkDate = new Date(today);
            checkDate.setDate(checkDate.getDate() - i);
            const dateKey = checkDate.toISOString().split('T')[0];
            if (careByDate[dateKey]) {
                streak++;
            } else if (i > 0) {
                break;
            }
        }
        return streak;
    }
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9zdGVmYW5iZWtrZXIvcHJvamVjdHMvZmFuY3ktcGxhbnRpZXMvc3JjL2xpYi9kYi9xdWVyaWVzL2NhcmUtaGlzdG9yeS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBkYiB9IGZyb20gJ0AvbGliL2RiJztcbmltcG9ydCB7IGNhcmVIaXN0b3J5LCBwbGFudEluc3RhbmNlcywgcGxhbnRzIH0gZnJvbSAnQC9saWIvZGIvc2NoZW1hJztcbmltcG9ydCB7IGVxLCBhbmQsIGRlc2MsIGFzYywgZ3RlLCBsdGUsIGluQXJyYXksIHNxbCwgY291bnQgfSBmcm9tICdkcml6emxlLW9ybSc7XG5pbXBvcnQgdHlwZSB7IFxuICBDYXJlSGlzdG9yeSwgXG4gIE5ld0NhcmVIaXN0b3J5LCBcbiAgUGxhbnRJbnN0YW5jZSxcbiAgUGxhbnQgXG59IGZyb20gJ0AvbGliL2RiL3NjaGVtYSc7XG5pbXBvcnQgdHlwZSB7IEVuaGFuY2VkUGxhbnRJbnN0YW5jZSB9IGZyb20gJ0AvbGliL3R5cGVzL3BsYW50LWluc3RhbmNlLXR5cGVzJztcbmltcG9ydCB0eXBlIHsgXG4gIENhcmVGaWx0ZXJJbnB1dCxcbiAgQ2FyZVN0YXRzUXVlcnlJbnB1dCxcbiAgQ2FyZURhc2hib2FyZFF1ZXJ5SW5wdXQgXG59IGZyb20gJ0AvbGliL3ZhbGlkYXRpb24vY2FyZS1zY2hlbWFzJztcbmltcG9ydCB0eXBlIHsgXG4gIEVuaGFuY2VkQ2FyZUhpc3RvcnksXG4gIFBsYW50Q2FyZVN0YXRpc3RpY3MsXG4gIENhcmVEYXNoYm9hcmREYXRhLFxuICBDYXJlVHlwZVxufSBmcm9tICdAL2xpYi90eXBlcy9jYXJlLXR5cGVzJztcbmltcG9ydCB7IENhcmVDYWxjdWxhdG9yIH0gZnJvbSAnQC9saWIvc2VydmljZXMvY2FyZS1jYWxjdWxhdG9yJztcbmltcG9ydCB7IGNhcmVIZWxwZXJzIH0gZnJvbSAnQC9saWIvdHlwZXMvY2FyZS10eXBlcyc7XG5cbi8qKlxuICogRGF0YWJhc2UgcXVlcmllcyBmb3IgY2FyZSBoaXN0b3J5IG1hbmFnZW1lbnRcbiAqL1xuZXhwb3J0IGNsYXNzIENhcmVIaXN0b3J5UXVlcmllcyB7XG4gIC8qKlxuICAgKiBDcmVhdGUgYSBuZXcgY2FyZSBoaXN0b3J5IGVudHJ5XG4gICAqL1xuICBzdGF0aWMgYXN5bmMgY3JlYXRlQ2FyZUhpc3RvcnkoZGF0YTogTmV3Q2FyZUhpc3RvcnkpOiBQcm9taXNlPENhcmVIaXN0b3J5PiB7XG4gICAgY29uc3QgW2NhcmVFbnRyeV0gPSBhd2FpdCBkYlxuICAgICAgLmluc2VydChjYXJlSGlzdG9yeSlcbiAgICAgIC52YWx1ZXMoe1xuICAgICAgICAuLi5kYXRhLFxuICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH0pXG4gICAgICAucmV0dXJuaW5nKCk7XG5cbiAgICByZXR1cm4gY2FyZUVudHJ5O1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBjYXJlIGhpc3RvcnkgYnkgSURcbiAgICovXG4gIHN0YXRpYyBhc3luYyBnZXRDYXJlSGlzdG9yeUJ5SWQoaWQ6IG51bWJlcik6IFByb21pc2U8Q2FyZUhpc3RvcnkgfCBudWxsPiB7XG4gICAgY29uc3QgW2NhcmVFbnRyeV0gPSBhd2FpdCBkYlxuICAgICAgLnNlbGVjdCgpXG4gICAgICAuZnJvbShjYXJlSGlzdG9yeSlcbiAgICAgIC53aGVyZShlcShjYXJlSGlzdG9yeS5pZCwgaWQpKVxuICAgICAgLmxpbWl0KDEpO1xuXG4gICAgcmV0dXJuIGNhcmVFbnRyeSB8fCBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBjYXJlIGhpc3RvcnkgZm9yIGEgc3BlY2lmaWMgcGxhbnQgaW5zdGFuY2VcbiAgICovXG4gIHN0YXRpYyBhc3luYyBnZXRDYXJlSGlzdG9yeUZvclBsYW50KFxuICAgIHBsYW50SW5zdGFuY2VJZDogbnVtYmVyLFxuICAgIHVzZXJJZDogbnVtYmVyLFxuICAgIGZpbHRlcnM/OiBQYXJ0aWFsPENhcmVGaWx0ZXJJbnB1dD5cbiAgKTogUHJvbWlzZTxFbmhhbmNlZENhcmVIaXN0b3J5W10+IHtcbiAgICAvLyBCdWlsZCB3aGVyZSBjb25kaXRpb25zXG4gICAgY29uc3QgY29uZGl0aW9ucyA9IFtcbiAgICAgIGVxKGNhcmVIaXN0b3J5LnBsYW50SW5zdGFuY2VJZCwgcGxhbnRJbnN0YW5jZUlkKSxcbiAgICAgIGVxKGNhcmVIaXN0b3J5LnVzZXJJZCwgdXNlcklkKVxuICAgIF07XG5cbiAgICBpZiAoZmlsdGVycz8uY2FyZVR5cGUpIHtcbiAgICAgIGNvbmRpdGlvbnMucHVzaChlcShjYXJlSGlzdG9yeS5jYXJlVHlwZSwgZmlsdGVycy5jYXJlVHlwZSkpO1xuICAgIH1cblxuICAgIGlmIChmaWx0ZXJzPy5zdGFydERhdGUpIHtcbiAgICAgIGNvbmRpdGlvbnMucHVzaChndGUoY2FyZUhpc3RvcnkuY2FyZURhdGUsIGZpbHRlcnMuc3RhcnREYXRlKSk7XG4gICAgfVxuXG4gICAgaWYgKGZpbHRlcnM/LmVuZERhdGUpIHtcbiAgICAgIGNvbmRpdGlvbnMucHVzaChsdGUoY2FyZUhpc3RvcnkuY2FyZURhdGUsIGZpbHRlcnMuZW5kRGF0ZSkpO1xuICAgIH1cblxuICAgIC8vIEFwcGx5IHNvcnRpbmdcbiAgICBjb25zdCBzb3J0RmllbGQgPSBmaWx0ZXJzPy5zb3J0QnkgPT09ICdjYXJlX3R5cGUnID8gY2FyZUhpc3RvcnkuY2FyZVR5cGUgOlxuICAgICAgICAgICAgICAgICAgICAgZmlsdGVycz8uc29ydEJ5ID09PSAnY3JlYXRlZF9hdCcgPyBjYXJlSGlzdG9yeS5jcmVhdGVkQXQgOlxuICAgICAgICAgICAgICAgICAgICAgY2FyZUhpc3RvcnkuY2FyZURhdGU7XG4gICAgXG4gICAgY29uc3Qgc29ydE9yZGVyID0gZmlsdGVycz8uc29ydE9yZGVyID09PSAnYXNjJyA/IGFzYyhzb3J0RmllbGQpIDogZGVzYyhzb3J0RmllbGQpO1xuXG4gICAgLy8gQnVpbGQgdGhlIHF1ZXJ5XG4gICAgbGV0IHF1ZXJ5ID0gZGJcbiAgICAgIC5zZWxlY3Qoe1xuICAgICAgICBjYXJlSGlzdG9yeTogY2FyZUhpc3RvcnksXG4gICAgICAgIHBsYW50SW5zdGFuY2U6IHBsYW50SW5zdGFuY2VzLFxuICAgICAgICBwbGFudDogcGxhbnRzLFxuICAgICAgfSlcbiAgICAgIC5mcm9tKGNhcmVIaXN0b3J5KVxuICAgICAgLmxlZnRKb2luKHBsYW50SW5zdGFuY2VzLCBlcShjYXJlSGlzdG9yeS5wbGFudEluc3RhbmNlSWQsIHBsYW50SW5zdGFuY2VzLmlkKSlcbiAgICAgIC5sZWZ0Sm9pbihwbGFudHMsIGVxKHBsYW50SW5zdGFuY2VzLnBsYW50SWQsIHBsYW50cy5pZCkpXG4gICAgICAud2hlcmUoYW5kKC4uLmNvbmRpdGlvbnMpKVxuICAgICAgLm9yZGVyQnkoc29ydE9yZGVyKTtcblxuICAgIC8vIEFwcGx5IHBhZ2luYXRpb25cbiAgICBpZiAoZmlsdGVycz8ubGltaXQpIHtcbiAgICAgIHF1ZXJ5ID0gcXVlcnkubGltaXQoZmlsdGVycy5saW1pdCkgYXMgYW55O1xuICAgIH1cbiAgICBpZiAoZmlsdGVycz8ub2Zmc2V0KSB7XG4gICAgICBxdWVyeSA9IHF1ZXJ5Lm9mZnNldChmaWx0ZXJzLm9mZnNldCkgYXMgYW55O1xuICAgIH1cblxuICAgIGNvbnN0IHJlc3VsdHMgPSBhd2FpdCBxdWVyeTtcblxuICAgIHJldHVybiByZXN1bHRzLm1hcChyZXN1bHQgPT4gdGhpcy5lbmhhbmNlQ2FyZUhpc3RvcnkocmVzdWx0LmNhcmVIaXN0b3J5LCByZXN1bHQucGxhbnRJbnN0YW5jZSwgcmVzdWx0LnBsYW50KSk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGNhcmUgaGlzdG9yeSBmb3IgbXVsdGlwbGUgcGxhbnQgaW5zdGFuY2VzIChmb3IgZGFzaGJvYXJkKVxuICAgKi9cbiAgc3RhdGljIGFzeW5jIGdldENhcmVIaXN0b3J5Rm9yUGxhbnRzKFxuICAgIHBsYW50SW5zdGFuY2VJZHM6IG51bWJlcltdLFxuICAgIHVzZXJJZDogbnVtYmVyLFxuICAgIGZpbHRlcnM/OiBQYXJ0aWFsPENhcmVGaWx0ZXJJbnB1dD5cbiAgKTogUHJvbWlzZTxFbmhhbmNlZENhcmVIaXN0b3J5W10+IHtcbiAgICBpZiAocGxhbnRJbnN0YW5jZUlkcy5sZW5ndGggPT09IDApIHJldHVybiBbXTtcblxuICAgIC8vIEJ1aWxkIHdoZXJlIGNvbmRpdGlvbnNcbiAgICBjb25zdCBjb25kaXRpb25zID0gW1xuICAgICAgaW5BcnJheShjYXJlSGlzdG9yeS5wbGFudEluc3RhbmNlSWQsIHBsYW50SW5zdGFuY2VJZHMpLFxuICAgICAgZXEoY2FyZUhpc3RvcnkudXNlcklkLCB1c2VySWQpXG4gICAgXTtcblxuICAgIGlmIChmaWx0ZXJzPy5jYXJlVHlwZSkge1xuICAgICAgY29uZGl0aW9ucy5wdXNoKGVxKGNhcmVIaXN0b3J5LmNhcmVUeXBlLCBmaWx0ZXJzLmNhcmVUeXBlKSk7XG4gICAgfVxuXG4gICAgaWYgKGZpbHRlcnM/LnN0YXJ0RGF0ZSkge1xuICAgICAgY29uZGl0aW9ucy5wdXNoKGd0ZShjYXJlSGlzdG9yeS5jYXJlRGF0ZSwgZmlsdGVycy5zdGFydERhdGUpKTtcbiAgICB9XG5cbiAgICBpZiAoZmlsdGVycz8uZW5kRGF0ZSkge1xuICAgICAgY29uZGl0aW9ucy5wdXNoKGx0ZShjYXJlSGlzdG9yeS5jYXJlRGF0ZSwgZmlsdGVycy5lbmREYXRlKSk7XG4gICAgfVxuXG4gICAgLy8gQXBwbHkgc29ydGluZ1xuICAgIGNvbnN0IHNvcnRGaWVsZCA9IGZpbHRlcnM/LnNvcnRCeSA9PT0gJ2NhcmVfdHlwZScgPyBjYXJlSGlzdG9yeS5jYXJlVHlwZSA6XG4gICAgICAgICAgICAgICAgICAgICBmaWx0ZXJzPy5zb3J0QnkgPT09ICdjcmVhdGVkX2F0JyA/IGNhcmVIaXN0b3J5LmNyZWF0ZWRBdCA6XG4gICAgICAgICAgICAgICAgICAgICBjYXJlSGlzdG9yeS5jYXJlRGF0ZTtcbiAgICBcbiAgICBjb25zdCBzb3J0T3JkZXIgPSBmaWx0ZXJzPy5zb3J0T3JkZXIgPT09ICdhc2MnID8gYXNjKHNvcnRGaWVsZCkgOiBkZXNjKHNvcnRGaWVsZCk7XG5cbiAgICAvLyBCdWlsZCB0aGUgcXVlcnlcbiAgICBsZXQgcXVlcnkgPSBkYlxuICAgICAgLnNlbGVjdCh7XG4gICAgICAgIGNhcmVIaXN0b3J5OiBjYXJlSGlzdG9yeSxcbiAgICAgICAgcGxhbnRJbnN0YW5jZTogcGxhbnRJbnN0YW5jZXMsXG4gICAgICAgIHBsYW50OiBwbGFudHMsXG4gICAgICB9KVxuICAgICAgLmZyb20oY2FyZUhpc3RvcnkpXG4gICAgICAubGVmdEpvaW4ocGxhbnRJbnN0YW5jZXMsIGVxKGNhcmVIaXN0b3J5LnBsYW50SW5zdGFuY2VJZCwgcGxhbnRJbnN0YW5jZXMuaWQpKVxuICAgICAgLmxlZnRKb2luKHBsYW50cywgZXEocGxhbnRJbnN0YW5jZXMucGxhbnRJZCwgcGxhbnRzLmlkKSlcbiAgICAgIC53aGVyZShhbmQoLi4uY29uZGl0aW9ucykpXG4gICAgICAub3JkZXJCeShzb3J0T3JkZXIpO1xuXG4gICAgLy8gQXBwbHkgcGFnaW5hdGlvblxuICAgIGlmIChmaWx0ZXJzPy5saW1pdCkge1xuICAgICAgcXVlcnkgPSBxdWVyeS5saW1pdChmaWx0ZXJzLmxpbWl0KSBhcyBhbnk7XG4gICAgfVxuICAgIGlmIChmaWx0ZXJzPy5vZmZzZXQpIHtcbiAgICAgIHF1ZXJ5ID0gcXVlcnkub2Zmc2V0KGZpbHRlcnMub2Zmc2V0KSBhcyBhbnk7XG4gICAgfVxuXG4gICAgY29uc3QgcmVzdWx0cyA9IGF3YWl0IHF1ZXJ5O1xuXG4gICAgcmV0dXJuIHJlc3VsdHMubWFwKHJlc3VsdCA9PiB0aGlzLmVuaGFuY2VDYXJlSGlzdG9yeShyZXN1bHQuY2FyZUhpc3RvcnksIHJlc3VsdC5wbGFudEluc3RhbmNlLCByZXN1bHQucGxhbnQpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgcmVjZW50IGNhcmUgaGlzdG9yeSBmb3IgYSB1c2VyXG4gICAqL1xuICBzdGF0aWMgYXN5bmMgZ2V0UmVjZW50Q2FyZUhpc3RvcnkoXG4gICAgdXNlcklkOiBudW1iZXIsXG4gICAgbGltaXQ6IG51bWJlciA9IDIwXG4gICk6IFByb21pc2U8RW5oYW5jZWRDYXJlSGlzdG9yeVtdPiB7XG4gICAgY29uc3QgcmVzdWx0cyA9IGF3YWl0IGRiXG4gICAgICAuc2VsZWN0KHtcbiAgICAgICAgY2FyZUhpc3Rvcnk6IGNhcmVIaXN0b3J5LFxuICAgICAgICBwbGFudEluc3RhbmNlOiBwbGFudEluc3RhbmNlcyxcbiAgICAgICAgcGxhbnQ6IHBsYW50cyxcbiAgICAgIH0pXG4gICAgICAuZnJvbShjYXJlSGlzdG9yeSlcbiAgICAgIC5sZWZ0Sm9pbihwbGFudEluc3RhbmNlcywgZXEoY2FyZUhpc3RvcnkucGxhbnRJbnN0YW5jZUlkLCBwbGFudEluc3RhbmNlcy5pZCkpXG4gICAgICAubGVmdEpvaW4ocGxhbnRzLCBlcShwbGFudEluc3RhbmNlcy5wbGFudElkLCBwbGFudHMuaWQpKVxuICAgICAgLndoZXJlKGVxKGNhcmVIaXN0b3J5LnVzZXJJZCwgdXNlcklkKSlcbiAgICAgIC5vcmRlckJ5KGRlc2MoY2FyZUhpc3RvcnkuY2FyZURhdGUpKVxuICAgICAgLmxpbWl0KGxpbWl0KTtcblxuICAgIHJldHVybiByZXN1bHRzLm1hcChyZXN1bHQgPT4gdGhpcy5lbmhhbmNlQ2FyZUhpc3RvcnkocmVzdWx0LmNhcmVIaXN0b3J5LCByZXN1bHQucGxhbnRJbnN0YW5jZSwgcmVzdWx0LnBsYW50KSk7XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIGNhcmUgaGlzdG9yeSBlbnRyeVxuICAgKi9cbiAgc3RhdGljIGFzeW5jIHVwZGF0ZUNhcmVIaXN0b3J5KFxuICAgIGlkOiBudW1iZXIsXG4gICAgdXNlcklkOiBudW1iZXIsXG4gICAgdXBkYXRlczogUGFydGlhbDxOZXdDYXJlSGlzdG9yeT5cbiAgKTogUHJvbWlzZTxDYXJlSGlzdG9yeSB8IG51bGw+IHtcbiAgICBjb25zdCBbdXBkYXRlZF0gPSBhd2FpdCBkYlxuICAgICAgLnVwZGF0ZShjYXJlSGlzdG9yeSlcbiAgICAgIC5zZXQoe1xuICAgICAgICAuLi51cGRhdGVzLFxuICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9KVxuICAgICAgLndoZXJlKFxuICAgICAgICBhbmQoXG4gICAgICAgICAgZXEoY2FyZUhpc3RvcnkuaWQsIGlkKSxcbiAgICAgICAgICBlcShjYXJlSGlzdG9yeS51c2VySWQsIHVzZXJJZClcbiAgICAgICAgKVxuICAgICAgKVxuICAgICAgLnJldHVybmluZygpO1xuXG4gICAgcmV0dXJuIHVwZGF0ZWQgfHwgbnVsbDtcbiAgfVxuXG4gIC8qKlxuICAgKiBEZWxldGUgY2FyZSBoaXN0b3J5IGVudHJ5XG4gICAqL1xuICBzdGF0aWMgYXN5bmMgZGVsZXRlQ2FyZUhpc3RvcnkoaWQ6IG51bWJlciwgdXNlcklkOiBudW1iZXIpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICBjb25zb2xlLmxvZygnQXR0ZW1wdGluZyB0byBkZWxldGUgY2FyZTonLCBpZCwgJ2ZvciB1c2VyOicsIHVzZXJJZCk7XG4gICAgXG4gICAgLy8gRmlyc3QgY2hlY2sgaWYgcmVjb3JkIGV4aXN0c1xuICAgIGNvbnN0IGV4aXN0aW5nID0gYXdhaXQgZGJcbiAgICAgIC5zZWxlY3QoKVxuICAgICAgLmZyb20oY2FyZUhpc3RvcnkpXG4gICAgICAud2hlcmUoZXEoY2FyZUhpc3RvcnkuaWQsIGlkKSlcbiAgICAgIC5saW1pdCgxKTtcbiAgICBcbiAgICBjb25zb2xlLmxvZygnRXhpc3RpbmcgcmVjb3JkOicsIGV4aXN0aW5nKTtcbiAgICBcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJcbiAgICAgICAgLmRlbGV0ZShjYXJlSGlzdG9yeSlcbiAgICAgICAgLndoZXJlKFxuICAgICAgICAgIGFuZChcbiAgICAgICAgICAgIGVxKGNhcmVIaXN0b3J5LmlkLCBpZCksXG4gICAgICAgICAgICBlcShjYXJlSGlzdG9yeS51c2VySWQsIHVzZXJJZClcbiAgICAgICAgICApXG4gICAgICAgICk7XG5cbiAgICAgIGNvbnNvbGUubG9nKCdEZWxldGUgcmVzdWx0OicsIHJlc3VsdCwgJ0xlbmd0aDonLCByZXN1bHQubGVuZ3RoKTtcbiAgICAgIFxuICAgICAgLy8gRG91YmxlIGNoZWNrIGJ5IHRyeWluZyB0byBmZXRjaCB0aGUgcmVjb3JkIGFnYWluXG4gICAgICBjb25zdCBzdGlsbEV4aXN0cyA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAuZnJvbShjYXJlSGlzdG9yeSlcbiAgICAgICAgLndoZXJlKGVxKGNhcmVIaXN0b3J5LmlkLCBpZCkpXG4gICAgICAgIC5saW1pdCgxKTtcbiAgICAgICAgXG4gICAgICBjb25zb2xlLmxvZygnUmVjb3JkIHN0aWxsIGV4aXN0cyBhZnRlciBkZWxldGU6Jywgc3RpbGxFeGlzdHMubGVuZ3RoID4gMCk7XG4gICAgICBcbiAgICAgIHJldHVybiByZXN1bHQubGVuZ3RoID4gMDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRGVsZXRlIGVycm9yOicsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgY2FyZSBzdGF0aXN0aWNzIGZvciBhIHBsYW50IGluc3RhbmNlXG4gICAqL1xuICBzdGF0aWMgYXN5bmMgZ2V0UGxhbnRDYXJlU3RhdGlzdGljcyhcbiAgICBwbGFudEluc3RhbmNlSWQ6IG51bWJlcixcbiAgICB1c2VySWQ6IG51bWJlclxuICApOiBQcm9taXNlPFBsYW50Q2FyZVN0YXRpc3RpY3MgfCBudWxsPiB7XG4gICAgLy8gR2V0IHBsYW50IGluc3RhbmNlXG4gICAgY29uc3QgW3BsYW50SW5zdGFuY2VdID0gYXdhaXQgZGJcbiAgICAgIC5zZWxlY3QoKVxuICAgICAgLmZyb20ocGxhbnRJbnN0YW5jZXMpXG4gICAgICAud2hlcmUoXG4gICAgICAgIGFuZChcbiAgICAgICAgICBlcShwbGFudEluc3RhbmNlcy5pZCwgcGxhbnRJbnN0YW5jZUlkKSxcbiAgICAgICAgICBlcShwbGFudEluc3RhbmNlcy51c2VySWQsIHVzZXJJZClcbiAgICAgICAgKVxuICAgICAgKVxuICAgICAgLmxpbWl0KDEpO1xuXG4gICAgaWYgKCFwbGFudEluc3RhbmNlKSByZXR1cm4gbnVsbDtcblxuICAgIC8vIEdldCBjYXJlIGhpc3RvcnlcbiAgICBjb25zdCBjYXJlSGlzdG9yeURhdGEgPSBhd2FpdCBkYlxuICAgICAgLnNlbGVjdCgpXG4gICAgICAuZnJvbShjYXJlSGlzdG9yeSlcbiAgICAgIC53aGVyZShcbiAgICAgICAgYW5kKFxuICAgICAgICAgIGVxKGNhcmVIaXN0b3J5LnBsYW50SW5zdGFuY2VJZCwgcGxhbnRJbnN0YW5jZUlkKSxcbiAgICAgICAgICBlcShjYXJlSGlzdG9yeS51c2VySWQsIHVzZXJJZClcbiAgICAgICAgKVxuICAgICAgKVxuICAgICAgLm9yZGVyQnkoYXNjKGNhcmVIaXN0b3J5LmNhcmVEYXRlKSk7XG5cbiAgICByZXR1cm4gQ2FyZUNhbGN1bGF0b3IuY2FsY3VsYXRlUGxhbnRDYXJlU3RhdGlzdGljcyhwbGFudEluc3RhbmNlLCBjYXJlSGlzdG9yeURhdGEpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBjYXJlIHN0YXRpc3RpY3MgZm9yIG11bHRpcGxlIHBsYW50c1xuICAgKi9cbiAgc3RhdGljIGFzeW5jIGdldEJ1bGtDYXJlU3RhdGlzdGljcyhcbiAgICBwbGFudEluc3RhbmNlSWRzOiBudW1iZXJbXSxcbiAgICB1c2VySWQ6IG51bWJlclxuICApOiBQcm9taXNlPFBsYW50Q2FyZVN0YXRpc3RpY3NbXT4ge1xuICAgIGlmIChwbGFudEluc3RhbmNlSWRzLmxlbmd0aCA9PT0gMCkgcmV0dXJuIFtdO1xuXG4gICAgLy8gR2V0IHBsYW50IGluc3RhbmNlc1xuICAgIGNvbnN0IHBsYW50SW5zdGFuY2VzRGF0YSA9IGF3YWl0IGRiXG4gICAgICAuc2VsZWN0KClcbiAgICAgIC5mcm9tKHBsYW50SW5zdGFuY2VzKVxuICAgICAgLndoZXJlKFxuICAgICAgICBhbmQoXG4gICAgICAgICAgaW5BcnJheShwbGFudEluc3RhbmNlcy5pZCwgcGxhbnRJbnN0YW5jZUlkcyksXG4gICAgICAgICAgZXEocGxhbnRJbnN0YW5jZXMudXNlcklkLCB1c2VySWQpXG4gICAgICAgIClcbiAgICAgICk7XG5cbiAgICAvLyBHZXQgY2FyZSBoaXN0b3J5IGZvciBhbGwgcGxhbnRzXG4gICAgY29uc3QgY2FyZUhpc3RvcnlEYXRhID0gYXdhaXQgZGJcbiAgICAgIC5zZWxlY3QoKVxuICAgICAgLmZyb20oY2FyZUhpc3RvcnkpXG4gICAgICAud2hlcmUoXG4gICAgICAgIGFuZChcbiAgICAgICAgICBpbkFycmF5KGNhcmVIaXN0b3J5LnBsYW50SW5zdGFuY2VJZCwgcGxhbnRJbnN0YW5jZUlkcyksXG4gICAgICAgICAgZXEoY2FyZUhpc3RvcnkudXNlcklkLCB1c2VySWQpXG4gICAgICAgIClcbiAgICAgIClcbiAgICAgIC5vcmRlckJ5KGFzYyhjYXJlSGlzdG9yeS5jYXJlRGF0ZSkpO1xuXG4gICAgLy8gR3JvdXAgY2FyZSBoaXN0b3J5IGJ5IHBsYW50IGluc3RhbmNlXG4gICAgY29uc3QgY2FyZUhpc3RvcnlCeVBsYW50ID0gY2FyZUhpc3RvcnlEYXRhLnJlZHVjZSgoYWNjLCBjYXJlKSA9PiB7XG4gICAgICBpZiAoIWFjY1tjYXJlLnBsYW50SW5zdGFuY2VJZF0pIHtcbiAgICAgICAgYWNjW2NhcmUucGxhbnRJbnN0YW5jZUlkXSA9IFtdO1xuICAgICAgfVxuICAgICAgYWNjW2NhcmUucGxhbnRJbnN0YW5jZUlkXS5wdXNoKGNhcmUpO1xuICAgICAgcmV0dXJuIGFjYztcbiAgICB9LCB7fSBhcyBSZWNvcmQ8bnVtYmVyLCBDYXJlSGlzdG9yeVtdPik7XG5cbiAgICAvLyBDYWxjdWxhdGUgc3RhdGlzdGljcyBmb3IgZWFjaCBwbGFudFxuICAgIHJldHVybiBwbGFudEluc3RhbmNlc0RhdGEubWFwKHBsYW50SW5zdGFuY2UgPT4gXG4gICAgICBDYXJlQ2FsY3VsYXRvci5jYWxjdWxhdGVQbGFudENhcmVTdGF0aXN0aWNzKFxuICAgICAgICBwbGFudEluc3RhbmNlLCBcbiAgICAgICAgY2FyZUhpc3RvcnlCeVBsYW50W3BsYW50SW5zdGFuY2UuaWRdIHx8IFtdXG4gICAgICApXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgY2FyZSBkYXNoYm9hcmQgZGF0YVxuICAgKi9cbiAgc3RhdGljIGFzeW5jIGdldENhcmVEYXNoYm9hcmREYXRhKFxuICAgIHVzZXJJZDogbnVtYmVyLFxuICAgIG9wdGlvbnM6IFBhcnRpYWw8Q2FyZURhc2hib2FyZFF1ZXJ5SW5wdXQ+ID0ge31cbiAgKTogUHJvbWlzZTxDYXJlRGFzaGJvYXJkRGF0YT4ge1xuICAgIGNvbnN0IHsgaW5jbHVkZUluYWN0aXZlID0gZmFsc2UsIGRheXNBaGVhZCA9IDcgfSA9IG9wdGlvbnM7XG5cbiAgICAvLyBHZXQgYWxsIHBsYW50IGluc3RhbmNlcyBmb3IgdGhlIHVzZXJcbiAgICBjb25zdCBwbGFudEluc3RhbmNlc0RhdGEgPSBhd2FpdCBkYlxuICAgICAgLnNlbGVjdCh7XG4gICAgICAgIHBsYW50SW5zdGFuY2U6IHBsYW50SW5zdGFuY2VzLFxuICAgICAgICBwbGFudDogcGxhbnRzLFxuICAgICAgfSlcbiAgICAgIC5mcm9tKHBsYW50SW5zdGFuY2VzKVxuICAgICAgLmxlZnRKb2luKHBsYW50cywgZXEocGxhbnRJbnN0YW5jZXMucGxhbnRJZCwgcGxhbnRzLmlkKSlcbiAgICAgIC53aGVyZShcbiAgICAgICAgaW5jbHVkZUluYWN0aXZlIFxuICAgICAgICAgID8gZXEocGxhbnRJbnN0YW5jZXMudXNlcklkLCB1c2VySWQpXG4gICAgICAgICAgOiBhbmQoXG4gICAgICAgICAgICAgIGVxKHBsYW50SW5zdGFuY2VzLnVzZXJJZCwgdXNlcklkKSxcbiAgICAgICAgICAgICAgZXEocGxhbnRJbnN0YW5jZXMuaXNBY3RpdmUsIHRydWUpXG4gICAgICAgICAgICApXG4gICAgICApO1xuXG4gICAgLy8gR2V0IHJlY2VudCBjYXJlIGhpc3RvcnkgZm9yIHN0YXRpc3RpY3NcbiAgICBjb25zdCBvbmVXZWVrQWdvID0gbmV3IERhdGUoKTtcbiAgICBvbmVXZWVrQWdvLnNldERhdGUob25lV2Vla0Fnby5nZXREYXRlKCkgLSA3KTtcblxuICAgIGNvbnN0IHJlY2VudENhcmVIaXN0b3J5ID0gYXdhaXQgZGJcbiAgICAgIC5zZWxlY3QoKVxuICAgICAgLmZyb20oY2FyZUhpc3RvcnkpXG4gICAgICAud2hlcmUoXG4gICAgICAgIGFuZChcbiAgICAgICAgICBlcShjYXJlSGlzdG9yeS51c2VySWQsIHVzZXJJZCksXG4gICAgICAgICAgZ3RlKGNhcmVIaXN0b3J5LmNhcmVEYXRlLCBvbmVXZWVrQWdvKVxuICAgICAgICApXG4gICAgICApO1xuXG4gICAgLy8gRW5oYW5jZSBwbGFudCBpbnN0YW5jZXMgd2l0aCBjYXJlIGNhbGN1bGF0aW9uc1xuICAgIGNvbnN0IGVuaGFuY2VkUGxhbnRzID0gcGxhbnRJbnN0YW5jZXNEYXRhLm1hcCgoeyBwbGFudEluc3RhbmNlLCBwbGFudCB9KSA9PiB7XG4gICAgICBpZiAoIXBsYW50KSByZXR1cm4gbnVsbDtcbiAgICAgIFxuICAgICAgY29uc3QgY2FyZVN0YXR1cyA9IENhcmVDYWxjdWxhdG9yLmNhbGN1bGF0ZUNhcmVTdGF0dXMocGxhbnRJbnN0YW5jZS5mZXJ0aWxpemVyRHVlKTtcbiAgICAgIGNvbnN0IGNhcmVVcmdlbmN5ID0gQ2FyZUNhbGN1bGF0b3IuY2FsY3VsYXRlQ2FyZVVyZ2VuY3kocGxhbnRJbnN0YW5jZS5mZXJ0aWxpemVyRHVlKTtcbiAgICAgIGNvbnN0IGRheXNVbnRpbEZlcnRpbGl6ZXJEdWUgPSBDYXJlQ2FsY3VsYXRvci5jYWxjdWxhdGVEYXlzVW50aWxGZXJ0aWxpemVyRHVlKHBsYW50SW5zdGFuY2UuZmVydGlsaXplckR1ZSk7XG4gICAgICBjb25zdCBkYXlzU2luY2VMYXN0RmVydGlsaXplZCA9IENhcmVDYWxjdWxhdG9yLmNhbGN1bGF0ZURheXNTaW5jZUxhc3RGZXJ0aWxpemVkKHBsYW50SW5zdGFuY2UubGFzdEZlcnRpbGl6ZWQpO1xuICAgICAgY29uc3QgZGF5c1NpbmNlTGFzdFJlcG90ID0gQ2FyZUNhbGN1bGF0b3IuY2FsY3VsYXRlRGF5c1NpbmNlTGFzdFJlcG90KHBsYW50SW5zdGFuY2UubGFzdFJlcG90KTtcbiAgICAgIGNvbnN0IGRpc3BsYXlOYW1lID0gcGxhbnRJbnN0YW5jZS5uaWNrbmFtZSB8fCBwbGFudC5jb21tb25OYW1lO1xuICAgICAgY29uc3QgcHJpbWFyeUltYWdlID0gcGxhbnRJbnN0YW5jZS5pbWFnZXM/LlswXSB8fCBwbGFudC5kZWZhdWx0SW1hZ2UgfHwgbnVsbDtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgLi4ucGxhbnRJbnN0YW5jZSxcbiAgICAgICAgcGxhbnQsXG4gICAgICAgIGNhcmVTdGF0dXMsXG4gICAgICAgIGNhcmVVcmdlbmN5LFxuICAgICAgICBkYXlzVW50aWxGZXJ0aWxpemVyRHVlLFxuICAgICAgICBkYXlzU2luY2VMYXN0RmVydGlsaXplZCxcbiAgICAgICAgZGF5c1NpbmNlTGFzdFJlcG90LFxuICAgICAgICBkaXNwbGF5TmFtZSxcbiAgICAgICAgcHJpbWFyeUltYWdlLFxuICAgICAgfTtcbiAgICB9KS5maWx0ZXIoKHBsYW50KTogcGxhbnQgaXMgRW5oYW5jZWRQbGFudEluc3RhbmNlID0+IHBsYW50ICE9PSBudWxsKTtcblxuICAgIC8vIENhdGVnb3JpemUgcGxhbnRzIGJ5IGNhcmUgc3RhdHVzXG4gICAgY29uc3Qgb3ZlcmR1ZSA9IGVuaGFuY2VkUGxhbnRzLmZpbHRlcihwID0+IHAuY2FyZVN0YXR1cyA9PT0gJ292ZXJkdWUnKTtcbiAgICBjb25zdCBkdWVUb2RheSA9IGVuaGFuY2VkUGxhbnRzLmZpbHRlcihwID0+IHAuY2FyZVN0YXR1cyA9PT0gJ2R1ZV90b2RheScpO1xuICAgIGNvbnN0IGR1ZVNvb24gPSBlbmhhbmNlZFBsYW50cy5maWx0ZXIocCA9PiBwLmNhcmVTdGF0dXMgPT09ICdkdWVfc29vbicpO1xuICAgIFxuICAgIC8vIEdldCByZWNlbnRseSBjYXJlZCBwbGFudHMgKGZlcnRpbGl6ZWQgaW4gbGFzdCAzIGRheXMpXG4gICAgY29uc3QgdGhyZWVEYXlzQWdvID0gbmV3IERhdGUoKTtcbiAgICB0aHJlZURheXNBZ28uc2V0RGF0ZSh0aHJlZURheXNBZ28uZ2V0RGF0ZSgpIC0gMyk7XG4gICAgY29uc3QgcmVjZW50bHlDYXJlZCA9IGVuaGFuY2VkUGxhbnRzLmZpbHRlcihwID0+IFxuICAgICAgcC5sYXN0RmVydGlsaXplZCAmJiBwLmxhc3RGZXJ0aWxpemVkID49IHRocmVlRGF5c0Fnb1xuICAgICk7XG5cbiAgICAvLyBDYWxjdWxhdGUgY2FyZSBzdHJlYWsgKGNvbnNlY3V0aXZlIGRheXMgd2l0aCBwcm9wZXIgY2FyZSlcbiAgICBjb25zdCBjYXJlU3RyZWFrRGF5cyA9IHRoaXMuY2FsY3VsYXRlVXNlckNhcmVTdHJlYWsodXNlcklkLCByZWNlbnRDYXJlSGlzdG9yeSk7XG5cbiAgICAvLyBDYWxjdWxhdGUgYXZlcmFnZSBjYXJlIGNvbnNpc3RlbmN5IGFjcm9zcyBhbGwgcGxhbnRzXG4gICAgY29uc3QgYXZlcmFnZUNhcmVDb25zaXN0ZW5jeSA9IGVuaGFuY2VkUGxhbnRzLmxlbmd0aCA+IDBcbiAgICAgID8gZW5oYW5jZWRQbGFudHMucmVkdWNlKChzdW0sIHBsYW50KSA9PiB7XG4gICAgICAgICAgLy8gU2ltcGxpZmllZCBjb25zaXN0ZW5jeSBjYWxjdWxhdGlvbiBmb3IgZGFzaGJvYXJkXG4gICAgICAgICAgY29uc3QgZGF5c1NpbmNlID0gcGxhbnQuZGF5c1NpbmNlTGFzdEZlcnRpbGl6ZWQgfHwgMDtcbiAgICAgICAgICBjb25zdCBzY2hlZHVsZURheXMgPSBjYXJlSGVscGVycy5wYXJzZUZlcnRpbGl6ZXJTY2hlZHVsZShwbGFudC5mZXJ0aWxpemVyU2NoZWR1bGUpO1xuICAgICAgICAgIGNvbnN0IGNvbnNpc3RlbmN5ID0gTWF0aC5tYXgoMCwgMTAwIC0gKGRheXNTaW5jZSAvIHNjaGVkdWxlRGF5cykgKiA1MCk7XG4gICAgICAgICAgcmV0dXJuIHN1bSArIGNvbnNpc3RlbmN5O1xuICAgICAgICB9LCAwKSAvIGVuaGFuY2VkUGxhbnRzLmxlbmd0aFxuICAgICAgOiAwO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIG92ZXJkdWUsXG4gICAgICBkdWVUb2RheSxcbiAgICAgIGR1ZVNvb24sXG4gICAgICByZWNlbnRseUNhcmVkLFxuICAgICAgc3RhdGlzdGljczoge1xuICAgICAgICB0b3RhbEFjdGl2ZVBsYW50czogZW5oYW5jZWRQbGFudHMubGVuZ3RoLFxuICAgICAgICBvdmVyZHVlQ291bnQ6IG92ZXJkdWUubGVuZ3RoLFxuICAgICAgICBkdWVUb2RheUNvdW50OiBkdWVUb2RheS5sZW5ndGgsXG4gICAgICAgIGR1ZVNvb25Db3VudDogZHVlU29vbi5sZW5ndGgsXG4gICAgICAgIGNhcmVTdHJlYWtEYXlzLFxuICAgICAgICB0b3RhbENhcmVFdmVudHNUaGlzV2VlazogcmVjZW50Q2FyZUhpc3RvcnkubGVuZ3RoLFxuICAgICAgICBhdmVyYWdlQ2FyZUNvbnNpc3RlbmN5OiBNYXRoLnJvdW5kKGF2ZXJhZ2VDYXJlQ29uc2lzdGVuY3kpLFxuICAgICAgfSxcbiAgICAgIHF1aWNrQWN0aW9uczogY2FyZUhlbHBlcnMuZ2V0RGVmYXVsdFF1aWNrQ2FyZUFjdGlvbnMoKSxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBjYXJlIGhpc3RvcnkgY291bnQgZm9yIGEgcGxhbnQgaW5zdGFuY2VcbiAgICovXG4gIHN0YXRpYyBhc3luYyBnZXRDYXJlSGlzdG9yeUNvdW50KFxuICAgIHBsYW50SW5zdGFuY2VJZDogbnVtYmVyLFxuICAgIHVzZXJJZDogbnVtYmVyLFxuICAgIGNhcmVUeXBlPzogQ2FyZVR5cGVcbiAgKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICBjb25zdCBjb25kaXRpb25zID0gW1xuICAgICAgZXEoY2FyZUhpc3RvcnkucGxhbnRJbnN0YW5jZUlkLCBwbGFudEluc3RhbmNlSWQpLFxuICAgICAgZXEoY2FyZUhpc3RvcnkudXNlcklkLCB1c2VySWQpXG4gICAgXTtcblxuICAgIGlmIChjYXJlVHlwZSkge1xuICAgICAgY29uZGl0aW9ucy5wdXNoKGVxKGNhcmVIaXN0b3J5LmNhcmVUeXBlLCBjYXJlVHlwZSkpO1xuICAgIH1cblxuICAgIGNvbnN0IFtyZXN1bHRdID0gYXdhaXQgZGJcbiAgICAgIC5zZWxlY3QoeyBjb3VudDogY291bnQoKSB9KVxuICAgICAgLmZyb20oY2FyZUhpc3RvcnkpXG4gICAgICAud2hlcmUoYW5kKC4uLmNvbmRpdGlvbnMpKTtcblxuICAgIHJldHVybiByZXN1bHQuY291bnQ7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGxhc3QgY2FyZSBkYXRlIGZvciBhIHNwZWNpZmljIGNhcmUgdHlwZVxuICAgKi9cbiAgc3RhdGljIGFzeW5jIGdldExhc3RDYXJlRGF0ZShcbiAgICBwbGFudEluc3RhbmNlSWQ6IG51bWJlcixcbiAgICB1c2VySWQ6IG51bWJlcixcbiAgICBjYXJlVHlwZTogQ2FyZVR5cGVcbiAgKTogUHJvbWlzZTxEYXRlIHwgbnVsbD4ge1xuICAgIGNvbnN0IFtyZXN1bHRdID0gYXdhaXQgZGJcbiAgICAgIC5zZWxlY3QoeyBjYXJlRGF0ZTogY2FyZUhpc3RvcnkuY2FyZURhdGUgfSlcbiAgICAgIC5mcm9tKGNhcmVIaXN0b3J5KVxuICAgICAgLndoZXJlKFxuICAgICAgICBhbmQoXG4gICAgICAgICAgZXEoY2FyZUhpc3RvcnkucGxhbnRJbnN0YW5jZUlkLCBwbGFudEluc3RhbmNlSWQpLFxuICAgICAgICAgIGVxKGNhcmVIaXN0b3J5LnVzZXJJZCwgdXNlcklkKSxcbiAgICAgICAgICBlcShjYXJlSGlzdG9yeS5jYXJlVHlwZSwgY2FyZVR5cGUpXG4gICAgICAgIClcbiAgICAgIClcbiAgICAgIC5vcmRlckJ5KGRlc2MoY2FyZUhpc3RvcnkuY2FyZURhdGUpKVxuICAgICAgLmxpbWl0KDEpO1xuXG4gICAgcmV0dXJuIHJlc3VsdD8uY2FyZURhdGUgfHwgbnVsbDtcbiAgfVxuXG4gIC8qKlxuICAgKiBCdWxrIGNyZWF0ZSBjYXJlIGhpc3RvcnkgZW50cmllc1xuICAgKi9cbiAgc3RhdGljIGFzeW5jIGJ1bGtDcmVhdGVDYXJlSGlzdG9yeShlbnRyaWVzOiBOZXdDYXJlSGlzdG9yeVtdKTogUHJvbWlzZTxDYXJlSGlzdG9yeVtdPiB7XG4gICAgaWYgKGVudHJpZXMubGVuZ3RoID09PSAwKSByZXR1cm4gW107XG5cbiAgICBjb25zdCBlbnRyaWVzV2l0aFRpbWVzdGFtcHMgPSBlbnRyaWVzLm1hcChlbnRyeSA9PiAoe1xuICAgICAgLi4uZW50cnksXG4gICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgfSkpO1xuXG4gICAgcmV0dXJuIGF3YWl0IGRiXG4gICAgICAuaW5zZXJ0KGNhcmVIaXN0b3J5KVxuICAgICAgLnZhbHVlcyhlbnRyaWVzV2l0aFRpbWVzdGFtcHMpXG4gICAgICAucmV0dXJuaW5nKCk7XG4gIH1cblxuICAvKipcbiAgICogUHJpdmF0ZSBoZWxwZXIgdG8gZW5oYW5jZSBjYXJlIGhpc3Rvcnkgd2l0aCBjb21wdXRlZCBwcm9wZXJ0aWVzXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyBlbmhhbmNlQ2FyZUhpc3RvcnkoXG4gICAgY2FyZTogQ2FyZUhpc3RvcnksXG4gICAgcGxhbnRJbnN0YW5jZT86IFBsYW50SW5zdGFuY2UgfCBudWxsLFxuICAgIHBsYW50PzogUGxhbnQgfCBudWxsXG4gICk6IEVuaGFuY2VkQ2FyZUhpc3Rvcnkge1xuICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG4gICAgY29uc3QgZGF5c1NpbmNlQ2FyZSA9IE1hdGguZmxvb3IoKG5vdy5nZXRUaW1lKCkgLSBjYXJlLmNhcmVEYXRlLmdldFRpbWUoKSkgLyAoMTAwMCAqIDYwICogNjAgKiAyNCkpO1xuICAgIGNvbnN0IGZvcm1hdHRlZERhdGUgPSBjYXJlSGVscGVycy5mb3JtYXRDYXJlRGF0ZShjYXJlLmNhcmVEYXRlKTtcbiAgICBjb25zdCBjYXJlVHlwZURpc3BsYXkgPSBjYXJlSGVscGVycy5nZXRDYXJlVHlwZURpc3BsYXkoY2FyZS5jYXJlVHlwZSBhcyBDYXJlVHlwZSk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgLi4uY2FyZSxcbiAgICAgIHBsYW50SW5zdGFuY2U6IHBsYW50SW5zdGFuY2UgJiYgcGxhbnQgPyB7IC4uLnBsYW50SW5zdGFuY2UsIHBsYW50IH0gOiB1bmRlZmluZWQsXG4gICAgICBkYXlzU2luY2VDYXJlLFxuICAgICAgZm9ybWF0dGVkRGF0ZSxcbiAgICAgIGNhcmVUeXBlRGlzcGxheSxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIFByaXZhdGUgaGVscGVyIHRvIGNhbGN1bGF0ZSB1c2VyIGNhcmUgc3RyZWFrXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyBjYWxjdWxhdGVVc2VyQ2FyZVN0cmVhayhcbiAgICB1c2VySWQ6IG51bWJlcixcbiAgICByZWNlbnRDYXJlSGlzdG9yeTogQ2FyZUhpc3RvcnlbXVxuICApOiBudW1iZXIge1xuICAgIC8vIFNpbXBsaWZpZWQgY2FyZSBzdHJlYWsgY2FsY3VsYXRpb25cbiAgICAvLyBDb3VudCBjb25zZWN1dGl2ZSBkYXlzIHdpdGggYXQgbGVhc3Qgb25lIGNhcmUgZXZlbnRcbiAgICBjb25zdCBjYXJlQnlEYXRlID0gcmVjZW50Q2FyZUhpc3RvcnkucmVkdWNlKChhY2MsIGNhcmUpID0+IHtcbiAgICAgIGNvbnN0IGRhdGVLZXkgPSBjYXJlLmNhcmVEYXRlLnRvSVNPU3RyaW5nKCkuc3BsaXQoJ1QnKVswXTtcbiAgICAgIGFjY1tkYXRlS2V5XSA9IHRydWU7XG4gICAgICByZXR1cm4gYWNjO1xuICAgIH0sIHt9IGFzIFJlY29yZDxzdHJpbmcsIGJvb2xlYW4+KTtcblxuICAgIGxldCBzdHJlYWsgPSAwO1xuICAgIGNvbnN0IHRvZGF5ID0gbmV3IERhdGUoKTtcbiAgICBcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDMwOyBpKyspIHsgLy8gQ2hlY2sgbGFzdCAzMCBkYXlzXG4gICAgICBjb25zdCBjaGVja0RhdGUgPSBuZXcgRGF0ZSh0b2RheSk7XG4gICAgICBjaGVja0RhdGUuc2V0RGF0ZShjaGVja0RhdGUuZ2V0RGF0ZSgpIC0gaSk7XG4gICAgICBjb25zdCBkYXRlS2V5ID0gY2hlY2tEYXRlLnRvSVNPU3RyaW5nKCkuc3BsaXQoJ1QnKVswXTtcbiAgICAgIFxuICAgICAgaWYgKGNhcmVCeURhdGVbZGF0ZUtleV0pIHtcbiAgICAgICAgc3RyZWFrKys7XG4gICAgICB9IGVsc2UgaWYgKGkgPiAwKSB7IC8vIERvbid0IGJyZWFrIG9uIGZpcnN0IGRheSAodG9kYXkpIGlmIG5vIGNhcmVcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHN0cmVhaztcbiAgfVxufSJdLCJuYW1lcyI6WyJDYXJlSGlzdG9yeVF1ZXJpZXMiLCJjcmVhdGVDYXJlSGlzdG9yeSIsImRhdGEiLCJjYXJlRW50cnkiLCJkYiIsImluc2VydCIsImNhcmVIaXN0b3J5IiwidmFsdWVzIiwiY3JlYXRlZEF0IiwiRGF0ZSIsInVwZGF0ZWRBdCIsInJldHVybmluZyIsImdldENhcmVIaXN0b3J5QnlJZCIsImlkIiwic2VsZWN0IiwiZnJvbSIsIndoZXJlIiwiZXEiLCJsaW1pdCIsImdldENhcmVIaXN0b3J5Rm9yUGxhbnQiLCJwbGFudEluc3RhbmNlSWQiLCJ1c2VySWQiLCJmaWx0ZXJzIiwiY29uZGl0aW9ucyIsImNhcmVUeXBlIiwicHVzaCIsInN0YXJ0RGF0ZSIsImd0ZSIsImNhcmVEYXRlIiwiZW5kRGF0ZSIsImx0ZSIsInNvcnRGaWVsZCIsInNvcnRCeSIsInNvcnRPcmRlciIsImFzYyIsImRlc2MiLCJxdWVyeSIsInBsYW50SW5zdGFuY2UiLCJwbGFudEluc3RhbmNlcyIsInBsYW50IiwicGxhbnRzIiwibGVmdEpvaW4iLCJwbGFudElkIiwiYW5kIiwib3JkZXJCeSIsIm9mZnNldCIsInJlc3VsdHMiLCJtYXAiLCJyZXN1bHQiLCJlbmhhbmNlQ2FyZUhpc3RvcnkiLCJnZXRDYXJlSGlzdG9yeUZvclBsYW50cyIsInBsYW50SW5zdGFuY2VJZHMiLCJsZW5ndGgiLCJpbkFycmF5IiwiZ2V0UmVjZW50Q2FyZUhpc3RvcnkiLCJ1cGRhdGVDYXJlSGlzdG9yeSIsInVwZGF0ZXMiLCJ1cGRhdGVkIiwidXBkYXRlIiwic2V0IiwiZGVsZXRlQ2FyZUhpc3RvcnkiLCJjb25zb2xlIiwibG9nIiwiZXhpc3RpbmciLCJkZWxldGUiLCJzdGlsbEV4aXN0cyIsImVycm9yIiwiZ2V0UGxhbnRDYXJlU3RhdGlzdGljcyIsImNhcmVIaXN0b3J5RGF0YSIsIkNhcmVDYWxjdWxhdG9yIiwiY2FsY3VsYXRlUGxhbnRDYXJlU3RhdGlzdGljcyIsImdldEJ1bGtDYXJlU3RhdGlzdGljcyIsInBsYW50SW5zdGFuY2VzRGF0YSIsImNhcmVIaXN0b3J5QnlQbGFudCIsInJlZHVjZSIsImFjYyIsImNhcmUiLCJnZXRDYXJlRGFzaGJvYXJkRGF0YSIsIm9wdGlvbnMiLCJpbmNsdWRlSW5hY3RpdmUiLCJkYXlzQWhlYWQiLCJpc0FjdGl2ZSIsIm9uZVdlZWtBZ28iLCJzZXREYXRlIiwiZ2V0RGF0ZSIsInJlY2VudENhcmVIaXN0b3J5IiwiZW5oYW5jZWRQbGFudHMiLCJjYXJlU3RhdHVzIiwiY2FsY3VsYXRlQ2FyZVN0YXR1cyIsImZlcnRpbGl6ZXJEdWUiLCJjYXJlVXJnZW5jeSIsImNhbGN1bGF0ZUNhcmVVcmdlbmN5IiwiZGF5c1VudGlsRmVydGlsaXplckR1ZSIsImNhbGN1bGF0ZURheXNVbnRpbEZlcnRpbGl6ZXJEdWUiLCJkYXlzU2luY2VMYXN0RmVydGlsaXplZCIsImNhbGN1bGF0ZURheXNTaW5jZUxhc3RGZXJ0aWxpemVkIiwibGFzdEZlcnRpbGl6ZWQiLCJkYXlzU2luY2VMYXN0UmVwb3QiLCJjYWxjdWxhdGVEYXlzU2luY2VMYXN0UmVwb3QiLCJsYXN0UmVwb3QiLCJkaXNwbGF5TmFtZSIsIm5pY2tuYW1lIiwiY29tbW9uTmFtZSIsInByaW1hcnlJbWFnZSIsImltYWdlcyIsImRlZmF1bHRJbWFnZSIsImZpbHRlciIsIm92ZXJkdWUiLCJwIiwiZHVlVG9kYXkiLCJkdWVTb29uIiwidGhyZWVEYXlzQWdvIiwicmVjZW50bHlDYXJlZCIsImNhcmVTdHJlYWtEYXlzIiwiY2FsY3VsYXRlVXNlckNhcmVTdHJlYWsiLCJhdmVyYWdlQ2FyZUNvbnNpc3RlbmN5Iiwic3VtIiwiZGF5c1NpbmNlIiwic2NoZWR1bGVEYXlzIiwiY2FyZUhlbHBlcnMiLCJwYXJzZUZlcnRpbGl6ZXJTY2hlZHVsZSIsImZlcnRpbGl6ZXJTY2hlZHVsZSIsImNvbnNpc3RlbmN5IiwiTWF0aCIsIm1heCIsInN0YXRpc3RpY3MiLCJ0b3RhbEFjdGl2ZVBsYW50cyIsIm92ZXJkdWVDb3VudCIsImR1ZVRvZGF5Q291bnQiLCJkdWVTb29uQ291bnQiLCJ0b3RhbENhcmVFdmVudHNUaGlzV2VlayIsInJvdW5kIiwicXVpY2tBY3Rpb25zIiwiZ2V0RGVmYXVsdFF1aWNrQ2FyZUFjdGlvbnMiLCJnZXRDYXJlSGlzdG9yeUNvdW50IiwiY291bnQiLCJnZXRMYXN0Q2FyZURhdGUiLCJidWxrQ3JlYXRlQ2FyZUhpc3RvcnkiLCJlbnRyaWVzIiwiZW50cmllc1dpdGhUaW1lc3RhbXBzIiwiZW50cnkiLCJub3ciLCJkYXlzU2luY2VDYXJlIiwiZmxvb3IiLCJnZXRUaW1lIiwiZm9ybWF0dGVkRGF0ZSIsImZvcm1hdENhcmVEYXRlIiwiY2FyZVR5cGVEaXNwbGF5IiwiZ2V0Q2FyZVR5cGVEaXNwbGF5IiwidW5kZWZpbmVkIiwiY2FyZUJ5RGF0ZSIsImRhdGVLZXkiLCJ0b0lTT1N0cmluZyIsInNwbGl0Iiwic3RyZWFrIiwidG9kYXkiLCJpIiwiY2hlY2tEYXRlIl0sIm1hcHBpbmdzIjoiOzs7OytCQTJCYUE7OztlQUFBQTs7O29CQTNCTTt3QkFDaUM7NEJBQ2M7Z0NBbUJuQzsy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