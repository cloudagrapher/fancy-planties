{"version":3,"sources":["/Users/stefanbekker/projects/fancy-planties/src/app/auth/verify-email/EmailVerificationClient.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useEffect } from 'react';\nimport { useRouter } from 'next/navigation';\nimport VerificationCodeInput from '@/components/auth/VerificationCodeInput';\n\nexport interface EmailVerificationClientProps {\n  email: string;\n}\n\nexport default function EmailVerificationClient({ email }: EmailVerificationClientProps) {\n  const [code, setCode] = useState('');\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState('');\n  const [success, setSuccess] = useState(false);\n  const [resendCooldown, setResendCooldown] = useState(0);\n  const [isResending, setIsResending] = useState(false);\n  const router = useRouter();\n\n  // Countdown timer for resend cooldown\n  useEffect(() => {\n    if (resendCooldown > 0) {\n      const timer = setTimeout(() => {\n        setResendCooldown(resendCooldown - 1);\n      }, 1000);\n      return () => clearTimeout(timer);\n    }\n  }, [resendCooldown]);\n\n  // Auto-submit when code is complete\n  useEffect(() => {\n    if (code.length === 6 && !isLoading) {\n      handleSubmit();\n    }\n  }, [code, isLoading]);\n\n  const handleSubmit = async (e?: React.FormEvent) => {\n    if (e) e.preventDefault();\n    \n    if (code.length !== 6) {\n      setError('Please enter a 6-digit code');\n      return;\n    }\n\n    setIsLoading(true);\n    setError('');\n\n    try {\n      const response = await fetch('/api/auth/verify-email', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          email,\n          code,\n        }),\n      });\n\n      const data = await response.json();\n\n      if (response.ok && data.success) {\n        setSuccess(true);\n        // Redirect to dashboard after a brief delay\n        setTimeout(() => {\n          router.push(data.redirectTo || '/dashboard');\n          router.refresh(); // Refresh to update auth state\n        }, 1500);\n      } else {\n        // Handle different error types\n        switch (data.error) {\n          case 'CODE_EXPIRED':\n            setError('This code has expired. Please request a new one.');\n            break;\n          case 'CODE_INVALID':\n            setError('Invalid code. Please check and try again.');\n            break;\n          case 'TOO_MANY_ATTEMPTS':\n            setError('Too many attempts. Please request a new code.');\n            break;\n          case 'ALREADY_VERIFIED':\n            setError('Your email is already verified.');\n            setTimeout(() => {\n              router.push('/dashboard');\n              router.refresh();\n            }, 2000);\n            break;\n          default:\n            setError(data.message || 'Verification failed. Please try again.');\n        }\n      }\n    } catch (error) {\n      console.error('Verification error:', error);\n      setError('Network error. Please check your connection and try again.');\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const handleResend = async () => {\n    if (resendCooldown > 0 || isResending) return;\n\n    setIsResending(true);\n    setError('');\n\n    try {\n      const response = await fetch('/api/auth/resend-verification', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          email,\n        }),\n      });\n\n      const data = await response.json();\n\n      if (response.ok && data.success) {\n        setResendCooldown(data.cooldownSeconds || 60);\n        setCode(''); // Clear the input\n        setError(''); // Clear any existing errors\n      } else {\n        setError(data.message || 'Failed to resend code. Please try again.');\n        if (data.cooldownSeconds) {\n          setResendCooldown(data.cooldownSeconds);\n        }\n      }\n    } catch (error) {\n      console.error('Resend error:', error);\n      setError('Network error. Please check your connection and try again.');\n    } finally {\n      setIsResending(false);\n    }\n  };\n\n  const handleCodeChange = (value: string) => {\n    setCode(value);\n    if (error) {\n      setError(''); // Clear error when user starts typing\n    }\n  };\n\n  if (success) {\n    return (\n      <div className=\"card card--mint text-center\">\n        <div className=\"flex-center mb-4\">\n          <div className=\"w-16 h-16 rounded-full bg-mint-200 flex-center\">\n            <svg\n              className=\"w-8 h-8 text-mint-700\"\n              fill=\"none\"\n              stroke=\"currentColor\"\n              viewBox=\"0 0 24 24\"\n            >\n              <path\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n                strokeWidth={2}\n                d=\"M5 13l4 4L19 7\"\n              />\n            </svg>\n          </div>\n        </div>\n        <h3 className=\"text-xl font-semibold text-mint-900 mb-2\">\n          Email verified successfully! ðŸŽ‰\n        </h3>\n        <p className=\"text-mint-700 mb-4\">\n          Welcome to Fancy Planties! Redirecting you to your dashboard...\n        </p>\n        <div className=\"spinner mx-auto\"></div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"card card--dreamy\">\n      <form onSubmit={handleSubmit} className=\"space-y-6\" role=\"form\">\n        <div className=\"text-center mb-6\">\n          <div className=\"w-12 h-12 rounded-full bg-mint-100 flex-center mx-auto mb-4\">\n            <svg\n              className=\"w-6 h-6 text-mint-600\"\n              fill=\"none\"\n              stroke=\"currentColor\"\n              viewBox=\"0 0 24 24\"\n            >\n              <path\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n                strokeWidth={2}\n                d=\"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z\"\n              />\n            </svg>\n          </div>\n          <h3 className=\"text-lg font-semibold text-neutral-900 mb-2\">\n            Enter verification code\n          </h3>\n          <p className=\"text-sm text-neutral-600\">\n            We've sent a 6-digit code to your email. Enter it below to verify your account.\n          </p>\n        </div>\n\n        <div className=\"space-y-4\">\n          <VerificationCodeInput\n            value={code}\n            onChange={handleCodeChange}\n            disabled={isLoading}\n            error={error}\n          />\n\n          <div className=\"text-center\">\n            <button\n              type=\"button\"\n              onClick={handleResend}\n              disabled={resendCooldown > 0 || isResending || isLoading}\n              className={`\n                text-sm font-medium transition-colors\n                ${resendCooldown > 0 || isResending || isLoading\n                  ? 'text-neutral-400 cursor-not-allowed'\n                  : 'text-mint-600 hover:text-mint-700 cursor-pointer'\n                }\n              `}\n            >\n              {isResending\n                ? 'Sending...'\n                : resendCooldown > 0\n                  ? `Resend code in ${resendCooldown}s`\n                  : 'Didn\\'t receive the code? Resend it'\n              }\n            </button>\n          </div>\n        </div>\n\n        {/* Manual submit button for accessibility */}\n        <div className=\"pt-4\">\n          <button\n            type=\"submit\"\n            disabled={isLoading || code.length !== 6}\n            className={`\n              btn btn--primary btn--full\n              ${isLoading ? 'btn--loading' : ''}\n            `}\n          >\n            {isLoading ? (\n              <>\n                <div className=\"spinner mr-2\"></div>\n                Verifying...\n              </>\n            ) : (\n              'Verify Email'\n            )}\n          </button>\n        </div>\n\n        <div className=\"text-center\">\n          <p className=\"text-xs text-neutral-500\">\n            Having trouble? Check your spam folder or{' '}\n            <button\n              type=\"button\"\n              onClick={handleResend}\n              disabled={resendCooldown > 0 || isResending}\n              className=\"text-mint-600 hover:text-mint-700 underline\"\n            >\n              request a new code\n            </button>\n          </p>\n        </div>\n      </form>\n    </div>\n  );\n}"],"names":["EmailVerificationClient","email","code","setCode","useState","isLoading","setIsLoading","error","setError","success","setSuccess","resendCooldown","setResendCooldown","isResending","setIsResending","router","useRouter","useEffect","timer","setTimeout","clearTimeout","length","handleSubmit","e","preventDefault","response","fetch","method","headers","body","JSON","stringify","data","json","ok","push","redirectTo","refresh","message","console","handleResend","cooldownSeconds","handleCodeChange","value","div","className","svg","fill","stroke","viewBox","path","strokeLinecap","strokeLinejoin","strokeWidth","d","h3","p","form","onSubmit","role","VerificationCodeInput","onChange","disabled","button","type","onClick"],"mappings":"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"}