{"version":3,"names":["cov_1w7citaed9","actualCoverage","s","checkDatabaseConnection","f","closeDatabaseConnection","db","sql","_drizzleorm","exports","connectionString","b","process","env","DATABASE_URL","client","_postgres","default","prepare","max","idle_timeout","connect_timeout","onnotice","NODE_ENV","console","log","undefined","_postgresjs","drizzle","schema","_schema","logger","execute","error","end"],"sources":["/Users/stefanbekker/projects/fancy-planties/src/lib/db/script-connection.ts"],"sourcesContent":["// Database connection for Node.js scripts (without server-only)\nimport { drizzle } from 'drizzle-orm/postgres-js';\nimport postgres from 'postgres';\nimport { sql } from 'drizzle-orm';\nimport * as schema from './schema';\n\nconst connectionString = process.env.DATABASE_URL || 'postgresql://postgres:postgres@localhost:5433/fancy_planties';\n\n// Connection configuration with pooling\nconst client = postgres(connectionString, {\n  prepare: false,\n  max: 10,\n  idle_timeout: 20,\n  connect_timeout: 10,\n  onnotice: process.env.NODE_ENV === 'development' ? console.log : undefined,\n});\n\nexport const db = drizzle(client, { \n  schema,\n  logger: process.env.NODE_ENV === 'development'\n});\n\n// Database connection health check\nexport async function checkDatabaseConnection(): Promise<boolean> {\n  try {\n    await db.execute(sql`SELECT 1`);\n    return true;\n  } catch (error) {\n    console.error('Database connection failed:', error);\n    return false;\n  }\n}\n\n// Graceful database shutdown\nexport async function closeDatabaseConnection() {\n  try {\n    await client.end();\n    console.log('Database connection closed gracefully');\n  } catch (error) {\n    console.error('Error closing database connection:', error);\n  }\n}\n\nexport { sql };\nexport * from './schema';"],"mappings":"AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}