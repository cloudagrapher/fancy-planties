41ecd2d2d5a1daa89e65c45887aefa83
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "MigrationUtils", {
    enumerable: true,
    get: function() {
        return MigrationUtils;
    }
});
require("server-only");
const _index = require("./index");
const _drizzleorm = require("drizzle-orm");
const _fs = /*#__PURE__*/ _interop_require_default(require("fs"));
const _path = /*#__PURE__*/ _interop_require_default(require("path"));
function _interop_require_default(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
class MigrationUtils {
    // Run all pending migrations
    static async runMigrations() {
        try {
            console.log('Starting database migrations...');
            // Create migrations table if it doesn't exist
            await _index.db.execute((0, _drizzleorm.sql)`
        CREATE TABLE IF NOT EXISTS __drizzle_migrations (
          id SERIAL PRIMARY KEY,
          hash text NOT NULL,
          created_at bigint
        );
      `);
            // Apply migration files from drizzle directory
            const migrationsPath = _path.default.join(process.cwd(), 'drizzle');
            if (_fs.default.existsSync(migrationsPath)) {
                const files = _fs.default.readdirSync(migrationsPath);
                const sqlFiles = files.filter((file)=>file.endsWith('.sql') && !file.includes('rls-policies')).sort(); // Ensure migrations are applied in order
                for (const file of sqlFiles){
                    const filePath = _path.default.join(migrationsPath, file);
                    const migrationSQL = _fs.default.readFileSync(filePath, 'utf8');
                    // Check if migration was already applied
                    const [existing] = await _index.db.execute((0, _drizzleorm.sql)`
            SELECT COUNT(*) as count FROM __drizzle_migrations 
            WHERE hash = ${file}
          `);
                    if (Number(existing?.count) === 0) {
                        console.log(`  📋 Applying migration: ${file}`);
                        // Split migration into individual statements
                        const statements = migrationSQL.split('--> statement-breakpoint').map((stmt)=>stmt.trim()).filter((stmt)=>stmt.length > 0 && !stmt.startsWith('--'));
                        for (const statement of statements){
                            const cleanStatement = statement.trim();
                            if (cleanStatement && !cleanStatement.startsWith('--')) {
                                await _index.db.execute(_drizzleorm.sql.raw(cleanStatement));
                            }
                        }
                        // Record migration as applied
                        await _index.db.execute((0, _drizzleorm.sql)`
              INSERT INTO __drizzle_migrations (hash, created_at) 
              VALUES (${file}, ${Date.now()})
            `);
                        console.log(`  ✅ Applied migration: ${file}`);
                    } else {
                        console.log(`  ⏭️  Skipping already applied migration: ${file}`);
                    }
                }
            }
            console.log('Migrations completed successfully');
        } catch (error) {
            console.error('Migration failed:', error);
            throw new Error('Failed to run migrations');
        }
    }
    // Apply RLS policies
    static async applyRLSPolicies() {
        try {
            console.log('Applying Row-Level Security policies...');
            const rlsPath = _path.default.join(process.cwd(), 'drizzle', 'rls-policies.sql');
            if (_fs.default.existsSync(rlsPath)) {
                const rlsSQL = _fs.default.readFileSync(rlsPath, 'utf8');
                // Split by semicolon and filter out comments
                const statements = rlsSQL.split(';').map((stmt)=>stmt.trim()).filter((stmt)=>stmt.length > 0 && !stmt.startsWith('--') && !stmt.match(/^\/\*.*\*\/$/));
                for (const statement of statements){
                    const cleanStatement = statement.trim();
                    if (cleanStatement && !cleanStatement.startsWith('--')) {
                        try {
                            await _index.db.execute(_drizzleorm.sql.raw(cleanStatement));
                        } catch (error) {
                            // Log but don't fail on policy conflicts (they might already exist)
                            if (error instanceof Error && error.message.includes('already exists')) {
                                console.log(`Policy already exists, skipping: ${cleanStatement.substring(0, 50)}...`);
                            } else {
                                console.error(`Failed to execute statement: ${cleanStatement.substring(0, 50)}...`);
                                throw error;
                            }
                        }
                    }
                }
                console.log('RLS policies applied successfully');
            } else {
                console.warn('RLS policies file not found, skipping...');
            }
        } catch (error) {
            console.error('Failed to apply RLS policies:', error);
            throw new Error('Failed to apply RLS policies');
        }
    }
    // Rollback last migration (basic implementation)
    static async rollbackLastMigration() {
        try {
            console.log('Rolling back last migration...');
            // This is a basic implementation - in production you'd want more sophisticated rollback logic
            console.warn('Rollback functionality requires manual intervention for safety');
            console.log('Please review the migration files and manually rollback if needed');
        } catch (error) {
            console.error('Rollback failed:', error);
            throw new Error('Failed to rollback migration');
        }
    }
    // Check migration status
    static async getMigrationStatus() {
        try {
            // Get applied migrations
            const appliedResults = await _index.db.execute((0, _drizzleorm.sql)`
        SELECT hash FROM __drizzle_migrations ORDER BY created_at
      `);
            const appliedMigrations = appliedResults.length;
            const appliedHashes = new Set(appliedResults.map((r)=>r.hash));
            // Get all migration files
            const migrationsPath = _path.default.join(process.cwd(), 'drizzle');
            const pendingMigrations = [];
            if (_fs.default.existsSync(migrationsPath)) {
                const files = _fs.default.readdirSync(migrationsPath);
                const sqlFiles = files.filter((file)=>file.endsWith('.sql') && !file.includes('rls-policies')).sort();
                // Find pending migrations
                for (const file of sqlFiles){
                    if (!appliedHashes.has(file)) {
                        pendingMigrations.push(file);
                    }
                }
            }
            return {
                appliedMigrations,
                pendingMigrations
            };
        } catch (error) {
            console.error('Failed to get migration status:', error);
            throw new Error('Failed to get migration status');
        }
    }
    // Seed initial data (for development)
    static async seedInitialData() {
        try {
            console.log('Seeding initial data...');
            // Check if we already have data
            const [userCount] = await _index.db.execute((0, _drizzleorm.sql)`SELECT COUNT(*) as count FROM users`);
            if (Number(userCount?.count) > 0) {
                console.log('Database already has data, skipping seed');
                return;
            }
            // Add some common plant taxonomy data
            const commonPlants = [
                {
                    family: 'Araceae',
                    genus: 'Monstera',
                    species: 'deliciosa',
                    commonName: 'Swiss Cheese Plant',
                    careInstructions: 'Bright indirect light, water when top inch of soil is dry',
                    isVerified: true
                },
                {
                    family: 'Araceae',
                    genus: 'Pothos',
                    species: 'aureus',
                    commonName: 'Golden Pothos',
                    careInstructions: 'Low to bright indirect light, water when soil is dry',
                    isVerified: true
                },
                {
                    family: 'Asparagaceae',
                    genus: 'Sansevieria',
                    species: 'trifasciata',
                    commonName: 'Snake Plant',
                    careInstructions: 'Low light tolerant, water sparingly',
                    isVerified: true
                },
                {
                    family: 'Araceae',
                    genus: 'Philodendron',
                    species: 'hederaceum',
                    commonName: 'Heartleaf Philodendron',
                    careInstructions: 'Bright indirect light, keep soil lightly moist',
                    isVerified: true
                }
            ];
            for (const plant of commonPlants){
                await _index.db.execute((0, _drizzleorm.sql)`
          INSERT INTO plants (family, genus, species, cultivar, common_name, care_instructions, is_verified)
          VALUES (${plant.family}, ${plant.genus}, ${plant.species}, NULL, ${plant.commonName}, ${plant.careInstructions}, ${plant.isVerified})
          ON CONFLICT (family, genus, species, cultivar) DO NOTHING
        `);
            }
            console.log('Initial data seeded successfully');
        } catch (error) {
            console.error('Failed to seed initial data:', error);
            throw new Error('Failed to seed initial data');
        }
    }
    // Database health check
    static async healthCheck() {
        try {
            // Check connection
            const connected = await _index.db.execute((0, _drizzleorm.sql)`SELECT 1`).then(()=>true).catch(()=>false);
            // Check if migrations table exists
            const [migrationTable] = await _index.db.execute((0, _drizzleorm.sql)`
        SELECT EXISTS (
          SELECT FROM information_schema.tables 
          WHERE table_name = '__drizzle_migrations'
        ) as exists
      `);
            const migrationsApplied = Boolean(migrationTable?.exists) || false;
            // Check if main tables exist (including email verification)
            const [tablesCheck] = await _index.db.execute((0, _drizzleorm.sql)`
        SELECT 
          (SELECT COUNT(*) FROM information_schema.tables WHERE table_name IN ('users', 'plants', 'plant_instances', 'propagations', 'sessions', 'email_verification_codes')) as table_count
      `);
            const tablesExist = Number(tablesCheck?.table_count) === 6;
            // Check if RLS is enabled on user tables
            const [rlsCheck] = await _index.db.execute((0, _drizzleorm.sql)`
        SELECT COUNT(*) as rls_count
        FROM pg_class c
        JOIN pg_namespace n ON n.oid = c.relnamespace
        WHERE c.relrowsecurity = true 
        AND n.nspname = 'public'
        AND c.relname IN ('plant_instances', 'propagations', 'sessions', 'care_history', 'care_guides', 'email_verification_codes')
      `);
            const rlsEnabled = Number(rlsCheck?.rls_count) === 6;
            return {
                connected,
                migrationsApplied,
                rlsEnabled,
                tablesExist
            };
        } catch (error) {
            console.error('Health check failed:', error);
            return {
                connected: false,
                migrationsApplied: false,
                rlsEnabled: false,
                tablesExist: false
            };
        }
    }
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9zdGVmYW5iZWtrZXIvcHJvamVjdHMvZmFuY3ktcGxhbnRpZXMvc3JjL2xpYi9kYi9taWdyYXRpb25zLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAnc2VydmVyLW9ubHknO1xuXG5pbXBvcnQgeyBkYiB9IGZyb20gJy4vaW5kZXgnO1xuaW1wb3J0IHsgc3FsIH0gZnJvbSAnZHJpenpsZS1vcm0nO1xuaW1wb3J0IGZzIGZyb20gJ2ZzJztcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuXG4vLyBNaWdyYXRpb24gdXRpbGl0aWVzXG5leHBvcnQgY2xhc3MgTWlncmF0aW9uVXRpbHMge1xuICAvLyBSdW4gYWxsIHBlbmRpbmcgbWlncmF0aW9uc1xuICBzdGF0aWMgYXN5bmMgcnVuTWlncmF0aW9ucygpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgY29uc29sZS5sb2coJ1N0YXJ0aW5nIGRhdGFiYXNlIG1pZ3JhdGlvbnMuLi4nKTtcbiAgICAgIFxuICAgICAgLy8gQ3JlYXRlIG1pZ3JhdGlvbnMgdGFibGUgaWYgaXQgZG9lc24ndCBleGlzdFxuICAgICAgYXdhaXQgZGIuZXhlY3V0ZShzcWxgXG4gICAgICAgIENSRUFURSBUQUJMRSBJRiBOT1QgRVhJU1RTIF9fZHJpenpsZV9taWdyYXRpb25zIChcbiAgICAgICAgICBpZCBTRVJJQUwgUFJJTUFSWSBLRVksXG4gICAgICAgICAgaGFzaCB0ZXh0IE5PVCBOVUxMLFxuICAgICAgICAgIGNyZWF0ZWRfYXQgYmlnaW50XG4gICAgICAgICk7XG4gICAgICBgKTtcblxuICAgICAgLy8gQXBwbHkgbWlncmF0aW9uIGZpbGVzIGZyb20gZHJpenpsZSBkaXJlY3RvcnlcbiAgICAgIGNvbnN0IG1pZ3JhdGlvbnNQYXRoID0gcGF0aC5qb2luKHByb2Nlc3MuY3dkKCksICdkcml6emxlJyk7XG4gICAgICBcbiAgICAgIGlmIChmcy5leGlzdHNTeW5jKG1pZ3JhdGlvbnNQYXRoKSkge1xuICAgICAgICBjb25zdCBmaWxlcyA9IGZzLnJlYWRkaXJTeW5jKG1pZ3JhdGlvbnNQYXRoKTtcbiAgICAgICAgY29uc3Qgc3FsRmlsZXMgPSBmaWxlc1xuICAgICAgICAgIC5maWx0ZXIoZmlsZSA9PiBmaWxlLmVuZHNXaXRoKCcuc3FsJykgJiYgIWZpbGUuaW5jbHVkZXMoJ3Jscy1wb2xpY2llcycpKVxuICAgICAgICAgIC5zb3J0KCk7IC8vIEVuc3VyZSBtaWdyYXRpb25zIGFyZSBhcHBsaWVkIGluIG9yZGVyXG5cbiAgICAgICAgZm9yIChjb25zdCBmaWxlIG9mIHNxbEZpbGVzKSB7XG4gICAgICAgICAgY29uc3QgZmlsZVBhdGggPSBwYXRoLmpvaW4obWlncmF0aW9uc1BhdGgsIGZpbGUpO1xuICAgICAgICAgIGNvbnN0IG1pZ3JhdGlvblNRTCA9IGZzLnJlYWRGaWxlU3luYyhmaWxlUGF0aCwgJ3V0ZjgnKTtcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBDaGVjayBpZiBtaWdyYXRpb24gd2FzIGFscmVhZHkgYXBwbGllZFxuICAgICAgICAgIGNvbnN0IFtleGlzdGluZ10gPSBhd2FpdCBkYi5leGVjdXRlKHNxbGBcbiAgICAgICAgICAgIFNFTEVDVCBDT1VOVCgqKSBhcyBjb3VudCBGUk9NIF9fZHJpenpsZV9taWdyYXRpb25zIFxuICAgICAgICAgICAgV0hFUkUgaGFzaCA9ICR7ZmlsZX1cbiAgICAgICAgICBgKTtcbiAgICAgICAgICBcbiAgICAgICAgICBpZiAoTnVtYmVyKGV4aXN0aW5nPy5jb3VudCkgPT09IDApIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGAgIPCfk4sgQXBwbHlpbmcgbWlncmF0aW9uOiAke2ZpbGV9YCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIFNwbGl0IG1pZ3JhdGlvbiBpbnRvIGluZGl2aWR1YWwgc3RhdGVtZW50c1xuICAgICAgICAgICAgY29uc3Qgc3RhdGVtZW50cyA9IG1pZ3JhdGlvblNRTFxuICAgICAgICAgICAgICAuc3BsaXQoJy0tPiBzdGF0ZW1lbnQtYnJlYWtwb2ludCcpXG4gICAgICAgICAgICAgIC5tYXAoc3RtdCA9PiBzdG10LnRyaW0oKSlcbiAgICAgICAgICAgICAgLmZpbHRlcihzdG10ID0+IHN0bXQubGVuZ3RoID4gMCAmJiAhc3RtdC5zdGFydHNXaXRoKCctLScpKTtcblxuICAgICAgICAgICAgZm9yIChjb25zdCBzdGF0ZW1lbnQgb2Ygc3RhdGVtZW50cykge1xuICAgICAgICAgICAgICBjb25zdCBjbGVhblN0YXRlbWVudCA9IHN0YXRlbWVudC50cmltKCk7XG4gICAgICAgICAgICAgIGlmIChjbGVhblN0YXRlbWVudCAmJiAhY2xlYW5TdGF0ZW1lbnQuc3RhcnRzV2l0aCgnLS0nKSkge1xuICAgICAgICAgICAgICAgIGF3YWl0IGRiLmV4ZWN1dGUoc3FsLnJhdyhjbGVhblN0YXRlbWVudCkpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIFJlY29yZCBtaWdyYXRpb24gYXMgYXBwbGllZFxuICAgICAgICAgICAgYXdhaXQgZGIuZXhlY3V0ZShzcWxgXG4gICAgICAgICAgICAgIElOU0VSVCBJTlRPIF9fZHJpenpsZV9taWdyYXRpb25zIChoYXNoLCBjcmVhdGVkX2F0KSBcbiAgICAgICAgICAgICAgVkFMVUVTICgke2ZpbGV9LCAke0RhdGUubm93KCl9KVxuICAgICAgICAgICAgYCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGAgIOKchSBBcHBsaWVkIG1pZ3JhdGlvbjogJHtmaWxlfWApO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgICDij63vuI8gIFNraXBwaW5nIGFscmVhZHkgYXBwbGllZCBtaWdyYXRpb246ICR7ZmlsZX1gKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgY29uc29sZS5sb2coJ01pZ3JhdGlvbnMgY29tcGxldGVkIHN1Y2Nlc3NmdWxseScpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdNaWdyYXRpb24gZmFpbGVkOicsIGVycm9yKTtcbiAgICAgIHRocm93IG5ldyBFcnJvcignRmFpbGVkIHRvIHJ1biBtaWdyYXRpb25zJyk7XG4gICAgfVxuICB9XG5cbiAgLy8gQXBwbHkgUkxTIHBvbGljaWVzXG4gIHN0YXRpYyBhc3luYyBhcHBseVJMU1BvbGljaWVzKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zb2xlLmxvZygnQXBwbHlpbmcgUm93LUxldmVsIFNlY3VyaXR5IHBvbGljaWVzLi4uJyk7XG4gICAgICBcbiAgICAgIGNvbnN0IHJsc1BhdGggPSBwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgJ2RyaXp6bGUnLCAncmxzLXBvbGljaWVzLnNxbCcpO1xuICAgICAgXG4gICAgICBpZiAoZnMuZXhpc3RzU3luYyhybHNQYXRoKSkge1xuICAgICAgICBjb25zdCBybHNTUUwgPSBmcy5yZWFkRmlsZVN5bmMocmxzUGF0aCwgJ3V0ZjgnKTtcbiAgICAgICAgXG4gICAgICAgIC8vIFNwbGl0IGJ5IHNlbWljb2xvbiBhbmQgZmlsdGVyIG91dCBjb21tZW50c1xuICAgICAgICBjb25zdCBzdGF0ZW1lbnRzID0gcmxzU1FMXG4gICAgICAgICAgLnNwbGl0KCc7JylcbiAgICAgICAgICAubWFwKHN0bXQgPT4gc3RtdC50cmltKCkpXG4gICAgICAgICAgLmZpbHRlcihzdG10ID0+IFxuICAgICAgICAgICAgc3RtdC5sZW5ndGggPiAwICYmIFxuICAgICAgICAgICAgIXN0bXQuc3RhcnRzV2l0aCgnLS0nKSAmJiBcbiAgICAgICAgICAgICFzdG10Lm1hdGNoKC9eXFwvXFwqLipcXCpcXC8kLylcbiAgICAgICAgICApO1xuXG4gICAgICAgIGZvciAoY29uc3Qgc3RhdGVtZW50IG9mIHN0YXRlbWVudHMpIHtcbiAgICAgICAgICBjb25zdCBjbGVhblN0YXRlbWVudCA9IHN0YXRlbWVudC50cmltKCk7XG4gICAgICAgICAgaWYgKGNsZWFuU3RhdGVtZW50ICYmICFjbGVhblN0YXRlbWVudC5zdGFydHNXaXRoKCctLScpKSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICBhd2FpdCBkYi5leGVjdXRlKHNxbC5yYXcoY2xlYW5TdGF0ZW1lbnQpKTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgIC8vIExvZyBidXQgZG9uJ3QgZmFpbCBvbiBwb2xpY3kgY29uZmxpY3RzICh0aGV5IG1pZ2h0IGFscmVhZHkgZXhpc3QpXG4gICAgICAgICAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIEVycm9yICYmIGVycm9yLm1lc3NhZ2UuaW5jbHVkZXMoJ2FscmVhZHkgZXhpc3RzJykpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgUG9saWN5IGFscmVhZHkgZXhpc3RzLCBza2lwcGluZzogJHtjbGVhblN0YXRlbWVudC5zdWJzdHJpbmcoMCwgNTApfS4uLmApO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEZhaWxlZCB0byBleGVjdXRlIHN0YXRlbWVudDogJHtjbGVhblN0YXRlbWVudC5zdWJzdHJpbmcoMCwgNTApfS4uLmApO1xuICAgICAgICAgICAgICAgIHRocm93IGVycm9yO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBjb25zb2xlLmxvZygnUkxTIHBvbGljaWVzIGFwcGxpZWQgc3VjY2Vzc2Z1bGx5Jyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zb2xlLndhcm4oJ1JMUyBwb2xpY2llcyBmaWxlIG5vdCBmb3VuZCwgc2tpcHBpbmcuLi4nKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIGFwcGx5IFJMUyBwb2xpY2llczonLCBlcnJvcik7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZhaWxlZCB0byBhcHBseSBSTFMgcG9saWNpZXMnKTtcbiAgICB9XG4gIH1cblxuICAvLyBSb2xsYmFjayBsYXN0IG1pZ3JhdGlvbiAoYmFzaWMgaW1wbGVtZW50YXRpb24pXG4gIHN0YXRpYyBhc3luYyByb2xsYmFja0xhc3RNaWdyYXRpb24oKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnNvbGUubG9nKCdSb2xsaW5nIGJhY2sgbGFzdCBtaWdyYXRpb24uLi4nKTtcbiAgICAgIFxuICAgICAgLy8gVGhpcyBpcyBhIGJhc2ljIGltcGxlbWVudGF0aW9uIC0gaW4gcHJvZHVjdGlvbiB5b3UnZCB3YW50IG1vcmUgc29waGlzdGljYXRlZCByb2xsYmFjayBsb2dpY1xuICAgICAgY29uc29sZS53YXJuKCdSb2xsYmFjayBmdW5jdGlvbmFsaXR5IHJlcXVpcmVzIG1hbnVhbCBpbnRlcnZlbnRpb24gZm9yIHNhZmV0eScpO1xuICAgICAgY29uc29sZS5sb2coJ1BsZWFzZSByZXZpZXcgdGhlIG1pZ3JhdGlvbiBmaWxlcyBhbmQgbWFudWFsbHkgcm9sbGJhY2sgaWYgbmVlZGVkJyk7XG4gICAgICBcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignUm9sbGJhY2sgZmFpbGVkOicsIGVycm9yKTtcbiAgICAgIHRocm93IG5ldyBFcnJvcignRmFpbGVkIHRvIHJvbGxiYWNrIG1pZ3JhdGlvbicpO1xuICAgIH1cbiAgfVxuXG4gIC8vIENoZWNrIG1pZ3JhdGlvbiBzdGF0dXNcbiAgc3RhdGljIGFzeW5jIGdldE1pZ3JhdGlvblN0YXR1cygpOiBQcm9taXNlPHtcbiAgICBhcHBsaWVkTWlncmF0aW9uczogbnVtYmVyO1xuICAgIHBlbmRpbmdNaWdyYXRpb25zOiBzdHJpbmdbXTtcbiAgfT4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBHZXQgYXBwbGllZCBtaWdyYXRpb25zXG4gICAgICBjb25zdCBhcHBsaWVkUmVzdWx0cyA9IGF3YWl0IGRiLmV4ZWN1dGUoc3FsYFxuICAgICAgICBTRUxFQ1QgaGFzaCBGUk9NIF9fZHJpenpsZV9taWdyYXRpb25zIE9SREVSIEJZIGNyZWF0ZWRfYXRcbiAgICAgIGApO1xuICAgICAgXG4gICAgICBjb25zdCBhcHBsaWVkTWlncmF0aW9ucyA9IGFwcGxpZWRSZXN1bHRzLmxlbmd0aDtcbiAgICAgIGNvbnN0IGFwcGxpZWRIYXNoZXMgPSBuZXcgU2V0KGFwcGxpZWRSZXN1bHRzLm1hcChyID0+IHIuaGFzaCkpO1xuICAgICAgXG4gICAgICAvLyBHZXQgYWxsIG1pZ3JhdGlvbiBmaWxlc1xuICAgICAgY29uc3QgbWlncmF0aW9uc1BhdGggPSBwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgJ2RyaXp6bGUnKTtcbiAgICAgIGNvbnN0IHBlbmRpbmdNaWdyYXRpb25zOiBzdHJpbmdbXSA9IFtdO1xuICAgICAgXG4gICAgICBpZiAoZnMuZXhpc3RzU3luYyhtaWdyYXRpb25zUGF0aCkpIHtcbiAgICAgICAgY29uc3QgZmlsZXMgPSBmcy5yZWFkZGlyU3luYyhtaWdyYXRpb25zUGF0aCk7XG4gICAgICAgIGNvbnN0IHNxbEZpbGVzID0gZmlsZXNcbiAgICAgICAgICAuZmlsdGVyKGZpbGUgPT4gZmlsZS5lbmRzV2l0aCgnLnNxbCcpICYmICFmaWxlLmluY2x1ZGVzKCdybHMtcG9saWNpZXMnKSlcbiAgICAgICAgICAuc29ydCgpO1xuICAgICAgICBcbiAgICAgICAgLy8gRmluZCBwZW5kaW5nIG1pZ3JhdGlvbnNcbiAgICAgICAgZm9yIChjb25zdCBmaWxlIG9mIHNxbEZpbGVzKSB7XG4gICAgICAgICAgaWYgKCFhcHBsaWVkSGFzaGVzLmhhcyhmaWxlKSkge1xuICAgICAgICAgICAgcGVuZGluZ01pZ3JhdGlvbnMucHVzaChmaWxlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgYXBwbGllZE1pZ3JhdGlvbnMsXG4gICAgICAgIHBlbmRpbmdNaWdyYXRpb25zXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gZ2V0IG1pZ3JhdGlvbiBzdGF0dXM6JywgZXJyb3IpO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdGYWlsZWQgdG8gZ2V0IG1pZ3JhdGlvbiBzdGF0dXMnKTtcbiAgICB9XG4gIH1cblxuICAvLyBTZWVkIGluaXRpYWwgZGF0YSAoZm9yIGRldmVsb3BtZW50KVxuICBzdGF0aWMgYXN5bmMgc2VlZEluaXRpYWxEYXRhKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zb2xlLmxvZygnU2VlZGluZyBpbml0aWFsIGRhdGEuLi4nKTtcbiAgICAgIFxuICAgICAgLy8gQ2hlY2sgaWYgd2UgYWxyZWFkeSBoYXZlIGRhdGFcbiAgICAgIGNvbnN0IFt1c2VyQ291bnRdID0gYXdhaXQgZGIuZXhlY3V0ZShzcWxgU0VMRUNUIENPVU5UKCopIGFzIGNvdW50IEZST00gdXNlcnNgKTtcbiAgICAgIFxuICAgICAgaWYgKE51bWJlcih1c2VyQ291bnQ/LmNvdW50KSA+IDApIHtcbiAgICAgICAgY29uc29sZS5sb2coJ0RhdGFiYXNlIGFscmVhZHkgaGFzIGRhdGEsIHNraXBwaW5nIHNlZWQnKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICAvLyBBZGQgc29tZSBjb21tb24gcGxhbnQgdGF4b25vbXkgZGF0YVxuICAgICAgY29uc3QgY29tbW9uUGxhbnRzID0gW1xuICAgICAgICB7XG4gICAgICAgICAgZmFtaWx5OiAnQXJhY2VhZScsXG4gICAgICAgICAgZ2VudXM6ICdNb25zdGVyYScsXG4gICAgICAgICAgc3BlY2llczogJ2RlbGljaW9zYScsXG4gICAgICAgICAgY29tbW9uTmFtZTogJ1N3aXNzIENoZWVzZSBQbGFudCcsXG4gICAgICAgICAgY2FyZUluc3RydWN0aW9uczogJ0JyaWdodCBpbmRpcmVjdCBsaWdodCwgd2F0ZXIgd2hlbiB0b3AgaW5jaCBvZiBzb2lsIGlzIGRyeScsXG4gICAgICAgICAgaXNWZXJpZmllZDogdHJ1ZVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgZmFtaWx5OiAnQXJhY2VhZScsXG4gICAgICAgICAgZ2VudXM6ICdQb3Rob3MnLFxuICAgICAgICAgIHNwZWNpZXM6ICdhdXJldXMnLFxuICAgICAgICAgIGNvbW1vbk5hbWU6ICdHb2xkZW4gUG90aG9zJyxcbiAgICAgICAgICBjYXJlSW5zdHJ1Y3Rpb25zOiAnTG93IHRvIGJyaWdodCBpbmRpcmVjdCBsaWdodCwgd2F0ZXIgd2hlbiBzb2lsIGlzIGRyeScsXG4gICAgICAgICAgaXNWZXJpZmllZDogdHJ1ZVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgZmFtaWx5OiAnQXNwYXJhZ2FjZWFlJyxcbiAgICAgICAgICBnZW51czogJ1NhbnNldmllcmlhJyxcbiAgICAgICAgICBzcGVjaWVzOiAndHJpZmFzY2lhdGEnLFxuICAgICAgICAgIGNvbW1vbk5hbWU6ICdTbmFrZSBQbGFudCcsXG4gICAgICAgICAgY2FyZUluc3RydWN0aW9uczogJ0xvdyBsaWdodCB0b2xlcmFudCwgd2F0ZXIgc3BhcmluZ2x5JyxcbiAgICAgICAgICBpc1ZlcmlmaWVkOiB0cnVlXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBmYW1pbHk6ICdBcmFjZWFlJyxcbiAgICAgICAgICBnZW51czogJ1BoaWxvZGVuZHJvbicsXG4gICAgICAgICAgc3BlY2llczogJ2hlZGVyYWNldW0nLFxuICAgICAgICAgIGNvbW1vbk5hbWU6ICdIZWFydGxlYWYgUGhpbG9kZW5kcm9uJyxcbiAgICAgICAgICBjYXJlSW5zdHJ1Y3Rpb25zOiAnQnJpZ2h0IGluZGlyZWN0IGxpZ2h0LCBrZWVwIHNvaWwgbGlnaHRseSBtb2lzdCcsXG4gICAgICAgICAgaXNWZXJpZmllZDogdHJ1ZVxuICAgICAgICB9XG4gICAgICBdO1xuXG4gICAgICBmb3IgKGNvbnN0IHBsYW50IG9mIGNvbW1vblBsYW50cykge1xuICAgICAgICBhd2FpdCBkYi5leGVjdXRlKHNxbGBcbiAgICAgICAgICBJTlNFUlQgSU5UTyBwbGFudHMgKGZhbWlseSwgZ2VudXMsIHNwZWNpZXMsIGN1bHRpdmFyLCBjb21tb25fbmFtZSwgY2FyZV9pbnN0cnVjdGlvbnMsIGlzX3ZlcmlmaWVkKVxuICAgICAgICAgIFZBTFVFUyAoJHtwbGFudC5mYW1pbHl9LCAke3BsYW50LmdlbnVzfSwgJHtwbGFudC5zcGVjaWVzfSwgTlVMTCwgJHtwbGFudC5jb21tb25OYW1lfSwgJHtwbGFudC5jYXJlSW5zdHJ1Y3Rpb25zfSwgJHtwbGFudC5pc1ZlcmlmaWVkfSlcbiAgICAgICAgICBPTiBDT05GTElDVCAoZmFtaWx5LCBnZW51cywgc3BlY2llcywgY3VsdGl2YXIpIERPIE5PVEhJTkdcbiAgICAgICAgYCk7XG4gICAgICB9XG5cbiAgICAgIGNvbnNvbGUubG9nKCdJbml0aWFsIGRhdGEgc2VlZGVkIHN1Y2Nlc3NmdWxseScpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gc2VlZCBpbml0aWFsIGRhdGE6JywgZXJyb3IpO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdGYWlsZWQgdG8gc2VlZCBpbml0aWFsIGRhdGEnKTtcbiAgICB9XG4gIH1cblxuICAvLyBEYXRhYmFzZSBoZWFsdGggY2hlY2tcbiAgc3RhdGljIGFzeW5jIGhlYWx0aENoZWNrKCk6IFByb21pc2U8e1xuICAgIGNvbm5lY3RlZDogYm9vbGVhbjtcbiAgICBtaWdyYXRpb25zQXBwbGllZDogYm9vbGVhbjtcbiAgICBybHNFbmFibGVkOiBib29sZWFuO1xuICAgIHRhYmxlc0V4aXN0OiBib29sZWFuO1xuICB9PiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIENoZWNrIGNvbm5lY3Rpb25cbiAgICAgIGNvbnN0IGNvbm5lY3RlZCA9IGF3YWl0IGRiLmV4ZWN1dGUoc3FsYFNFTEVDVCAxYCkudGhlbigoKSA9PiB0cnVlKS5jYXRjaCgoKSA9PiBmYWxzZSk7XG4gICAgICBcbiAgICAgIC8vIENoZWNrIGlmIG1pZ3JhdGlvbnMgdGFibGUgZXhpc3RzXG4gICAgICBjb25zdCBbbWlncmF0aW9uVGFibGVdID0gYXdhaXQgZGIuZXhlY3V0ZShzcWxgXG4gICAgICAgIFNFTEVDVCBFWElTVFMgKFxuICAgICAgICAgIFNFTEVDVCBGUk9NIGluZm9ybWF0aW9uX3NjaGVtYS50YWJsZXMgXG4gICAgICAgICAgV0hFUkUgdGFibGVfbmFtZSA9ICdfX2RyaXp6bGVfbWlncmF0aW9ucydcbiAgICAgICAgKSBhcyBleGlzdHNcbiAgICAgIGApO1xuICAgICAgY29uc3QgbWlncmF0aW9uc0FwcGxpZWQgPSBCb29sZWFuKG1pZ3JhdGlvblRhYmxlPy5leGlzdHMpIHx8IGZhbHNlO1xuXG4gICAgICAvLyBDaGVjayBpZiBtYWluIHRhYmxlcyBleGlzdCAoaW5jbHVkaW5nIGVtYWlsIHZlcmlmaWNhdGlvbilcbiAgICAgIGNvbnN0IFt0YWJsZXNDaGVja10gPSBhd2FpdCBkYi5leGVjdXRlKHNxbGBcbiAgICAgICAgU0VMRUNUIFxuICAgICAgICAgIChTRUxFQ1QgQ09VTlQoKikgRlJPTSBpbmZvcm1hdGlvbl9zY2hlbWEudGFibGVzIFdIRVJFIHRhYmxlX25hbWUgSU4gKCd1c2VycycsICdwbGFudHMnLCAncGxhbnRfaW5zdGFuY2VzJywgJ3Byb3BhZ2F0aW9ucycsICdzZXNzaW9ucycsICdlbWFpbF92ZXJpZmljYXRpb25fY29kZXMnKSkgYXMgdGFibGVfY291bnRcbiAgICAgIGApO1xuICAgICAgY29uc3QgdGFibGVzRXhpc3QgPSBOdW1iZXIodGFibGVzQ2hlY2s/LnRhYmxlX2NvdW50KSA9PT0gNjtcblxuICAgICAgLy8gQ2hlY2sgaWYgUkxTIGlzIGVuYWJsZWQgb24gdXNlciB0YWJsZXNcbiAgICAgIGNvbnN0IFtybHNDaGVja10gPSBhd2FpdCBkYi5leGVjdXRlKHNxbGBcbiAgICAgICAgU0VMRUNUIENPVU5UKCopIGFzIHJsc19jb3VudFxuICAgICAgICBGUk9NIHBnX2NsYXNzIGNcbiAgICAgICAgSk9JTiBwZ19uYW1lc3BhY2UgbiBPTiBuLm9pZCA9IGMucmVsbmFtZXNwYWNlXG4gICAgICAgIFdIRVJFIGMucmVscm93c2VjdXJpdHkgPSB0cnVlIFxuICAgICAgICBBTkQgbi5uc3BuYW1lID0gJ3B1YmxpYydcbiAgICAgICAgQU5EIGMucmVsbmFtZSBJTiAoJ3BsYW50X2luc3RhbmNlcycsICdwcm9wYWdhdGlvbnMnLCAnc2Vzc2lvbnMnLCAnY2FyZV9oaXN0b3J5JywgJ2NhcmVfZ3VpZGVzJywgJ2VtYWlsX3ZlcmlmaWNhdGlvbl9jb2RlcycpXG4gICAgICBgKTtcbiAgICAgIGNvbnN0IHJsc0VuYWJsZWQgPSBOdW1iZXIocmxzQ2hlY2s/LnJsc19jb3VudCkgPT09IDY7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIGNvbm5lY3RlZCxcbiAgICAgICAgbWlncmF0aW9uc0FwcGxpZWQsXG4gICAgICAgIHJsc0VuYWJsZWQsXG4gICAgICAgIHRhYmxlc0V4aXN0XG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdIZWFsdGggY2hlY2sgZmFpbGVkOicsIGVycm9yKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGNvbm5lY3RlZDogZmFsc2UsXG4gICAgICAgIG1pZ3JhdGlvbnNBcHBsaWVkOiBmYWxzZSxcbiAgICAgICAgcmxzRW5hYmxlZDogZmFsc2UsXG4gICAgICAgIHRhYmxlc0V4aXN0OiBmYWxzZVxuICAgICAgfTtcbiAgICB9XG4gIH1cbn0iXSwibmFtZXMiOlsiTWlncmF0aW9uVXRpbHMiLCJydW5NaWdyYXRpb25zIiwiY29uc29sZSIsImxvZyIsImRiIiwiZXhlY3V0ZSIsInNxbCIsIm1pZ3JhdGlvbnNQYXRoIiwicGF0aCIsImpvaW4iLCJwcm9jZXNzIiwiY3dkIiwiZnMiLCJleGlzdHNTeW5jIiwiZmlsZXMiLCJyZWFkZGlyU3luYyIsInNxbEZpbGVzIiwiZmlsdGVyIiwiZmlsZSIsImVuZHNXaXRoIiwiaW5jbHVkZXMiLCJzb3J0IiwiZmlsZVBhdGgiLCJtaWdyYXRpb25TUUwiLCJyZWFkRmlsZVN5bmMiLCJleGlzdGluZyIsIk51bWJlciIsImNvdW50Iiwic3RhdGVtZW50cyIsInNwbGl0IiwibWFwIiwic3RtdCIsInRyaW0iLCJsZW5ndGgiLCJzdGFydHNXaXRoIiwic3RhdGVtZW50IiwiY2xlYW5TdGF0ZW1lbnQiLCJyYXciLCJEYXRlIiwibm93IiwiZXJyb3IiLCJFcnJvciIsImFwcGx5UkxTUG9saWNpZXMiLCJybHNQYXRoIiwicmxzU1FMIiwibWF0Y2giLCJtZXNzYWdlIiwic3Vic3RyaW5nIiwid2FybiIsInJvbGxiYWNrTGFzdE1pZ3JhdGlvbiIsImdldE1pZ3JhdGlvblN0YXR1cyIsImFwcGxpZWRSZXN1bHRzIiwiYXBwbGllZE1pZ3JhdGlvbnMiLCJhcHBsaWVkSGFzaGVzIiwiU2V0IiwiciIsImhhc2giLCJwZW5kaW5nTWlncmF0aW9ucyIsImhhcyIsInB1c2giLCJzZWVkSW5pdGlhbERhdGEiLCJ1c2VyQ291bnQiLCJjb21tb25QbGFudHMiLCJmYW1pbHkiLCJnZW51cyIsInNwZWNpZXMiLCJjb21tb25OYW1lIiwiY2FyZUluc3RydWN0aW9ucyIsImlzVmVyaWZpZWQiLCJwbGFudCIsImhlYWx0aENoZWNrIiwiY29ubmVjdGVkIiwidGhlbiIsImNhdGNoIiwibWlncmF0aW9uVGFibGUiLCJtaWdyYXRpb25zQXBwbGllZCIsIkJvb2xlYW4iLCJleGlzdHMiLCJ0YWJsZXNDaGVjayIsInRhYmxlc0V4aXN0IiwidGFibGVfY291bnQiLCJybHNDaGVjayIsInJsc0VuYWJsZWQiLCJybHNfY291bnQiXSwibWFwcGluZ3MiOiI7Ozs7K0JBUWFBOzs7ZUFBQUE7OztRQVJOO3VCQUVZOzRCQUNDOzJEQUNMOzZEQUNFOzs7Ozs7QUFHVixNQUFNQTtJQUNYLDZCQUE2QjtJQUM3Qixh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