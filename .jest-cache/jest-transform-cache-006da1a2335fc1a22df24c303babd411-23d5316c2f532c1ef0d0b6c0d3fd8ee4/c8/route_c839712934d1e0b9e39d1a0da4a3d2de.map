{"version":3,"names":["cov_1fc4pd2a28","actualCoverage","s","POST","request","f","_middleware","withRateLimit","req","body","json","validation","_validation","validateInput","signUpSchema","success","b","_server","NextResponse","error","errors","status","email","password","name","data","result","_auth","signUp","_server1","setSessionCookie","session","id","user","console","Error","message"],"sources":["/Users/stefanbekker/projects/fancy-planties/src/app/api/auth/signup/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { signUp } from '@/lib/auth';\nimport { setSessionCookie } from '@/lib/auth/server';\nimport { signUpSchema, validateInput } from '@/lib/auth/validation';\nimport { withRateLimit } from '@/lib/auth/middleware';\n\nexport async function POST(request: NextRequest) {\n  return withRateLimit(request, async (req) => {\n    try {\n      const body = await req.json();\n      \n      // Validate input\n      const validation = validateInput(signUpSchema, body);\n      if (!validation.success) {\n        return NextResponse.json(\n          { error: 'Validation failed', errors: validation.errors },\n          { status: 400 }\n        );\n      }\n      \n      const { email, password, name } = validation.data;\n      \n      // Attempt to sign up\n      const result = await signUp(email, password, name);\n      \n      // Set session cookie\n      await setSessionCookie(result.session.id);\n      \n      return NextResponse.json({\n        success: true,\n        user: {\n          id: result.user.id,\n          email: result.user.email,\n          name: result.user.name,\n        },\n      });\n      \n    } catch (error) {\n      console.error('Sign up error:', error);\n      \n      if (error instanceof Error && error.message === 'User already exists') {\n        return NextResponse.json(\n          { error: 'An account with this email already exists' },\n          { status: 409 }\n        );\n      }\n      \n      return NextResponse.json(\n        { error: 'Internal server error' },\n        { status: 500 }\n      );\n    }\n  });\n}"],"mappings":"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","ignoreList":[]}